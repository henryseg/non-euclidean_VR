import*as e from"three";var t={9397:(e,t)=>{!function(e){var t=/\S/,n=/\"/g,r=/\n/g,i=/\r/g,s=/\\/g,o=/\u2028/,a=/\u2029/;function l(e){"}"===e.n.substr(e.n.length-1)&&(e.n=e.n.substring(0,e.n.length-1))}function c(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function d(e,t,n){if(t.charAt(n)!=e.charAt(0))return!1;for(var r=1,i=e.length;r<i;r++)if(t.charAt(n+r)!=e.charAt(r))return!1;return!0}e.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},e.scan=function(n,r){var i=n.length,s=0,o=null,a=null,h="",u=[],p=!1,m=0,f=0,b="{{",v="}}";function g(){h.length>0&&(u.push({tag:"_t",text:new String(h)}),h="")}function A(n,r){if(g(),n&&function(){for(var n=!0,r=f;r<u.length;r++)if(!(n=e.tags[u[r].tag]<e.tags._v||"_t"==u[r].tag&&null===u[r].text.match(t)))return!1;return n}())for(var i,s=f;s<u.length;s++)u[s].text&&((i=u[s+1])&&">"==i.tag&&(i.indent=u[s].text.toString()),u.splice(s,1));else r||u.push({tag:"\n"});p=!1,f=u.length}function y(e,t){var n="="+v,r=e.indexOf(n,t),i=c(e.substring(e.indexOf("=",t)+1,r)).split(" ");return b=i[0],v=i[i.length-1],r+n.length-1}for(r&&(r=r.split(" "),b=r[0],v=r[1]),m=0;m<i;m++)0==s?d(b,n,m)?(--m,g(),s=1):"\n"==n.charAt(m)?A(p):h+=n.charAt(m):1==s?(m+=b.length-1,"="==(o=(a=e.tags[n.charAt(m+1)])?n.charAt(m+1):"_v")?(m=y(n,m),s=0):(a&&m++,s=2),p=m):d(v,n,m)?(u.push({tag:o,n:c(h),otag:b,ctag:v,i:"/"==o?p-b.length:m+v.length}),h="",m+=v.length-1,s=0,"{"==o&&("}}"==v?m++:l(u[u.length-1]))):h+=n.charAt(m);return A(p,!0),u};var h={_t:!0,"\n":!0,$:!0,"/":!0};function u(t,n,r,i){var s,o=[],a=null,l=null;for(s=r[r.length-1];t.length>0;){if(l=t.shift(),s&&"<"==s.tag&&!(l.tag in h))throw new Error("Illegal content in < super tag.");if(e.tags[l.tag]<=e.tags.$||p(l,i))r.push(l),l.nodes=u(t,l.tag,r,i);else{if("/"==l.tag){if(0===r.length)throw new Error("Closing tag without opener: /"+l.n);if(a=r.pop(),l.n!=a.n&&!m(l.n,a.n,i))throw new Error("Nesting error: "+a.n+" vs. "+l.n);return a.end=l.i,o}"\n"==l.tag&&(l.last=0==t.length||"\n"==t[0].tag)}o.push(l)}if(r.length>0)throw new Error("missing closing tag: "+r.pop().n);return o}function p(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n].o==e.n)return e.tag="#",!0}function m(e,t,n){for(var r=0,i=n.length;r<i;r++)if(n[r].c==e&&n[r].o==t)return!0}function f(e){var t=[];for(var n in e.partials)t.push('"'+v(n)+'":{name:"'+v(e.partials[n].name)+'", '+f(e.partials[n])+"}");return"partials: {"+t.join(",")+"}, subs: "+function(e){var t=[];for(var n in e)t.push('"'+v(n)+'": function(c,p,t,i) {'+e[n]+"}");return"{ "+t.join(",")+" }"}(e.subs)}e.stringify=function(t,n,r){return"{code: function (c,p,i) { "+e.wrapMain(t.code)+" },"+f(t)+"}"};var b=0;function v(e){return e.replace(s,"\\\\").replace(n,'\\"').replace(r,"\\n").replace(i,"\\r").replace(o,"\\u2028").replace(a,"\\u2029")}function g(e){return~e.indexOf(".")?"d":"f"}function A(e,t){var n="<"+(t.prefix||"")+e.n+b++;return t.partials[n]={name:e.n,partials:{}},t.code+='t.b(t.rp("'+v(n)+'",c,p,"'+(e.indent||"")+'"));',n}function y(e,t){t.code+="t.b(t.t(t."+g(e.n)+'("'+v(e.n)+'",c,p,0)));'}function w(e){return"t.b("+e+");"}e.generate=function(t,n,r){b=0;var i={code:"",subs:{},partials:{}};return e.walk(t,i),r.asString?this.stringify(i,n,r):this.makeTemplate(i,n,r)},e.wrapMain=function(e){return'var t=this;t.b(i=i||"");'+e+"return t.fl();"},e.template=e.Template,e.makeTemplate=function(e,t,n){var r=this.makePartials(e);return r.code=new Function("c","p","i",this.wrapMain(e.code)),new this.template(r,t,this,n)},e.makePartials=function(e){var t,n={subs:{},partials:e.partials,name:e.name};for(t in n.partials)n.partials[t]=this.makePartials(n.partials[t]);for(t in e.subs)n.subs[t]=new Function("c","p","t","i",e.subs[t]);return n},e.codegen={"#":function(t,n){n.code+="if(t.s(t."+g(t.n)+'("'+v(t.n)+'",c,p,1),c,p,0,'+t.i+","+t.end+',"'+t.otag+" "+t.ctag+'")){t.rs(c,p,function(c,p,t){',e.walk(t.nodes,n),n.code+="});c.pop();}"},"^":function(t,n){n.code+="if(!t.s(t."+g(t.n)+'("'+v(t.n)+'",c,p,1),c,p,1,0,0,"")){',e.walk(t.nodes,n),n.code+="};"},">":A,"<":function(t,n){var r={partials:{},code:"",subs:{},inPartial:!0};e.walk(t.nodes,r);var i=n.partials[A(t,n)];i.subs=r.subs,i.partials=r.partials},$:function(t,n){var r={subs:{},code:"",partials:n.partials,prefix:t.n};e.walk(t.nodes,r),n.subs[t.n]=r.code,n.inPartial||(n.code+='t.sub("'+v(t.n)+'",c,p,i);')},"\n":function(e,t){t.code+=w('"\\n"'+(e.last?"":" + i"))},_v:function(e,t){t.code+="t.b(t.v(t."+g(e.n)+'("'+v(e.n)+'",c,p,0)));'},_t:function(e,t){t.code+=w('"'+v(e.text)+'"')},"{":y,"&":y},e.walk=function(t,n){for(var r,i=0,s=t.length;i<s;i++)(r=e.codegen[t[i].tag])&&r(t[i],n);return n},e.parse=function(e,t,n){return u(e,0,[],(n=n||{}).sectionTags||[])},e.cache={},e.cacheKey=function(e,t){return[e,!!t.asString,!!t.disableLambda,t.delimiters,!!t.modelGet].join("||")},e.compile=function(t,n){n=n||{};var r=e.cacheKey(t,n),i=this.cache[r];if(i){var s=i.partials;for(var o in s)delete s[o].instance;return i}return i=this.generate(this.parse(this.scan(t,n.delimiters),t,n),t,n),this.cache[r]=i}}(t)},5485:(e,t,n)=>{var r=n(9397);r.Template=n(2882).Template,r.template=r.Template,e.exports=r},2882:(e,t)=>{!function(e){function t(e,t,n){var r;return t&&"object"==typeof t&&(void 0!==t[e]?r=t[e]:n&&t.get&&"function"==typeof t.get&&(r=t.get(e))),r}e.Template=function(e,t,n,r){e=e||{},this.r=e.code||this.r,this.c=n,this.options=r||{},this.text=t||"",this.partials=e.partials||{},this.subs=e.subs||{},this.buf=""},e.Template.prototype={r:function(e,t,n){return""},v:function(e){return e=l(e),a.test(e)?e.replace(n,"&amp;").replace(r,"&lt;").replace(i,"&gt;").replace(s,"&#39;").replace(o,"&quot;"):e},t:l,render:function(e,t,n){return this.ri([e],t||{},n)},ri:function(e,t,n){return this.r(e,t,n)},ep:function(e,t){var n=this.partials[e],r=t[n.name];if(n.instance&&n.base==r)return n.instance;if("string"==typeof r){if(!this.c)throw new Error("No compiler available.");r=this.c.compile(r,this.options)}if(!r)return null;if(this.partials[e].base=r,n.subs){for(key in t.stackText||(t.stackText={}),n.subs)t.stackText[key]||(t.stackText[key]=void 0!==this.activeSub&&t.stackText[this.activeSub]?t.stackText[this.activeSub]:this.text);r=function(e,t,n,r,i,s){function o(){}function a(){}var l;o.prototype=e,a.prototype=e.subs;var c=new o;for(l in c.subs=new a,c.subsText={},c.buf="",r=r||{},c.stackSubs=r,c.subsText=s,t)r[l]||(r[l]=t[l]);for(l in r)c.subs[l]=r[l];for(l in i=i||{},c.stackPartials=i,n)i[l]||(i[l]=n[l]);for(l in i)c.partials[l]=i[l];return c}(r,n.subs,n.partials,this.stackSubs,this.stackPartials,t.stackText)}return this.partials[e].instance=r,r},rp:function(e,t,n,r){var i=this.ep(e,n);return i?i.ri(t,n,r):""},rs:function(e,t,n){var r=e[e.length-1];if(c(r))for(var i=0;i<r.length;i++)e.push(r[i]),n(e,t,this),e.pop();else n(e,t,this)},s:function(e,t,n,r,i,s,o){var a;return(!c(e)||0!==e.length)&&("function"==typeof e&&(e=this.ms(e,t,n,r,i,s,o)),a=!!e,!r&&a&&t&&t.push("object"==typeof e?e:t[t.length-1]),a)},d:function(e,n,r,i){var s,o=e.split("."),a=this.f(o[0],n,r,i),l=this.options.modelGet,d=null;if("."===e&&c(n[n.length-2]))a=n[n.length-1];else for(var h=1;h<o.length;h++)void 0!==(s=t(o[h],a,l))?(d=a,a=s):a="";return!(i&&!a)&&(i||"function"!=typeof a||(n.push(d),a=this.mv(a,n,r),n.pop()),a)},f:function(e,n,r,i){for(var s=!1,o=!1,a=this.options.modelGet,l=n.length-1;l>=0;l--)if(void 0!==(s=t(e,n[l],a))){o=!0;break}return o?(i||"function"!=typeof s||(s=this.mv(s,n,r)),s):!i&&""},ls:function(e,t,n,r,i){var s=this.options.delimiters;return this.options.delimiters=i,this.b(this.ct(l(e.call(t,r)),t,n)),this.options.delimiters=s,!1},ct:function(e,t,n){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(e,this.options).render(t,n)},b:function(e){this.buf+=e},fl:function(){var e=this.buf;return this.buf="",e},ms:function(e,t,n,r,i,s,o){var a,l=t[t.length-1],c=e.call(l);return"function"==typeof c?!!r||(a=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(c,l,n,a.substring(i,s),o)):c},mv:function(e,t,n){var r=t[t.length-1],i=e.call(r);return"function"==typeof i?this.ct(l(i.call(r)),r,n):i},sub:function(e,t,n,r){var i=this.subs[e];i&&(this.activeSub=e,i(t,n,this,r),this.activeSub=!1)}};var n=/&/g,r=/</g,i=/>/g,s=/\'/g,o=/\"/g,a=/[&<>\"\']/;function l(e){return String(null==e?"":e)}var c=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}}(t)},9606:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("RayType "),r.b(r.v(r.f("name",e,t,0))),r.b("_setRayType(ExtVector v, RelVector n,float r) {"),r.b("\n"+n),r.b("    return setRayType("),r.b(r.v(r.f("name",e,t,0))),r.b(", v, n, r);"),r.b("\n"+n),r.b("}"),r.b("\n"),r.b("\n"+n),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, RelVector normal, RayType rayType) {"),r.b("\n"+n),r.b("    return render("),r.b(r.v(r.f("name",e,t,0))),r.b(", v, rayType);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"RayType {{name}}_setRayType(ExtVector v, RelVector n,float r) {\n    return setRayType({{name}}, v, n, r);\n}\n\nvec3 {{name}}_render(ExtVector v, RelVector normal, RayType rayType) {\n    return render({{name}}, v, rayType);\n}",r);return e.render.apply(e,arguments)}},9909:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v) {"),r.b("\n"+n),r.b("    return vec3(0, float(v.data.iMarch/camera.maxSteps), v.data.totalDist / camera.maxDist);"),r.b("\n"+n),r.b("    //return debugColor;"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v) {\n    return vec3(0, float(v.data.iMarch/camera.maxSteps), v.data.totalDist / camera.maxDist);\n    //return debugColor;\n}",r);return e.render.apply(e,arguments)}},6077:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, RelVector normal) {"),r.b("\n"+n),r.b("    return normalMaterialRender(v, normal);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v, RelVector normal) {\n    return normalMaterialRender(v, normal);\n}",r);return e.render.apply(e,arguments)}},1202:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("RayType "),r.b(r.v(r.f("name",e,t,0))),r.b("_setRayType(ExtVector v, RelVector n,float r) {"),r.b("\n"+n),r.b("    return setRayType("),r.b(r.v(r.f("name",e,t,0))),r.b(", v, n,r);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"RayType {{name}}_setRayType(ExtVector v, RelVector n,float r) {\n    return setRayType({{name}}, v, n,r);\n}",r);return e.render.apply(e,arguments)}},2330:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, RelVector normal, RayType rayType) {"),r.b("\n"+n),r.b("    if (rayType.reflect){"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.f("name",e,t,0))),r.b(".specular;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    return "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v, RelVector normal, RayType rayType) {\n    if (rayType.reflect){\n        return {{name}}.specular;\n    }\n    return {{material.name}}_render(v);\n}",r);return e.render.apply(e,arguments)}},9040:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, RelVector normal, RayType rayType) {"),r.b("\n"+n),r.b("    if (rayType.reflect){"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.f("name",e,t,0))),r.b(".specular;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    return "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, normal);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v, RelVector normal, RayType rayType) {\n    if (rayType.reflect){\n        return {{name}}.specular;\n    }\n    return {{material.name}}_render(v, normal);\n}",r);return e.render.apply(e,arguments)}},588:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, RelVector normal, vec2 uv, RayType rayType) {"),r.b("\n"+n),r.b("    if (rayType.reflect){"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.f("name",e,t,0))),r.b(".specular;   "),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    return "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, normal, uv);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v, RelVector normal, vec2 uv, RayType rayType) {\n    if (rayType.reflect){\n        return {{name}}.specular;   \n    }\n    return {{material.name}}_render(v, normal, uv);\n}",r);return e.render.apply(e,arguments)}},1365:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, RelVector normal, vec2 uv, RayType rayType) {"),r.b("\n"+n),r.b("    if (rayType.reflect){"),r.b("\n"+n),r.b("      return "),r.b(r.v(r.f("name",e,t,0))),r.b(".specular;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    return "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, uv);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v, RelVector normal, vec2 uv, RayType rayType) {\n    if (rayType.reflect){\n      return {{name}}.specular;\n    }\n    return {{material.name}}_render(v, uv);\n}",r);return e.render.apply(e,arguments)}},8149:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, RelVector normal) {"),r.b("\n"+n),r.b("    bool check;"),r.b("\n"+n),r.b("    RelVector dir;"),r.b("\n"+n),r.b("    float intensity;"),r.b("\n"+n),r.b("    int k;"),r.b("\n"+n),r.b(" "),r.b("\n"+n),r.b("    PhongMaterial material = "),r.b(r.v(r.f("name",e,t,0))),r.b(";"),r.b("\n"+n),r.b("    vec3 color = vec3(0);"),r.b("\n"),r.b("\n"+n),r.s(r.f("lights",e,t,1),e,t,0,204,519,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("        k = "),r.b(r.v(r.f("name",e,t,0))),r.b(".maxDirs;"),r.b("\n"+n),r.b("        for(int j=0; j < k; j++){"),r.b("\n"+n),r.b("            check = "),r.b(r.v(r.f("name",e,t,0))),r.b("_directions(v.vector, j, dir, intensity);"),r.b("\n"+n),r.b("            if(check) {"),r.b("\n"+n),r.b("                color = color + lightComputation(v.vector.local, normal.local, dir.local, material, "),r.b(r.v(r.f("name",e,t,0))),r.b(".color, intensity);"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("        }"),r.b("\n"+n)})),e.pop()),r.b("    "),r.b("\n"+n),r.b("    return color;"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v, RelVector normal) {\n    bool check;\n    RelVector dir;\n    float intensity;\n    int k;\n \n    PhongMaterial material = {{name}};\n    vec3 color = vec3(0);\n\n    {{#lights}}\n        k = {{name}}.maxDirs;\n        for(int j=0; j < k; j++){\n            check = {{name}}_directions(v.vector, j, dir, intensity);\n            if(check) {\n                color = color + lightComputation(v.vector.local, normal.local, dir.local, material, {{name}}.color, intensity);\n            }\n        }\n    {{/lights}}\n    \n    return color;\n}",r);return e.render.apply(e,arguments)}},3838:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, RelVector normal) {"),r.b("\n"+n),r.b("    bool check;"),r.b("\n"+n),r.b("    RelVector dir;"),r.b("\n"+n),r.b("    float intensity;"),r.b("\n"+n),r.b("    int k;"),r.b("\n"),r.b("\n"+n),r.b("    PhongWrapMaterial material = "),r.b(r.v(r.f("name",e,t,0))),r.b(";"),r.b("\n"+n),r.b("    vec3 baseColor = "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v);"),r.b("\n"+n),r.b("    vec3 color = vec3(0);"),r.b("\n"),r.b("\n"+n),r.s(r.f("lights",e,t,1),e,t,0,257,583,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("        k = "),r.b(r.v(r.f("name",e,t,0))),r.b(".maxDirs;"),r.b("\n"+n),r.b("        for(int j=0; j < k; j++){"),r.b("\n"+n),r.b("            check = "),r.b(r.v(r.f("name",e,t,0))),r.b("_directions(v.vector, j, dir, intensity);"),r.b("\n"+n),r.b("            if(check) {"),r.b("\n"+n),r.b("                color = color + lightComputation(v.vector.local, normal.local, dir.local, baseColor, material, "),r.b(r.v(r.f("name",e,t,0))),r.b(".color, intensity);"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("        }"),r.b("\n"+n)})),e.pop()),r.b("    "),r.b("\n"+n),r.b("    return color;"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v, RelVector normal) {\n    bool check;\n    RelVector dir;\n    float intensity;\n    int k;\n\n    PhongWrapMaterial material = {{name}};\n    vec3 baseColor = {{material.name}}_render(v);\n    vec3 color = vec3(0);\n\n    {{#lights}}\n        k = {{name}}.maxDirs;\n        for(int j=0; j < k; j++){\n            check = {{name}}_directions(v.vector, j, dir, intensity);\n            if(check) {\n                color = color + lightComputation(v.vector.local, normal.local, dir.local, baseColor, material, {{name}}.color, intensity);\n            }\n        }\n    {{/lights}}\n    \n    return color;\n}",r);return e.render.apply(e,arguments)}},472:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, RelVector normal) {"),r.b("\n"+n),r.b("    bool check;"),r.b("\n"+n),r.b("    RelVector dir;"),r.b("\n"+n),r.b("    float intensity;"),r.b("\n"+n),r.b("    int k;"),r.b("\n"),r.b("\n"+n),r.b("    PhongWrapMaterial material = "),r.b(r.v(r.f("name",e,t,0))),r.b(";"),r.b("\n"+n),r.b("    vec3 baseColor = "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, normal);"),r.b("\n"+n),r.b("    vec3 color = vec3(0);"),r.b("\n"),r.b("\n"+n),r.s(r.f("lights",e,t,1),e,t,0,265,591,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("        k = "),r.b(r.v(r.f("name",e,t,0))),r.b(".maxDirs;"),r.b("\n"+n),r.b("        for(int j=0; j < k; j++){"),r.b("\n"+n),r.b("            check = "),r.b(r.v(r.f("name",e,t,0))),r.b("_directions(v.vector, j, dir, intensity);"),r.b("\n"+n),r.b("            if(check) {"),r.b("\n"+n),r.b("                color = color + lightComputation(v.vector.local, normal.local, dir.local, baseColor, material, "),r.b(r.v(r.f("name",e,t,0))),r.b(".color, intensity);"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("        }"),r.b("\n"+n)})),e.pop()),r.b("    "),r.b("\n"+n),r.b("    return color;"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v, RelVector normal) {\n    bool check;\n    RelVector dir;\n    float intensity;\n    int k;\n\n    PhongWrapMaterial material = {{name}};\n    vec3 baseColor = {{material.name}}_render(v, normal);\n    vec3 color = vec3(0);\n\n    {{#lights}}\n        k = {{name}}.maxDirs;\n        for(int j=0; j < k; j++){\n            check = {{name}}_directions(v.vector, j, dir, intensity);\n            if(check) {\n                color = color + lightComputation(v.vector.local, normal.local, dir.local, baseColor, material, {{name}}.color, intensity);\n            }\n        }\n    {{/lights}}\n    \n    return color;\n}",r);return e.render.apply(e,arguments)}},7660:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, RelVector normal, vec2 uv) {"),r.b("\n"+n),r.b("    bool check;"),r.b("\n"+n),r.b("    RelVector dir;"),r.b("\n"+n),r.b("    float intensity;"),r.b("\n"+n),r.b("    int k;"),r.b("\n"),r.b("\n"+n),r.b("    PhongWrapMaterial material = "),r.b(r.v(r.f("name",e,t,0))),r.b(";"),r.b("\n"+n),r.b("    vec3 baseColor = "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, normal, uv);"),r.b("\n"+n),r.b("    vec3 color = vec3(0);"),r.b("\n"),r.b("\n"+n),r.s(r.f("lights",e,t,1),e,t,0,278,604,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("        k = "),r.b(r.v(r.f("name",e,t,0))),r.b(".maxDirs;"),r.b("\n"+n),r.b("        for(int j=0; j < k; j++){"),r.b("\n"+n),r.b("            check = "),r.b(r.v(r.f("name",e,t,0))),r.b("_directions(v.vector, j, dir, intensity);"),r.b("\n"+n),r.b("            if(check) {"),r.b("\n"+n),r.b("                color = color + lightComputation(v.vector.local, normal.local, dir.local, baseColor, material, "),r.b(r.v(r.f("name",e,t,0))),r.b(".color, intensity);"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("        }"),r.b("\n"+n)})),e.pop()),r.b("}"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v, RelVector normal, vec2 uv) {\n    bool check;\n    RelVector dir;\n    float intensity;\n    int k;\n\n    PhongWrapMaterial material = {{name}};\n    vec3 baseColor = {{material.name}}_render(v, normal, uv);\n    vec3 color = vec3(0);\n\n    {{#lights}}\n        k = {{name}}.maxDirs;\n        for(int j=0; j < k; j++){\n            check = {{name}}_directions(v.vector, j, dir, intensity);\n            if(check) {\n                color = color + lightComputation(v.vector.local, normal.local, dir.local, baseColor, material, {{name}}.color, intensity);\n            }\n        }\n    {{/lights}}\n}",r);return e.render.apply(e,arguments)}},8204:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, RelVector normal, vec2 uv) {"),r.b("\n"+n),r.b("    bool check;"),r.b("\n"+n),r.b("    RelVector dir;"),r.b("\n"+n),r.b("    float intensity;"),r.b("\n"+n),r.b("    int k;"),r.b("\n"+n),r.b(" "),r.b("\n"+n),r.b("    PhongWrapMaterial material = "),r.b(r.v(r.f("name",e,t,0))),r.b(";"),r.b("\n"+n),r.b("    vec3 baseColor = "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, uv);"),r.b("\n"+n),r.b("    vec3 color = vec3(0);"),r.b("\n"),r.b("\n"+n),r.s(r.f("lights",e,t,1),e,t,0,271,597,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("        k = "),r.b(r.v(r.f("name",e,t,0))),r.b(".maxDirs;"),r.b("\n"+n),r.b("        for(int j=0; j < k; j++){"),r.b("\n"+n),r.b("            check = "),r.b(r.v(r.f("name",e,t,0))),r.b("_directions(v.vector, j, dir, intensity);"),r.b("\n"+n),r.b("            if(check) {"),r.b("\n"+n),r.b("                color = color + lightComputation(v.vector.local, normal.local, dir.local, baseColor, material, "),r.b(r.v(r.f("name",e,t,0))),r.b(".color, intensity);"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("        }"),r.b("\n"+n)})),e.pop()),r.b("    "),r.b("\n"+n),r.b("    return color;"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v, RelVector normal, vec2 uv) {\n    bool check;\n    RelVector dir;\n    float intensity;\n    int k;\n \n    PhongWrapMaterial material = {{name}};\n    vec3 baseColor = {{material.name}}_render(v, uv);\n    vec3 color = vec3(0);\n\n    {{#lights}}\n        k = {{name}}.maxDirs;\n        for(int j=0; j < k; j++){\n            check = {{name}}_directions(v.vector, j, dir, intensity);\n            if(check) {\n                color = color + lightComputation(v.vector.local, normal.local, dir.local, baseColor, material, {{name}}.color, intensity);\n            }\n        }\n    {{/lights}}\n    \n    return color;\n}",r);return e.render.apply(e,arguments)}},6142:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * Gradient for the complement of a shape"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("RelVector "),r.b(r.v(r.f("name",e,t,0))),r.b("_gradient(RelVector v){"),r.b("\n"+n),r.b("    return negate("),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_gradient(v));"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * Gradient for the complement of a shape\n */\nRelVector {{name}}_gradient(RelVector v){\n    return negate({{shape.name}}_gradient(v));\n}",r);return e.render.apply(e,arguments)}},7939:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * SDF for the complement of a shape"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("float "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(RelVector v){"),r.b("\n"+n),r.b("    return - "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * SDF for the complement of a shape\n */\nfloat {{name}}_sdf(RelVector v){\n    return - {{shape.name}}_sdf(v);\n}",r);return e.render.apply(e,arguments)}},7260:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec2 "),r.b(r.v(r.f("name",e,t,0))),r.b("_uvMap(RelVector v){"),r.b("\n"+n),r.b("    return "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_uvMap(v);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec2 {{name}}_uvMap(RelVector v){\n    return {{shape.name}}_uvMap(v);\n}",r);return e.render.apply(e,arguments)}},6861:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * Gradient for the union of two shapes"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("RelVector "),r.b(r.v(r.f("name",e,t,0))),r.b("_gradient(RelVector v){"),r.b("\n"+n),r.b("    float dist1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    float dist2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    RelVector grad1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_gradient(v);"),r.b("\n"+n),r.b("    RelVector grad2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_gradient(v);"),r.b("\n"+n),r.b("    return gradientMaxPoly(dist1, dist2, grad1, grad2, "),r.b(r.v(r.f("name",e,t,0))),r.b(".maxCoeff);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * Gradient for the union of two shapes\n */\nRelVector {{name}}_gradient(RelVector v){\n    float dist1 = {{shape1.name}}_sdf(v);\n    float dist2 = {{shape2.name}}_sdf(v);\n    RelVector grad1 = {{shape1.name}}_gradient(v);\n    RelVector grad2 = {{shape2.name}}_gradient(v);\n    return gradientMaxPoly(dist1, dist2, grad1, grad2, {{name}}.maxCoeff);\n}",r);return e.render.apply(e,arguments)}},3335:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * Gradient for the intersection of two shapes"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("RelVector "),r.b(r.v(r.f("name",e,t,0))),r.b("_gradient(RelVector v){"),r.b("\n"+n),r.b("    float dist1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    float dist2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    if(dist1 > dist2){"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_gradient(v);"),r.b("\n"+n),r.b("    } else{"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_gradient(v);"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * Gradient for the intersection of two shapes\n */\nRelVector {{name}}_gradient(RelVector v){\n    float dist1 = {{shape1.name}}_sdf(v);\n    float dist2 = {{shape2.name}}_sdf(v);\n    if(dist1 > dist2){\n        return {{shape1.name}}_gradient(v);\n    } else{\n        return {{shape2.name}}_gradient(v);\n    }\n}",r);return e.render.apply(e,arguments)}},6428:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * SDF for the union of two shapes"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("float "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(RelVector v){"),r.b("\n"+n),r.b("    float dist1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    float dist2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    return smoothMaxPoly(dist1, dist2, "),r.b(r.v(r.f("name",e,t,0))),r.b(".maxCoeff);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * SDF for the union of two shapes\n */\nfloat {{name}}_sdf(RelVector v){\n    float dist1 = {{shape1.name}}_sdf(v);\n    float dist2 = {{shape2.name}}_sdf(v);\n    return smoothMaxPoly(dist1, dist2, {{name}}.maxCoeff);\n}",r);return e.render.apply(e,arguments)}},2076:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * SDF for the intersection of two shapes"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("float "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(RelVector v){"),r.b("\n"+n),r.b("    float dist1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    float dist2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    return max(dist1, dist2);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * SDF for the intersection of two shapes\n */\nfloat {{name}}_sdf(RelVector v){\n    float dist1 = {{shape1.name}}_sdf(v);\n    float dist2 = {{shape2.name}}_sdf(v);\n    return max(dist1, dist2);\n}",r);return e.render.apply(e,arguments)}},2905:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * UV Map for the intersection of two shapes"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("vec2 "),r.b(r.v(r.f("name",e,t,0))),r.b("_uvMap(RelVector v){"),r.b("\n"+n),r.b("    float dist1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    float dist2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    if(dist1 < dist2){"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_uvMap(v);"),r.b("\n"+n),r.b("    } else{"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_uvMap(v);"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * UV Map for the intersection of two shapes\n */\nvec2 {{name}}_uvMap(RelVector v){\n    float dist1 = {{shape1.name}}_sdf(v);\n    float dist2 = {{shape2.name}}_sdf(v);\n    if(dist1 < dist2){\n        return {{shape1.name}}_uvMap(v);\n    } else{\n        return {{shape2.name}}_uvMap(v);\n    }\n}",r);return e.render.apply(e,arguments)}},8655:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * Gradient for the union of two shapes"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("RelVector "),r.b(r.v(r.f("name",e,t,0))),r.b("_gradient(RelVector v){"),r.b("\n"+n),r.b("    float dist1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    float dist2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    RelVector grad1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_gradient(v);"),r.b("\n"+n),r.b("    RelVector grad2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_gradient(v);"),r.b("\n"+n),r.b("    return gradientMinPoly(dist1, dist2, grad1, grad2, "),r.b(r.v(r.f("name",e,t,0))),r.b(".minCoeff);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * Gradient for the union of two shapes\n */\nRelVector {{name}}_gradient(RelVector v){\n    float dist1 = {{shape1.name}}_sdf(v);\n    float dist2 = {{shape2.name}}_sdf(v);\n    RelVector grad1 = {{shape1.name}}_gradient(v);\n    RelVector grad2 = {{shape2.name}}_gradient(v);\n    return gradientMinPoly(dist1, dist2, grad1, grad2, {{name}}.minCoeff);\n}",r);return e.render.apply(e,arguments)}},7762:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * Gradient for the union of two shapes"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("RelVector "),r.b(r.v(r.f("name",e,t,0))),r.b("_gradient(RelVector v){"),r.b("\n"+n),r.b("    float dist1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    float dist2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    if(dist1 < dist2){"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_gradient(v);"),r.b("\n"+n),r.b("    } else{"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_gradient(v);"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * Gradient for the union of two shapes\n */\nRelVector {{name}}_gradient(RelVector v){\n    float dist1 = {{shape1.name}}_sdf(v);\n    float dist2 = {{shape2.name}}_sdf(v);\n    if(dist1 < dist2){\n        return {{shape1.name}}_gradient(v);\n    } else{\n        return {{shape2.name}}_gradient(v);\n    }\n}",r);return e.render.apply(e,arguments)}},3238:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * SDF for the union of two shapes"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("float "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(RelVector v){"),r.b("\n"+n),r.b("    float dist1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    float dist2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    return smoothMinPoly(dist1, dist2, "),r.b(r.v(r.f("name",e,t,0))),r.b(".minCoeff);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * SDF for the union of two shapes\n */\nfloat {{name}}_sdf(RelVector v){\n    float dist1 = {{shape1.name}}_sdf(v);\n    float dist2 = {{shape2.name}}_sdf(v);\n    return smoothMinPoly(dist1, dist2, {{name}}.minCoeff);\n}",r);return e.render.apply(e,arguments)}},3908:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * SDF for the union of two shapes"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("float "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(RelVector v){"),r.b("\n"+n),r.b("    float dist1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    float dist2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    return min(dist1, dist2);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * SDF for the union of two shapes\n */\nfloat {{name}}_sdf(RelVector v){\n    float dist1 = {{shape1.name}}_sdf(v);\n    float dist2 = {{shape2.name}}_sdf(v);\n    return min(dist1, dist2);\n}",r);return e.render.apply(e,arguments)}},7500:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * UV Map for the intersection of two shapes"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("vec2 "),r.b(r.v(r.f("name",e,t,0))),r.b("_uvMap(RelVector v){"),r.b("\n"+n),r.b("    float dist1 = "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    float dist2 = "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    if(dist1 > dist2){"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.d("shape1.name",e,t,0))),r.b("_uvMap(v);"),r.b("\n"+n),r.b("    } else{"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.d("shape2.name",e,t,0))),r.b("_uvMap(v);"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * UV Map for the intersection of two shapes\n */\nvec2 {{name}}_uvMap(RelVector v){\n    float dist1 = {{shape1.name}}_sdf(v);\n    float dist2 = {{shape2.name}}_sdf(v);\n    if(dist1 > dist2){\n        return {{shape1.name}}_uvMap(v);\n    } else{\n        return {{shape2.name}}_uvMap(v);\n    }\n}",r);return e.render.apply(e,arguments)}},6242:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * Gradient for a wrapping"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("RelVector "),r.b(r.v(r.f("name",e,t,0))),r.b("_gradient(RelVector v){"),r.b("\n"+n),r.b("    return "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_gradient(v);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * Gradient for a wrapping\n */\nRelVector {{name}}_gradient(RelVector v){\n    return {{shape.name}}_gradient(v);\n}",r);return e.render.apply(e,arguments)}},3105:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * SDF for a wrapping"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("float "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(RelVector v){"),r.b("\n"+n),r.b("    float wrap = "),r.b(r.v(r.d("wrap.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    if(wrap > camera.threshold){"),r.b("\n"+n),r.b("        return wrap;"),r.b("\n"+n),r.b("    } else {"),r.b("\n"+n),r.b("        return "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * SDF for a wrapping\n */\nfloat {{name}}_sdf(RelVector v){\n    float wrap = {{wrap.name}}_sdf(v);\n    if(wrap > camera.threshold){\n        return wrap;\n    } else {\n        return {{shape.name}}_sdf(v);\n    }\n}",r);return e.render.apply(e,arguments)}},9338:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec2 "),r.b(r.v(r.f("name",e,t,0))),r.b("_uvMap(RelVector v){"),r.b("\n"+n),r.b("    return "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_uvMap(v);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec2 {{name}}_uvMap(RelVector v){\n    return {{shape.name}}_uvMap(v);\n}",r);return e.render.apply(e,arguments)}},8008:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * Default creeping function (binary search)"),r.b("\n"+n),r.b(" * @param start starting point of the creeping"),r.b("\n"+n),r.b(" * @param outside vector out of the boundary (obtained from the previous flow, or the previous creeping)"),r.b("\n"+n),r.b(" * @param offset how long we flow after passing the boundary"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("ExtVector "),r.b(r.v(r.f("glslCreepName",e,t,0))),r.b("(ExtVector v, ExtVector outside,  float offset){"),r.b("\n"+n),r.b("    ExtVector try = outside;"),r.b("\n"+n),r.b("    float sIn = 0.;"),r.b("\n"+n),r.b("    float sOut = try.data.lastFlowDist;"),r.b("\n"+n),r.b("    float s;"),r.b("\n"+n),r.b("    for(int i=0; i < 100; i++){"),r.b("\n"+n),r.b("        if(sOut - sIn < offset){"),r.b("\n"+n),r.b("            break;"),r.b("\n"+n),r.b("        }"),r.b("\n"+n),r.b("        s = 0.5 * sIn + 0.5 * sOut;"),r.b("\n"+n),r.b("        try = flow(v,s);"),r.b("\n"+n),r.b("        if("),r.b(r.v(r.f("glslTestName",e,t,0))),r.b("(try.vector.local.pos)){"),r.b("\n"+n),r.b("            sOut = s;"),r.b("\n"+n),r.b("            outside = try;"),r.b("\n"+n),r.b("        } else {"),r.b("\n"+n),r.b("            sIn = s;"),r.b("\n"+n),r.b("        }"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    return outside;"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/**\n * Default creeping function (binary search)\n * @param start starting point of the creeping\n * @param outside vector out of the boundary (obtained from the previous flow, or the previous creeping)\n * @param offset how long we flow after passing the boundary\n */\nExtVector {{glslCreepName}}(ExtVector v, ExtVector outside,  float offset){\n    ExtVector try = outside;\n    float sIn = 0.;\n    float sOut = try.data.lastFlowDist;\n    float s;\n    for(int i=0; i < 100; i++){\n        if(sOut - sIn < offset){\n            break;\n        }\n        s = 0.5 * sIn + 0.5 * sOut;\n        try = flow(v,s);\n        if({{glslTestName}}(try.vector.local.pos)){\n            sOut = s;\n            outside = try;\n        } else {\n            sIn = s;\n        }\n    }\n    return outside;\n}",r);return e.render.apply(e,arguments)}},968:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b("* Teleportation."),r.b("\n"+n),r.b("* Check if the local vector is still in the fundamental domain define by the teleportation tests."),r.b("\n"+n),r.b("* If not, teleport the local vector, update the cellBoost and its inverse accordingly and set teleported to true"),r.b("\n"+n),r.b("* Otherwise, do nothing and set teleported to false"),r.b("\n"+n),r.b("* @param[in] v the relative vector to teleport."),r.b("\n"+n),r.b("*/"),r.b("\n"+n),r.b("ExtVector teleport(ExtVector v){"),r.b("\n"+n),r.b("    v.data.isTeleported = false;"),r.b("\n"+n),r.s(r.f("teleportations",e,t,1),e,t,0,424,621,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("        if("),r.b(r.v(r.f("glslTestName",e,t,0))),r.b("(v.vector.local.pos)){"),r.b("\n"+n),r.b("            v.vector = rewrite(v.vector, "),r.b(r.v(r.d("elt.name",e,t,0))),r.b(", "),r.b(r.v(r.d("inv.name",e,t,0))),r.b(");"),r.b("\n"+n),r.b("            v.data.isTeleported = true;"),r.b("\n"+n),r.b("            return v;"),r.b("\n"+n),r.b("        }"),r.b("\n"+n)})),e.pop()),r.b("    return v;"),r.b("\n"+n),r.b("}"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b("/**"),r.b("\n"+n),r.b(" * Does one of the two following transformation: "),r.b("\n"+n),r.b(" * flow the vector by the given time, if the vector escape the fundamental domain, "),r.b("\n"+n),r.b(" * then flow during a smaller time to reach the boundary (creeping)."),r.b("\n"+n),r.b(" * @param[inout] v the relative vector to flow / teleport / creep."),r.b("\n"+n),r.b(" * @param[in] t the (maximal) time to flow"),r.b("\n"+n),r.b(" * @param[in] offset the amount we march passed the boundary"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("ExtVector creepingFlow(ExtVector v, float t, float offset){"),r.b("\n"+n),r.b("    ExtVector try = flow(v, t);"),r.b("\n"+n),r.s(r.f("teleportations",e,t,1),e,t,0,1156,1525,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("\n"+n),r.s(r.f("usesCreepingCustom",e,t,1),e,t,0,1189,1308,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("        if("),r.b(r.v(r.f("glslTestName",e,t,0))),r.b("(try.vector.local.pos)){"),r.b("\n"+n),r.b("            try = "),r.b(r.v(r.f("glslCreepName",e,t,0))),r.b("(v, offset);"),r.b("\n"+n),r.b("        }"),r.b("\n"+n)})),e.pop()),r.b("\n"+n),r.s(r.f("usesCreepingBinary",e,t,1),e,t,0,1364,1488,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("        if("),r.b(r.v(r.f("glslTestName",e,t,0))),r.b("(try.vector.local.pos)){"),r.b("\n"+n),r.b("            try = "),r.b(r.v(r.f("glslCreepName",e,t,0))),r.b("(v, try, offset);"),r.b("\n"+n),r.b("        }"),r.b("\n"+n)})),e.pop()),r.b("        "),r.b("\n"+n)})),e.pop()),r.b("    return try;"),r.b("\n"+n),r.b("}"),r.b("\n"),r.b("\n"),r.fl()},partials:{},subs:{}},"/**\n* Teleportation.\n* Check if the local vector is still in the fundamental domain define by the teleportation tests.\n* If not, teleport the local vector, update the cellBoost and its inverse accordingly and set teleported to true\n* Otherwise, do nothing and set teleported to false\n* @param[in] v the relative vector to teleport.\n*/\nExtVector teleport(ExtVector v){\n    v.data.isTeleported = false;\n    {{#teleportations}}\n        if({{glslTestName}}(v.vector.local.pos)){\n            v.vector = rewrite(v.vector, {{elt.name}}, {{inv.name}});\n            v.data.isTeleported = true;\n            return v;\n        }\n    {{/teleportations}}\n    return v;\n}\n\n\n/**\n * Does one of the two following transformation: \n * flow the vector by the given time, if the vector escape the fundamental domain, \n * then flow during a smaller time to reach the boundary (creeping).\n * @param[inout] v the relative vector to flow / teleport / creep.\n * @param[in] t the (maximal) time to flow\n * @param[in] offset the amount we march passed the boundary\n */\nExtVector creepingFlow(ExtVector v, float t, float offset){\n    ExtVector try = flow(v, t);\n    {{#teleportations}}\n\n        {{#usesCreepingCustom}}\n        if({{glslTestName}}(try.vector.local.pos)){\n            try = {{glslCreepName}}(v, offset);\n        }\n        {{/usesCreepingCustom}}\n\n        {{#usesCreepingBinary}}\n        if({{glslTestName}}(try.vector.local.pos)){\n            try = {{glslCreepName}}(v, try, offset);\n        }\n        {{/usesCreepingBinary}}\n        \n    {{/teleportations}}\n    return try;\n}\n\n",r);return e.render.apply(e,arguments)}},7577:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("bool "),r.b(r.v(r.f("name",e,t,0))),r.b("_directions(RelVector v, int i, out RelVector dir, out float intensity) {"),r.b("\n"+n),r.b("    return directions("),r.b(r.v(r.f("name",e,t,0))),r.b(", v, i, dir, intensity);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"bool {{name}}_directions(RelVector v, int i, out RelVector dir, out float intensity) {\n    return directions({{name}}, v, i, dir, intensity);\n}",r);return e.render.apply(e,arguments)}},8778:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v) {"),r.b("\n"+n),r.b("    return render("),r.b(r.v(r.f("name",e,t,0))),r.b(", v);"),r.b("\n"+n),r.b("}"),r.b("\n"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v) {\n    return render({{name}}, v);\n}\n",r);return e.render.apply(e,arguments)}},1215:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec3 "),r.b(r.v(r.f("name",e,t,0))),r.b("_render(ExtVector v, vec2 uv) {"),r.b("\n"+n),r.b("    return render("),r.b(r.v(r.f("name",e,t,0))),r.b(", v, uv);"),r.b("\n"+n),r.b("}"),r.b("\n"),r.fl()},partials:{},subs:{}},"vec3 {{name}}_render(ExtVector v, vec2 uv) {\n    return render({{name}}, v, uv);\n}\n",r);return e.render.apply(e,arguments)}},2044:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/***********************************************************************************************************************"),r.b("\n"+n),r.b(" ***********************************************************************************************************************"),r.b("\n"+n),r.b(" * "),r.b("\n"+n),r.b(" * Defines the scene SDF and scene Material computations used during the ray-marching and lightening."),r.b("\n"+n),r.b(" *"),r.b("\n"+n),r.b(" ***********************************************************************************************************************"),r.b("\n"+n),r.b(" **********************************************************************************************************************/"),r.b("\n"),r.b("\n"+n),r.b("/**"),r.b("\n"+n),r.b(" * Distance along the geodesic directed by \\`v\\` to the closest object in the local scene"),r.b("\n"+n),r.b(" * @param[in] v the direction to follows"),r.b("\n"+n),r.b(" * @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)"),r.b("\n"+n),r.b(" * @param[out] objId the ID of the solid we hit."),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("float _localSceneSDF(RelVector v, out int hit, out int objId){"),r.b("\n"+n),r.b("    hit = HIT_NOTHING;"),r.b("\n"+n),r.b("    float res = camera.maxDist;"),r.b("\n"+n),r.b("    float dist;"),r.b("\n"),r.b("\n"+n),r.s(r.d("scene.solids",e,t,1),e,t,0,1024,1376,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.s(r.f("isLocal",e,t,1),e,t,0,1045,1359,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("            if("),r.b(r.v(r.f("name",e,t,0))),r.b(".isRendered){"),r.b("\n"+n),r.b("                dist = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("                if(dist < camera.threshold) {"),r.b("\n"+n),r.b("                    hit = HIT_SOLID;"),r.b("\n"+n),r.b("                    objId = "),r.b(r.v(r.f("id",e,t,0))),r.b(";"),r.b("\n"+n),r.b("                    return dist;"),r.b("\n"+n),r.b("                }"),r.b("\n"+n),r.b("                res = min(res, dist);"),r.b("\n"+n),r.b("            }"),r.b("\n"+n)})),e.pop())})),e.pop()),r.b("    "),r.b("\n"+n),r.b("    return res;"),r.b("\n"+n),r.b("}"),r.b("\n"),r.b("\n"+n),r.b("/**"),r.b("\n"+n),r.b("* Distance along the geodesic directed by \\`v\\` to the closest object in the local scene"),r.b("\n"+n),r.b("* When nearest neighbor is on, the representatiion of v can be updated "),r.b("\n"+n),r.b("* so that the local vector is in a neighbor of the fundamental domain."),r.b("\n"+n),r.b("* This is used to compute correctly the normal / uv map of a local object."),r.b("\n"+n),r.b("* @param[in] v the direction to follows"),r.b("\n"+n),r.b("* @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)"),r.b("\n"+n),r.b("* @param[out] objId the ID of the solid we hit."),r.b("\n"+n),r.b("*/"),r.b("\n"+n),r.b("float localSceneSDF(inout RelVector v, out int hit, out int objId){"),r.b("\n"+n),r.b("    float res, dist;"),r.b("\n"+n),r.b("    dist = _localSceneSDF(v, hit, objId);"),r.b("\n"+n),r.b("    if(hit == HIT_SOLID) {"),r.b("\n"+n),r.b("        return dist;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    res = dist;"),r.b("\n"+n),r.b("    "),r.b("\n"+n),r.s(r.d("set.usesNearestNeighbors",e,t,1),e,t,0,2144,2560,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("        RelVector aux = v;"),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.s(r.d("set.neighbors",e,t,1),e,t,0,2207,2508,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("                aux = rewrite(v, "),r.b(r.v(r.d("elt.name",e,t,0))),r.b(", "),r.b(r.v(r.d("inv.name",e,t,0))),r.b(");"),r.b("\n"+n),r.b("                dist = _localSceneSDF(aux, hit, objId);"),r.b("\n"+n),r.b("                if(hit == HIT_SOLID) {"),r.b("\n"+n),r.b("                    v = aux;"),r.b("\n"+n),r.b("                    return dist;"),r.b("\n"+n),r.b("                }"),r.b("\n"+n),r.b("                res = min(res, dist);"),r.b("\n"+n),r.b("                "),r.b("\n"+n)})),e.pop()),r.b("        "),r.b("\n"+n),r.b("        return res;"),r.b("\n"+n)})),e.pop()),r.b("\n"+n),r.s(r.d("set.usesNearestNeighbors",e,t,1),e,t,1,0,0,"")||(r.b("        return res;"),r.b("\n"+n)),r.b("}"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b("/**"),r.b("\n"+n),r.b(" * Distance along the geodesic directed by \\`v\\` to the closest object in the global scene"),r.b("\n"+n),r.b(" * @param[in] v the direction to follows"),r.b("\n"+n),r.b(" * @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)"),r.b("\n"+n),r.b(" * @param[out] objID the ID of the solid we hit."),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("float globalSceneSDF(RelVector v, out int hit, out int objId){"),r.b("\n"+n),r.b("    hit = HIT_NOTHING;"),r.b("\n"+n),r.b("    float res = camera.maxDist;"),r.b("\n"+n),r.b("    float dist;"),r.b("\n"+n),r.b("    "),r.b("\n"+n),r.s(r.d("scene.solids",e,t,1),e,t,0,3118,3472,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.s(r.f("isGlobal",e,t,1),e,t,0,3140,3454,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("            if("),r.b(r.v(r.f("name",e,t,0))),r.b(".isRendered){"),r.b("\n"+n),r.b("                dist = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("                if(dist < camera.threshold) {"),r.b("\n"+n),r.b("                    hit = HIT_SOLID;"),r.b("\n"+n),r.b("                    objId = "),r.b(r.v(r.f("id",e,t,0))),r.b(";"),r.b("\n"+n),r.b("                    return dist;"),r.b("\n"+n),r.b("                }"),r.b("\n"+n),r.b("                res = min(res, dist);"),r.b("\n"+n),r.b("            }"),r.b("\n"+n)})),e.pop())})),e.pop()),r.b("    "),r.b("\n"+n),r.b("    return res;"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/***********************************************************************************************************************\n ***********************************************************************************************************************\n * \n * Defines the scene SDF and scene Material computations used during the ray-marching and lightening.\n *\n ***********************************************************************************************************************\n **********************************************************************************************************************/\n\n/**\n * Distance along the geodesic directed by \\`v\\` to the closest object in the local scene\n * @param[in] v the direction to follows\n * @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)\n * @param[out] objId the ID of the solid we hit.\n */\nfloat _localSceneSDF(RelVector v, out int hit, out int objId){\n    hit = HIT_NOTHING;\n    float res = camera.maxDist;\n    float dist;\n\n    {{#scene.solids}}\n        {{#isLocal}}\n            if({{name}}.isRendered){\n                dist = {{shape.name}}_sdf(v);\n                if(dist < camera.threshold) {\n                    hit = HIT_SOLID;\n                    objId = {{id}};\n                    return dist;\n                }\n                res = min(res, dist);\n            }\n        {{/isLocal}}\n    {{/scene.solids}}\n    \n    return res;\n}\n\n/**\n* Distance along the geodesic directed by \\`v\\` to the closest object in the local scene\n* When nearest neighbor is on, the representatiion of v can be updated \n* so that the local vector is in a neighbor of the fundamental domain.\n* This is used to compute correctly the normal / uv map of a local object.\n* @param[in] v the direction to follows\n* @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)\n* @param[out] objId the ID of the solid we hit.\n*/\nfloat localSceneSDF(inout RelVector v, out int hit, out int objId){\n    float res, dist;\n    dist = _localSceneSDF(v, hit, objId);\n    if(hit == HIT_SOLID) {\n        return dist;\n    }\n    res = dist;\n    \n    {{#set.usesNearestNeighbors}}\n        RelVector aux = v;\n        \n        {{#set.neighbors}}\n                aux = rewrite(v, {{elt.name}}, {{inv.name}});\n                dist = _localSceneSDF(aux, hit, objId);\n                if(hit == HIT_SOLID) {\n                    v = aux;\n                    return dist;\n                }\n                res = min(res, dist);\n                \n        {{/set.neighbors}}\n        \n        return res;\n    {{/set.usesNearestNeighbors}}\n\n    {{^set.usesNearestNeighbors}}\n        return res;\n    {{/set.usesNearestNeighbors}}\n}\n\n\n/**\n * Distance along the geodesic directed by \\`v\\` to the closest object in the global scene\n * @param[in] v the direction to follows\n * @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)\n * @param[out] objID the ID of the solid we hit.\n */\nfloat globalSceneSDF(RelVector v, out int hit, out int objId){\n    hit = HIT_NOTHING;\n    float res = camera.maxDist;\n    float dist;\n    \n    {{#scene.solids}}\n        {{#isGlobal}}\n            if({{name}}.isRendered){\n                dist = {{shape.name}}_sdf(v);\n                if(dist < camera.threshold) {\n                    hit = HIT_SOLID;\n                    objId = {{id}};\n                    return dist;\n                }\n                res = min(res, dist);\n            }\n        {{/isGlobal}}\n    {{/scene.solids}}\n    \n    return res;\n}",r);return e.render.apply(e,arguments)}},7781:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("VectorData initVectorData(){"),r.b("\n"+n),r.b("    return VectorData(0., 0., 0., false, 0, 0, false, vec3(0), vec3(1));"),r.b("\n"+n),r.b("}"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b("void updateVectorDataFromSolid(inout ExtVector v, int objId){"),r.b("\n"+n),r.b("    RelVector normal;"),r.b("\n"+n),r.b("    vec2 uv;"),r.b("\n"+n),r.b("    vec3 color;"),r.b("\n"+n),r.b("    vec3 reflectivity;"),r.b("\n"+n),r.b("    float t;"),r.b("\n"+n),r.b("    "),r.b("\n"+n),r.b("    switch(objId){"),r.b("\n"+n),r.s(r.d("scene.solids",e,t,1),e,t,0,300,3705,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("    "),r.b("\n"+n),r.b("        case "),r.b(r.v(r.f("id",e,t,0))),r.b(":"),r.b("\n"+n),r.s(r.d("material.isReflecting",e,t,1),e,t,0,361,2329,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("            "),r.b("\n"+n),r.b("            if(v.data.iBounce == maxBounces){"),r.b("\n"+n),r.b("                reflectivity = vec3(0);"),r.b("\n"+n),r.b("            } "),r.b("\n"+n),r.b("            else {"),r.b("\n"+n),r.b("                reflectivity = "),r.b(r.v(r.d("material.name",e,t,0))),r.b(".reflectivity;"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("            "),r.b("\n"+n),r.b("            normal = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_gradient(v.vector);"),r.b("\n"+n),r.b("            // in general the gradient is not necessarily a unit vector"),r.b("\n"+n),r.b("            normal = geomNormalize(normal);"),r.b("\n"+n),r.b("    "),r.b("\n"+n),r.s(r.d("material.usesNormal",e,t,1),e,t,1,0,0,"")||(r.s(r.d("material.usesUVMap",e,t,1),e,t,1,0,0,"")||(r.b("                    color =  "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v);"),r.b("\n"+n)),r.s(r.d("material.usesUVMap",e,t,1),e,t,0,976,1111,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("                    uv = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_uvMap(v.vector);"),r.b("\n"+n),r.b("                    color = "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, uv);"),r.b("\n"+n)})),e.pop())),r.b("    "),r.b("\n"+n),r.s(r.d("material.usesNormal",e,t,1),e,t,0,1213,1577,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.s(r.d("material.usesUVMap",e,t,1),e,t,1,0,0,"")||(r.b("                    color = "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, normal);"),r.b("\n"+n)),r.s(r.d("material.usesUVMap",e,t,1),e,t,0,1398,1541,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("                    uv = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_uvMap(v.vector);"),r.b("\n"+n),r.b("                    color = "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, normal, uv);"),r.b("\n"+n)})),e.pop())})),e.pop()),r.b("\n"+n),r.s(r.d("scene.fog",e,t,1),e,t,0,1629,1706,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("                color = applyFog(color, v.data.lastBounceDist);"),r.b("\n"+n)})),e.pop()),r.b("\n"+n),r.b("            if(length(reflectivity) == 0.) {"),r.b("\n"+n),r.b("                v.data.stop = true;"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("            else{"),r.b("\n"+n),r.b("                v.data.stop = false;"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("            v.data.pixel = v.data.pixel + v.data.leftToComputeColor * (vec3(1) - reflectivity) * color;"),r.b("\n"+n),r.b("            v.data.leftToComputeColor = v.data.leftToComputeColor *  reflectivity;"),r.b("\n"+n),r.b("            v.vector = geomReflect(v.vector,normal);"),r.b("\n"+n),r.b("            v.data.lastBounceDist = 0.;"),r.b("\n"+n),r.b("            v.data.iBounce = v.data.iBounce + 1;"),r.b("\n"+n),r.b("            t = 20. * camera.threshold / abs(geomDot(v.vector, normal));"),r.b("\n"+n),r.b("            v = flow(v, t);"),r.b("\n"+n),r.b("    "),r.b("\n"+n)})),e.pop()),r.b("    "),r.b("\n"+n),r.s(r.d("material.isReflecting",e,t,1),e,t,1,0,0,"")||(r.s(r.d("material.usesNormal",e,t,1),e,t,1,0,0,"")||(r.s(r.d("material.usesUVMap",e,t,1),e,t,1,0,0,"")||(r.b("                    color =  "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v);"),r.b("\n"+n)),r.s(r.d("material.usesUVMap",e,t,1),e,t,0,2610,2745,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("                    uv = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_uvMap(v.vector);"),r.b("\n"+n),r.b("                    color = "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, uv);"),r.b("\n"+n)})),e.pop())),r.b("    "),r.b("\n"+n),r.s(r.d("material.usesNormal",e,t,1),e,t,0,2847,3339,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.s(r.d("material.usesUVMap",e,t,1),e,t,1,0,0,"")||(r.b("                    normal = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_gradient(v.vector);"),r.b("\n"+n),r.b("                    color = "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, normal);"),r.b("\n"+n)),r.s(r.d("material.usesUVMap",e,t,1),e,t,0,3096,3303,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("                    normal = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_gradient(v.vector);"),r.b("\n"+n),r.b("                    uv = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_uvMap(v.vector);"),r.b("\n"+n),r.b("                    color = "),r.b(r.v(r.d("material.name",e,t,0))),r.b("_render(v, normal, uv);"),r.b("\n"+n)})),e.pop())})),e.pop()),r.b("\n"+n),r.s(r.d("scene.fog",e,t,1),e,t,0,3391,3468,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("                color = applyFog(color, v.data.lastBounceDist);"),r.b("\n"+n)})),e.pop()),r.b("            v.data.pixel = v.data.pixel + v.data.leftToComputeColor * color;"),r.b("\n"+n),r.b("            v.data.leftToComputeColor = vec3(0);"),r.b("\n"+n),r.b("            v.data.stop = true;"),r.b("\n"+n)),r.b("    "),r.b("\n"+n),r.b("        break;"),r.b("\n"+n),r.b("    "),r.b("\n"+n)})),e.pop()),r.b("    }"),r.b("\n"+n),r.b("}"),r.b("\n"),r.b("\n"+n),r.b("void updateVectorData(inout ExtVector v, int hit, int objId){"),r.b("\n"+n),r.b("    if (hit == HIT_DEBUG) {"),r.b("\n"+n),r.b("        v.data.pixel = debugColor;"),r.b("\n"+n),r.b("        v.data.leftToComputeColor = vec3(0);"),r.b("\n"+n),r.b("        v.data.stop = true;"),r.b("\n"+n),r.b("        return;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    if (hit == HIT_NOTHING) {"),r.b("\n"+n),r.b("        vec3 color = "),r.b(r.v(r.d("scene.background.name",e,t,0))),r.b("_render(v);"),r.b("\n"+n),r.b("        v.data.pixel = v.data.pixel + v.data.leftToComputeColor * color;"),r.b("\n"+n),r.b("        v.data.leftToComputeColor = vec3(0);"),r.b("\n"+n),r.b("        v.data.stop = true;"),r.b("\n"+n),r.b("        return;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    if(hit == HIT_SOLID) {"),r.b("\n"+n),r.b("        updateVectorDataFromSolid(v, objId);"),r.b("\n"+n),r.b("        return;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"VectorData initVectorData(){\n    return VectorData(0., 0., 0., false, 0, 0, false, vec3(0), vec3(1));\n}\n\n\nvoid updateVectorDataFromSolid(inout ExtVector v, int objId){\n    RelVector normal;\n    vec2 uv;\n    vec3 color;\n    vec3 reflectivity;\n    float t;\n    \n    switch(objId){\n    {{#scene.solids}}\n    \n        case {{id}}:\n        {{#material.isReflecting}}\n            \n            if(v.data.iBounce == maxBounces){\n                reflectivity = vec3(0);\n            } \n            else {\n                reflectivity = {{material.name}}.reflectivity;\n            }\n            \n            normal = {{shape.name}}_gradient(v.vector);\n            // in general the gradient is not necessarily a unit vector\n            normal = geomNormalize(normal);\n    \n            {{^material.usesNormal}}\n                {{^material.usesUVMap}}\n                    color =  {{material.name}}_render(v);\n                {{/material.usesUVMap}}\n                {{#material.usesUVMap}}\n                    uv = {{shape.name}}_uvMap(v.vector);\n                    color = {{material.name}}_render(v, uv);\n                {{/material.usesUVMap}}\n            {{/material.usesNormal}}\n    \n            {{#material.usesNormal}}\n                {{^material.usesUVMap}}\n                    color = {{material.name}}_render(v, normal);\n                {{/material.usesUVMap}}\n                {{#material.usesUVMap}}\n                    uv = {{shape.name}}_uvMap(v.vector);\n                    color = {{material.name}}_render(v, normal, uv);\n                {{/material.usesUVMap}}\n            {{/material.usesNormal}}\n\n            {{#scene.fog}}\n                color = applyFog(color, v.data.lastBounceDist);\n            {{/scene.fog}}\n\n            if(length(reflectivity) == 0.) {\n                v.data.stop = true;\n            }\n            else{\n                v.data.stop = false;\n            }\n            v.data.pixel = v.data.pixel + v.data.leftToComputeColor * (vec3(1) - reflectivity) * color;\n            v.data.leftToComputeColor = v.data.leftToComputeColor *  reflectivity;\n            v.vector = geomReflect(v.vector,normal);\n            v.data.lastBounceDist = 0.;\n            v.data.iBounce = v.data.iBounce + 1;\n            t = 20. * camera.threshold / abs(geomDot(v.vector, normal));\n            v = flow(v, t);\n    \n        {{/material.isReflecting}}\n    \n        {{^material.isReflecting}}\n            {{^material.usesNormal}}\n                {{^material.usesUVMap}}\n                    color =  {{material.name}}_render(v);\n                {{/material.usesUVMap}}\n                {{#material.usesUVMap}}\n                    uv = {{shape.name}}_uvMap(v.vector);\n                    color = {{material.name}}_render(v, uv);\n                {{/material.usesUVMap}}\n            {{/material.usesNormal}}\n    \n            {{#material.usesNormal}}\n                {{^material.usesUVMap}}\n                    normal = {{shape.name}}_gradient(v.vector);\n                    color = {{material.name}}_render(v, normal);\n                {{/material.usesUVMap}}\n                {{#material.usesUVMap}}\n                    normal = {{shape.name}}_gradient(v.vector);\n                    uv = {{shape.name}}_uvMap(v.vector);\n                    color = {{material.name}}_render(v, normal, uv);\n                {{/material.usesUVMap}}\n            {{/material.usesNormal}}\n\n            {{#scene.fog}}\n                color = applyFog(color, v.data.lastBounceDist);\n            {{/scene.fog}}\n            v.data.pixel = v.data.pixel + v.data.leftToComputeColor * color;\n            v.data.leftToComputeColor = vec3(0);\n            v.data.stop = true;\n        {{/material.isReflecting}}\n    \n        break;\n    \n    {{/scene.solids}}\n    }\n}\n\nvoid updateVectorData(inout ExtVector v, int hit, int objId){\n    if (hit == HIT_DEBUG) {\n        v.data.pixel = debugColor;\n        v.data.leftToComputeColor = vec3(0);\n        v.data.stop = true;\n        return;\n    }\n    if (hit == HIT_NOTHING) {\n        vec3 color = {{scene.background.name}}_render(v);\n        v.data.pixel = v.data.pixel + v.data.leftToComputeColor * color;\n        v.data.leftToComputeColor = vec3(0);\n        v.data.stop = true;\n        return;\n    }\n    if(hit == HIT_SOLID) {\n        updateVectorDataFromSolid(v, objId);\n        return;\n    }\n}",r);return e.render.apply(e,arguments)}},4122:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/**"),r.b("\n"+n),r.b(" * We assume that we are inside a solid"),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("void nextObjectProperties(RelVector normal, out float ior, out vec3 absorb,out vec3 emission,out float opticalDepth, out bool isInside){"),r.b("\n"+n),r.b("    float dist;"),r.b("\n"+n),r.b("    ior = "),r.b(r.v(r.d("scene.ptBackground.name",e,t,0))),r.b('.ior; // index of the "air"'),r.b("\n"+n),r.b("    absorb = "),r.b(r.v(r.d("scene.ptBackground.name",e,t,0))),r.b('.absorb; // absorb of the "air"'),r.b("\n"+n),r.b("    emission=vec3(0,0,0);//no emission from 'air'"),r.b("\n"+n),r.b("    opticalDepth="),r.b(r.v(r.d("scene.ptBackground.name",e,t,0))),r.b('.opticalDepth; // opticalDepth of the "air"'),r.b("\n"+n),r.b("    isInside = false;"),r.b("\n"+n),r.b("    "),r.b("\n"+n),r.b("    RelVector v = flow(normal, 2. * camera.threshold);"),r.b("\n"+n),r.s(r.d("scene.solids",e,t,1),e,t,0,579,1010,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("        if("),r.b(r.v(r.f("name",e,t,0))),r.b(".isRendered){"),r.b("\n"+n),r.b("            dist = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("            if(dist < camera.threshold) {"),r.b("\n"+n),r.b("                ior = "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".ior;"),r.b("\n"+n),r.b("                absorb = "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".absorb;"),r.b("\n"+n),r.b("                emission = "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".volumeEmission;"),r.b("\n"+n),r.b("                opticalDepth = "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".opticalDepth;"),r.b("\n"+n),r.b("                isInside = true;"),r.b("\n"+n),r.b("                return;"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("        }"),r.b("\n"+n)})),e.pop()),r.b("}"),r.fl()},partials:{},subs:{}},'/**\n * We assume that we are inside a solid\n */\nvoid nextObjectProperties(RelVector normal, out float ior, out vec3 absorb,out vec3 emission,out float opticalDepth, out bool isInside){\n    float dist;\n    ior = {{scene.ptBackground.name}}.ior; // index of the "air"\n    absorb = {{scene.ptBackground.name}}.absorb; // absorb of the "air"\n    emission=vec3(0,0,0);//no emission from \'air\'\n    opticalDepth={{scene.ptBackground.name}}.opticalDepth; // opticalDepth of the "air"\n    isInside = false;\n    \n    RelVector v = flow(normal, 2. * camera.threshold);\n    {{#scene.solids}}\n        if({{name}}.isRendered){\n            dist = {{shape.name}}_sdf(v);\n            if(dist < camera.threshold) {\n                ior = {{ptMaterial.name}}.ior;\n                absorb = {{ptMaterial.name}}.absorb;\n                emission = {{ptMaterial.name}}.volumeEmission;\n                opticalDepth = {{ptMaterial.name}}.opticalDepth;\n                isInside = true;\n                return;\n            }\n        }\n    {{/scene.solids}}\n}',r);return e.render.apply(e,arguments)}},6172:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("/***********************************************************************************************************************"),r.b("\n"+n),r.b(" ***********************************************************************************************************************"),r.b("\n"+n),r.b(" * "),r.b("\n"+n),r.b(" * Defines the scene SDF and scene Material computations used during the ray-marching and lightening."),r.b("\n"+n),r.b(" *"),r.b("\n"+n),r.b(" ***********************************************************************************************************************"),r.b("\n"+n),r.b(" **********************************************************************************************************************/"),r.b("\n"),r.b("\n"+n),r.b("/**"),r.b("\n"+n),r.b(" * Distance along the geodesic directed by \\`v\\` to the closest object in the local scene"),r.b("\n"+n),r.b(" * @param[in] v the direction to follows"),r.b("\n"+n),r.b(" * @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)"),r.b("\n"+n),r.b(" * @param[out] objId the ID of the solid we hit."),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("float _localSceneSDF(RelVector v, out int hit, out int objId){"),r.b("\n"+n),r.b("    hit = HIT_NOTHING;"),r.b("\n"+n),r.b("    float res = camera.maxDist;"),r.b("\n"+n),r.b("    float dist;"),r.b("\n"),r.b("\n"+n),r.s(r.d("scene.solids",e,t,1),e,t,0,1024,1381,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.s(r.f("isLocal",e,t,1),e,t,0,1045,1364,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("            if("),r.b(r.v(r.f("name",e,t,0))),r.b(".isRendered){"),r.b("\n"+n),r.b("                dist = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("                if(abs(dist) < camera.threshold) {"),r.b("\n"+n),r.b("                    hit = HIT_SOLID;"),r.b("\n"+n),r.b("                    objId = "),r.b(r.v(r.f("id",e,t,0))),r.b(";"),r.b("\n"+n),r.b("                    return dist;"),r.b("\n"+n),r.b("                }"),r.b("\n"+n),r.b("                res = min(res, dist);"),r.b("\n"+n),r.b("            }"),r.b("\n"+n)})),e.pop())})),e.pop()),r.b("    "),r.b("\n"+n),r.b("    return res;"),r.b("\n"+n),r.b("}"),r.b("\n"),r.b("\n"+n),r.b("/**"),r.b("\n"+n),r.b("* Distance along the geodesic directed by \\`v\\` to the closest object in the local scene"),r.b("\n"+n),r.b("* When nearest neighbor is on, the representatiion of v can be updated "),r.b("\n"+n),r.b("* so that the local vector is in a neighbor of the fundamental domain."),r.b("\n"+n),r.b("* This is used to compute correctly the normal / uv map of a local object."),r.b("\n"+n),r.b("* @param[in] v the direction to follows"),r.b("\n"+n),r.b("* @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)"),r.b("\n"+n),r.b("* @param[out] objId the ID of the solid we hit."),r.b("\n"+n),r.b("*/"),r.b("\n"+n),r.b("float localSceneSDF(inout RelVector v, out int hit, out int objId){"),r.b("\n"+n),r.b("    float res, dist;"),r.b("\n"+n),r.b("    dist = _localSceneSDF(v, hit, objId);"),r.b("\n"+n),r.b("    if(hit == HIT_SOLID) {"),r.b("\n"+n),r.b("        return dist;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    res = dist;"),r.b("\n"+n),r.b("    "),r.b("\n"+n),r.s(r.d("set.usesNearestNeighbors",e,t,1),e,t,0,2149,2565,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("        RelVector aux = v;"),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.s(r.d("set.neighbors",e,t,1),e,t,0,2212,2513,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("                aux = rewrite(v, "),r.b(r.v(r.d("elt.name",e,t,0))),r.b(", "),r.b(r.v(r.d("inv.name",e,t,0))),r.b(");"),r.b("\n"+n),r.b("                dist = _localSceneSDF(aux, hit, objId);"),r.b("\n"+n),r.b("                if(hit == HIT_SOLID) {"),r.b("\n"+n),r.b("                    v = aux;"),r.b("\n"+n),r.b("                    return dist;"),r.b("\n"+n),r.b("                }"),r.b("\n"+n),r.b("                res = min(res, dist);"),r.b("\n"+n),r.b("                "),r.b("\n"+n)})),e.pop()),r.b("        "),r.b("\n"+n),r.b("        return res;"),r.b("\n"+n)})),e.pop()),r.b("\n"+n),r.s(r.d("set.usesNearestNeighbors",e,t,1),e,t,1,0,0,"")||(r.b("        return res;"),r.b("\n"+n)),r.b("}"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b("/**"),r.b("\n"+n),r.b(" * Distance along the geodesic directed by \\`v\\` to the closest object in the global scene"),r.b("\n"+n),r.b(" * @param[in] v the direction to follows"),r.b("\n"+n),r.b(" * @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)"),r.b("\n"+n),r.b(" * @param[out] objID the ID of the solid we hit."),r.b("\n"+n),r.b(" */"),r.b("\n"+n),r.b("float globalSceneSDF(RelVector v, out int hit, out int objId){"),r.b("\n"+n),r.b("    hit = HIT_NOTHING;"),r.b("\n"+n),r.b("    float res = camera.maxDist;"),r.b("\n"+n),r.b("    float dist;"),r.b("\n"+n),r.b("    "),r.b("\n"+n),r.s(r.d("scene.solids",e,t,1),e,t,0,3123,3482,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.s(r.f("isGlobal",e,t,1),e,t,0,3145,3464,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("            if("),r.b(r.v(r.f("name",e,t,0))),r.b(".isRendered){"),r.b("\n"+n),r.b("                dist = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_sdf(v);"),r.b("\n"+n),r.b("                if(abs(dist) < camera.threshold) {"),r.b("\n"+n),r.b("                    hit = HIT_SOLID;"),r.b("\n"+n),r.b("                    objId = "),r.b(r.v(r.f("id",e,t,0))),r.b(";"),r.b("\n"+n),r.b("                    return dist;"),r.b("\n"+n),r.b("                }"),r.b("\n"+n),r.b("                res = min(res, dist);"),r.b("\n"+n),r.b("            }"),r.b("\n"+n)})),e.pop())})),e.pop()),r.b("    "),r.b("\n"+n),r.b("    return res;"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"/***********************************************************************************************************************\n ***********************************************************************************************************************\n * \n * Defines the scene SDF and scene Material computations used during the ray-marching and lightening.\n *\n ***********************************************************************************************************************\n **********************************************************************************************************************/\n\n/**\n * Distance along the geodesic directed by \\`v\\` to the closest object in the local scene\n * @param[in] v the direction to follows\n * @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)\n * @param[out] objId the ID of the solid we hit.\n */\nfloat _localSceneSDF(RelVector v, out int hit, out int objId){\n    hit = HIT_NOTHING;\n    float res = camera.maxDist;\n    float dist;\n\n    {{#scene.solids}}\n        {{#isLocal}}\n            if({{name}}.isRendered){\n                dist = {{shape.name}}_sdf(v);\n                if(abs(dist) < camera.threshold) {\n                    hit = HIT_SOLID;\n                    objId = {{id}};\n                    return dist;\n                }\n                res = min(res, dist);\n            }\n        {{/isLocal}}\n    {{/scene.solids}}\n    \n    return res;\n}\n\n/**\n* Distance along the geodesic directed by \\`v\\` to the closest object in the local scene\n* When nearest neighbor is on, the representatiion of v can be updated \n* so that the local vector is in a neighbor of the fundamental domain.\n* This is used to compute correctly the normal / uv map of a local object.\n* @param[in] v the direction to follows\n* @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)\n* @param[out] objId the ID of the solid we hit.\n*/\nfloat localSceneSDF(inout RelVector v, out int hit, out int objId){\n    float res, dist;\n    dist = _localSceneSDF(v, hit, objId);\n    if(hit == HIT_SOLID) {\n        return dist;\n    }\n    res = dist;\n    \n    {{#set.usesNearestNeighbors}}\n        RelVector aux = v;\n        \n        {{#set.neighbors}}\n                aux = rewrite(v, {{elt.name}}, {{inv.name}});\n                dist = _localSceneSDF(aux, hit, objId);\n                if(hit == HIT_SOLID) {\n                    v = aux;\n                    return dist;\n                }\n                res = min(res, dist);\n                \n        {{/set.neighbors}}\n        \n        return res;\n    {{/set.usesNearestNeighbors}}\n\n    {{^set.usesNearestNeighbors}}\n        return res;\n    {{/set.usesNearestNeighbors}}\n}\n\n\n/**\n * Distance along the geodesic directed by \\`v\\` to the closest object in the global scene\n * @param[in] v the direction to follows\n * @param[out] hit say if we hit an object (1), nothing (0) or if there is a bug (-1)\n * @param[out] objID the ID of the solid we hit.\n */\nfloat globalSceneSDF(RelVector v, out int hit, out int objId){\n    hit = HIT_NOTHING;\n    float res = camera.maxDist;\n    float dist;\n    \n    {{#scene.solids}}\n        {{#isGlobal}}\n            if({{name}}.isRendered){\n                dist = {{shape.name}}_sdf(v);\n                if(abs(dist) < camera.threshold) {\n                    hit = HIT_SOLID;\n                    objId = {{id}};\n                    return dist;\n                }\n                res = min(res, dist);\n            }\n        {{/isGlobal}}\n    {{/scene.solids}}\n    \n    return res;\n}",r);return e.render.apply(e,arguments)}},6272:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("VectorData initVectorData(){"),r.b("\n"+n),r.b("    return VectorData(0., 0., 0., false, 0, 0, false, vec3(0), vec3(1), "),r.b(r.v(r.d("scene.ptBackground.name",e,t,0))),r.b(".absorb, "),r.b(r.v(r.d("scene.ptBackground.name",e,t,0))),r.b(".volumeEmission, "),r.b(r.v(r.d("scene.ptBackground.name",e,t,0))),r.b(".opticalDepth, false);"),r.b("\n"+n),r.b("}"),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b("void roulette(inout ExtVector v){"),r.b("\n"+n),r.b("    // as the light left gets smaller, the ray is more likely to get terminated early."),r.b("\n"+n),r.b("    // survivors have their value boosted to make up for fewer samples being in the average."),r.b("\n"+n),r.b("    float p = max(v.data.light.r, max(v.data.light.g, v.data.light.b));"),r.b("\n"+n),r.b("    if (randomFloat() > p){"),r.b("\n"+n),r.b("        v.data.stop = true;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    // add the energy we 'lose' by randomly terminating paths"),r.b("\n"+n),r.b("    v.data.light = v.data.light / p;"),r.b("\n"+n),r.b("}"),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b("void updateVectorDataFromSolid(inout ExtVector v, int objId){"),r.b("\n"+n),r.b("    RelVector normal;"),r.b("\n"+n),r.b("    RayType rayType;"),r.b("\n"+n),r.b("    vec2 uv;"),r.b("\n"+n),r.b("    vec3 color;"),r.b("\n"+n),r.b("    vec3 reflectivity;"),r.b("\n"+n),r.b("    float hackCoeff = 1.;"),r.b("\n"+n),r.b("    float r; /** ratio of IOR */"),r.b("\n"+n),r.b("    float nextIOR; /** IOR of the neighbor solid */"),r.b("\n"+n),r.b("    vec3 nextAbsorb; /** absorb of the neighbor solid */"),r.b("\n"+n),r.b("    vec3 nextEmission;/** volumetric emission of the neighbor solid */"),r.b("\n"+n),r.b("    float nextOpticalDepth;/** optical depth of the neighbor solid */"),r.b("\n"+n),r.b("    bool nextIsInside = true;"),r.b("\n"),r.b("\n"+n),r.b("    RelVector diffuseDir;"),r.b("\n"+n),r.b("    RelVector reflectDir;"),r.b("\n"+n),r.b("    RelVector refractDir;"),r.b("\n"),r.b("\n"+n),r.b("    // get a uniformly distributed vector on the sphere"),r.b("\n"+n),r.b("    RelVector random = randomVector(v.vector);"),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b("    //get volumetric coloring:"),r.b("\n"+n),r.b("    //portion of light is absorbed."),r.b("\n"+n),r.b("    vec3 volAbsorb = exp((-v.data.currentAbsorb) * v.data.lastBounceDist);"),r.b("\n"+n),r.b("    "),r.b("\n"+n),r.b("    //light is emitted along the journey (linear or expoenential pickup)"),r.b("\n"+n),r.b("    vec3 volEmit = v.data.currentEmission * v.data.lastBounceDist;"),r.b("\n"+n),r.b("    //vec3 volEmit = exp(v.data.currentEmission * v.data.lastBounceDist)-vec3(1);"),r.b("\n"),r.b("\n"+n),r.b("    //use these quantities to update pixel and light:"),r.b("\n"+n),r.b("    v.data.light = v.data.light * volAbsorb;"),r.b("\n"+n),r.b("    v.data.pixel = v.data.pixel + v.data.light*volEmit;"),r.b("\n"+n),r.b("    v.data.light = v.data.light + volEmit;//the absorbtion doesn't distort the light output"),r.b("\n"+n),r.b("    "),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b("switch(objId){"),r.b("\n"+n),r.s(r.d("scene.solids",e,t,1),e,t,0,2036,5260,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("    "),r.b("\n"+n),r.b("        case "),r.b(r.v(r.f("id",e,t,0))),r.b(":"),r.b("\n"+n),r.b("            normal = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_gradient(v.vector);"),r.b("\n"+n),r.b("            normal = geomNormalize(normal);"),r.b("\n"),r.b("\n"+n),r.b("            "),r.b("\n"+n),r.b("            // get info and reset normal based on which side we are on."),r.b("\n"+n),r.b('            // starting assumption: in the "air"'),r.b("\n"+n),r.b("            r = "),r.b(r.v(r.d("scene.ptBackground.name",e,t,0))),r.b(".ior / "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".ior;"),r.b("\n"+n),r.b("            nextAbsorb = "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".absorb;"),r.b("\n"+n),r.b("            nextEmission = "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".volumeEmission;"),r.b("\n"+n),r.b("            nextOpticalDepth = "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".opticalDepth;"),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.b("            if(v.data.isInside){"),r.b("\n"+n),r.b("                //things to change if we are inside a material instead:"),r.b("\n"+n),r.b("                nextObjectProperties(normal, nextIOR, nextAbsorb,nextEmission, nextOpticalDepth,nextIsInside);"),r.b("\n"+n),r.b("                r = "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".ior / nextIOR;"),r.b("\n"+n),r.b("                normal = negate(normal);"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.b("            rayType = "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b("_setRayType(v, normal,r);"),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.s(r.d("ptMaterial.usesUVMap",e,t,1),e,t,1,0,0,"")||(r.b("                color =  "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b("_render(v, normal, rayType);"),r.b("\n"+n)),r.s(r.d("ptMaterial.usesUVMap",e,t,1),e,t,0,3160,3302,"{{ }}")&&(r.rs(e,t,(function(e,t,r){r.b("                uv = "),r.b(r.v(r.d("shape.name",e,t,0))),r.b("_uvMap(v.vector);"),r.b("\n"+n),r.b("                color = "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b("_render(v, normal, uv, rayType);"),r.b("\n"+n)})),e.pop()),r.b("        "),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.b("        // hack to make sure that lights are not too bright"),r.b("\n"+n),r.b("            if(v.data.iBounce == 0){"),r.b("\n"+n),r.b("                hackCoeff = 0.2;"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.b("            //apply surface effects"),r.b("\n"+n),r.b("            v.data.pixel = v.data.pixel + hackCoeff * v.data.light * "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".emission;"),r.b("\n"+n),r.b("            if(!rayType.refract){"),r.b("\n"+n),r.b("                v.data.light = v.data.light * color / max(rayType.chance, 0.0001);"),r.b("\n"+n),r.b("             }"),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.b("            // update the ray direction"),r.b("\n"+n),r.b("            // diffuse uses a normal oriented cosine weighted hemisphere sample."),r.b("\n"+n),r.b("            diffuseDir = geomNormalize(add(normal, random));"),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.b("            if(rayType.diffuse){"),r.b("\n"+n),r.b("                v.vector = diffuseDir;"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.b("            if(rayType.reflect){"),r.b("\n"+n),r.b("                // perfectly smooth specular uses the reflection ray."),r.b("\n"+n),r.b("                reflectDir = geomReflect(v.vector, normal);"),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.b("                // rough (glossy) specular lerps from the smooth specular to the rough diffuse by the material roughness squared"),r.b("\n"+n),r.b("               // reflectDir = geomNormalize(geomMix(reflectDir, diffuseDir, "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".roughness * "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".roughness));"),r.b("\n"+n),r.b("                v.vector = reflectDir;"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("        "),r.b("\n"+n),r.b("            if(rayType.refract){"),r.b("\n"+n),r.b("                    refractDir = geomRefract(v.vector,normal, r);"),r.b("\n"+n),r.b("                    // rough (glossy) specular lerps from the smooth specular to the rough diffuse by the material roughness squared"),r.b("\n"+n),r.b("                    refractDir = geomNormalize(geomMix(refractDir, diffuseDir, "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".roughness * "),r.b(r.v(r.d("ptMaterial.name",e,t,0))),r.b(".roughness));"),r.b("\n"+n),r.b("                    v.data.isInside = nextIsInside;"),r.b("\n"+n),r.b("                    v.data.currentAbsorb = nextAbsorb;"),r.b("\n"+n),r.b("                    v.data.currentEmission = nextEmission;"),r.b("\n"+n),r.b("                    v.data.currentOpticalDepth = nextOpticalDepth;"),r.b("\n"+n),r.b("                    v.vector = refractDir;"),r.b("\n"+n),r.b("            }"),r.b("\n"+n),r.b("            break;"),r.b("\n"+n),r.b("    "),r.b("\n"+n)})),e.pop()),r.b("    }"),r.b("\n"),r.b("\n"+n),r.b("    v.data.lastBounceDist = 0.;"),r.b("\n"+n),r.b("    v.data.iBounce = v.data.iBounce + 1;"),r.b("\n"+n),r.b("    // be carefull, v is not normal to the surface"),r.b("\n"+n),r.b("    // if the time we flow is too small, we are still below the camera threshold"),r.b("\n"+n),r.b("    float t = 20. * camera.threshold / abs(geomDot(v.vector, normal));"),r.b("\n"+n),r.b("    v = flow(v, t);"),r.b("\n"+n),r.b("}"),r.b("\n"),r.b("\n"+n),r.b("void updateVectorData(inout ExtVector v, int hit, int objId){"),r.b("\n"+n),r.b("    if (hit == HIT_DEBUG) {"),r.b("\n"+n),r.b("        v.data.pixel = debugColor;"),r.b("\n"+n),r.b("        v.data.stop = true;"),r.b("\n"+n),r.b("        return;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    if (hit == HIT_NOTHING) {"),r.b("\n"+n),r.b("        vec3 bgColor = "),r.b(r.v(r.d("scene.ptBackground.name",e,t,0))),r.b(".diffuse;"),r.b("\n"+n),r.b("        v.data.pixel = v.data.pixel + v.data.light * bgColor;"),r.b("\n"+n),r.b("        v.data.stop = true;"),r.b("\n"+n),r.b("        return;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("    if(hit == HIT_SOLID) {"),r.b("\n"+n),r.b("        updateVectorDataFromSolid(v, objId);"),r.b("\n"+n),r.b("        roulette(v);"),r.b("\n"+n),r.b("        return;"),r.b("\n"+n),r.b("    }"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"VectorData initVectorData(){\n    return VectorData(0., 0., 0., false, 0, 0, false, vec3(0), vec3(1), {{scene.ptBackground.name}}.absorb, {{scene.ptBackground.name}}.volumeEmission, {{scene.ptBackground.name}}.opticalDepth, false);\n}\n\n\n\nvoid roulette(inout ExtVector v){\n    // as the light left gets smaller, the ray is more likely to get terminated early.\n    // survivors have their value boosted to make up for fewer samples being in the average.\n    float p = max(v.data.light.r, max(v.data.light.g, v.data.light.b));\n    if (randomFloat() > p){\n        v.data.stop = true;\n    }\n    // add the energy we 'lose' by randomly terminating paths\n    v.data.light = v.data.light / p;\n}\n\n\n\nvoid updateVectorDataFromSolid(inout ExtVector v, int objId){\n    RelVector normal;\n    RayType rayType;\n    vec2 uv;\n    vec3 color;\n    vec3 reflectivity;\n    float hackCoeff = 1.;\n    float r; /** ratio of IOR */\n    float nextIOR; /** IOR of the neighbor solid */\n    vec3 nextAbsorb; /** absorb of the neighbor solid */\n    vec3 nextEmission;/** volumetric emission of the neighbor solid */\n    float nextOpticalDepth;/** optical depth of the neighbor solid */\n    bool nextIsInside = true;\n\n    RelVector diffuseDir;\n    RelVector reflectDir;\n    RelVector refractDir;\n\n    // get a uniformly distributed vector on the sphere\n    RelVector random = randomVector(v.vector);\n\n\n\n\n\n    //get volumetric coloring:\n    //portion of light is absorbed.\n    vec3 volAbsorb = exp((-v.data.currentAbsorb) * v.data.lastBounceDist);\n    \n    //light is emitted along the journey (linear or expoenential pickup)\n    vec3 volEmit = v.data.currentEmission * v.data.lastBounceDist;\n    //vec3 volEmit = exp(v.data.currentEmission * v.data.lastBounceDist)-vec3(1);\n\n    //use these quantities to update pixel and light:\n    v.data.light = v.data.light * volAbsorb;\n    v.data.pixel = v.data.pixel + v.data.light*volEmit;\n    v.data.light = v.data.light + volEmit;//the absorbtion doesn't distort the light output\n    \n\n\n\n\n\n\nswitch(objId){\n    {{#scene.solids}}\n    \n        case {{id}}:\n            normal = {{shape.name}}_gradient(v.vector);\n            normal = geomNormalize(normal);\n\n            \n            // get info and reset normal based on which side we are on.\n            // starting assumption: in the \"air\"\n            r = {{scene.ptBackground.name}}.ior / {{ptMaterial.name}}.ior;\n            nextAbsorb = {{ptMaterial.name}}.absorb;\n            nextEmission = {{ptMaterial.name}}.volumeEmission;\n            nextOpticalDepth = {{ptMaterial.name}}.opticalDepth;\n        \n            if(v.data.isInside){\n                //things to change if we are inside a material instead:\n                nextObjectProperties(normal, nextIOR, nextAbsorb,nextEmission, nextOpticalDepth,nextIsInside);\n                r = {{ptMaterial.name}}.ior / nextIOR;\n                normal = negate(normal);\n            }\n        \n            rayType = {{ptMaterial.name}}_setRayType(v, normal,r);\n        \n            {{^ptMaterial.usesUVMap}}\n                color =  {{ptMaterial.name}}_render(v, normal, rayType);\n            {{/ptMaterial.usesUVMap}}\n            {{#ptMaterial.usesUVMap}}\n                uv = {{shape.name}}_uvMap(v.vector);\n                color = {{ptMaterial.name}}_render(v, normal, uv, rayType);\n            {{/ptMaterial.usesUVMap}}\n        \n        \n        // hack to make sure that lights are not too bright\n            if(v.data.iBounce == 0){\n                hackCoeff = 0.2;\n            }\n        \n            //apply surface effects\n            v.data.pixel = v.data.pixel + hackCoeff * v.data.light * {{ptMaterial.name}}.emission;\n            if(!rayType.refract){\n                v.data.light = v.data.light * color / max(rayType.chance, 0.0001);\n             }\n        \n            // update the ray direction\n            // diffuse uses a normal oriented cosine weighted hemisphere sample.\n            diffuseDir = geomNormalize(add(normal, random));\n        \n            if(rayType.diffuse){\n                v.vector = diffuseDir;\n            }\n        \n            if(rayType.reflect){\n                // perfectly smooth specular uses the reflection ray.\n                reflectDir = geomReflect(v.vector, normal);\n        \n                // rough (glossy) specular lerps from the smooth specular to the rough diffuse by the material roughness squared\n               // reflectDir = geomNormalize(geomMix(reflectDir, diffuseDir, {{ptMaterial.name}}.roughness * {{ptMaterial.name}}.roughness));\n                v.vector = reflectDir;\n            }\n        \n            if(rayType.refract){\n                    refractDir = geomRefract(v.vector,normal, r);\n                    // rough (glossy) specular lerps from the smooth specular to the rough diffuse by the material roughness squared\n                    refractDir = geomNormalize(geomMix(refractDir, diffuseDir, {{ptMaterial.name}}.roughness * {{ptMaterial.name}}.roughness));\n                    v.data.isInside = nextIsInside;\n                    v.data.currentAbsorb = nextAbsorb;\n                    v.data.currentEmission = nextEmission;\n                    v.data.currentOpticalDepth = nextOpticalDepth;\n                    v.vector = refractDir;\n            }\n            break;\n    \n    {{/scene.solids}}\n    }\n\n    v.data.lastBounceDist = 0.;\n    v.data.iBounce = v.data.iBounce + 1;\n    // be carefull, v is not normal to the surface\n    // if the time we flow is too small, we are still below the camera threshold\n    float t = 20. * camera.threshold / abs(geomDot(v.vector, normal));\n    v = flow(v, t);\n}\n\nvoid updateVectorData(inout ExtVector v, int hit, int objId){\n    if (hit == HIT_DEBUG) {\n        v.data.pixel = debugColor;\n        v.data.stop = true;\n        return;\n    }\n    if (hit == HIT_NOTHING) {\n        vec3 bgColor = {{scene.ptBackground.name}}.diffuse;\n        v.data.pixel = v.data.pixel + v.data.light * bgColor;\n        v.data.stop = true;\n        return;\n    }\n    if(hit == HIT_SOLID) {\n        updateVectorDataFromSolid(v, objId);\n        roulette(v);\n        return;\n    }\n}",r);return e.render.apply(e,arguments)}},5030:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("RelVector "),r.b(r.v(r.f("name",e,t,0))),r.b("_gradient(RelVector v){"),r.b("\n"+n),r.b("    return gradient("),r.b(r.v(r.f("name",e,t,0))),r.b(",v);"),r.b("\n"+n),r.b("}"),r.b("\n"),r.fl()},partials:{},subs:{}},"RelVector {{name}}_gradient(RelVector v){\n    return gradient({{name}},v);\n}\n",r);return e.render.apply(e,arguments)}},8266:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("RelVector "),r.b(r.v(r.f("name",e,t,0))),r.b("_gradient(RelVector v){"),r.b("\n"+n),r.b("    float newEp = 0.001;"),r.b("\n"),r.b("\n"+n),r.b("    RelVector shiftPX = smallShift(v, vec3(newEp, 0, 0));"),r.b("\n"+n),r.b("    RelVector shiftPY = smallShift(v, vec3(0, newEp, 0));"),r.b("\n"+n),r.b("    RelVector shiftPZ = smallShift(v, vec3(0, 0, newEp));"),r.b("\n"+n),r.b("    RelVector shiftMX = smallShift(v, vec3(-newEp, 0, 0));"),r.b("\n"+n),r.b("    RelVector shiftMY = smallShift(v, vec3(0, -newEp, 0));"),r.b("\n"+n),r.b("    RelVector shiftMZ = smallShift(v, vec3(0, 0, -newEp));"),r.b("\n"),r.b("\n"+n),r.b("    float vgx = "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(shiftPX) - "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(shiftMX);"),r.b("\n"+n),r.b("    float vgy = "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(shiftPY) - "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(shiftMY);"),r.b("\n"+n),r.b("    float vgz = "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(shiftPZ) - "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(shiftMZ);"),r.b("\n"+n),r.b("    RelVector n = createRelVector(v, vec3(vgx, vgy, vgz));"),r.b("\n"),r.b("\n"+n),r.b("    n = geomNormalize(n);"),r.b("\n"+n),r.b("    return n;"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"RelVector {{name}}_gradient(RelVector v){\n    float newEp = 0.001;\n\n    RelVector shiftPX = smallShift(v, vec3(newEp, 0, 0));\n    RelVector shiftPY = smallShift(v, vec3(0, newEp, 0));\n    RelVector shiftPZ = smallShift(v, vec3(0, 0, newEp));\n    RelVector shiftMX = smallShift(v, vec3(-newEp, 0, 0));\n    RelVector shiftMY = smallShift(v, vec3(0, -newEp, 0));\n    RelVector shiftMZ = smallShift(v, vec3(0, 0, -newEp));\n\n    float vgx = {{name}}_sdf(shiftPX) - {{name}}_sdf(shiftMX);\n    float vgy = {{name}}_sdf(shiftPY) - {{name}}_sdf(shiftMY);\n    float vgz = {{name}}_sdf(shiftPZ) - {{name}}_sdf(shiftMZ);\n    RelVector n = createRelVector(v, vec3(vgx, vgy, vgz));\n\n    n = geomNormalize(n);\n    return n;\n}",r);return e.render.apply(e,arguments)}},3707:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("float "),r.b(r.v(r.f("name",e,t,0))),r.b("_sdf(RelVector v) {"),r.b("\n"+n),r.b("    return sdf("),r.b(r.v(r.f("name",e,t,0))),r.b(",v);"),r.b("\n"+n),r.b("}"),r.b("\n"),r.fl()},partials:{},subs:{}},"float {{name}}_sdf(RelVector v) {\n    return sdf({{name}},v);\n}\n",r);return e.render.apply(e,arguments)}},4355:(e,t,n)=>{var r=n(5485);e.exports=function(){var e=new r.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("vec2 "),r.b(r.v(r.f("name",e,t,0))),r.b("_uvMap(RelVector v){"),r.b("\n"+n),r.b("    return uvMap("),r.b(r.v(r.f("name",e,t,0))),r.b(", v);"),r.b("\n"+n),r.b("}"),r.fl()},partials:{},subs:{}},"vec2 {{name}}_uvMap(RelVector v){\n    return uvMap({{name}}, v);\n}",r);return e.render.apply(e,arguments)}},6097:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                     \n  \n                                                                                                                        \n                                                                                                                        \n\n                                                                                                                        \n          \n                                    \n                                                                                                                        \n\nstruct GroupElement {\n    Isometry isom;                                 \n};\n\nconst GroupElement GROUP_IDENTITY = GroupElement(IDENTITY);\n\nGroupElement multiply(GroupElement elt1, GroupElement elt2){\n    return GroupElement(multiply(elt1.isom, elt2.isom));\n}\n\n                                              \n                                                 \n   \n\nIsometry toIsometry(GroupElement elt) {\n    return elt.isom;\n}"},9188:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                     \n  \n                                                                                                                        \n                                                                                                                        \n\n                                                                                                                        \n          \n                               \n                                                                                                                        \n\nstruct GroupElement {\n    bool fake;                                                           \n};\n\nconst GroupElement GROUP_IDENTITY = GroupElement(true);\n\nGroupElement multiply(GroupElement elt1, GroupElement elt2){\n    return GroupElement(true);\n}\n\n                                              \n                                \n   \n\nIsometry toIsometry(GroupElement elt) {\n    return IDENTITY;\n}"},5363:e=>{e.exports="   \n                                                                \n   \nfloat fresnelReflectAmount(RelVector incident, RelVector normal, float r, float reflecAt0, float relfectAt90) {\n                           \n    float r0 = (r - 1.) / (r + 1.);\n    r0 = r0 * r0;\n    float cosX = -geomDot(normal, incident);\n    if (r > 1.)\n    {\n        float sinT2 = r * r * (1. - cosX * cosX);\n                                    \n        if (sinT2 > 1.){\n            return relfectAt90;\n        }\n        cosX = sqrt(1. - sinT2);\n    }\n    float x = 1.- cosX;\n    float ret = clamp(r0 + (1. - r0) * x * x * x * x * x, 0., 1.);\n\n                                                        \n                               \n    return reflecAt0 + (relfectAt90 - reflecAt0) * ret;\n}"},2093:e=>{e.exports="   \n                                  \n   \nfloat smoothMaxPoly(float a, float b, float k){\n    float h = max(1. - abs(a - b) / k, 0.);\n    return max(a, b) + 0.25 * k * h * h;\n}\n\n   \n                                                                                 \n                                                 \n                                                   \n                                                   \n                                                    \n   \nRelVector gradientMaxPoly(float dist1, float dist2, RelVector grad1, RelVector grad2, float k){\n    RelVector gradMin, gradMax;\n    if (dist1 < dist2) {\n        gradMin = grad1;\n        gradMax = grad2;\n    }\n    else {\n        gradMin = grad2;\n        gradMax = grad1;\n    }\n    float h = max(1. - abs(dist1 - dist2) / k, 0.);\n    return add(multiplyScalar(1. - 0.5 * h, gradMax), multiplyScalar(0.5 * h, gradMin));\n}\n"},5442:e=>{e.exports="float smoothMinPoly(float a, float b, float k){\n    float h = max(1. - abs(a - b) / k, 0.);\n    return min(a, b) - 0.25 * k * h * h;\n}\n\n\n   \n                                                                                 \n                                                 \n                                                   \n                                                   \n                                                    \n   \nRelVector gradientMinPoly(float dist1, float dist2, RelVector grad1, RelVector grad2, float k){\n    RelVector gradMin, gradMax;\n    if (dist1 < dist2) {\n        gradMin = grad1;\n        gradMax = grad2;\n    }\n    else {\n        gradMin = grad2;\n        gradMax = grad1;\n    }\n    float h = max(1. - abs(dist1 - dist2) / k, 0.);\n\n    return add(multiplyScalar(1. - 0.5 * h, gradMin), multiplyScalar(0.5 * h, gradMax));\n}\n"},2143:e=>{e.exports="                                                                                                                        \n          \n                        \n                                                                                                                        \nstruct BasicPTMaterial {\n    vec3 emission;\n    vec3 volumeEmission;\n    float opticalDepth;\n    vec3 diffuse;\n    vec3 specular;\n    vec3 absorb;\n    float ior;\n    float roughness;\n    float diffuseChance;\n    float reflectionChance;\n    float refractionChance;\n};\n\n\nRayType setRayType(BasicPTMaterial material, ExtVector v, RelVector n, float r) {\n    RayType res = RayType(false, false, false, 0.);\n    float random = randomFloat();\n\n    float reflectionChance = fresnelReflectAmount(v.vector, n, r, material.reflectionChance, 1.0);\n    float chanceMultiplier = (1. - reflectionChance) / (1. - material.reflectionChance);\n                                                         \n                                  \n    float refractionChance = chanceMultiplier * material.refractionChance;\n    float diffuseChance = 1. - refractionChance - reflectionChance;\n\n    if (random < diffuseChance){\n        res.diffuse = true;\n        res.chance = diffuseChance;\n    } else if (random < diffuseChance + reflectionChance){\n        res.reflect = true;\n        res.chance = reflectionChance;\n    }\n    else {\n        res.refract = true;\n        res.chance = refractionChance;\n    }\n    return res;\n}\n\nvec3 render(BasicPTMaterial material, ExtVector v, RayType rayType) {\n    if (rayType.reflect){\n        return material.specular;\n    }\n                               \n                                              \n                                         \n       \n    return material.diffuse;\n}\n\n"},2197:e=>{e.exports="                                                                                                                        \n          \n                        \n                                                                                                                        \nstruct CheckerboardMaterial {\n    vec2 dir1;\n    vec2 dir2;\n    vec3 color1;\n    vec3 color2;\n};\n\nvec3 render(CheckerboardMaterial material, ExtVector v, vec2 uv) {\n    float x1 = mod(dot(uv, material.dir1), 2.);\n    float x2 = mod(dot(uv, material.dir2), 2.);\n    if (x1 < 1. && x2 < 1.){\n        return material.color1;\n    } else if (x1 >= 1. && x2 >= 1.) {\n        return material.color1;\n    } else {\n        return material.color2;\n    }\n}\n\n"},7793:e=>{e.exports="\n                                                                                                                        \n                       \n                                                                                                                        \n"},3496:e=>{e.exports="                                                                                                                        \n                  \n                                            \n                                                     \n                                                                                                                        \n\nvec3 normalMaterialRender(ExtVector v, RelVector normal) {\n    Vector[3] f;\n    Point pos = applyGroupElement(v.vector.cellBoost, v.vector.local.pos);\n    frame(pos, f);\n\n    f[0] = applyGroupElement(v.vector.invCellBoost, f[0]);\n    f[1] = applyGroupElement(v.vector.invCellBoost, f[1]);\n    f[2] = applyGroupElement(v.vector.invCellBoost, f[2]);\n    \n                  \n                            \n    float r =  geomDot(normal.local, f[0]);\n    float g =  geomDot(normal.local, f[1]);\n    float b =  geomDot(normal.local, f[2]);\n    return abs(vec3(r, g, b));\n}"},7198:e=>{e.exports="                                                                                                                        \n          \n                        \n                                                                                                                        \nstruct PathTracerWrapMaterial {\n    vec3 emission;\n    vec3 volumeEmission;\n    float opticalDepth;\n    vec3 specular;\n    vec3 absorb;\n    float ior;\n    float roughness;\n    float diffuseChance;\n    float reflectionChance;\n    float refractionChance;\n};\n\n\nRayType setRayType(PathTracerWrapMaterial material, ExtVector v, RelVector n, float r) {\n    RayType res = RayType(false, false, false, 0.);\n    float random = randomFloat();\n\n    float reflectionChance = fresnelReflectAmount(v.vector, n, r, material.reflectionChance, 1.0);\n    float chanceMultiplier = (1. - reflectionChance) / (1. - material.reflectionChance);\n    float refractionChance = chanceMultiplier * material.refractionChance;\n    float diffuseChance = 1. - refractionChance - reflectionChance;\n\n    if (random < diffuseChance){\n        res.diffuse = true;\n        res.chance = diffuseChance;\n    } else if (random < diffuseChance + reflectionChance){\n        res.reflect = true;\n        res.chance = reflectionChance;\n    }\n    else {\n        res.refract = true;\n        res.chance = refractionChance;\n    }\n    return res;\n}\n\n"},6045:e=>{e.exports="                                                                                                                        \n                 \n                                                                                                                        \n\nstruct PhongMaterial {\n    vec3 color;\n    float ambient;\n    float diffuse;\n    float specular;\n    float shininess;\n    vec3 reflectivity;\n};\n\n\n   \n                                                                \n                                \n                                                                        \n                                                             \n                                             \n                                               \n                                                                         \n                                                                   \n                                                            \n                                                      \n   \n                                                                                                                   \n                               \n                         \n                       \n                                                    \n                                                  \n                                                  \n  \n                                                          \n                                                                                                   \n                                 \n                                                       \n                  \n    \n\nvec3 lightComputation(Vector v, Vector n, Vector dir, PhongMaterial material, vec3 lightColor, float intensity){\n    Vector auxV = negate(v);\n    Vector auxL = dir;\n    Vector auxN = n;\n    Vector auxR = geomReflect(negate(auxL), auxN);\n    float NdotL = max(geomDot(auxN, auxL), 0.);\n    float RdotV = max(geomDot(auxR, auxV), 0.);\n\n                                                 \n    float specularCoeff = material.specular * pow(RdotV, material.shininess);\n    float diffuseCoeff = material.diffuse * NdotL;\n    float ambientCoeff = material.ambient;\n\n                                                \n                                                                                                                                                                                                                                      \n    vec3 specularLight = lightColor.rgb;\n    vec3 diffuseLight = 0.8 * lightColor.rgb + 0.2 * vec3(1.);\n    vec3 ambientLight = 0.5 * lightColor.rgb + 0.5 * vec3(1.);\n\n                                                 \n    vec3 specular = specularCoeff * specularLight;\n    vec3 diffuse = diffuseCoeff * diffuseLight * material.color;\n    vec3 ambient = ambientCoeff * ambientLight * material.color;\n\n                 \n    vec3 res = intensity * (ambient + diffuse + specular);\n\n    return res;\n}"},5836:e=>{e.exports="                                                                                                                        \n          \n                      \n                                                                                                                        \n\nstruct PhongWrapMaterial {\n    float ambient;\n    float diffuse;\n    float specular;\n    float shininess;\n    vec3 reflectivity;\n};\n\nvec3 lightComputation(Vector v, Vector n, Vector dir, vec3 baseColor, PhongWrapMaterial material, vec3 lightColor, float intensity){\n    Vector auxV = negate(v);\n    Vector auxL = dir;\n    Vector auxN = n;\n    Vector auxR = geomReflect(negate(auxL), auxN);\n    float NdotL = max(geomDot(auxN, auxL), 0.);\n    float RdotV = max(geomDot(auxR, auxV), 0.);\n\n                                                 \n    float specularCoeff = material.specular * pow(RdotV, material.shininess);\n    float diffuseCoeff = material.diffuse * NdotL;\n    float ambientCoeff = material.ambient;\n\n                                                \n                                                                                                                                                                                                                                      \n    vec3 specularLight = lightColor.rgb;\n    vec3 diffuseLight = 0.8 * lightColor.rgb + 0.2 * vec3(1.);\n    vec3 ambientLight = 0.5 * lightColor.rgb + 0.5 * vec3(1.);\n\n                                                 \n    vec3 specular = specularCoeff * specularLight;\n    vec3 diffuse = diffuseCoeff * diffuseLight * baseColor;\n    vec3 ambient = ambientCoeff * ambientLight * baseColor;\n\n                 \n    vec3 res = intensity * (ambient + diffuse + specular);\n\n    return res;\n}"},9095:e=>{e.exports="                                                                                                                        \n          \n                        \n                                                                                                                        \nstruct SimpleTextureMaterial {\n    sampler2D sampler;\n    vec2 start;\n    vec2 scale;\n    bool repeatU;\n    bool repeatV;\n};\n\nvec3 render(SimpleTextureMaterial material, ExtVector v, vec2 uv) {\n    vec2 texCoords = (uv - material.start) * material.scale;\n    vec4 color = texture(material.sampler, texCoords);\n                                                 \n    return color.xyz;\n}\n\n\n"},2664:e=>{e.exports="                                                                                                                        \n                        \n                                                                                                                        \n\nstruct SingleColorMaterial {\n    vec3 color;\n};\n\nvec3 render(SingleColorMaterial material, ExtVector v) {\n    return material.color;\n}"},5348:e=>{e.exports="vec3 applyFog(vec3 color, float dist){\n    float coeff = exp(- fog.scattering * dist);\n    return coeff * color + (1. - coeff) * fog.color;\n}"},7885:e=>{e.exports="                                                                                                                        \n  \n          \n                                 \n  \n                                                                                                                        \n\nstruct ExpFog {\n    vec3 color;                             \n    float scattering;                                                    \n};\n"},7333:e=>{e.exports="struct IntersectionShape {\n    float maxCoeff;\n};"},519:e=>{e.exports="struct UnionShape {\n    float minCoeff;\n};\n"},1685:e=>{e.exports="   \n                                                     \n                                                               \n   \nRelVector mapping(vec3 coords){\n    vec4 dir = vec4(coords, 0);\n    dir = camera.matrix * dir;\n    dir = normalize(dir);\n    Vector v = createVector(ORIGIN, dir.xyz);\n    RelVector res = applyPosition(camera.position, v);\n    return geomNormalize(res);\n}"},7591:e=>{e.exports="                                                                                                                        \n          \n          \n                                                                                               \n                                                                                                                        \nstruct Camera {\n    float fov;                              \n    float minDist;                                     \n    float maxDist;                                     \n    int maxSteps;                                                       \n    float threshold;                                          \n    RelPosition position;                                                                            \n    mat4 matrix;                                                 \n};"},4651:e=>{e.exports="   \n                                                                                                 \n                                                                                        \n                                                               \n   \nRelVector mapping(vec3 coords){\n    vec4 dir = vec4(coords, 0);\n    dir = camera.matrix * dir;\n    dir = normalize(dir);\n    Vector v = createVector(ORIGIN, dir.xyz);\n    RelVector res = applyPosition(camera.position, v);\n    return geomNormalize(res);\n}\n\n   \n                                                                                             \n                                                               \n   \nRelVector mappingFromFlatScreen(vec2 coords) {\n                                                         \n    vec2 jitter = vec2(randomFloat(), randomFloat()) - 0.5;\n\n                                                                            \n    vec2 planeCoords = (coords - 0.5 * resolution + jitter) / (0.5 * resolution.y);\n\n                              \n    float z = - 1. / tan(radians(0.5 * camera.fov));\n\n                                                      \n    vec4 dir = vec4(planeCoords, z, 0);\n\n    dir = camera.matrix * dir;\n    dir = normalize(dir);\n    Vector v = createVector(ORIGIN, dir.xyz);\n    RelVector res = applyPosition(camera.position, v);\n    return geomNormalize(res);\n}"},766:e=>{e.exports="                                                                                                                        \n          \n                      \n                                                                                               \n                                                                                                                        \nstruct PathTracerCamera {\n    float fov;                     \n    float minDist;                                     \n    float maxDist;                                     \n    int maxSteps;                                                       \n    float threshold;                                          \n    RelPosition position;                                                                            \n    mat4 matrix;                                                 \n    float focalLength;                    \n    float aperture;                \n};"},5074:e=>{e.exports="   \n                                                     \n                                                               \n   \nRelVector mapping(vec3 coords){\n    vec4 dir = normalize(vec4(coords, 0));\n    dir = camera.matrix * dir;\n    dir = normalize(dir);\n    Vector v = createVector(ORIGIN, dir.xyz);\n    return applyPosition(camera.position, v);\n}"},6539:e=>{e.exports="                                                                                                                        \n          \n          \n                                                                                               \n                                                                                                                        \nstruct VRCamera {\n    float fov;                     \n    float minDist;                                     \n    float maxDist;                                     \n    int maxSteps;                                                       \n    float threshold;                                          \n    RelPosition position;                                                                            \n    mat4 matrix;                                                 \n};"},190:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                                                               \n  \n                                                                                                                        \n                                                                                                                        \n\n\nVector geomMix(Vector v1, Vector v2, float a){\n    return add(multiplyScalar(1.-a, v1), multiplyScalar(a, v2));\n}\n\n   \n                                           \n                         \n             \n   \nVector negate(Vector v) {\n    return multiplyScalar(-1., v);\n}\n\n\n   \n                                         \n                       \n   \nfloat geomLength(Vector v){\n    return sqrt(geomDot(v, v));\n}\n\n   \n                                                          \n                            \n   \nVector geomNormalize(Vector v){\n    float a = geomLength(v);\n    return multiplyScalar(1./a, v);\n}\n\n   \n                                                     \n   \nfloat cosAngle(Vector v1, Vector v2){\n    float a1 = geomLength(v1);\n    float a2 = geomLength(v2);\n    return geomDot(v1, v2)/ (a1 * a2);\n}\n\n   \n                                                           \n                                   \n                                                                                                        \n                                     \n                                                                   \n                                                                       \n   \nVector geomReflect(Vector v, Vector n){\n    return sub(v, multiplyScalar(2. * geomDot(v, n), n));\n}\n\n\n   \n                                         \n                                                                        \n                                                                                   \n                                              \n   \nVector geomRefract(Vector v, Vector n, float r){\n    float cosTheta1 = -geomDot(n, v);\n    float sinTheta2Sq = r * r * (1. - cosTheta1 * cosTheta1);\n\n    if (sinTheta2Sq > 1.){\n               \n        return zeroVector(v.pos);\n    }\n                                                                 \n    float cosTheta2 = sqrt(1. - sinTheta2Sq);\n    float aux = r * cosTheta1 - cosTheta2;\n    return add(multiplyScalar(r, v), multiplyScalar(aux, n));\n}\n\n   \n                                                                          \n                                           \n   \nIsometry makeTranslation(Vector v) {\n    return makeTranslation(v.pos);\n}\n\n   \n                                                                          \n                                              \n   \nIsometry makeInvTranslation(Vector v) {\n    return makeInvTranslation(v.pos);\n}\n"},4168:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                                                               \n  \n                                                                                                                        \n                                                                                                                        \n\n   \n                                                                         \n               \n   \nVector createVector(Point p, vec3 coords, Vector[3] frame){\n    Vector c0 = multiplyScalar(coords[0], frame[0]);\n    Vector c1 = multiplyScalar(coords[1], frame[1]);\n    Vector c2 = multiplyScalar(coords[2], frame[2]);\n    return add(c0, add(c1, c2));\n}\n\n\n\n   \n                                                                                          \n               \n   \nVector createVector(Point p, vec3 coords){\n    Vector[3] f;\n    frame(p, f);\n    return createVector(p, coords, f);\n}\n\n   \n                                                                                          \n               \n   \nVector createVectorOrtho(Point p, vec3 coords){\n    Vector[3] f;\n    orthoFrame(p, f);\n    return createVector(p, coords, f);\n}\n\n\n                                                                                                                        \n  \n                   \n                                                             \n                                                                       \n  \n                                                                                                                        \n\nstruct Position {\n    Isometry boost;\n    mat4 facing;\n};\n\n\n   \n                                        \n                          \n                                           \n   \nVector applyPosition(Position p, Vector v){\n    Vector res = applyFacing(p.facing, v);\n    return applyIsometry(p.boost, res);\n}"},2792:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                       \n                                                                                               \n  \n                                                                                                                        \n                                                                                                                        \n\n   \n              \n                                \n   \nPoint applyIsometry(GroupElement elt, Point p){\n    return applyIsometry(toIsometry(elt), p);\n}\n\nPoint applyGroupElement(GroupElement elt, Point p){\n    return applyIsometry(toIsometry(elt), p);\n}\n\n   \n              \n                                \n   \nVector applyIsometry(GroupElement elt, Vector v){\n    return applyIsometry(toIsometry(elt), v);\n}\n\nVector applyGroupElement(GroupElement elt, Vector v){\n    return applyIsometry(toIsometry(elt), v);\n}\n\n\n\n                                                                                                                        \n  \n                      \n                                                        \n                                                                     \n                        \n                                                                                 \n                                                                                 \n                                                                                   \n                                                                                    \n                                                                       \n                                                                                                                        \n\nstruct RelPosition {\n    Position local;\n    GroupElement cellBoost;\n    GroupElement invCellBoost;\n};\n\n\n                                                                                                                        \n  \n                    \n                                  \n                                                                       \n                      \n                                                                                 \n                                                                                 \n                                                                            \n                                                                                    \n                                                                                                                        \n\nstruct RelVector {\n    Vector local;\n    GroupElement cellBoost;\n    GroupElement invCellBoost;\n};\n\n\n   \n                                                            \n   \nRelVector reduceError(RelVector v){\n    v.local = reduceError(v.local);\n    return v;\n}\n\n   \n                         \n                            \n                                                      \n   \nRelVector add(RelVector v1, RelVector v2){\n    v1.local = add(v1.local, v2.local);\n    return v1;\n}\n\n   \n                              \n                            \n                                                      \n   \nRelVector sub(RelVector v1, RelVector v2){\n    v1.local = sub(v1.local, v2.local);\n    return v1;\n}\n\n   \n                                   \n                         \n                      \n   \nRelVector multiplyScalar(float s, RelVector v){\n    v.local = multiplyScalar(s, v.local);\n    return v;\n}\n\n   \n                                                                                 \n                     \n                                                        \n   \nfloat geomDot(RelVector v1, RelVector v2) {\n    return geomDot(v1.local, v2.local);\n}\n\n   \n                              \n   \nRelVector geomNormalize(RelVector v){\n    v.local = geomNormalize(v.local);\n    return v;\n}\n\n   \n                                   \n                                                        \n   \nRelVector geomMix(RelVector v1, RelVector v2, float a) {\n    v1.local = geomMix(v1.local, v2.local, a);\n    return v1;\n}\n\n   \n                                            \n   \nRelVector negate(RelVector v){\n    v.local = negate(v.local);\n    return v;\n}\n\n   \n                                                                     \n                                                       \n   \nRelVector geomReflect(RelVector v, RelVector normal){\n    v.local = geomReflect(v.local, normal.local);\n    return v;\n}\n\n\n   \n                                                                     \n                                                       \n   \nRelVector geomRefract(RelVector v, RelVector normal, float n){\n    v.local = geomRefract(v.local, normal.local, n);\n    return v;\n}\n\n   \n                         \n                                            \n                                                                         \n   \nRelVector flow(RelVector v, float t) {\n    v.local = flow(v.local, t);\n    return v;\n}\n\n   \n                                                                                          \n                                                                           \n                                                                          \n                               \n                                                                                              \n   \nRelVector smallShift(RelVector v, vec3 dp){\n    v.local = smallShift(v.local, dp);\n    return v;\n                                                 \n                                                               \n}\n\n\n   \n                                                                                                            \n                           \n                                                   \n                                                                                             \n                                            \n   \n                                                   \n                                                   \n               \n                                                             \n                                                                 \n   \n\n   \n                                                                                                            \n                                                   \n                                                                                             \n   \nRelVector createRelVector(RelVector v, vec3 coords){\n    v.local =  createVector(v.local.pos, coords);\n    return v;\n                                                           \n                                                               \n}\n\n   \n                                                                  \n                          \n                                           \n   \nRelVector applyPosition(RelPosition position, Vector v) {\n    Vector local = applyPosition(position.local, v);\n    return RelVector(local, position.cellBoost, position.invCellBoost);\n}\n\n   \n                                                                                                                    \n   \nRelVector rewrite(RelVector v, GroupElement elt, GroupElement inv){\n    v.local = applyGroupElement(elt, v.local);\n                                     \n                                       \n    v.cellBoost = multiply(v.cellBoost, inv);\n    v.invCellBoost = multiply(elt, v.invCellBoost);\n    return v;\n}\n\n\n                                                                                                                        \n  \n                    \n                                    \n                                                                              \n                  \n                                                      \n                                                                                         \n  \n                                                                                                                        \n\nstruct ExtVector {\n    RelVector vector;\n    VectorData data;\n};\n\n\nExtVector flow(ExtVector v, float t) {\n    v.vector = flow(v.vector, t);\n    v.data.lastFlowDist = t;\n    v.data.lastBounceDist = v.data.lastBounceDist + t;\n    v.data.totalDist  = v.data.totalDist + t;\n    return v;\n}\n\n\n\n"},5315:e=>{e.exports="   \n                          \n   \nvarying vec3 spherePosition;\n\n   \n                                           \n                       \n                                                           \n                                 \n                                                         \n   \nvoid main() {\n    RelVector vector = mapping(spherePosition);\n    ExtVector v = ExtVector(vector, initVectorData());\n    vec3 color = getColor(v);\n    gl_FragColor = vec4(color, 1);\n}"},9461:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                              \n  \n                                                                                                                        \n                                                                                                                        \n\nstruct VectorData {\n    float lastFlowDist;                                                                    \n    float lastBounceDist;                                                           \n    float totalDist;                                                  \n    bool isTeleported;                                             \n    int iMarch;                                                        \n    int iBounce;                                             \n    bool stop;                              \n    vec3 pixel;                                                                   \n    vec3 leftToComputeColor;                                                                     \n};"},1767:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                                             \n  \n                                                                                                                        \n                                                                                                                        \n\n   \n              \n   \nconst float PI = 3.1415926538;\n\n   \n                      \n   \nvec3 debugColor = vec3(0.5, 0, 0.8);\n\n   \n                                    \n         \n   \nconst int HIT_NOTHING = 0;\n   \n                                    \n         \n   \nconst int HIT_SOLID = 1;\n   \n                                  \n         \n   \nconst int HIT_DEBUG = -1;\n"},145:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n              \n  \n                                                                                                                        \n                                                                                                                        \n\n\n   \n                \n                                                      \n                                         \n                                                                                       \n                                                      \n                                                                    \n          \n                                \n                               \n                          \n                                                                                               \n                                                               \n                                                                                                                 \n                                                                                         \n   \nint raymarch(inout ExtVector v, out int objId){\n    initFlow(v.vector.local);                                                                 \n    ExtVector globalV0 = v;\n    ExtVector globalV = globalV0;\n    ExtVector localV0 = v;\n    ExtVector localV = localV0;\n    ExtVector res = v;\n    int auxId;\n    int auxHit;\n    float marchingStep = camera.minDist;\n    float dist;\n    int hit = HIT_NOTHING;\n\n    \n                  \n    for (int i = 0; i < camera.maxSteps; i++){\n                          \n        localV.data.iMarch = v.data.iMarch + i;\n        \n                                                     \n        localV = teleport(localV);\n        if (localV.data.isTeleported){\n                                                                                           \n            localV0 = localV;\n                                                                                      \n            marchingStep = camera.minDist;\n        }\n        else {\n                                                    \n            if (localV.data.totalDist > camera.maxDist) {\n                break;\n            }\n            dist = localSceneSDF(localV.vector, auxHit, auxId);\n            if (auxHit == HIT_DEBUG){\n                hit = HIT_DEBUG;\n                break;\n            }\n            if (auxHit == HIT_SOLID) {\n                                   \n                hit = HIT_SOLID;\n                objId = auxId;\n                v = localV;\n                break;\n            }\n            marchingStep = marchingStep + dist;\n            localV = creepingFlow(localV0, marchingStep, camera.threshold);\n        }\n    }\n    if(hit == HIT_NOTHING) {\n        v = localV;\n    }\n\n                  \n    marchingStep = camera.minDist;\n    for (int i=0; i < camera.maxSteps; i++){\n                          \n        globalV.data.iMarch = v.data.iMarch + i;\n        \n        if (globalV.data.totalDist > localV.data.totalDist || globalV.data.totalDist > camera.maxDist){\n                                              \n            break;\n        }\n        dist = globalSceneSDF(globalV.vector, auxHit, auxId);\n\n        if (auxHit == HIT_DEBUG){\n            hit = HIT_DEBUG;\n            break;\n        }\n        if (auxHit == HIT_SOLID) {\n                               \n            hit = auxHit;\n            objId = auxId;\n            v = globalV;\n            break;\n        }\n        marchingStep = marchingStep + dist;\n        globalV = flow(globalV0, marchingStep);\n    }\n\n    if(hit == HIT_NOTHING) {\n        v = globalV;\n    }\n    return hit;\n}\n\nvec3 getColor(ExtVector v){\n    int objId;\n    int hit;\n    for (int i = 0; i <= maxBounces; i++){\n        if (v.data.stop){\n            break;\n        }\n        hit = raymarch(v, objId);\n        updateVectorData(v, hit, objId);\n    }\n    return v.data.pixel;\n}"},2639:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                \n  \n                                                                                                                        \n                                                                                                                        \n \nvarying vec3 spherePosition;\n\n   \n                                      \n                                                   \n                                                               \n                                                 \n   \nvoid main()\n{\n    spherePosition = position;\n    gl_Position = projectionMatrix * vec4(position, 1.0);\n}"},8187:e=>{e.exports="   \n                          \n   \nvarying vec3 spherePosition;\n\n\n   \n                                           \n                       \n                                                           \n                                 \n                                                         \n   \nvoid main() {\n    initSeed(gl_FragCoord.xy, frameSeed);\n    RelVector vector = mappingFromFlatScreen(gl_FragCoord.xy);\n    ExtVector v = ExtVector(vector, initVectorData());\n    vec3 color = getColor(v);\n    gl_FragColor = vec4(color, 1);\n}\n"},9638:e=>{e.exports="   \n                                                \n  \n   \nuint seed;\n\n   \n                                                \n                                                                  \n                                                \n                                                                                                         \n   \nvoid initSeed(vec2 coords, uint frameSeed){\n    uvec2 aux = uvec2(coords);\n    seed =  aux.x * uint(1973) + aux.y * uint(925277) + frameSeed * uint(26699) | uint(1);\n}\n\n   \n                           \n               \n                                                                                                     \n   \nuint wangHash() {\n    seed = (seed ^ uint(61)) ^ (seed >> uint(16));\n    seed = seed * uint(9);\n    seed = seed ^ (seed >> 4);\n    seed = seed * uint(0x27d4eb2d);\n    seed = seed ^ (seed >> 15);\n    return seed;\n}\n\n   \n                                                  \n   \nfloat randomFloat() {\n    return float(wangHash()) / 4294967296.;\n}\n\n   \n                                                                           \n                                                                                                    \n                                                                                                       \n                                          \n   \nvec3 randomUnitVec3() {\n    float z = randomFloat() * 2. - 1.;\n    float theta = randomFloat() * 2. * PI;\n    float r = sqrt(1. - z * z);\n    float x = r * cos(theta);\n    float y = r * sin(theta);\n    return vec3(x, y, z);\n}\n\n   \n                                                   \n                                                      \n   \nVector randomVector(Point p) {\n    vec3 dir = randomUnitVec3();\n    return createVectorOrtho(p, dir);\n}\n\n   \n                                                                     \n                                                                                               \n   \nvec2 randomNormal2D(){\n    float u = randomFloat();\n    float v = randomFloat();\n\n    float r = sqrt(abs(2. * log(u)));\n    float x = r * cos(2. * PI * v);\n    float y = r * sin(2. * PI * v);\n\n    return vec2(x, y);\n\n}\n\n   \n                                                      \n   \nfloat randomNormal(float mean, float stdev){\n\n                           \n    float x = randomNormal2D().x;\n\n                                   \n    return stdev * x + mean;\n}\n"},7920:e=>{e.exports="   \n                                                                                      \n  \n   \n\n\n   \n                                                                                   \n                                                                          \n                                                       \n   \nRelVector randomVector(RelVector v) {\n    v.local = randomVector(v.local.pos);\n    return v;\n}"},3499:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n              \n  \n                                                                                                                        \n                                                                                                                        \n\n\n   \n                \n                                                      \n                                         \n                                                                                       \n                                                      \n                                                                    \n          \n                                \n                               \n                          \n                                                                                               \n                                                               \n                                                                                                                 \n                                                                                         \n   \nint raymarch(inout ExtVector v, out int objId){\n    initFlow(v.vector.local);                                                                 \n    ExtVector globalV0 = v;\n    ExtVector globalV = globalV0;\n    ExtVector localV0 = v;\n    ExtVector localV = localV0;\n    ExtVector res = v;\n    int auxId;\n    int auxHit;\n    float marchingStep = camera.minDist;\n    float dist;\n    int hit = HIT_NOTHING;\n\n    \n                  \n    for (int i = 0; i < camera.maxSteps; i++){\n                          \n        localV.data.iMarch = v.data.iMarch + i;\n        \n                                                     \n        localV = teleport(localV);\n        if (localV.data.isTeleported){\n                                                                                           \n            localV0 = localV;\n                                                                                      \n            marchingStep = camera.minDist;\n        }\n        else {\n                                                    \n            if (localV.data.totalDist > camera.maxDist) {\n                break;\n            }\n            dist = localSceneSDF(localV.vector, auxHit, auxId);\n            if (auxHit == HIT_DEBUG){\n                hit = HIT_DEBUG;\n                break;\n            }\n            if (auxHit == HIT_SOLID) {\n                                   \n                hit = HIT_SOLID;\n                objId = auxId;\n                v = localV;\n                break;\n            }\n            marchingStep = marchingStep + abs(dist);\n            localV = creepingFlow(localV0, marchingStep, camera.threshold);\n        }\n    }\n    if(hit == HIT_NOTHING) {\n        v = localV;\n    }\n                  \n    marchingStep = camera.minDist;\n    for (int i=0; i < camera.maxSteps; i++){\n                          \n        globalV.data.iMarch = v.data.iMarch + i;\n        \n        if (globalV.data.totalDist > localV.data.totalDist || globalV.data.totalDist > camera.maxDist){\n                                              \n            break;\n        }\n        dist = globalSceneSDF(globalV.vector, auxHit, auxId);\n\n        if (auxHit == HIT_DEBUG){\n            hit = HIT_DEBUG;\n            break;\n        }\n        if (auxHit == HIT_SOLID) {\n                               \n            hit = auxHit;\n            objId = auxId;\n            v = globalV;\n            break;\n        }\n        marchingStep = marchingStep + abs(dist);\n        globalV = flow(globalV0, marchingStep);\n    }\n\n    if(hit == HIT_NOTHING) {\n        v = globalV;\n    }\n    return hit;\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nbool doesItScatter(inout float dist, float opticalDepth){\n                          \n    if (opticalDepth>100.){\n        return false;\n    }\n    else {\n        float probScatter=1.-exp(-dist/opticalDepth);\n        float flip=randomFloat();\n        if (flip<probScatter){\n                                           \n                                                \n            dist=dist*randomFloat();\n            return true;\n        }\n                                              \n        return false;\n    }\n}\n\n\nvoid scatterRay(inout ExtVector v){\n                                         \n    RelVector w=randomVector(v.vector);\n    \n                                                 \n                                                  \n    v.vector=w;\n                                             \n                                                      \n}\n\n\n\nint scatterRaymarch(inout ExtVector v, out int objId){\n    initFlow(v.vector.local);                                                                 \n    ExtVector globalV0 = v;\n    ExtVector globalV = globalV0;\n    ExtVector localV0 = v;\n    ExtVector localV = localV0;\n    ExtVector res = v;\n    int auxId;\n    int auxHit;\n    float marchingStep = camera.minDist;\n    float dist;\n    int hit = HIT_NOTHING;\n    float d;\n    bool doScatter;\n\n\n                  \n    for (int i = 0; i < camera.maxSteps; i++){\n                          \n        localV.data.iMarch = v.data.iMarch + i;\n\n                                                     \n        localV = teleport(localV);\n        if (localV.data.isTeleported){\n                                                                                           \n            localV0 = localV;\n                                                                                      \n            marchingStep = camera.minDist;\n        }\n        else {\n                                                    \n            if (localV.data.totalDist > camera.maxDist) {\n                break;\n            }\n            dist = localSceneSDF(localV.vector, auxHit, auxId);\n            if (auxHit == HIT_DEBUG){\n                hit = HIT_DEBUG;\n                break;\n            }\n            if (auxHit == HIT_SOLID) {\n                                   \n                hit = HIT_SOLID;\n                objId = auxId;\n                v = localV;\n                break;\n            }\n            \n                                          \n            d=abs(dist);\n            doScatter=doesItScatter(d,v.data.currentOpticalDepth);\n            \n                                                \n            marchingStep = marchingStep + d;\n            localV = creepingFlow(localV0, marchingStep, camera.threshold);\n            \n                                                       \n            if(doScatter){\n                scatterRay(localV);\n            }\n        }\n    }\n    if(hit == HIT_NOTHING) {\n        v = localV;\n    }\n                  \n    marchingStep = camera.minDist;\n    for (int i=0; i < camera.maxSteps; i++){\n                          \n        globalV.data.iMarch = v.data.iMarch + i;\n\n        if (globalV.data.totalDist > localV.data.totalDist || globalV.data.totalDist > camera.maxDist){\n                                              \n            break;\n        }\n        dist = globalSceneSDF(globalV.vector, auxHit, auxId);\n\n        if (auxHit == HIT_DEBUG){\n            hit = HIT_DEBUG;\n            break;\n        }\n        if (auxHit == HIT_SOLID) {\n                               \n            hit = auxHit;\n            objId = auxId;\n            v = globalV;\n            break;\n        }\n        \n                                      \n        d=abs(dist);\n        doScatter=doesItScatter(d,v.data.currentOpticalDepth);\n\n                                            \n        marchingStep = marchingStep + d;\n        globalV = flow(globalV0, marchingStep);\n\n                                                   \n        if(doScatter){\n            scatterRay(globalV);\n        }\n    }\n\n    if(hit == HIT_NOTHING) {\n        v = globalV;\n    }\n    return hit;\n}\n\n\n\n\n\n\n\n\n\n\n\n\nvec3 getColor(ExtVector v){\n    int objId;\n    int hit;\n    for (int i = 0; i <= maxBounces; i++){\n        if (v.data.stop){\n            break;\n        }\n        hit = scatterRaymarch(v, objId);\n        updateVectorData(v, hit, objId);\n    }\n    return v.data.pixel;\n}"},3888:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n           \n  \n                                                                                                                        \n                                                                                                                        \n\nstruct RayType{\n    bool diffuse;\n    bool reflect;\n    bool refract;\n    float chance;\n};\n\n                                                                                                                        \n                                                                                                                        \n  \n                              \n  \n                                                                                                                        \n                                                                                                                        \n\nstruct VectorData {\n    float lastFlowDist;                                                                    \n    float lastBounceDist;                                                           \n    float totalDist;                                                  \n    bool isTeleported;                                             \n    int iMarch;                                                        \n    int iBounce;                                             \n    bool stop;                              \n    vec3 pixel;         \n    vec3 light;         \n    vec3 currentAbsorb;                                                    \n    vec3 currentEmission;                                                             \n    float currentOpticalDepth;                                                              \n    bool isInside;                                        \n};\n\n"},7499:e=>{e.exports="                                                                                                                        \n  \n           \n                               \n  \n                                                                                                                        \n \n struct Solid {\n    bool isRendered;\n };\n"},5595:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                                                    \n  \n                                                                                                                        \n                                                                                                                        \n\n\n                                                                                                                        \n  \n                       \n  \n                                                                                                                        \n\n  \n                                              \n                                                                                                                 \n                                     \n                                                                                        \n                                                \n  \n\n                                                                  \nfloat ell_k;\nfloat ell_kprime;\nfloat ell_m;\nfloat ell_K;\nfloat ell_E;\n\n                                                                                                                 \nfloat ell_mu;\nfloat ell_L;\n\n  \n                                       \n                                                          \n                                                                             \n                                       \n                                                                                 \n                                           \n                                     \n                                          \n                                                                                      \n                                       \n                        \n                                                                      \n                                  \n                           \n         \n                                                                           \n                                                                                       \n                                      \n                                                                                              \n                                                                  \n  \n\n\n                                               \nconst int AGMSteps = 20;\n                                 \nconst float AGMTolerance = 0.000001;\n                                                                       \n                                                                \n                        \n                       \n              \nvec3 AGMList[AGMSteps];\n                                                                                                                       \nint AGMLength;\n\nvoid agm() {\n                                                                 \n                                     \n                                            \n                                             \n                                        \n\n                     \n    AGMList[0] = vec3(1., ell_kprime, ell_k);\n    AGMLength = 1;\n\n                                         \n    float a0;\n    float g0;\n    float error;\n\n                \n    for (int i = 1; i < AGMSteps; i++) {\n        a0 = AGMList[i - 1].x;\n        g0 = AGMList[i - 1].y;\n        error = 0.5 * (a0 - g0);\n\n        if (error < AGMTolerance) {\n            break;\n        }\n\n        AGMList[i] = vec3(0.5 * (a0 + g0), sqrt(a0 * g0), error);\n        AGMLength = AGMLength + 1;\n    }\n}\n\nvec2 ellipke() {\n                                                                 \n                                                       \n\n                                           \n    float aux = 0.;\n\n                \n    for (int i = 0; i < AGMLength; i++) {\n        aux = aux + pow(2., float(i-1)) * AGMList[i].z * AGMList[i].z;\n    }\n\n                              \n    float K = 0.5 * PI / AGMList[AGMLength - 1].x;\n    float E = K * (1. - aux);\n    return vec2(K, E);\n}\n\nvec3 ellipj1(float u) {\n                                                                          \n                                            \n                                                           \n                                                                 \n                                            \n\n                                          \n    float a0 = AGMList[AGMLength - 1].x;\n    float g0 = AGMList[AGMLength - 1].y;\n\n    float eps = 1.;\n    if (sin(u * a0) < 0.) {\n        eps = -1.;\n    }\n\n                                                 \n\n    float c = a0 * cos(u * a0) / sin(u * a0);\n    float d = 1.;\n    float aux_c;\n    float aux_d;\n    float num;\n    float den;\n\n    for (int j = 1; j < AGMLength; j++) {\n        aux_c = c * d;\n        num = (c * c / AGMList[AGMLength - j].x + AGMList[AGMLength - 1 - j].y);\n        den = (c * c / AGMList[AGMLength - j].x + AGMList[AGMLength - 1 - j].x);\n        aux_d =  num / den;\n        c = aux_c;\n        d = aux_d;\n    }\n\n                           \n    float sn = eps / sqrt(1. + c * c);\n    float cn = c * sn;\n    float dn = d;\n\n    return vec3(sn, cn, dn);\n}\n\n\nvec3 ellipj2(float u) {\n                                                                          \n                                            \n                                                              \n                                            \n\n                                                    \n    float phi0 = pow(2., float(AGMLength-1)) * AGMList[AGMLength - 1].x * u;\n    float phi1;\n    float aux;\n\n\n    for (int i = 1; i < AGMLength; i++) {\n        aux = AGMList[AGMLength - i].z / AGMList[AGMLength - i].x;\n        phi1 = 0.5 * (phi0 + asin(aux * sin(phi0)));\n        phi0 = phi1;\n    }\n\n    float sn = sin(phi0);\n    float cn = cos(phi0);\n    float dn = sqrt(1. - ell_m * sn * sn);\n    return vec3(sn, cn, dn);\n\n}\n\n\nvec3 ellipj3(float u) {\n                                                                          \n                                                                  \n\n    float emc = 1.0-ell_m;\n    float a, b, c;\n    const int N = 4;\n    float em[N], en[N];\n    a = 1.0;\n    float dn = 1.0;\n    for (int i = 0; i < N; i++) {\n        em[i] = a;\n        emc = sqrt(emc);\n        en[i] = emc;\n        c = 0.5*(a+emc);\n        emc = a*emc;\n        a = c;\n    }\n                                          \n                              \n    u = c*u;\n    float sn = sin(u);\n    float cn = cos(u);\n    if (sn != 0.0) {\n        a = cn/sn; c = a*c;\n        for (int i = N-1; i >= 0; i--) {\n            b = em[i];\n            a = c*a;\n            c = dn*c;\n            dn = (en[i]+a)/(b+a);\n            a = c/b;\n        }\n        a = 1.0/sqrt(c*c + 1.0);\n        if (sn < 0.0) sn = -a;\n        else sn = a;\n        cn = c*sn;\n    }\n\n    return vec3(sn, cn, dn);\n}\n\n\nvec3 ellipjAtZero(float u) {\n                                                                                       \n                                                       \n\n    float k2 = ell_m;\n    float k4 = ell_m * ell_m;\n    float k6 = k4 * ell_m;\n\n    float u1 = u;\n    float u2 = u1 * u;\n    float u3 = u2 * u;\n    float u4 = u3 * u;\n    float u5 = u4 * u;\n    float u6 = u5 * u;\n    float u7 = u6 * u;\n\n    return vec3(\n    u1\n    - (1. + k2) * u3 / 6.\n    + (1. + 14. * k2 + k4) * u5 / 120.\n    - (1. + 135. * k2 + 135. * k4 + k6) * u7 / 5040.,\n\n    1.\n    - u2 / 2.\n    + (1. + 4. * k2) * u4 / 24.\n    - (1. + 44. * k2 + 16. * k4) * u6 / 720.,\n\n    1.\n    - k2 * u2 / 2.\n    + k2 * (4. + k2) * u4 / 24.\n    - k2 * (16. + 44. * k2 + k4) * u6 / 720.\n    );\n}\n\n\n\nvec3 ellipj(float u) {\n                                                                                                     \n                                                                \n    float tolerance = 0.001;\n\n\n    float u1 = mod(u, 4. * ell_K);\n    float sign = 1.;\n    if (u1 > 2. * ell_K) {\n        u1 = 4.* ell_K -u1;\n        sign = -1.;\n    }\n\n    vec3 aux;\n\n    if (u1 < tolerance) {\n        aux = ellipjAtZero(u1);\n    }\n    else {\n        aux = ellipj1(u1);\n    }\n\n    return vec3(sign * aux.x, aux.y, aux.z);\n}\n\n\nfloat ellipz(float tanPhi) {\n                                                                                               \n                                                   \n                                                                                                         \n                                   \n                                                              \n                                                        \n    float tolerance = 0.001;\n\n\n    float sign = 1.;\n    float t0 = tanPhi;\n    if (t0 < 0.) {\n        t0 = - t0;\n        sign = -1.;\n    }\n\n    float res = 0.;\n\n                                                                        \n                               \n    if (t0 < tolerance) {\n        float k2 = ell_m;\n        float k4 = k2 * ell_m;\n        float k6 = k4 * ell_m;\n        res =  - (ell_E /ell_K - 1.) * t0;\n        res = res - (1./6.) * (ell_E * k2 / ell_K + k2 - 2. * ell_E / ell_K + 2.) * pow(t0, 3.);\n        res = res - (1./40.) * (3. * ell_E * k4 / ell_K + k4 - 8. * ell_E * k2 / ell_K - 8. * k2 + 8. * ell_E / ell_K - 8.) * pow(t0, 5.);\n        res = res - (1./112.) * (5. * ell_E * k6 / ell_K + k6 - 18. * ell_E * k4 / ell_K - 6. * k4 + 24. * ell_E * k2 / ell_K + 24. * k2 - 16. * ell_E / ell_K + 16.) * pow(t0, 7.);\n    }\n    else {\n                                                       \n\n        float t1;                           \n        float s1;                           \n        float aux;\n\n        for (int i = 0; i < AGMLength; i++) {\n            aux = AGMList[i].y / AGMList[i].x;\n            t1 = t0 * (1. + aux) / (1. - aux * t0 * t0);\n            s1 = t0 * (1. + aux) / sqrt((1. + t0 * t0) * (1. + aux * aux * t0 * t0));\n            res = res + AGMList[i + 1].z * s1;\n\n            t0 = t1;\n        }\n    }\n    return sign * res;\n}\n\n                                                                                                                        \n  \n                   \n                                            \n                            \n             \n                                                                              \n  \n                                                                                                                        \nstruct Isometry{\n    mat4 matrix;\n    bool isInSol;\n};\n\n   \n                    \n   \nconst Isometry IDENTITY = Isometry(mat4(1.), true);                          \n\n   \n                                                              \n                      \n   \nIsometry reduceError(Isometry isom){\n    return isom;\n}\n\n   \n                                     \n   \nIsometry multiply(Isometry isom1, Isometry isom2) {\n    return Isometry(isom1.matrix * isom2.matrix, isom1.isInSol && isom2.isInSol);\n}\n\n   \n                                            \n   \nIsometry geomInverse(Isometry isom) {\n    mat4 inv = inverse(isom.matrix);\n    return Isometry(inv, isom.isInSol);\n}\n\n                                                                                                                        \n  \n                \n                                        \n  \n                                                                                                                        \nstruct Point{\n    vec4 coords;\n};\n\n\nconst Point ORIGIN = Point(vec4(0, 0, 0, 1));                              \n\n\n   \n                                                           \n   \nPoint reduceError(Point p){\n    return p;\n}\n\n   \n                                       \n   \nPoint applyIsometry(Isometry isom, Point p) {\n    vec4 coords = isom.matrix * p.coords;\n    return Point(coords);\n}\n\n  \n                                         \n   \nPoint flip(Point p){\n    return Point(vec4(p.coords.y, p.coords.x, -p.coords.z, 1.));\n}\n\n   \n                                                                     \n                                  \n   \n\nIsometry makeTranslation(Point p) {\n    vec4 c = p.coords;\n    mat4 matrix =  mat4(\n    exp(c.z), 0., 0., 0.,\n    0., exp(-c.z), 0., 0.,\n    0., 0., 1., 0,\n    c.x, c.y, c.z, 1.\n    );\n    return Isometry(matrix, true);\n}\n\n   \n                                                                     \n                                     \n   \nIsometry makeInvTranslation(Point p) {\n    vec4 c = p.coords;\n    mat4 matrix =  mat4(\n    exp(-c.z), 0., 0., 0.,\n    0., exp(c.z), 0., 0.,\n    0., 0., 1., 0,\n    -exp(-c.z) * c.x, -exp(c.z) * c.y, -c.z, 1.\n    );\n    return Isometry(matrix, true);\n}\n\n                                                                                                                        \n  \n                 \n                                                              \n                                                                                                  \n                       \n                                                                      \n                                                                                                        \n  \n                                                                                                                        \nstruct Vector{\n    Point pos;                     \n    vec4 dir;                            \n};\n\n\n   \n                                \n   \nVector zeroVector(Point pos){\n    return Vector(pos, vec4(0));\n}\n\n   \n                                                            \n   \nVector reduceError(Vector v){\n    return v;\n}\n\n   \n                         \n                            \n   \nVector add(Vector v1, Vector v2){\n    return Vector(v1.pos, v1.dir + v2.dir);\n}\n\n   \n                              \n                            \n   \nVector sub(Vector v1, Vector v2){\n    return Vector(v1.pos, v1.dir - v2.dir);\n}\n\n   \n                                   \n                         \n                      \n   \nVector multiplyScalar(float s, Vector v){\n    return Vector(v.pos, s * v.dir);\n}\n\n   \n                                                                                 \n                     \n   \nfloat geomDot(Vector v1, Vector v2) {\n    return dot(v1.dir, v2.dir);\n}\n\n   \n                                        \n   \nVector applyIsometry(Isometry isom, Vector v) {\n    Point pos = applyIsometry(isom, v.pos);\n    if (isom.isInSol) {\n        return Vector(pos, v.dir);\n    } else {\n        Isometry push = makeTranslation(v.pos);\n        Isometry pull = makeInvTranslation(pos);\n        vec4 dir = pull.matrix * isom.matrix * push.matrix * v.dir;\n        return Vector(pos, v.dir);\n    }\n}\n\n  \n                                         \n   \nVector flip(Vector v){\n    Point pos = flip(v.pos);\n    return Vector(pos, vec4(v.dir.y, v.dir.x, -v.dir.z, 0.));\n}\n\n   \n                                                                         \n                                                                                                           \n                                           \n   \nVector applyFacing(mat4 m, Vector v) {\n    return Vector(v.pos, m * v.dir);\n}\n\nvoid initFlow(Vector v){\n                                                                                      \n                                                     \n                                                                        \n                                             \n                                                                                        \n                                                              \n\n                                             \n                                        \n    float ab = abs(v.dir.x * v.dir.y);\n\n                                                                      \n    float aux1 = sqrt(1. - 2. * ab);\n    float aux2 = 2. * sqrt(ab);\n\n                \n    ell_mu = sqrt(1. + 2. * ab);\n\n                                           \n    ell_k = aux1 / ell_mu;\n    ell_kprime = aux2 / ell_mu;\n    ell_m = (1. - 2. * ab) / (1. + 2. * ab);\n\n                                                         \n    agm();\n    vec2 KE = ellipke();\n    ell_K = KE.x;\n    ell_E = KE.y;\n\n                                                                                                             \n    if (ab != 0.) {\n        ell_L = ell_E / (ell_kprime * ell_K) - 0.5 * ell_kprime;\n    }\n}\n"},9395:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                                                    \n  \n                                                                                                                        \n                                                                                                                        \n\n   \n                               \n                                                                       \n                                     \n                                                      \n   \nvoid frame(Point p, out Vector[3] f){\n    f[0] = Vector(p, vec4(1, 0, 0, 0));\n    f[1] = Vector(p, vec4(0, 1, 0, 0));\n    f[2] = Vector(p, vec4(0, 0, 1, 0));\n}\n\n   \n                                           \n                                                                       \n                                     \n                                                      \n   \nvoid orthoFrame(Point p, out Vector[3] f){\n    f[0] = Vector(p, vec4(1, 0, 0, 0));\n    f[1] = Vector(p, vec4(0, 1, 0, 0));\n    f[2] = Vector(p, vec4(0, 0, 1, 0));\n}\n\n   \n                                                                                         \n                              \n                                                                                              \n   \nPoint smallShift(Point p, vec3 dp){\n    Point aux = Point(vec4(dp, 1));\n    Isometry isom = makeTranslation(p);\n    return applyIsometry(isom, aux);\n}\n\nVector smallShift(Vector v, vec3 dp){\n    Point pos = smallShift(v.pos, dp);\n    return Vector(pos, v.dir);\n}\n\n   \n                                 \n               \n                                                   \n   \nVector numFlow(Vector v, float t){\n    float NUM_STEP = 0.0002;\n    Isometry shift = makeTranslation(v.pos);\n\n    Vector aux = Vector(ORIGIN, v.dir);\n    vec4 field_p;\n    vec4 field_u;\n    int n = int(floor(t/NUM_STEP));\n    for (int i=0; i<n; i++){\n        field_p = vec4(\n        exp(aux.pos.coords.z) * aux.dir.x,\n        exp(-aux.pos.coords.z) * aux.dir.y,\n        aux.dir.z,\n        0.\n        );\n        field_u = vec4(\n        aux.dir.x * aux.dir.z,\n        -aux.dir.y * aux.dir.z,\n        - aux.dir.x *  aux.dir.x + aux.dir.y * aux.dir.y,\n        0\n        );\n        aux.pos.coords = aux.pos.coords + NUM_STEP * field_p;\n        aux.dir = aux.dir + NUM_STEP * field_u;\n        aux = geomNormalize(aux);\n    }\n    return applyIsometry(shift, aux);\n}\n\nVector hypXFlow(Vector v, float t){\n                                                                  \n                                                          \n                                                        \n                                                            \n    \n                                                        \n    Isometry shift = makeTranslation(v.pos);\n                             \n    Vector resOrigin;\n\n                                                                              \n    float a = v.dir.x;\n    float b = v.dir.y;\n    float c = v.dir.z;\n\n                                                                      \n                                      \n                                                                  \n    float b2 = b * b;\n    float c2 = c * c;\n                                                                                          \n    float n1 = sqrt(b2 + c2);\n    float n2 = n1 * n1;\n    float n3 = n1 * n2;\n    float n4 = n1 * n3;\n                \n    float sign = 1.;\n    if (b < 0.) {\n        sign = -1.;\n    }\n                                                      \n    float shs = (c * cosh(n1 * t) + n1 * sinh(n1 * t)) / abs(b);\n    float chs = (n1 * cosh(n1 * t) + c * sinh(n1 * t)) / abs(b);\n    float ths = shs / chs;\n\n\n    vec4 u0 = vec4(\n    0.,\n    sign * n1 / chs,\n    n1 * ths,\n    0.\n    );\n\n    vec4 u1 = vec4(\n    abs(b) * chs / n1,\n    0.,\n    0.,\n    0.\n    );\n\n    vec4 u2 = vec4(\n    0.,\n    sign * b2 * chs / (4. * n3)\n    + sign * (b2 - 2. * c2)  * (n1 * t * shs / pow(chs, 2.) - 1. / chs) / (4. * n3)\n    - 3. * sign * c * shs / (4. * n2 * pow(chs, 2.)),\n    - b2 * shs * chs / (2. * n3)\n    - (b2 - 2. * c2) * (ths - n1 * t / pow(chs, 2.)) / (4. * n3)\n    + 3. * c / (4. * n2 * pow(chs, 2.)),\n    0.\n    );\n\n    resOrigin.dir = u0  + a * u1 + a * a * u2;\n\n\n    vec4 p0 = vec4(\n    0.,\n    n1 * ths / b - c / b,\n    log(abs(b) * chs / n1),\n    1.\n    );\n\n    vec4 p1 = vec4(\n    b2 * (shs * chs + n1 * t) / (2. * n3) - c / (2. * n2),\n    0.,\n    0.,\n    0.\n    );\n\n    vec4 p2 = vec4(\n    0.,\n    b * n1 * t / (2. * n3)\n    - (b2 - 2. * c2) * ( n1 * t / pow(chs, 2.) + ths) / (4. * b * n3)\n    + 3. * c / (4. * b * n2 * pow(chs, 2.))\n    - c / (2. * b * n2),\n    - b2 * pow(chs, 2.) / (4. * n4)\n    - (b2 - 2. * c2) * (n1 * t * ths - 1.) / (4. * n4)\n    + 3. * c * ths / (4. * n3),\n    0.\n    );\n\n    resOrigin.pos.coords = p0 + a * p1 + a * a * p2;\n    \n    resOrigin = geomNormalize(resOrigin);\n    return applyIsometry(shift, resOrigin);\n}\n\nVector hypYFlow(Vector v, float t) {\n                                                                  \n                                                      \n    Vector res = flip(v);\n    res = hypXFlow(res, t);\n    res = flip(res);\n    return res;\n}\n\n\nVector ellFlow(Vector v, float t){\n                                               \n                   \n\n                                                        \n    Isometry shift = makeTranslation(v.pos);\n\n                             \n    Vector resOrigin;\n\n                                                                              \n    float a = v.dir.x;\n    float b = v.dir.y;\n    float c = v.dir.z;\n    \n                                                                          \n                                                                                                       \n                                                                                                                    \n                                                                              \n\n                                                       \n\n                        \n                                                                                               \n                                            \n       \n            \n\n                                                                           \n\n                                                     \n        float aux = sqrt(1. - 2. * abs(a * b));\n                                                                                         \n        vec3 jacobi_s0 = vec3(\n        - c / aux,\n        (abs(a) - abs(b)) / aux,\n        (abs(a) + abs(b)) / ell_mu\n        );\n\n\n                              \n        float signa = 1.;\n        if (a < 0.) {\n            signa = -1.;\n        }\n        float signb = 1.;\n        if (b < 0.) {\n            signb = -1.;\n        }\n\n                                               \n        float kOkprime = ell_k / ell_kprime;\n        float oneOkprime = 1. / ell_kprime;\n\n                                                                         \n\n                                                    \n                                                                                                        \n        float s = mod(ell_mu * t, 4. * ell_K);\n                                                      \n        vec3 jacobi_s = ellipj(s);\n\n                                                                                     \n        float den = 1. - ell_m * jacobi_s.x * jacobi_s.x * jacobi_s0.x * jacobi_s0.x;\n        vec3 jacobi_ss0 = vec3(\n        (jacobi_s.x * jacobi_s0.y * jacobi_s0.z + jacobi_s0.x * jacobi_s.y * jacobi_s.z) / den,\n        (jacobi_s.y * jacobi_s0.y - jacobi_s.x * jacobi_s.z * jacobi_s0.x * jacobi_s0.z) / den,\n        (jacobi_s.z * jacobi_s0.z - ell_m * jacobi_s.x * jacobi_s.y * jacobi_s0.x * jacobi_s0.y) / den\n        );\n\n                                                                 \n        float zetaj = ellipz(jacobi_s.x / jacobi_s.y) - ell_m * jacobi_s.x * jacobi_s0.x * jacobi_ss0.x;\n\n\n                                       \n        resOrigin.pos.coords = vec4(\n\n        signa * sqrt(abs(b / a)) * (\n        oneOkprime * zetaj\n        + kOkprime * (jacobi_ss0.x - jacobi_s0.x)\n        + ell_L * ell_mu * t\n        ),\n        signb * sqrt(abs(a / b)) * (\n        oneOkprime * zetaj\n        - kOkprime * (jacobi_ss0.x - jacobi_s0.x)\n        + ell_L * ell_mu * t\n        ),\n        0.5 * log(abs(b / a)) + asinh(kOkprime * jacobi_ss0.y),\n        1.\n        );\n\n        resOrigin.dir = vec4(\n        a * sqrt(abs(b/a)) * (kOkprime * jacobi_ss0.y + oneOkprime * jacobi_ss0.z),\n        - b * sqrt(abs(a/b)) * (kOkprime * jacobi_ss0.y - oneOkprime * jacobi_ss0.z),\n        - ell_k * ell_mu * jacobi_ss0.x,\n        0.\n        );\n       \n\n    resOrigin = geomNormalize(resOrigin);\n    return applyIsometry(shift, resOrigin);\n}\n\n\n   \n                                  \n                                                 \n   \nVector flow(Vector v, float t){\n    float tolerance = 0.0001;\n\n    if (abs(t) < 0.002) {\n        return numFlow(v, t);\n                                \n    }\n    else {\n        if (abs(v.dir.x * t) < tolerance) {\n                                  \n            return hypXFlow(v, t);\n        }\n        else if (abs(v.dir.y * t) < tolerance) {\n                                       \n            return hypYFlow(v, t);\n        }\n        else {\n            return ellFlow(v, t);\n        }\n    }\n}\n"},1360:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                     \n  \n                                                                                                                        \n                                                                                                                        \n\nconst float PHI = 0.5 * (1. + sqrt(5.));\nconst float DENUM = 1. / (PHI + 2.);\n\n                                                                                                                        \n          \n                            \n                                                                                                                        \n\nstruct GroupElement {\n    vec2 coords;                                           \n};\n\nconst GroupElement GROUP_IDENTITY = GroupElement(vec2(0));\n\nGroupElement multiply(GroupElement elt1, GroupElement elt2){\n    vec2 coords = elt1.coords + elt2.coords;\n    return GroupElement(coords);\n}\n\nIsometry toIsometry(GroupElement elt) {\n    float a = elt.coords.x;\n    float b = elt.coords.y;\n    vec4 coords = vec4((a * PHI + b) * DENUM, (-a + b * PHI) * DENUM, 0, 1);\n    return makeTranslation(Point(coords));\n}"},7802:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                     \n  \n                                                                                                                        \n                                                                                                                        \n\nconst float PHI = 0.5 * (1. + sqrt(5.));\nconst float DENUM = 1. / (PHI + 2.);\nconst float TAU = 2. * log(PHI);\n\n                                                                                                                        \n          \n                            \n                                                                                                                        \n\nstruct GroupElement {\n    vec3 coords;                                           \n    mat3 matrix;                                                 \n};\n\nconst GroupElement GROUP_IDENTITY = GroupElement(vec3(0), mat3(1));\n\nGroupElement multiply(GroupElement elt1, GroupElement elt2){\n    vec3 coords = elt1.coords + elt1.matrix * elt2.coords;\n    mat3 matrix = elt1.matrix * elt2.matrix;\n    return GroupElement(coords, matrix);\n}\n\nIsometry toIsometry(GroupElement elt) {\n    float a = elt.coords.x;\n    float b = elt.coords.y;\n    float c = elt.coords.z;\n    vec4 coords = vec4((a * PHI + b) * DENUM, (-a + b * PHI) * DENUM, c * TAU, 1);\n    return makeTranslation(Point(coords));\n}"},3573:e=>{e.exports="                                                                                                                        \n          \n                        \n                                                                                                                        \n\nstruct ConstDirLight {\n    int id;\n    vec3 color;\n    float intensity;\n    vec3 direction;\n    int maxDirs;\n};\n\nbool directions(ConstDirLight light, RelVector v, int i, out RelVector dir, out float intensity) {\n    if (i!=0){\n        return false;\n    }\n    intensity = light.intensity;\n                                                             \n                                                                        \n    vec4 coords = vec4(light.direction, 0.);\n    Vector local = Vector(v.local.pos, coords);\n    dir = RelVector(local, v.cellBoost, v.invCellBoost);\n    return true;\n}"},6010:e=>{e.exports="                                                                                                                        \n          \n                        \n                                                                                                                        \n\nstruct ZSun {\n    int id;\n    vec3 color;\n    float intensity;\n    float direction;\n    int maxDirs;\n};\n\nbool directions(ZSun light, RelVector v, int i, out RelVector dir, out float intensity) {\n    if (i!=0){\n        return false;\n    }\n    intensity = light.intensity;\n    Vector local=Vector(v.local.pos, vec4(0, 0, light.direction, 0));\n    dir = RelVector(local, v.cellBoost, v.invCellBoost);\n    return true;\n}"},3275:e=>{e.exports="                                                                                                                        \n                         \n                                                                                                                        \n\nstruct VaryingColorMaterial {\n    vec3 mainColor;\n    vec3 weight;\n};\n\nvec3 render(VaryingColorMaterial material, ExtVector v) {\n    return material.mainColor + material.weight * v.vector.local.pos.coords.xyz;\n}"},2361:e=>{e.exports="                                                                                                                        \n          \n                   \n                                                                                                                        \n\nstruct FakeBallShape {\n    int id;\n    Point center;\n    float radius;\n};\n\n   \n                                                \n   \nfloat sdf(FakeBallShape ball, RelVector v) {\n    Point center = applyGroupElement(v.invCellBoost, ball.center);\n    vec4 diff = v.local.pos.coords - center.coords;\n    return length(diff) - ball.radius;\n}\n\n   \n                                             \n   \nRelVector gradient(FakeBallShape ball, RelVector v){\n    Point center = applyGroupElement(v.invCellBoost, ball.center);\n    Vector local = Vector(v.local.pos, v.local.pos.coords - center.coords);\n    local = geomNormalize(local);\n    return RelVector(local, v.cellBoost, v.invCellBoost);\n}\n\n"},9277:e=>{e.exports="                                                                                                                        \n          \n                    \n                                                                                                                        \n\nstruct LocalCube {\n    int id;\n    vec4 testX;\n    vec4 testY;\n    vec4 testZ;\n    float smoothness;\n    vec3 sides;\n};\n\n   \n                                            \n   \nfloat sdf(LocalCube cube, RelVector v) {\n    float dotX = dot(v.local.pos.coords, cube.testX);\n    float dotY = dot(v.local.pos.coords, cube.testY);\n    float dotZ = dot(v.local.pos.coords, cube.testZ);\n\n    float distX = asinh((abs(dotX) - 0.5 * cube.sides.x) * exp(-dotZ));\n    float distY = asinh((abs(dotY) - 0.5 * cube.sides.y) * exp(dotZ));\n    float distZ = abs(dotZ) - 0.5 * cube.sides.z;\n\n    float aux = smoothMaxPoly(distX, distY, cube.smoothness);\n    return smoothMaxPoly(aux, distZ, cube.smoothness);\n}\n\n   \n                                         \n   \nRelVector gradient(LocalCube cube, RelVector v){\n    float dotX = dot(v.local.pos.coords, cube.testX);\n    float dotY = dot(v.local.pos.coords, cube.testY);\n    float dotZ = dot(v.local.pos.coords, cube.testZ);\n\n    float auxX = abs(dotX) - 0.5 * cube.sides.x;\n    float auxY = abs(dotY) - 0.5 * cube.sides.y;\n    float auxZX = exp(-dotZ);\n    float auxZY = exp(dotZ);\n    float distX = asinh(auxX * auxZX);\n    float distY = asinh(auxY * auxZY);\n    float distZ = abs(dotZ) - 0.5 * cube.sides.z;\n\n    float den;\n    vec4 dir;\n\n    den = sqrt(auxX * auxX + auxZX * auxZX + 1.);\n    dir = (auxZX / den) * (-auxX * cube.testZ + sign(auxX) * cube.testX);\n    dir.w = 0.;\n    RelVector gradX = RelVector(Vector(v.local.pos, dir), v.cellBoost, v.invCellBoost);\n\n    den = sqrt(auxY * auxY + auxZY * auxZY + 1.);\n    dir = (auxZY / den) * (auxY * cube.testZ + sign(auxY) * cube.testY);\n    dir.w = 0.;\n    RelVector gradY = RelVector(Vector(v.local.pos, dir), v.cellBoost, v.invCellBoost);\n\n    dir = sign(dotZ) * cube.testZ;\n    dir.w = 0.;\n    RelVector gradZ = RelVector(Vector(v.local.pos, dir), v.cellBoost, v.invCellBoost);\n\n    float distAux = smoothMaxPoly(distX, distY, cube.smoothness);\n    RelVector gradAux = gradientMaxPoly(distX, distY, gradX, gradY, cube.smoothness);\n\n    return gradientMaxPoly(distAux, distZ, gradAux, gradZ, cube.smoothness);\n}\n\n"},6290:e=>{e.exports="                                                                                                                        \n          \n                   \n                                                                                                                        \n\nstruct LocalFakeBallShape {\n    int id;\n    Point center;\n    float radius;\n};\n\n   \n                                                \n   \nfloat sdf(LocalFakeBallShape ball, RelVector v) {\n    vec4 diff = v.local.pos.coords - ball.center.coords;\n    return length(diff) - ball.radius;\n}\n\n   \n                                             \n   \nRelVector gradient(LocalFakeBallShape ball, RelVector v){\n    Vector local = Vector(v.local.pos, v.local.pos.coords - ball.center.coords);\n    local = geomNormalize(local);\n    return RelVector(local, v.cellBoost, v.invCellBoost);\n}\n\n"},1273:e=>{e.exports="                                                                                                                        \n          \n                       \n                                                                                                                        \n\nstruct LocalXYHalfSpaceShape {\n    vec4 testX;                                                                 \n    vec4 testZ;                                                                 \n    Point origin;\n    vec3 uDir;                                       \n    vec3 vDir;                                       \n};\n\n                                                                                                            \nfloat sdf(LocalXYHalfSpaceShape halfspace, RelVector v){\n    float dotX = dot(v.local.pos.coords, halfspace.testX);\n    float dotZ = dot(v.local.pos.coords, halfspace.testZ);\n    return asinh(dotX * exp(-dotZ));\n}\n\nRelVector gradient(LocalXYHalfSpaceShape halfspace, RelVector v){\n    float dotX = dot(v.local.pos.coords, halfspace.testX);\n    float dotZ = dot(v.local.pos.coords, halfspace.testZ);\n    float eDotZ = exp(-dotZ);\n    float coeff = 1. / sqrt(dotX * dotX * eDotZ * eDotZ + 1.);\n    vec4 dir = coeff * eDotZ * (halfspace.testX - dotX * halfspace.testZ);\n                                              \n                        \n    dir.w = 0.;\n    Isometry isom = makeInvTranslation(v.local.pos);\n    dir = isom.matrix * dir;\n    Vector n = Vector(v.local.pos, dir);\n    n = geomNormalize(n);\n    return RelVector(n, v.cellBoost, v.invCellBoost);\n}\n\nvec2 uvMap(LocalXYHalfSpaceShape halfspace, RelVector v){\n                                                                      \n                                                 \n                                                        \n                                                        \n    float uCoord = dot(v.local.pos.coords - halfspace.origin.coords, vec4(halfspace.uDir, 0));\n    float vCoord = dot(v.local.pos.coords - halfspace.origin.coords, vec4(halfspace.vDir, 0));\n    return vec2(uCoord, vCoord);\n}\n\n"},9583:e=>{e.exports="                                                                                                                        \n          \n                       \n                                                                                                                        \n\nstruct LocalZHalfSpaceShape {\n    vec4 test;                                                      \n    Point origin;                                                 \n    vec3 uDir;                                       \n    vec3 vDir;                                       \n};\n\n                                                                                                            \nfloat sdf(LocalZHalfSpaceShape halfspace, RelVector v){\n    return dot(v.local.pos.coords, halfspace.test);\n}\n\nRelVector gradient(LocalZHalfSpaceShape halfspace, RelVector v){\n                                                                     \n    vec4 dir = halfspace.test * vec4(0, 0, 1, 0);\n    Vector local = Vector(v.local.pos, dir);\n    return RelVector(local, v.cellBoost, v.invCellBoost);\n}\n\nvec2 uvMap(LocalZHalfSpaceShape halfspace, RelVector v){\n                                                                      \n                                                 \n                                                        \n                                                        \n    float uCoord = dot(v.local.pos.coords - halfspace.origin.coords, vec4(halfspace.uDir, 0));\n    float vCoord = dot(v.local.pos.coords - halfspace.origin.coords, vec4(halfspace.vDir, 0));\n    return vec2(uCoord, vCoord);\n}\n\n"},668:e=>{e.exports="                                                                                                                        \n          \n                       \n                                                                                                                        \n\nstruct XYHalfSpaceShape {\n    vec4 testX;                                                                 \n    vec4 testZ;                                                                 \n    Point origin;\n    vec3 uDir;                                       \n    vec3 vDir;                                       \n};\n\n                                                                                                            \nfloat sdf(XYHalfSpaceShape halfspace, RelVector v){\n    Isometry aux = toIsometry(v.cellBoost);\n    vec4 testX = transpose(aux.matrix) * halfspace.testX;\n    vec4 testZ = transpose(aux.matrix) * halfspace.testZ;\n    float dotX = dot(v.local.pos.coords, testX);\n    float dotZ = dot(v.local.pos.coords, testZ);\n    return asinh(dotX * exp(-dotZ));\n}\n\nRelVector gradient(XYHalfSpaceShape halfspace, RelVector v){\n    Isometry aux = toIsometry(v.cellBoost);\n    vec4 testX = transpose(aux.matrix) * halfspace.testX;\n    vec4 testZ = transpose(aux.matrix) * halfspace.testZ;\n    float dotX = dot(v.local.pos.coords, testX);\n    float dotZ = dot(v.local.pos.coords, testZ);\n    float eDotZ = exp(-dotZ);\n    float coeff = 1. / sqrt(dotX * dotX * eDotZ * eDotZ + 1.);\n    vec4 dir = coeff * eDotZ * (testX - dotX * testZ);\n                                              \n                        \n    dir.w = 0.;\n    Isometry isom = makeInvTranslation(v.local.pos);\n    dir = isom.matrix * dir;\n    Vector n = Vector(v.local.pos, dir);\n    n = geomNormalize(n);\n    return RelVector(n, v.cellBoost, v.invCellBoost);\n}\n\nvec2 uvMap(XYHalfSpaceShape halfspace, RelVector v){\n    Point pos = applyGroupElement(v.invCellBoost, halfspace.origin);\n    Isometry isom = toIsometry(v.invCellBoost);\n    vec4 uDir = isom.matrix * vec4(halfspace.uDir, 0);\n    vec4 vDir = isom.matrix * vec4(halfspace.vDir, 0);\n    float uCoord = dot(v.local.pos.coords - pos.coords, uDir);\n    float vCoord = dot(v.local.pos.coords - pos.coords, vDir);\n    return vec2(uCoord, vCoord);\n}\n\n"},5239:e=>{e.exports="                                                                                                                        \n          \n                       \n                                                                                                                        \n\nstruct ZHalfSpaceShape {\n    vec4 test;                                                      \n    Point origin;                                                 \n    vec3 uDir;                                       \n    vec3 vDir;                                       \n};\n\n                                                                                                            \nfloat sdf(ZHalfSpaceShape halfspace, RelVector v){\n    Isometry aux = toIsometry(v.cellBoost);\n    vec4 test = transpose(aux.matrix) * halfspace.test;\n    return dot(v.local.pos.coords, test);\n}\n\nRelVector gradient(ZHalfSpaceShape halfspace, RelVector v){\n                                                                     \n    vec4 dir = halfspace.test * vec4(0, 0, 1, 0);\n    Vector local = Vector(v.local.pos, dir);\n    return RelVector(local, v.cellBoost, v.invCellBoost);\n}\n\nvec2 uvMap(ZHalfSpaceShape halfspace, RelVector v){\n    Point pos = applyGroupElement(v.invCellBoost, halfspace.origin);\n    Isometry isom = toIsometry(v.invCellBoost);\n    vec4 uDir = isom.matrix * vec4(halfspace.uDir, 0);\n    vec4 vDir = isom.matrix * vec4(halfspace.vDir, 0);\n    float uCoord = dot(v.local.pos.coords - pos.coords, uDir);\n    float vCoord = dot(v.local.pos.coords - pos.coords, vDir);\n    return vec2(uCoord, vCoord);\n}\n\n"},5688:e=>{e.exports="                                                                                                                        \n                                                                                                                        \n  \n                                                            \n  \n                                                                                                                        \n                                                                                                                        \n\n\n"},466:(e,t,n)=>{e.exports=n.p+"img/426f7657671a2811d4aa.png"},8367:(e,t,n)=>{e.exports=n.p+"img/33960f5af615e67309e5.jpg"},2971:(e,t,n)=>{e.exports=n.p+"img/eba62d0cff4836a949b8.png"},5753:(e,t,n)=>{e.exports=n.p+"img/4b569137334e61081651.jpg"}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;if("string"==typeof import.meta.url&&(e=import.meta.url),!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})();var i={};(()=>{r.d(i,{QU:()=>Zr,ZH:()=>yi,K9:()=>id,cK:()=>$s,_x:()=>Ks,kj:()=>Js,Vz:()=>go,Iy:()=>va,Vf:()=>bc,TB:()=>xo,Al:()=>Bs,KO:()=>To,c$:()=>Ri,OZ:()=>Kc,Ao:()=>Rc,mD:()=>jr,yb:()=>_i,ZA:()=>ks,Jz:()=>Ur,HZ:()=>al,TN:()=>Fa,JV:()=>n,Sc:()=>ll,Nh:()=>cl,RL:()=>Sn,_k:()=>to,uR:()=>ul,EB:()=>rd,Zs:()=>Wc,oR:()=>Jc,lt:()=>Ic,mU:()=>nd,Vh:()=>jc,Qc:()=>td,Q9:()=>Uc,Qv:()=>Fo,F5:()=>ai,Uc:()=>Al,Yu:()=>Io,Fh:()=>Fs,oB:()=>ao,pJ:()=>pi,GW:()=>si,DZ:()=>sd,_K:()=>sa,JF:()=>po,Lv:()=>Xo,E9:()=>s,Ly:()=>a,jo:()=>gl,mH:()=>ml,xd:()=>vl,pX:()=>Mn,Dz:()=>Hr,Uj:()=>pl,cV:()=>Pa,lR:()=>Ya,xs:()=>wi,oC:()=>dl,h8:()=>ui,Qf:()=>Yc,_D:()=>Vo,$p:()=>hl,xG:()=>eo,qC:()=>ad,N$:()=>ld,TO:()=>cd,yI:()=>Ka,E6:()=>ei,zO:()=>od,cB:()=>Ac,OW:()=>o,$9:()=>sl,iR:()=>Ps,Y2:()=>ed,ot:()=>Oc,JX:()=>$c,fr:()=>Bc,t2:()=>pc,ak:()=>xn,Cy:()=>ga,M3:()=>rc,jV:()=>Ba,jS:()=>zl,wS:()=>oa,IJ:()=>Qo,p2:()=>En,dV:()=>no,G0:()=>Ja,re:()=>ol,xS:()=>lc});const t=(e=>{var t={};return r.d(t,e),t})({AnimationClip:()=>e.AnimationClip,Bone:()=>e.Bone,Box3:()=>e.Box3,BufferAttribute:()=>e.BufferAttribute,BufferGeometry:()=>e.BufferGeometry,CanvasTexture:()=>e.CanvasTexture,ClampToEdgeWrapping:()=>e.ClampToEdgeWrapping,Clock:()=>e.Clock,Color:()=>e.Color,DirectionalLight:()=>e.DirectionalLight,DoubleSide:()=>e.DoubleSide,EventDispatcher:()=>e.EventDispatcher,FileLoader:()=>e.FileLoader,Float32BufferAttribute:()=>e.Float32BufferAttribute,FloatType:()=>e.FloatType,FrontSide:()=>e.FrontSide,Group:()=>e.Group,ImageBitmapLoader:()=>e.ImageBitmapLoader,InterleavedBuffer:()=>e.InterleavedBuffer,InterleavedBufferAttribute:()=>e.InterleavedBufferAttribute,Interpolant:()=>e.Interpolant,InterpolateDiscrete:()=>e.InterpolateDiscrete,InterpolateLinear:()=>e.InterpolateLinear,Line:()=>e.Line,LineBasicMaterial:()=>e.LineBasicMaterial,LineLoop:()=>e.LineLoop,LineSegments:()=>e.LineSegments,LinearFilter:()=>e.LinearFilter,LinearMipmapLinearFilter:()=>e.LinearMipmapLinearFilter,LinearMipmapNearestFilter:()=>e.LinearMipmapNearestFilter,Loader:()=>e.Loader,LoaderUtils:()=>e.LoaderUtils,Material:()=>e.Material,MathUtils:()=>e.MathUtils,Matrix3:()=>e.Matrix3,Matrix4:()=>e.Matrix4,Mesh:()=>e.Mesh,MeshBasicMaterial:()=>e.MeshBasicMaterial,MeshPhysicalMaterial:()=>e.MeshPhysicalMaterial,MeshStandardMaterial:()=>e.MeshStandardMaterial,MirroredRepeatWrapping:()=>e.MirroredRepeatWrapping,NearestFilter:()=>e.NearestFilter,NearestMipmapLinearFilter:()=>e.NearestMipmapLinearFilter,NearestMipmapNearestFilter:()=>e.NearestMipmapNearestFilter,NumberKeyframeTrack:()=>e.NumberKeyframeTrack,Object3D:()=>e.Object3D,OrthographicCamera:()=>e.OrthographicCamera,PerspectiveCamera:()=>e.PerspectiveCamera,PointLight:()=>e.PointLight,Points:()=>e.Points,PointsMaterial:()=>e.PointsMaterial,PropertyBinding:()=>e.PropertyBinding,Quaternion:()=>e.Quaternion,QuaternionKeyframeTrack:()=>e.QuaternionKeyframeTrack,RGBAFormat:()=>e.RGBAFormat,RGBFormat:()=>e.RGBFormat,RepeatWrapping:()=>e.RepeatWrapping,Scene:()=>e.Scene,ShaderMaterial:()=>e.ShaderMaterial,Skeleton:()=>e.Skeleton,SkinnedMesh:()=>e.SkinnedMesh,Sphere:()=>e.Sphere,SphereBufferGeometry:()=>e.SphereBufferGeometry,SphereGeometry:()=>e.SphereGeometry,SpotLight:()=>e.SpotLight,TangentSpaceNormalMap:()=>e.TangentSpaceNormalMap,TextureLoader:()=>e.TextureLoader,TriangleFanDrawMode:()=>e.TriangleFanDrawMode,TriangleStripDrawMode:()=>e.TriangleStripDrawMode,Uniform:()=>e.Uniform,UniformsUtils:()=>e.UniformsUtils,Vector2:()=>e.Vector2,Vector3:()=>e.Vector3,Vector4:()=>e.Vector4,VectorKeyframeTrack:()=>e.VectorKeyframeTrack,WebGLRenderTarget:()=>e.WebGLRenderTarget,WebGLRenderer:()=>e.WebGLRenderer,sRGBEncoding:()=>e.sRGBEncoding});class n{constructor(){this.build(...arguments)}get isIsometry(){return!0}build(){throw new Error("This method need be overloaded.")}identity(){throw new Error("This method need be overloaded.")}reduceError(){throw new Error("This method need be overloaded.")}multiply(e){throw new Error("This method need be overloaded.")}premultiply(e){throw new Error("This method need be overloaded.")}invert(){return this.matrix.invert(),this}makeTranslation(e){throw new Error("This method need be overloaded.")}makeInvTranslation(e){throw new Error("This method need be overloaded.")}makeTranslationFromDir(e){throw new Error("This method need be overloaded.")}diffExpMap(e){throw new Error("This method need be overloaded.")}equals(e){throw new Error("This method need be overloaded.")}clone(){throw new Error("This method need be overloaded.")}copy(e){throw new Error("This method need be overloaded.")}}n.prototype.build=function(){this.matrix=new t.Matrix4},n.prototype.identity=function(){return this.matrix.identity(),this},n.prototype.reduceError=function(){return this},n.prototype.multiply=function(e){return this.matrix.multiply(e.matrix),this},n.prototype.premultiply=function(e){return this.matrix.premultiply(e.matrix),this},n.prototype.invert=function(){return this.matrix.invert(),this},n.prototype.makeTranslation=function(e){const[t,n,r]=e.coords.toArray();return this.matrix.set(Math.exp(r),0,0,t,0,Math.exp(-r),0,n,0,0,1,r,0,0,0,1),this},n.prototype.makeInvTranslation=function(e){const[t,n,r]=e.coords.toArray();return this.matrix.set(Math.exp(-r),0,0,-Math.exp(-r)*t,0,Math.exp(r),0,-Math.exp(r)*n,0,0,1,-r,0,0,0,1),this},n.prototype.makeFlip=function(){return this.matrix.set(0,1,0,0,1,0,0,0,0,0,-1,0,0,0,0,1),this},n.prototype.makeReflectionX=function(){return this.matrix.set(-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},n.prototype.makeReflectionY=function(){return this.matrix.set(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1),this},n.prototype.equals=function(e){return this.matrix.equals(e.matrix)},n.prototype.clone=function(){let e=new n;return e.matrix.copy(this.matrix),e},n.prototype.copy=function(e){return this.matrix.copy(e.matrix),this};class s{constructor(...e){this.build(...e)}build(){throw new Error("This method need be overloaded.")}set(){throw new Error("This method need be overloaded.")}get isPoint(){return!0}applyIsometry(e){throw new Error("This method need be overloaded.")}reduceError(){throw new Error("This method need be overloaded.")}equals(e){throw new Error("This method need be overloaded.")}clone(){throw new Error("This method need be overloaded.")}copy(e){throw new Error("This method need be overloaded.")}}s.prototype.build=function(){this.coords=0===arguments.length?new t.Vector4(0,0,0,1):new t.Vector4(...arguments)},s.prototype.set=function(){return this.coords.set(arguments[0],arguments[1],arguments[2],1),this},s.prototype.applyIsometry=function(e){return this.coords.applyMatrix4(e.matrix),this},s.prototype.equals=function(e){return this.coords.equals(e.coords)},s.prototype.reduceError=function(){return this},s.prototype.clone=function(){let e=new s;return e.coords.copy(this.coords),e},s.prototype.copy=function(e){return this.coords.copy(e.coords),this};class o extends t.Vector3{get isVector(){return!0}applyMatrix4(e){const n=new t.Vector4(this.x,this.y,this.z,0);return n.applyMatrix4(e),this.set(n.x,n.y,n.z),this}applyFacing(e){return this.applyQuaternion(e.quaternion),this}}class a{constructor(){this.boost=new n,this.quaternion=new t.Quaternion}get isPosition(){return!0}get facing(){return(new t.Matrix4).makeRotationFromQuaternion(this.quaternion)}setBoost(e){return this.boost=e,this}setQuaternion(e){return this.quaternion=e,this}reduceErrorBoost(){return this.boost.reduceError(),this}reduceErrorQuaternion(){return this.quaternion.normalize(),this}reduceError(){return this.reduceErrorBoost(),this.reduceErrorQuaternion(),this}get point(){return(new s).applyIsometry(this.boost)}reset(){return this.boost.identity(),this.quaternion.identity(),this}applyIsometry(e){return this.boost.premultiply(e),this}applyQuaternion(e){return this.quaternion.multiply(e),this}multiply(e){return this.boost.multiply(e.boost),this.quaternion.premultiply(e.quaternion),this}premultiply(e){return this.boost.premultiply(e.boost),this.quaternion.multiply(e.quaternion),this}invert(){return this.boost.invert(),this.quaternion.conjugate(),this}flowFromOrigin(e){throw new Error("This method need be overloaded.")}flow(e){const t=e.clone().applyFacing(this),n=(new a).flowFromOrigin(t);return this.multiply(n),this}fakeDiffExpMap(e){const n=(new o).setFromMatrixPosition(e),r=(new t.Quaternion).setFromRotationMatrix(e);return this.flow(n),this.quaternion.multiply(r),this}equals(e){return this.boost.equals(e.boost)&&this.quaternion.equals(e.quaternion)}clone(){let e=new a;return e.boost.copy(this.boost),e.quaternion.copy(this.quaternion),e}copy(e){this.boost.copy(e.boost),this.quaternion.copy(e.quaternion)}}const l=.001;a.prototype.flowFromOrigin=function(e){const n=e.length()/l,r=e.clone().normalize(),i=new t.Vector3,o=new s,a=new t.Vector4,c=new t.Quaternion;for(let e=0;e<n;e++)a.set(r.x,r.y,r.z,0).applyMatrix4(this.boost.matrix).multiplyScalar(l),o.coords.add(a),this.boost.makeTranslation(o),c.set(r.y,r.x,0,0).multiply(this.quaternion).multiplyScalar(5e-4),this.quaternion.add(c).normalize(),i.set(r.x*r.z,-r.y*r.z,-r.x*r.x+r.y*r.y),r.add(i.multiplyScalar(l)).normalize();return this};var c=r(5595),d=r.n(c),h=r(9395),u=r.n(h),p={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"};class m{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const f=new t.OrthographicCamera(-1,1,1,-1,0,1),b=new t.BufferGeometry;b.setAttribute("position",new t.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),b.setAttribute("uv",new t.Float32BufferAttribute([0,2,0,0,2,0],2));class v{constructor(e){this._mesh=new t.Mesh(b,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,f)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class g extends m{constructor(e,n){super(),this.textureID=void 0!==n?n:"tDiffuse",e instanceof t.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=t.UniformsUtils.clone(e.uniforms),this.material=new t.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new v(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class A extends m{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),i=e.state;let s,o;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(s=0,o=1):(s=1,o=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,s,4294967295),i.buffers.stencil.setClear(o),i.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class y extends m{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class w{constructor(e,n){if(this.renderer=e,void 0===n){const r={minFilter:t.LinearFilter,magFilter:t.LinearFilter,format:t.RGBAFormat},i=e.getSize(new t.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(n=new t.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===p&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===g&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new g(p),this.clock=new t.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let t=0,r=this.passes.length;t<r;t++){const r=this.passes[t];if(!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),r.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==A&&(r instanceof A?n=!0:r instanceof y&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const n=this.renderer.getSize(new t.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=n.width,this._height=n.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}const _=new t.OrthographicCamera(-1,1,1,-1,0,1),x=new t.BufferGeometry;x.setAttribute("position",new t.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),x.setAttribute("uv",new t.Float32BufferAttribute([0,2,0,0,2,0],2));class E extends m{constructor(e,n,r,i,s){super(),this.scene=e,this.camera=n,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=void 0!==s?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new t.Color}render(e,t,n){const r=e.autoClear;let i,s;e.autoClear=!1,void 0!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=s),e.autoClear=r}}Object.defineProperty(t.WebGLRenderer.prototype,"isWebGLRenderer",{get:function(){return!0}});class S{constructor(e,n,r,i,s,o={},a={}){this.shader1=e,this.shader2=n,this.set=r,this.camera=i,this.scene=s,this.threeRenderer=a.isWebGLRenderer?a:new t.WebGLRenderer(a),this.maxBounces=void 0!==o.maxBounces?o.maxBounces:0,this.postProcess=void 0!==o.postProcess&&o.postProcess,this.threeScene=new t.Scene}setPixelRatio(e){this.threeRenderer.setPixelRatio(e)}setSize(e,t,n=!0){this.threeRenderer.setSize(e,t,n)}setClearColor(e,t){this.threeRenderer.setClearColor(e,t)}setAnimationLoop(e){this.threeRenderer.setAnimationLoop(e)}get domElement(){return this.threeRenderer.domElement}build(){throw new Error("AbstractRenderer: this method is not implemented")}render(){throw new Error("AbstractRenderer: this method is not implemented")}}class M{constructor(e=1){this.useCase=e,this.code="",this.includedImports=[],this.includedClasses=[],this.includedConstants=[],this.includedUniforms=[],this.includedInstances=[],this.uniforms={}}addChunk(e){return this.code=this.code+"\r\n\r\n"+e,this}addImport(e){return this.includedImports.includes(e)||(this.includedImports.push(e),this.code=this.code+"\r\n\r\n"+e),this}addClass(e,t){return this.includedClasses.includes(e)||(this.includedClasses.push(e),this.code=this.code+"\r\n\r\n"+t),this}addConstant(e,t,n){return this.includedConstants.includes(e)||(this.includedConstants.push(e),this.code=this.code+"\r\n\r\n"+`const ${t} ${e} = ${n};`),this}addUniform(e,t,n){return this.includedUniforms.includes(e)||(this.includedUniforms.push(e),this.code=this.code+"\r\n\r\n"+`uniform ${t} ${e};`,this.uniforms[e]={type:t,value:n}),this}updateUniform(e,t){return this.uniforms[e].value=t,this}addInstance(e,t){return this.includedInstances.includes(e)||(this.includedInstances.push(e),this.code=this.code+"\r\n\r\n"+t),this}}var R=r(2639),T=r.n(R),C=r(1767),I=r.n(C),D=r(190),V=r.n(D),P=r(4168),F=r.n(P),B=r(145),L=r.n(B),k=r(2044),O=r.n(k),N=r(9461),G=r.n(N),U=r(7781),H=r.n(U);const z={uniforms:{tDiffuse:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n\n\n        vec3 LessThan(vec3 f, float value)\n        {\n            return vec3(\n            (f.x < value) ? 1.0f : 0.0f,\n            (f.y < value) ? 1.0f : 0.0f,\n            (f.z < value) ? 1.0f : 0.0f);\n        }\n\n        //GAMMA CORRECTION\n        vec3 LinearToSRGB(vec3 rgb)\n        {\n            rgb = clamp(rgb, 0.0f, 1.0f);\n\n            return mix(\n            pow(rgb, vec3(1.0f / 2.4f)) * 1.055f - 0.055f,\n            rgb * 12.92f,\n            LessThan(rgb, 0.0031308f)\n            );\n        }\n        //TONE MAPPING\n        vec3 ACESFilm(vec3 x)\n        {\n            float a = 2.51f;\n            float b = 0.03f;\n            float c = 2.43f;\n            float d = 0.59f;\n            float e = 0.14f;\n            return clamp((x * (a * x + b)) / (x * (c * x + d) + e), 0.0f, 1.0f);\n        }\n\n        vec3 postProcess(vec3 pixelColor){\n\n            //set the exposure \n            float exposure = 0.8;\n            pixelColor *= exposure;\n\n            //correct tones\n            pixelColor = ACESFilm(pixelColor);\n            pixelColor = LinearToSRGB(pixelColor);\n\n            return pixelColor;\n        }\n        \n        void main() {\n            vec4 color = texture2D(tDiffuse, vUv);\n            vec3 aux = postProcess(color.rgb);\n            gl_FragColor = vec4(min(vec3(1.0), aux), color.a);\n        }"};var j=r(5315),X=r.n(j);class Q extends S{constructor(e,t,n,r,i,s={},o={}){super(e,t,n,r,i,s,o),this._fragmentBuilder=new M,this.composer=new w(this.threeRenderer)}get isBasicRenderer(){return!0}setPixelRatio(e){super.setPixelRatio(e),this.composer.setPixelRatio(window.devicePixelRatio)}setSize(e,t,n=!0){super.setSize(e,t,n),this.composer.setSize(window.innerWidth,window.innerHeight)}buildFragmentShader(){this._fragmentBuilder.addChunk(I()),this._fragmentBuilder.addUniform("maxBounces","int",this.maxBounces),this._fragmentBuilder.addChunk(this.shader1),this._fragmentBuilder.addChunk(V()),this._fragmentBuilder.addChunk(this.shader2),this._fragmentBuilder.addChunk(F()),this._fragmentBuilder.addChunk(G()),this.set.shader(this._fragmentBuilder),this.camera.shader(this._fragmentBuilder),this.scene.shader(this._fragmentBuilder),this._fragmentBuilder.addChunk(O()(this)),this._fragmentBuilder.addChunk(H()(this)),this._fragmentBuilder.addChunk(L()),this._fragmentBuilder.addChunk(X())}build(){const e=new t.SphereBufferGeometry(1e3,60,40);e.scale(1,1,-1),this.buildFragmentShader();const n=new t.ShaderMaterial({uniforms:this._fragmentBuilder.uniforms,vertexShader:T(),fragmentShader:this._fragmentBuilder.code}),r=new t.Mesh(e,n);this.threeScene.add(r);const i=new E(this.threeScene,this.camera.threeCamera);if(i.clear=!1,this.composer.addPass(i),this.postProcess){const e=new g(z);e.clear=!1,this.composer.addPass(e)}return this}checkShader(){console.log(this._fragmentBuilder.code)}render(){this.composer.render()}}class W extends m{constructor(e,n){super(),void 0===p&&console.error("THREE.TexturePass relies on CopyShader");const r=p;this.map=e,this.opacity=void 0!==n?n:1,this.uniforms=t.UniformsUtils.clone(r.uniforms),this.material=new t.ShaderMaterial({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,depthTest:!1,depthWrite:!1}),this.needsSwap=!1,this.fsQuad=new v(null)}render(e,t,n){const r=e.autoClear;e.autoClear=!1,this.fsQuad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(),this.fsQuad.render(e),e.autoClear=r}}var q=r(6172),Z=r.n(q),Y=r(3499),K=r.n(Y),J=r(9638),$=r.n(J),ee=r(7920),te=r.n(ee),ne=r(3888),re=r.n(ne),ie=r(6272),se=r.n(ie),oe=r(8187),ae=r.n(oe),le=r(4122),ce=r.n(le);const de=new t.ShaderMaterial({uniforms:{accTex:new t.Uniform(null),newTex:new t.Uniform(null),iFrame:new t.Uniform(0)},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        varying vec2 vUv;\n        uniform sampler2D accTex;\n        uniform sampler2D newTex;\n        uniform float iFrame;\n        void main() {\n            float den = 1./ (1. + iFrame);\n            gl_FragColor = den * (iFrame *  texture2D(accTex, vUv) + texture2D(newTex, vUv));\n        }"}),he=new class{constructor(e){this._mesh=new t.Mesh(x,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,_)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}(de),ue={minFilter:t.NearestFilter,magFilter:t.NearestFilter,format:t.RGBAFormat,type:t.FloatType};class pe extends S{constructor(e,n,r,i,s,o={},a={}){super(e,n,r,i,s,o,a),this.maxBounces=void 0!==o.maxBounces?o.maxBounces:50,this._fragmentBuilder=new M(3),this.sceneTarget=new t.WebGLRenderTarget(window.innerWidth,window.innerHeight,ue),this.accReadTarget=new t.WebGLRenderTarget(window.innerWidth,window.innerHeight,ue),this.accWriteTarget=new t.WebGLRenderTarget(window.innerWidth,window.innerHeight,ue),this.iFrame=0,this.displayComposer=new w(this.threeRenderer)}get isPathTracerRenderer(){return!0}setPixelRatio(e){super.setPixelRatio(e),this.displayComposer.setPixelRatio(e)}setSize(e,t,n=!0){super.setSize(e,t,n),this.sceneTarget.setSize(e,t),this.accReadTarget.setSize(e,t),this.accWriteTarget.setSize(e,t),this.displayComposer.setSize(e,t)}updateFrameSeed(){const e=Math.floor(1e4*Math.random());this._fragmentBuilder.updateUniform("frameSeed",e)}buildFragmentShader(){this._fragmentBuilder.addChunk(I());const e=new t.Vector2(this.accWriteTarget.width,this.accWriteTarget.height);this._fragmentBuilder.addUniform("resolution","vec2",e),this._fragmentBuilder.addUniform("maxBounces","int",this.maxBounces),this._fragmentBuilder.addChunk(this.shader1),this._fragmentBuilder.addChunk(V()),this._fragmentBuilder.addChunk(this.shader2),this._fragmentBuilder.addChunk(F()),this._fragmentBuilder.addUniform("frameSeed","uint",Math.floor(1e4*Math.random())),this._fragmentBuilder.addChunk($()),this._fragmentBuilder.addChunk(re()),this.set.shader(this._fragmentBuilder),this._fragmentBuilder.addChunk(te()),this.camera.shader(this._fragmentBuilder),this.scene.shader(this._fragmentBuilder),this._fragmentBuilder.addChunk(Z()(this)),this._fragmentBuilder.addChunk(ce()(this)),this._fragmentBuilder.addChunk(se()(this)),this._fragmentBuilder.addChunk(K()),this._fragmentBuilder.addChunk(ae())}build(){const e=new t.SphereBufferGeometry(1e3,60,40);e.scale(1,1,-1),this.buildFragmentShader();const n=new t.ShaderMaterial({uniforms:this._fragmentBuilder.uniforms,vertexShader:T(),fragmentShader:this._fragmentBuilder.code}),r=new t.Mesh(e,n);return this.threeScene.add(r),this.displayComposer.addPass(new W(this.accReadTarget.texture)),this.displayComposer.addPass(new g(z)),this}checkShader(){console.log(this._fragmentBuilder.code)}renderAccTarget(){this.threeRenderer.setRenderTarget(null),this.displayComposer.render()}render(){let e;this.updateFrameSeed();const n=new t.Vector2(this.accWriteTarget.width,this.accWriteTarget.height);this._fragmentBuilder.updateUniform("resolution",n),this.threeRenderer.setRenderTarget(this.sceneTarget),this.threeRenderer.render(this.threeScene,this.camera.threeCamera),this.threeRenderer.setRenderTarget(this.accWriteTarget),de.uniforms.accTex.value=this.accReadTarget.texture,de.uniforms.newTex.value=this.sceneTarget.texture,de.uniforms.iFrame.value=this.iFrame,he.render(this.threeRenderer),e=this.accReadTarget,this.accReadTarget=this.accWriteTarget,this.accWriteTarget=e,this.renderAccTarget(),this.iFrame=this.iFrame+1}}const me=void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},fe=Symbol("@@webxr-polyfill/EventTarget");class be{constructor(){this[fe]={listeners:new Map}}addEventListener(e,t){if("string"!=typeof e)throw new Error("`type` must be a string");if("function"!=typeof t)throw new Error("`listener` must be a function");const n=this[fe].listeners.get(e)||[];n.push(t),this[fe].listeners.set(e,n)}removeEventListener(e,t){if("string"!=typeof e)throw new Error("`type` must be a string");if("function"!=typeof t)throw new Error("`listener` must be a function");const n=this[fe].listeners.get(e)||[];for(let e=n.length;e>=0;e--)n[e]===t&&n.pop()}dispatchEvent(e,t){const n=this[fe].listeners.get(e)||[],r=[];for(let e=0;e<n.length;e++)r[e]=n[e];for(let e of r)e(t);"function"==typeof this[`on${e}`]&&this[`on${e}`](t)}}let ve="undefined"!=typeof Float32Array?Float32Array:Array;Math.PI;function ge(){let e=new ve(16);return ve!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ae(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ye(e,t){let n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],d=t[8],h=t[9],u=t[10],p=t[11],m=t[12],f=t[13],b=t[14],v=t[15],g=n*a-r*o,A=n*l-i*o,y=n*c-s*o,w=r*l-i*a,_=r*c-s*a,x=i*c-s*l,E=d*f-h*m,S=d*b-u*m,M=d*v-p*m,R=h*b-u*f,T=h*v-p*f,C=u*v-p*b,I=g*C-A*T+y*R+w*M-_*S+x*E;return I?(I=1/I,e[0]=(a*C-l*T+c*R)*I,e[1]=(i*T-r*C-s*R)*I,e[2]=(f*x-b*_+v*w)*I,e[3]=(u*_-h*x-p*w)*I,e[4]=(l*M-o*C-c*S)*I,e[5]=(n*C-i*M+s*S)*I,e[6]=(b*y-m*x-v*A)*I,e[7]=(d*x-u*y+p*A)*I,e[8]=(o*T-a*M+c*E)*I,e[9]=(r*M-n*T-s*E)*I,e[10]=(m*_-f*y+v*g)*I,e[11]=(h*y-d*_-p*g)*I,e[12]=(a*S-o*R-l*E)*I,e[13]=(n*R-r*S+i*E)*I,e[14]=(f*A-m*w-b*g)*I,e[15]=(d*w-h*A+u*g)*I,e):null}function we(e,t,n){let r=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],d=t[7],h=t[8],u=t[9],p=t[10],m=t[11],f=t[12],b=t[13],v=t[14],g=t[15],A=n[0],y=n[1],w=n[2],_=n[3];return e[0]=A*r+y*a+w*h+_*f,e[1]=A*i+y*l+w*u+_*b,e[2]=A*s+y*c+w*p+_*v,e[3]=A*o+y*d+w*m+_*g,A=n[4],y=n[5],w=n[6],_=n[7],e[4]=A*r+y*a+w*h+_*f,e[5]=A*i+y*l+w*u+_*b,e[6]=A*s+y*c+w*p+_*v,e[7]=A*o+y*d+w*m+_*g,A=n[8],y=n[9],w=n[10],_=n[11],e[8]=A*r+y*a+w*h+_*f,e[9]=A*i+y*l+w*u+_*b,e[10]=A*s+y*c+w*p+_*v,e[11]=A*o+y*d+w*m+_*g,A=n[12],y=n[13],w=n[14],_=n[15],e[12]=A*r+y*a+w*h+_*f,e[13]=A*i+y*l+w*u+_*b,e[14]=A*s+y*c+w*p+_*v,e[15]=A*o+y*d+w*m+_*g,e}function _e(e,t,n){let r=t[0],i=t[1],s=t[2],o=t[3],a=r+r,l=i+i,c=s+s,d=r*a,h=r*l,u=r*c,p=i*l,m=i*c,f=s*c,b=o*a,v=o*l,g=o*c;return e[0]=1-(p+f),e[1]=h+g,e[2]=u-v,e[3]=0,e[4]=h-g,e[5]=1-(d+f),e[6]=m+b,e[7]=0,e[8]=u+v,e[9]=m-b,e[10]=1-(d+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function xe(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Ee(e,t){let n=t[0]+t[5]+t[10],r=0;return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function Se(e,t,n,r,i){let s,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(s=1/(r-i),e[10]=(i+r)*s,e[14]=2*i*r*s):(e[10]=-1,e[14]=-2*r),e}function Me(){let e=new ve(3);return ve!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Re(e){var t=new ve(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Te(e,t,n){let r=new ve(3);return r[0]=e,r[1]=t,r[2]=n,r}function Ce(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ie(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function De(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Ve(e,t){let n=t[0],r=t[1],i=t[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function Pe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Fe(e,t,n){let r=t[0],i=t[1],s=t[2],o=n[0],a=n[1],l=n[2];return e[0]=i*l-s*a,e[1]=s*o-r*l,e[2]=r*a-i*o,e}function Be(e,t,n){let r=n[0],i=n[1],s=n[2],o=n[3],a=t[0],l=t[1],c=t[2],d=i*c-s*l,h=s*a-r*c,u=r*l-i*a,p=i*u-s*h,m=s*d-r*u,f=r*h-i*d,b=2*o;return d*=b,h*=b,u*=b,p*=2,m*=2,f*=2,e[0]=a+d+p,e[1]=l+h+m,e[2]=c+u+f,e}const Le=function(e){let t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)};!function(){let e=Me()}();!function(){let e=function(){let e=new ve(4);return ve!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();function ke(){let e=new ve(4);return ve!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Oe(e,t,n){let r=t[0],i=t[1],s=t[2],o=t[3],a=n[0],l=n[1],c=n[2],d=n[3];return e[0]=r*d+o*a+i*c-s*l,e[1]=i*d+o*l+s*a-r*c,e[2]=s*d+o*c+r*l-i*a,e[3]=o*d-r*a-i*l-s*c,e}function Ne(e,t,n,r){let i,s,o,a,l,c=t[0],d=t[1],h=t[2],u=t[3],p=n[0],m=n[1],f=n[2],b=n[3];return s=c*p+d*m+h*f+u*b,s<0&&(s=-s,p=-p,m=-m,f=-f,b=-b),1-s>1e-6?(i=Math.acos(s),o=Math.sin(i),a=Math.sin((1-r)*i)/o,l=Math.sin(r*i)/o):(a=1-r,l=r),e[0]=a*c+l*p,e[1]=a*d+l*m,e[2]=a*h+l*f,e[3]=a*u+l*b,e}function Ge(e,t){let n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s,a=o?1/o:0;return e[0]=-n*a,e[1]=-r*a,e[2]=-i*a,e[3]=s*a,e}const Ue=function(e){let t=new ve(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},He=function(e,t,n,r){let i=new ve(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i},ze=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},je=function(e,t){let n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=i*o,e[3]=s*o),e},Xe=(function(){let e=Me(),t=Te(1,0,0),n=Te(0,1,0)}(),function(){let e=ke(),t=ke()}(),function(){let e=function(){let e=new ve(9);return ve!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}()}(),Symbol("@@webxr-polyfill/XRRigidTransform"));class Qe{constructor(){if(this[Xe]={matrix:null,position:null,orientation:null,inverse:null},0===arguments.length)this[Xe].matrix=Ae(new Float32Array(16));else if(1===arguments.length)arguments[0]instanceof Float32Array?this[Xe].matrix=arguments[0]:(this[Xe].position=this._getPoint(arguments[0]),this[Xe].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else{if(2!==arguments.length)throw new Error("Too many arguments!");this[Xe].position=this._getPoint(arguments[0]),this[Xe].orientation=this._getPoint(arguments[1])}if(this[Xe].matrix){let e=Me();xe(e,this[Xe].matrix),this[Xe].position=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2]});let t=ke();Ee(t,this[Xe].matrix),this[Xe].orientation=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2],w:t[3]})}else this[Xe].matrix=Ae(new Float32Array(16)),_e(this[Xe].matrix,He(this[Xe].orientation.x,this[Xe].orientation.y,this[Xe].orientation.z,this[Xe].orientation.w),Te(this[Xe].position.x,this[Xe].position.y,this[Xe].position.z))}_getPoint(e){return e instanceof DOMPointReadOnly?e:DOMPointReadOnly.fromPoint(e)}get matrix(){return this[Xe].matrix}get position(){return this[Xe].position}get orientation(){return this[Xe].orientation}get inverse(){if(null===this[Xe].inverse){let e=Ae(new Float32Array(16));ye(e,this[Xe].matrix),this[Xe].inverse=new Qe(e),this[Xe].inverse[Xe].inverse=this}return this[Xe].inverse}}const We=Symbol("@@webxr-polyfill/XRSpace");class qe{constructor(e=null,t=null){this[We]={specialType:e,inputSource:t,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[We].specialType}get _inputSource(){return this[We].inputSource}_ensurePoseUpdated(e,t){t!=this[We].lastFrameId&&(this[We].lastFrameId=t,this._onPoseUpdate(e))}_onPoseUpdate(e){"viewer"==this[We].specialType&&(this._baseMatrix=e.getBasePoseMatrix())}set _baseMatrix(e){this[We].baseMatrix=e,this[We].inverseBaseMatrix=null}get _baseMatrix(){return this[We].baseMatrix||this[We].inverseBaseMatrix&&(this[We].baseMatrix=new Float32Array(16),ye(this[We].baseMatrix,this[We].inverseBaseMatrix)),this[We].baseMatrix}set _inverseBaseMatrix(e){this[We].inverseBaseMatrix=e,this[We].baseMatrix=null}get _inverseBaseMatrix(){return this[We].inverseBaseMatrix||this[We].baseMatrix&&(this[We].inverseBaseMatrix=new Float32Array(16),ye(this[We].inverseBaseMatrix,this[We].baseMatrix)),this[We].inverseBaseMatrix}_getSpaceRelativeTransform(e){if(!this._inverseBaseMatrix||!e._baseMatrix)return null;let t=new Float32Array(16);return we(t,this._inverseBaseMatrix,e._baseMatrix),new Qe(t)}}const Ze=Symbol("@@webxr-polyfill/XRReferenceSpace"),Ye=["viewer","local","local-floor","bounded-floor","unbounded"];class Ke extends qe{constructor(e,t=null){if(!Ye.includes(e))throw new Error(`XRReferenceSpaceType must be one of ${Ye}`);if(super(e),"bounded-floor"===e&&!t)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");(function(e){return"bounded-floor"===e||"local-floor"===e})(e)&&!t&&((t=Ae(new Float32Array(16)))[13]=1.6),this._inverseBaseMatrix=t||Ae(new Float32Array(16)),this[Ze]={type:e,transform:t,originOffset:Ae(new Float32Array(16))}}_transformBasePoseMatrix(e,t){we(e,this._inverseBaseMatrix,t)}_originOffsetMatrix(){return this[Ze].originOffset}_adjustForOriginOffset(e){let t=new Float32Array(16);ye(t,this[Ze].originOffset),we(e,t,e)}_getSpaceRelativeTransform(e){let t=super._getSpaceRelativeTransform(e);return this._adjustForOriginOffset(t.matrix),new XRRigidTransform(t.matrix)}getOffsetReferenceSpace(e){let t=new Ke(this[Ze].type,this[Ze].transform,this[Ze].bounds);return we(t[Ze].originOffset,this[Ze].originOffset,e.matrix),t}}const Je=Symbol("@@webxr-polyfill/XR"),$e=["inline","immersive-vr","immersive-ar"],et={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}};let tt;if("performance"in me==!1){let e=Date.now();tt=()=>Date.now()-e}else tt=()=>performance.now();var nt=tt;const rt=Symbol("@@webxr-polyfill/XRPose");class it{constructor(e,t){this[rt]={transform:e,emulatedPosition:t}}get transform(){return this[rt].transform}get emulatedPosition(){return this[rt].emulatedPosition}}const st=Symbol("@@webxr-polyfill/XRViewerPose");class ot extends it{constructor(e,t,n=!1){super(e,n),this[st]={views:t}}get views(){return this[st].views}}const at=Symbol("@@webxr-polyfill/XRViewport");class lt{constructor(e){this[at]={target:e}}get x(){return this[at].target.x}get y(){return this[at].target.y}get width(){return this[at].target.width}get height(){return this[at].target.height}}const ct=["left","right","none"],dt=Symbol("@@webxr-polyfill/XRView");class ht{constructor(e,t,n,r){if(!ct.includes(n))throw new Error(`XREye must be one of: ${ct}`);const i=Object.create(null),s=new lt(i);this[dt]={device:e,eye:n,viewport:s,temp:i,sessionId:r,transform:t}}get eye(){return this[dt].eye}get projectionMatrix(){return this[dt].device.getProjectionMatrix(this.eye)}get transform(){return this[dt].transform}_getViewport(e){if(this[dt].device.getViewport(this[dt].sessionId,this.eye,e,this[dt].temp))return this[dt].viewport}}const ut=Symbol("@@webxr-polyfill/XRFrame"),pt="XRFrame access outside the callback that produced it is invalid.";let mt=0;class ft{constructor(e,t,n){this[ut]={id:++mt,active:!1,animationFrame:!1,device:e,session:t,sessionId:n}}get session(){return this[ut].session}getViewerPose(e){if(!this[ut].animationFrame)throw new DOMException("getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.","InvalidStateError");if(!this[ut].active)throw new DOMException(pt,"InvalidStateError");const t=this[ut].device,n=this[ut].session;n[Ct].viewerSpace._ensurePoseUpdated(t,this[ut].id),e._ensurePoseUpdated(t,this[ut].id);let r=e._getSpaceRelativeTransform(n[Ct].viewerSpace);const i=[];for(let r of n[Ct].viewSpaces){r._ensurePoseUpdated(t,this[ut].id);let n=e._getSpaceRelativeTransform(r),s=new ht(t,n,r.eye,this[ut].sessionId);i.push(s)}return new ot(r,i,!1)}getPose(e,t){if(!this[ut].active)throw new DOMException(pt,"InvalidStateError");const n=this[ut].device;if("target-ray"===e._specialType||"grip"===e._specialType)return n.getInputPose(e._inputSource,t,e._specialType);{e._ensurePoseUpdated(n,this[ut].id),t._ensurePoseUpdated(n,this[ut].id);let r=t._getSpaceRelativeTransform(e);return r?new XRPose(r,!1):null}}}const bt=Symbol("@@webxr-polyfill/XRRenderState"),vt=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null});class gt{constructor(e={}){const t=Object.assign({},vt,e);this[bt]={config:t}}get depthNear(){return this[bt].config.depthNear}get depthFar(){return this[bt].config.depthFar}get inlineVerticalFieldOfView(){return this[bt].config.inlineVerticalFieldOfView}get baseLayer(){return this[bt].config.baseLayer}}const At=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),yt=Symbol("@@webxr-polyfill/xr-compatible"),wt=Symbol("@@webxr-polyfill/XRWebGLLayer"),_t=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1});const xt=Symbol("@@webxr-polyfill/XRInputSourceEvent");class Et extends Event{constructor(e,t){super(e,t),this[xt]={frame:t.frame,inputSource:t.inputSource},Object.setPrototypeOf(this,Et.prototype)}get frame(){return this[xt].frame}get inputSource(){return this[xt].inputSource}}const St=Symbol("@@webxr-polyfill/XRSessionEvent");class Mt extends Event{constructor(e,t){super(e,t),this[St]={session:t.session},Object.setPrototypeOf(this,Mt.prototype)}get session(){return this[St].session}}const Rt=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent");class Tt extends Event{constructor(e,t){super(e,t),this[Rt]={session:t.session,added:t.added,removed:t.removed},Object.setPrototypeOf(this,Tt.prototype)}get session(){return this[Rt].session}get added(){return this[Rt].added}get removed(){return this[Rt].removed}}const Ct=Symbol("@@webxr-polyfill/XRSession");class It extends qe{constructor(e){super(e)}get eye(){return this._specialType}_onPoseUpdate(e){this._inverseBaseMatrix=e.getBaseViewMatrix(this._specialType)}}class Dt extends be{constructor(e,t,n){super();let r="inline"!=t,i=new gt({inlineVerticalFieldOfView:r?null:.5*Math.PI});this[Ct]={device:e,mode:t,immersive:r,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:n,activeRenderState:i,pendingRenderState:null,viewerSpace:new Ke("viewer"),viewSpaces:[],currentInputSources:[]},r?this[Ct].viewSpaces.push(new It("left"),new It("right")):this[Ct].viewSpaces.push(new It("none")),this[Ct].onDeviceFrame=()=>{if(this[Ct].ended||this[Ct].suspended)return;if(this[Ct].deviceFrameHandle=null,this[Ct].startDeviceFrameLoop(),null!==this[Ct].pendingRenderState&&(this[Ct].activeRenderState=new gt(this[Ct].pendingRenderState),this[Ct].pendingRenderState=null,this[Ct].activeRenderState.baseLayer&&this[Ct].device.onBaseLayerSet(this[Ct].id,this[Ct].activeRenderState.baseLayer)),null===this[Ct].activeRenderState.baseLayer)return;const t=new ft(e,this,this[Ct].id),n=this[Ct].currentFrameCallbacks=this[Ct].frameCallbacks;this[Ct].frameCallbacks=[],t[ut].active=!0,t[ut].animationFrame=!0,this[Ct].device.onFrameStart(this[Ct].id,this[Ct].activeRenderState),this._checkInputSourcesChange();const r=nt();for(let e=0;e<n.length;e++)try{n[e].cancelled||"function"!=typeof n[e].callback||n[e].callback(r,t)}catch(e){console.error(e)}this[Ct].currentFrameCallbacks=null,t[ut].active=!1,this[Ct].device.onFrameEnd(this[Ct].id)},this[Ct].startDeviceFrameLoop=()=>{null===this[Ct].deviceFrameHandle&&(this[Ct].deviceFrameHandle=this[Ct].device.requestAnimationFrame(this[Ct].onDeviceFrame))},this[Ct].stopDeviceFrameLoop=()=>{const e=this[Ct].deviceFrameHandle;null!==e&&(this[Ct].device.cancelAnimationFrame(e),this[Ct].deviceFrameHandle=null)},this[Ct].onPresentationEnd=t=>{if(t!==this[Ct].id)return this[Ct].suspended=!1,this[Ct].startDeviceFrameLoop(),void this.dispatchEvent("focus",{session:this});this[Ct].ended=!0,this[Ct].stopDeviceFrameLoop(),e.removeEventListener("@@webxr-polyfill/vr-present-end",this[Ct].onPresentationEnd),e.removeEventListener("@@webxr-polyfill/vr-present-start",this[Ct].onPresentationStart),e.removeEventListener("@@webxr-polyfill/input-select-start",this[Ct].onSelectStart),e.removeEventListener("@@webxr-polyfill/input-select-end",this[Ct].onSelectEnd),this.dispatchEvent("end",new Mt("end",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-end",this[Ct].onPresentationEnd),this[Ct].onPresentationStart=e=>{e!==this[Ct].id&&(this[Ct].suspended=!0,this[Ct].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-start",this[Ct].onPresentationStart),this[Ct].onSelectStart=e=>{e.sessionId===this[Ct].id&&this[Ct].dispatchInputSourceEvent("selectstart",e.inputSource)},e.addEventListener("@@webxr-polyfill/input-select-start",this[Ct].onSelectStart),this[Ct].onSelectEnd=e=>{e.sessionId===this[Ct].id&&(this[Ct].dispatchInputSourceEvent("selectend",e.inputSource),this[Ct].dispatchInputSourceEvent("select",e.inputSource))},e.addEventListener("@@webxr-polyfill/input-select-end",this[Ct].onSelectEnd),this[Ct].onSqueezeStart=e=>{e.sessionId===this[Ct].id&&this[Ct].dispatchInputSourceEvent("squeezestart",e.inputSource)},e.addEventListener("@@webxr-polyfill/input-squeeze-start",this[Ct].onSqueezeStart),this[Ct].onSqueezeEnd=e=>{e.sessionId===this[Ct].id&&(this[Ct].dispatchInputSourceEvent("squeezeend",e.inputSource),this[Ct].dispatchInputSourceEvent("squeeze",e.inputSource))},e.addEventListener("@@webxr-polyfill/input-squeeze-end",this[Ct].onSqueezeEnd),this[Ct].dispatchInputSourceEvent=(t,n)=>{const r=new ft(e,this,this[Ct].id),i=new Et(t,{frame:r,inputSource:n});r[ut].active=!0,this.dispatchEvent(t,i),r[ut].active=!1},this[Ct].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[Ct].activeRenderState}get environmentBlendMode(){return this[Ct].device.environmentBlendMode||"opaque"}async requestReferenceSpace(e){if(this[Ct].ended)return;if(!Ye.includes(e))throw new TypeError(`XRReferenceSpaceType must be one of ${Ye}`);if(!this[Ct].device.doesSessionSupportReferenceSpace(this[Ct].id,e))throw new DOMException(`The ${e} reference space is not supported by this session.`,"NotSupportedError");if("viewer"===e)return this[Ct].viewerSpace;let t=await this[Ct].device.requestFrameOfReferenceTransform(e);if("bounded-floor"===e){if(!t)throw new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError");if(!this[Ct].device.requestStageBounds())throw new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError");throw new DOMException(`The WebXR polyfill does not support the ${e} reference space yet.`,"NotSupportedError")}return new Ke(e,t)}requestAnimationFrame(e){if(this[Ct].ended)return;const t=++this[Ct].frameHandle;return this[Ct].frameCallbacks.push({handle:t,callback:e,cancelled:!1}),t}cancelAnimationFrame(e){let t=this[Ct].frameCallbacks,n=t.findIndex((t=>t&&t.handle===e));n>-1&&(t[n].cancelled=!0,t.splice(n,1)),t=this[Ct].currentFrameCallbacks,t&&(n=t.findIndex((t=>t&&t.handle===e)),n>-1&&(t[n].cancelled=!0))}get inputSources(){return this[Ct].device.getInputSources()}async end(){if(!this[Ct].ended)return this[Ct].immersive&&(this[Ct].ended=!0,this[Ct].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[Ct].onPresentationStart),this[Ct].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[Ct].onPresentationEnd),this[Ct].device.removeEventListener("@@webxr-polyfill/input-select-start",this[Ct].onSelectStart),this[Ct].device.removeEventListener("@@webxr-polyfill/input-select-end",this[Ct].onSelectEnd),this.dispatchEvent("end",new Mt("end",{session:this}))),this[Ct].stopDeviceFrameLoop(),this[Ct].device.endSession(this[Ct].id)}updateRenderState(e){if(this[Ct].ended){throw new Error("Can't call updateRenderState on an XRSession that has already ended.")}if(e.baseLayer&&e.baseLayer._session!==this){throw new Error("Called updateRenderState with a base layer that was created by a different session.")}if(null!==e.inlineVerticalFieldOfView&&void 0!==e.inlineVerticalFieldOfView){if(this[Ct].immersive){throw new Error("inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.")}e.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,e.inlineVerticalFieldOfView))}if(null===this[Ct].pendingRenderState){const e=this[Ct].activeRenderState;this[Ct].pendingRenderState={depthNear:e.depthNear,depthFar:e.depthFar,inlineVerticalFieldOfView:e.inlineVerticalFieldOfView,baseLayer:e.baseLayer}}Object.assign(this[Ct].pendingRenderState,e)}_checkInputSourcesChange(){const e=[],t=[],n=this.inputSources,r=this[Ct].currentInputSources;for(const t of n)r.includes(t)||e.push(t);for(const e of r)n.includes(e)||t.push(e);(e.length>0||t.length>0)&&this.dispatchEvent("inputsourceschange",new Tt("inputsourceschange",{session:this,added:e,removed:t})),this[Ct].currentInputSources.length=0;for(const e of n)this[Ct].currentInputSources.push(e)}}const Vt=Symbol("@@webxr-polyfill/XRInputSource");class Pt{constructor(e){this[Vt]={impl:e,gripSpace:new qe("grip",this),targetRaySpace:new qe("target-ray",this)}}get handedness(){return this[Vt].impl.handedness}get targetRayMode(){return this[Vt].impl.targetRayMode}get gripSpace(){let e=this[Vt].impl.targetRayMode;return"gaze"===e||"screen"===e?null:this[Vt].gripSpace}get targetRaySpace(){return this[Vt].targetRaySpace}get profiles(){return this[Vt].impl.profiles}get gamepad(){return this[Vt].impl.gamepad}}const Ft=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent");class Bt extends Event{constructor(e,t){super(e,t),this[Ft]={referenceSpace:t.referenceSpace,transform:t.transform||null},Object.setPrototypeOf(this,Bt.prototype)}get referenceSpace(){return this[Ft].referenceSpace}get transform(){return this[Ft].transform}}var Lt={XRSystem:class extends be{constructor(e){super(),this[Je]={device:null,devicePromise:e,immersiveSession:null,inlineSessions:new Set},e.then((e=>{this[Je].device=e}))}async isSessionSupported(e){return this[Je].device||await this[Je].devicePromise,"inline"!=e?Promise.resolve(this[Je].device.isSessionSupported(e)):Promise.resolve(!0)}async requestSession(e,t){if(!this[Je].device){if("inline"!=e)throw new Error("Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode\nor navigator.xr.requestSession('inline') prior to requesting an immersive\nsession. This is a limitation specific to the WebXR Polyfill and does not apply\nto native implementations of the API.");await this[Je].devicePromise}if(!$e.includes(e))throw new TypeError(`The provided value '${e}' is not a valid enum value of type XRSessionMode`);const n=et[e],r=n.requiredFeatures.concat(t&&t.requiredFeatures?t.requiredFeatures:[]),i=n.optionalFeatures.concat(t&&t.optionalFeatures?t.optionalFeatures:[]),s=new Set;let o=!1;for(let e of r)this[Je].device.isFeatureSupported(e)?s.add(e):(console.error(`The required feature '${e}' is not supported`),o=!0);if(o)throw new DOMException("Session does not support some required features","NotSupportedError");for(let e of i)this[Je].device.isFeatureSupported(e)?s.add(e):console.log(`The optional feature '${e}' is not supported`);const a=await this[Je].device.requestSession(e,s),l=new XRSession(this[Je].device,e,a);"inline"==e?this[Je].inlineSessions.add(l):this[Je].immersiveSession=l;const c=()=>{"inline"==e?this[Je].inlineSessions.delete(l):this[Je].immersiveSession=null,l.removeEventListener("end",c)};return l.addEventListener("end",c),l}},XRSession:Dt,XRSessionEvent:Mt,XRFrame:ft,XRView:ht,XRViewport:lt,XRViewerPose:ot,XRWebGLLayer:class{constructor(e,t,n={}){const r=Object.assign({},_t,n);if(!(e instanceof Dt))throw new Error("session must be a XRSession");if(e.ended)throw new Error("InvalidStateError");if(t[At]&&!0!==t[yt])throw new Error("InvalidStateError");const i=t.getParameter(t.FRAMEBUFFER_BINDING);this[wt]={context:t,config:r,framebuffer:i,session:e}}get context(){return this[wt].context}get antialias(){return this[wt].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return this[wt].framebuffer}get framebufferWidth(){return this[wt].context.drawingBufferWidth}get framebufferHeight(){return this[wt].context.drawingBufferHeight}get _session(){return this[wt].session}getViewport(e){return e._getViewport(this)}static getNativeFramebufferScaleFactor(e){if(!e)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return e[Ct].ended?0:1}},XRSpace:qe,XRReferenceSpace:Ke,XRReferenceSpaceEvent:Bt,XRInputSource:Pt,XRInputSourceEvent:Et,XRInputSourcesChangeEvent:Tt,XRRenderState:gt,XRRigidTransform:Qe,XRPose:it};const kt=e=>"function"!=typeof e.prototype.makeXRCompatible&&(e.prototype.makeXRCompatible=function(){return this[yt]=!0,Promise.resolve()},!0),Ot=e=>{const t=e.prototype.getContext;e.prototype.getContext=function(e,n){const r=t.call(this,e,n);return r&&(r[At]=!0,n&&"xrCompatible"in n&&(r[yt]=n.xrCompatible)),r}};var Nt="undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{};var Gt,Ut,Ht=(Gt=function(e,t){e.exports=function(){var e,t,n,r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=.001,a=1,l=function(e,t){return"data:"+e+","+encodeURIComponent(t)},c=function(e,t,n){return e+(t-e)*n},d=function(){var e=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return e}}(),h=function(){var e=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome");return function(){return e}}(),u=function(){var e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return e}}(),p=function(){var e=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return e}}(),m=(t=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),n=t?parseInt(t[1],10):null,function(){return n}),f=function(){var e=!1;return e=d()&&u()&&-1!==navigator.userAgent.indexOf("13_4"),function(){return e}}(),b=function(){var e=!1;if(65===m()){var t=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(t){var n=t[1].split("."),r=s(n,4),i=(r[0],r[1],r[2]),o=r[3];e=3325===parseInt(i,10)&&parseInt(o,10)<148}}return function(){return e}}(),v=function(){var e=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return e}}(),g=function(){var e=90==window.orientation||-90==window.orientation;return v()?!e:e},A=function(e){return!(isNaN(e)||e<=o||e>a)},y=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},w=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},_=function(e){if(h())return!1;if(e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else{if(!e.msRequestFullscreen)return!1;e.msRequestFullscreen()}return!0},x=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},E=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},S=function(e,t,n,r){var i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t),e.compileShader(i);var s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,n),e.compileShader(s);var o=e.createProgram();for(var a in e.attachShader(o,i),e.attachShader(o,s),r)e.bindAttribLocation(o,r[a],a);return e.linkProgram(o),e.deleteShader(i),e.deleteShader(s),o},M=function(e,t){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i="",s=0;s<r;s++)n[i=e.getActiveUniform(t,s).name.replace("[0]","")]=e.getUniformLocation(t,i);return n},R=function(e,t,n,r,i,s,o){var a=1/(t-n),l=1/(r-i),c=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(i+r)*l,e[14]=(o+s)*c,e[15]=1,e},T=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},C=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},I=function(e){if(d()){var t=e.style.width,n=e.style.height;e.style.width=parseInt(t)+1+"px",e.style.height=parseInt(n)+"px",setTimeout((function(){e.style.width=t,e.style.height=n}),100)}window.canvas=e},D=function(){var e=Math.PI/180,t=.25*Math.PI;function n(n,r,i,s){var o=Math.tan(r?r.upDegrees*e:t),a=Math.tan(r?r.downDegrees*e:t),l=Math.tan(r?r.leftDegrees*e:t),c=Math.tan(r?r.rightDegrees*e:t),d=2/(l+c),h=2/(o+a);return n[0]=d,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=h,n[6]=0,n[7]=0,n[8]=-(l-c)*d*.5,n[9]=(o-a)*h*.5,n[10]=s/(i-s),n[11]=-1,n[12]=0,n[13]=0,n[14]=s*i/(i-s),n[15]=0,n}function r(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=r+r,l=i+i,c=s+s,d=r*a,h=r*l,u=r*c,p=i*l,m=i*c,f=s*c,b=o*a,v=o*l,g=o*c;return e[0]=1-(p+f),e[1]=h+g,e[2]=u-v,e[3]=0,e[4]=h-g,e[5]=1-(d+f),e[6]=m+b,e[7]=0,e[8]=u+v,e[9]=m-b,e[10]=1-(d+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function i(e,t,n){var r,i,s,o,a,l,c,d,h,u,p,m,f=n[0],b=n[1],v=n[2];return t===e?(e[12]=t[0]*f+t[4]*b+t[8]*v+t[12],e[13]=t[1]*f+t[5]*b+t[9]*v+t[13],e[14]=t[2]*f+t[6]*b+t[10]*v+t[14],e[15]=t[3]*f+t[7]*b+t[11]*v+t[15]):(r=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],d=t[7],h=t[8],u=t[9],p=t[10],m=t[11],e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=c,e[7]=d,e[8]=h,e[9]=u,e[10]=p,e[11]=m,e[12]=r*f+a*b+h*v+t[12],e[13]=i*f+l*b+u*v+t[13],e[14]=s*f+c*b+p*v+t[14],e[15]=o*f+d*b+m*v+t[15]),e}function s(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],d=t[8],h=t[9],u=t[10],p=t[11],m=t[12],f=t[13],b=t[14],v=t[15],g=n*a-r*o,A=n*l-i*o,y=n*c-s*o,w=r*l-i*a,_=r*c-s*a,x=i*c-s*l,E=d*f-h*m,S=d*b-u*m,M=d*v-p*m,R=h*b-u*f,T=h*v-p*f,C=u*v-p*b,I=g*C-A*T+y*R+w*M-_*S+x*E;return I?(I=1/I,e[0]=(a*C-l*T+c*R)*I,e[1]=(i*T-r*C-s*R)*I,e[2]=(f*x-b*_+v*w)*I,e[3]=(u*_-h*x-p*w)*I,e[4]=(l*M-o*C-c*S)*I,e[5]=(n*C-i*M+s*S)*I,e[6]=(b*y-m*x-v*A)*I,e[7]=(d*x-u*y+p*A)*I,e[8]=(o*T-a*M+c*E)*I,e[9]=(r*M-n*T-s*E)*I,e[10]=(m*_-f*y+v*g)*I,e[11]=(h*y-d*_-p*g)*I,e[12]=(a*S-o*R-l*E)*I,e[13]=(n*R-r*S+i*E)*I,e[14]=(f*A-m*w-b*g)*I,e[15]=(d*w-h*A+u*g)*I,e):null}var o=new Float32Array([0,0,0,1]),a=new Float32Array([0,0,0]);function l(e,t,l,c,d,h){n(e,c||null,h.depthNear,h.depthFar),r(t,l.orientation||o,l.position||a),d&&i(t,t,d),s(t,t)}return function(e,t,n){return!(!e||!t||(e.pose=t,e.timestamp=t.timestamp,l(e.leftProjectionMatrix,e.leftViewMatrix,t,n._getFieldOfView("left"),n._getEyeOffset("left"),n),l(e.rightProjectionMatrix,e.rightViewMatrix,t,n._getFieldOfView("right"),n._getEyeOffset("right"),n),0))}}(),V=function(){var e=window.self!==window.top,t=P(document.referrer),n=P(window.location.href);return e&&t!==n},P=function(e){var t,n=e.indexOf("://");t=-1!==n?n+3:0;var r=e.indexOf("/",t);return-1===r&&(r=e.length),e.substring(0,r)},F=function(e){return e.w>1?(console.warn("getQuaternionAngle: w > 1"),0):2*Math.acos(e.w)},B=(e={},function(t,n){void 0===e[t]&&(console.warn("webvr-polyfill: "+n),e[t]=!0)}),L=function(e,t){B(e,e+" has been deprecated. This may not work on native WebVR displays. "+(t?"Please use "+t+" instead.":""))};function k(e,t,n){if(t){for(var r=[],i=null,s=0;s<t.length;++s)switch(o=t[s]){case e.TEXTURE_BINDING_2D:case e.TEXTURE_BINDING_CUBE_MAP:if((l=t[++s])<e.TEXTURE0||l>e.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),r.push(null,null);break}i||(i=e.getParameter(e.ACTIVE_TEXTURE)),e.activeTexture(l),r.push(e.getParameter(o),null);break;case e.ACTIVE_TEXTURE:i=e.getParameter(e.ACTIVE_TEXTURE),r.push(null);break;default:r.push(e.getParameter(o))}for(n(e),s=0;s<t.length;++s){var o=t[s],a=r[s];switch(o){case e.ACTIVE_TEXTURE:break;case e.ARRAY_BUFFER_BINDING:e.bindBuffer(e.ARRAY_BUFFER,a);break;case e.COLOR_CLEAR_VALUE:e.clearColor(a[0],a[1],a[2],a[3]);break;case e.COLOR_WRITEMASK:e.colorMask(a[0],a[1],a[2],a[3]);break;case e.CURRENT_PROGRAM:e.useProgram(a);break;case e.ELEMENT_ARRAY_BUFFER_BINDING:e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a);break;case e.FRAMEBUFFER_BINDING:e.bindFramebuffer(e.FRAMEBUFFER,a);break;case e.RENDERBUFFER_BINDING:e.bindRenderbuffer(e.RENDERBUFFER,a);break;case e.TEXTURE_BINDING_2D:if((l=t[++s])<e.TEXTURE0||l>e.TEXTURE31)break;e.activeTexture(l),e.bindTexture(e.TEXTURE_2D,a);break;case e.TEXTURE_BINDING_CUBE_MAP:var l;if((l=t[++s])<e.TEXTURE0||l>e.TEXTURE31)break;e.activeTexture(l),e.bindTexture(e.TEXTURE_CUBE_MAP,a);break;case e.VIEWPORT:e.viewport(a[0],a[1],a[2],a[3]);break;case e.BLEND:case e.CULL_FACE:case e.DEPTH_TEST:case e.SCISSOR_TEST:case e.STENCIL_TEST:a?e.enable(o):e.disable(o);break;default:console.log("No GL restore behavior for 0x"+o.toString(16))}i&&e.activeTexture(i)}}else n(e)}var O=k,N=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join("\n"),G=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join("\n");function U(e,t,n,r){this.gl=e,this.cardboardUI=t,this.bufferScale=n,this.dirtySubmitFrameBindings=r,this.ctxAttribs=e.getContextAttributes(),this.instanceExt=e.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=e.drawingBufferWidth,this.bufferHeight=e.drawingBufferHeight,this.realBindFramebuffer=e.bindFramebuffer,this.realEnable=e.enable,this.realDisable=e.disable,this.realColorMask=e.colorMask,this.realClearColor=e.clearColor,this.realViewport=e.viewport,d()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=S(e,N,G,this.attribs),this.uniforms=M(e,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.indexCount=0,this.renderTarget=e.createTexture(),this.framebuffer=e.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=e.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=e.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=e.createRenderbuffer()),this.patch(),this.onResize()}U.prototype.destroy=function(){var e=this.gl;this.unpatch(),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),e.deleteTexture(this.renderTarget),e.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&e.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&e.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&e.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},U.prototype.onResize=function(){var e=this.gl,t=this,n=[e.RENDERBUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0];O(e,n,(function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.framebuffer),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.texImage2D(e.TEXTURE_2D,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,t.bufferWidth,t.bufferHeight,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.renderTarget,0),t.ctxAttribs.depth&&t.ctxAttribs.stencil?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthStencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t.depthStencilBuffer)):t.ctxAttribs.depth?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.depthBuffer)):t.ctxAttribs.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,t.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,t.stencilBuffer)),!e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),t.realClearColor.apply(e,t.clearColor)})),this.cardboardUI&&this.cardboardUI.onResize()},U.prototype.patch=function(){if(!this.isPatched){var e=this,t=this.gl.canvas,n=this.gl;d()||(t.width=y()*this.bufferScale,t.height=w()*this.bufferScale,Object.defineProperty(t,"width",{configurable:!0,enumerable:!0,get:function(){return e.bufferWidth},set:function(n){e.bufferWidth=n,e.realCanvasWidth.set.call(t,n),e.onResize()}}),Object.defineProperty(t,"height",{configurable:!0,enumerable:!0,get:function(){return e.bufferHeight},set:function(n){e.bufferHeight=n,e.realCanvasHeight.set.call(t,n),e.onResize()}})),this.lastBoundFramebuffer=n.getParameter(n.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(t,r){e.lastBoundFramebuffer=r||e.framebuffer,e.realBindFramebuffer.call(n,t,e.lastBoundFramebuffer)},this.cullFace=n.getParameter(n.CULL_FACE),this.depthTest=n.getParameter(n.DEPTH_TEST),this.blend=n.getParameter(n.BLEND),this.scissorTest=n.getParameter(n.SCISSOR_TEST),this.stencilTest=n.getParameter(n.STENCIL_TEST),n.enable=function(t){switch(t){case n.CULL_FACE:e.cullFace=!0;break;case n.DEPTH_TEST:e.depthTest=!0;break;case n.BLEND:e.blend=!0;break;case n.SCISSOR_TEST:e.scissorTest=!0;break;case n.STENCIL_TEST:e.stencilTest=!0}e.realEnable.call(n,t)},n.disable=function(t){switch(t){case n.CULL_FACE:e.cullFace=!1;break;case n.DEPTH_TEST:e.depthTest=!1;break;case n.BLEND:e.blend=!1;break;case n.SCISSOR_TEST:e.scissorTest=!1;break;case n.STENCIL_TEST:e.stencilTest=!1}e.realDisable.call(n,t)},this.colorMask=n.getParameter(n.COLOR_WRITEMASK),n.colorMask=function(t,r,i,s){e.colorMask[0]=t,e.colorMask[1]=r,e.colorMask[2]=i,e.colorMask[3]=s,e.realColorMask.call(n,t,r,i,s)},this.clearColor=n.getParameter(n.COLOR_CLEAR_VALUE),n.clearColor=function(t,r,i,s){e.clearColor[0]=t,e.clearColor[1]=r,e.clearColor[2]=i,e.clearColor[3]=s,e.realClearColor.call(n,t,r,i,s)},this.viewport=n.getParameter(n.VIEWPORT),n.viewport=function(t,r,i,s){e.viewport[0]=t,e.viewport[1]=r,e.viewport[2]=i,e.viewport[3]=s,e.realViewport.call(n,t,r,i,s)},this.isPatched=!0,I(t)}},U.prototype.unpatch=function(){if(this.isPatched){var e=this.gl,t=this.gl.canvas;d()||(Object.defineProperty(t,"width",this.realCanvasWidth),Object.defineProperty(t,"height",this.realCanvasHeight)),t.width=this.bufferWidth,t.height=this.bufferHeight,e.bindFramebuffer=this.realBindFramebuffer,e.enable=this.realEnable,e.disable=this.realDisable,e.colorMask=this.realColorMask,e.clearColor=this.realClearColor,e.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,null),this.isPatched=!1,setTimeout((function(){I(t)}),1)}},U.prototype.setTextureBounds=function(e,t){e||(e=[0,0,.5,1]),t||(t=[.5,0,.5,1]),this.viewportOffsetScale[0]=e[0],this.viewportOffsetScale[1]=e[1],this.viewportOffsetScale[2]=e[2],this.viewportOffsetScale[3]=e[3],this.viewportOffsetScale[4]=t[0],this.viewportOffsetScale[5]=t[1],this.viewportOffsetScale[6]=t[2],this.viewportOffsetScale[7]=t[3]},U.prototype.submitFrame=function(){var e=this.gl,t=this,n=[];if(this.dirtySubmitFrameBindings||n.push(e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING,e.ELEMENT_ARRAY_BUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0),O(e,n,(function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null);var n=0,r=0;t.instanceExt&&(n=e.getVertexAttrib(t.attribs.position,t.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),r=e.getVertexAttrib(t.attribs.texCoord,t.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),t.cullFace&&t.realDisable.call(e,e.CULL_FACE),t.depthTest&&t.realDisable.call(e,e.DEPTH_TEST),t.blend&&t.realDisable.call(e,e.BLEND),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realDisable.call(e,e.STENCIL_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),(t.ctxAttribs.alpha||d())&&(t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)),e.useProgram(t.program),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.enableVertexAttribArray(t.attribs.position),e.enableVertexAttribArray(t.attribs.texCoord),e.vertexAttribPointer(t.attribs.position,2,e.FLOAT,!1,20,0),e.vertexAttribPointer(t.attribs.texCoord,3,e.FLOAT,!1,20,8),t.instanceExt&&(0!=n&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.position,0),0!=r&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.texCoord,0)),e.activeTexture(e.TEXTURE0),e.uniform1i(t.uniforms.diffuse,0),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.uniform4fv(t.uniforms.viewportOffsetScale,t.viewportOffsetScale),e.drawElements(e.TRIANGLES,t.indexCount,e.UNSIGNED_SHORT,0),t.cardboardUI&&t.cardboardUI.renderNoState(),t.realBindFramebuffer.call(t.gl,e.FRAMEBUFFER,t.framebuffer),t.ctxAttribs.preserveDrawingBuffer||(t.realClearColor.call(e,0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)),t.dirtySubmitFrameBindings||t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.cullFace&&t.realEnable.call(e,e.CULL_FACE),t.depthTest&&t.realEnable.call(e,e.DEPTH_TEST),t.blend&&t.realEnable.call(e,e.BLEND),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realEnable.call(e,e.STENCIL_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),!t.ctxAttribs.alpha&&t.ctxAttribs.preserveDrawingBuffer||t.realClearColor.apply(e,t.clearColor),t.instanceExt&&(0!=n&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.position,n),0!=r&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.texCoord,r))})),d()){var r=e.canvas;r.width==t.bufferWidth&&r.height==t.bufferHeight||(t.bufferWidth=r.width,t.bufferHeight=r.height,t.onResize())}},U.prototype.updateDeviceInfo=function(e){var t=this.gl,n=this,r=[t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING];O(t,r,(function(t){var r=n.computeMeshVertices_(n.meshWidth,n.meshHeight,e);if(t.bindBuffer(t.ARRAY_BUFFER,n.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),!n.indexCount){var i=n.computeMeshIndices_(n.meshWidth,n.meshHeight);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),n.indexCount=i.length}}))},U.prototype.computeMeshVertices_=function(e,t,n){for(var r=new Float32Array(2*e*t*5),i=n.getLeftEyeVisibleTanAngles(),s=n.getLeftEyeNoLensTanAngles(),o=n.getLeftEyeVisibleScreenRect(s),a=0,l=0;l<2;l++){for(var d=0;d<t;d++)for(var h=0;h<e;h++,a++){var u=h/(e-1),p=d/(t-1),m=u,f=p,b=c(i[0],i[2],u),v=c(i[3],i[1],p),g=Math.sqrt(b*b+v*v),A=n.distortion.distortInverse(g),y=v*A/g;u=(b*A/g-s[0])/(s[2]-s[0]),p=(y-s[3])/(s[1]-s[3]),u=2*(o.x+u*o.width-.5),p=2*(o.y+p*o.height-.5),r[5*a+0]=u,r[5*a+1]=p,r[5*a+2]=m,r[5*a+3]=f,r[5*a+4]=l}var w=i[2]-i[0];i[0]=-(w+i[0]),i[2]=w-i[2],w=s[2]-s[0],s[0]=-(w+s[0]),s[2]=w-s[2],o.x=1-(o.x+o.width)}return r},U.prototype.computeMeshIndices_=function(e,t){for(var n=new Uint16Array(2*(e-1)*(t-1)*6),r=e/2,i=t/2,s=0,o=0,a=0;a<2;a++)for(var l=0;l<t;l++)for(var c=0;c<e;c++,s++)0!=c&&0!=l&&(c<=r==l<=i?(n[o++]=s,n[o++]=s-e-1,n[o++]=s-e,n[o++]=s-e-1,n[o++]=s,n[o++]=s-1):(n[o++]=s-1,n[o++]=s-e,n[o++]=s,n[o++]=s-e,n[o++]=s-1,n[o++]=s-e-1));return n},U.prototype.getOwnPropertyDescriptor_=function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n.get&&void 0!==n.set||(n.configurable=!0,n.enumerable=!0,n.get=function(){return this.getAttribute(t)},n.set=function(e){this.setAttribute(t,e)}),n};var H=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join("\n"),z=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join("\n"),j=Math.PI/180,X=60,Q=12,W=20,q=1,Z=.75,Y=.3125,K=4,J=28,$=1.5;function ee(e){this.gl=e,this.attribs={position:0},this.program=S(e,H,z,this.attribs),this.uniforms=M(e,this.program),this.vertexBuffer=e.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function te(e){this.coefficients=e}ee.prototype.destroy=function(){var e=this.gl;this.listener&&e.canvas.removeEventListener("click",this.listener,!1),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer)},ee.prototype.listen=function(e,t){var n=this.gl.canvas;this.listener=function(r){var i=n.clientWidth/2,s=J*$;r.clientX>i-s&&r.clientX<i+s&&r.clientY>n.clientHeight-s?e(r):r.clientX<s&&r.clientY<s&&t(r)},n.addEventListener("click",this.listener,!1)},ee.prototype.onResize=function(){var e=this.gl,t=this,n=[e.ARRAY_BUFFER_BINDING];O(e,n,(function(e){var n=[],r=e.drawingBufferWidth/2,i=Math.max(screen.width,screen.height)*window.devicePixelRatio,s=e.drawingBufferWidth/i*window.devicePixelRatio,o=K*s/2,a=J*$*s,l=J*s/2,c=(J*$-J)*s;function d(e,t){var i=(90-e)*j,s=Math.cos(i),o=Math.sin(i);n.push(Y*s*l+r,Y*o*l+l),n.push(t*s*l+r,t*o*l+l)}n.push(r-o,a),n.push(r-o,e.drawingBufferHeight),n.push(r+o,a),n.push(r+o,e.drawingBufferHeight),t.gearOffset=n.length/2;for(var h=0;h<=6;h++){var u=h*X;d(u,q),d(u+Q,q),d(u+W,Z),d(u+(X-W),Z),d(u+(X-Q),q)}function p(t,r){n.push(c+t,e.drawingBufferHeight-c-r)}t.gearVertexCount=n.length/2-t.gearOffset,t.arrowOffset=n.length/2;var m=o/Math.sin(45*j);p(0,l),p(l,0),p(l+m,m),p(m,l+m),p(m,l-m),p(0,l),p(l,2*l),p(l+m,2*l-m),p(m,l-m),p(0,l),p(m,l-o),p(J*s,l-o),p(m,l+o),p(J*s,l+o),t.arrowVertexCount=n.length/2-t.arrowOffset,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW)}))},ee.prototype.render=function(){var e=this.gl,t=this,n=[e.CULL_FACE,e.DEPTH_TEST,e.BLEND,e.SCISSOR_TEST,e.STENCIL_TEST,e.COLOR_WRITEMASK,e.VIEWPORT,e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING];O(e,n,(function(e){e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.colorMask(!0,!0,!0,!0),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.renderNoState()}))},ee.prototype.renderNoState=function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.enableVertexAttribArray(this.attribs.position),e.vertexAttribPointer(this.attribs.position,2,e.FLOAT,!1,8,0),e.uniform4f(this.uniforms.color,1,1,1,1),R(this.projMat,0,e.drawingBufferWidth,0,e.drawingBufferHeight,.1,1024),e.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.drawArrays(e.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),e.drawArrays(e.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},te.prototype.distortInverse=function(e){for(var t=0,n=1,r=e-this.distort(t);Math.abs(n-t)>1e-4;){var i=e-this.distort(n),s=n-i*((n-t)/(i-r));t=n,n=s,r=i}return n},te.prototype.distort=function(e){for(var t=e*e,n=0,r=0;r<this.coefficients.length;r++)n=t*(n+this.coefficients[r]);return(n+1)*e};var ne=Math.PI/180,re=180/Math.PI,ie=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0};ie.prototype={constructor:ie,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var e=this.length();if(0!==e){var t=1/e;this.multiplyScalar(t)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(e){this.x*=e,this.y*=e,this.z*=e},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z,a=e.w,l=a*t+s*r-o*n,c=a*n+o*t-i*r,d=a*r+i*n-s*t,h=-i*t-s*n-o*r;return this.x=l*a+h*-i+c*-o-d*-s,this.y=c*a+h*-s+d*-i-l*-o,this.z=d*a+h*-o+l*-s-c*-i,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,s=t.x,o=t.y,a=t.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}};var se,oe,ae,le=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1};function ce(e){this.width=e.width||y(),this.height=e.height||w(),this.widthMeters=e.widthMeters,this.heightMeters=e.heightMeters,this.bevelMeters=e.bevelMeters}le.prototype={constructor:le,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEulerXYZ:function(e,t,n){var r=Math.cos(e/2),i=Math.cos(t/2),s=Math.cos(n/2),o=Math.sin(e/2),a=Math.sin(t/2),l=Math.sin(n/2);return this.x=o*i*s+r*a*l,this.y=r*a*s-o*i*l,this.z=r*i*l+o*a*s,this.w=r*i*s-o*a*l,this},setFromEulerYXZ:function(e,t,n){var r=Math.cos(e/2),i=Math.cos(t/2),s=Math.cos(n/2),o=Math.sin(e/2),a=Math.sin(t/2),l=Math.sin(n/2);return this.x=o*i*s+r*a*l,this.y=r*a*s-o*i*l,this.z=r*i*l-o*a*s,this.w=r*i*s+o*a*l,this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e.x,r=e.y,i=e.z,s=e.w,o=t.x,a=t.y,l=t.z,c=t.w;return this.x=n*c+s*o+r*l-i*a,this.y=r*c+s*a+i*o-n*l,this.z=i*c+s*l+n*a-r*o,this.w=s*c-n*o-r*a-i*l,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this.x,r=this.y,i=this.z,s=this.w,o=s*e.w+n*e.x+r*e.y+i*e.z;if(o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),o>=1)return this.w=s,this.x=n,this.y=r,this.z=i,this;var a=Math.acos(o),l=Math.sqrt(1-o*o);if(Math.abs(l)<.001)return this.w=.5*(s+this.w),this.x=.5*(n+this.x),this.y=.5*(r+this.y),this.z=.5*(i+this.z),this;var c=Math.sin((1-t)*a)/l,d=Math.sin(t*a)/l;return this.w=s*c+this.w*d,this.x=n*c+this.x*d,this.y=r*c+this.y*d,this.z=i*c+this.z*d,this},setFromUnitVectors:(ae=1e-6,function(e,t){return void 0===se&&(se=new ie),(oe=e.dot(t)+1)<ae?(oe=0,Math.abs(e.x)>Math.abs(e.z)?se.set(-e.y,e.x,0):se.set(0,-e.z,e.y)):se.crossVectors(e,t),this.x=se.x,this.y=se.y,this.z=se.z,this.w=oe,this.normalize(),this})};var de=new ce({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),he=new ce({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),ue={CardboardV1:new me({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new me({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function pe(e,t){this.viewer=ue.CardboardV2,this.updateDeviceParams(e),this.distortion=new te(this.viewer.distortionCoefficients);for(var n=0;n<t.length;n++){var r=t[n];ue[r.id]=new me(r)}}function me(e){this.id=e.id,this.label=e.label,this.fov=e.fov,this.interLensDistance=e.interLensDistance,this.baselineLensDistance=e.baselineLensDistance,this.screenLensDistance=e.screenLensDistance,this.distortionCoefficients=e.distortionCoefficients,this.inverseCoefficients=e.inverseCoefficients}pe.prototype.updateDeviceParams=function(e){this.device=this.determineDevice_(e)||this.device},pe.prototype.getDevice=function(){return this.device},pe.prototype.setViewer=function(e){this.viewer=e,this.distortion=new te(this.viewer.distortionCoefficients)},pe.prototype.determineDevice_=function(e){if(!e)return d()?(console.warn("Using fallback iOS device measurements."),he):(console.warn("Using fallback Android device measurements."),de);var t=.0254,n=t/e.xdpi,r=t/e.ydpi;return new ce({widthMeters:n*y(),heightMeters:r*w(),bevelMeters:.001*e.bevelMm})},pe.prototype.getDistortedFieldOfViewLeftEye=function(){var e=this.viewer,t=this.device,n=this.distortion,r=e.screenLensDistance,i=(t.widthMeters-e.interLensDistance)/2,s=e.interLensDistance/2,o=e.baselineLensDistance-t.bevelMeters,a=t.heightMeters-o,l=re*Math.atan(n.distort(i/r)),c=re*Math.atan(n.distort(s/r)),d=re*Math.atan(n.distort(o/r)),h=re*Math.atan(n.distort(a/r));return{leftDegrees:Math.min(l,e.fov),rightDegrees:Math.min(c,e.fov),downDegrees:Math.min(d,e.fov),upDegrees:Math.min(h,e.fov)}},pe.prototype.getLeftEyeVisibleTanAngles=function(){var e=this.viewer,t=this.device,n=this.distortion,r=Math.tan(-ne*e.fov),i=Math.tan(ne*e.fov),s=Math.tan(ne*e.fov),o=Math.tan(-ne*e.fov),a=t.widthMeters/4,l=t.heightMeters/2,c=e.baselineLensDistance-t.bevelMeters-l,d=e.interLensDistance/2-a,h=-c,u=e.screenLensDistance,p=n.distort((d-a)/u),m=n.distort((h+l)/u),f=n.distort((d+a)/u),b=n.distort((h-l)/u),v=new Float32Array(4);return v[0]=Math.max(r,p),v[1]=Math.min(i,m),v[2]=Math.min(s,f),v[3]=Math.max(o,b),v},pe.prototype.getLeftEyeNoLensTanAngles=function(){var e=this.viewer,t=this.device,n=this.distortion,r=new Float32Array(4),i=n.distortInverse(Math.tan(-ne*e.fov)),s=n.distortInverse(Math.tan(ne*e.fov)),o=n.distortInverse(Math.tan(ne*e.fov)),a=n.distortInverse(Math.tan(-ne*e.fov)),l=t.widthMeters/4,c=t.heightMeters/2,d=e.baselineLensDistance-t.bevelMeters-c,h=e.interLensDistance/2-l,u=-d,p=e.screenLensDistance,m=(h-l)/p,f=(u+c)/p,b=(h+l)/p,v=(u-c)/p;return r[0]=Math.max(i,m),r[1]=Math.min(s,f),r[2]=Math.min(o,b),r[3]=Math.max(a,v),r},pe.prototype.getLeftEyeVisibleScreenRect=function(e){var t=this.viewer,n=this.device,r=t.screenLensDistance,i=(n.widthMeters-t.interLensDistance)/2,s=t.baselineLensDistance-n.bevelMeters,o=(e[0]*r+i)/n.widthMeters,a=(e[1]*r+s)/n.heightMeters,l=(e[2]*r+i)/n.widthMeters,c=(e[3]*r+s)/n.heightMeters;return{x:o,y:c,width:l-o,height:a-c}},pe.prototype.getFieldOfViewLeftEye=function(e){return e?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},pe.prototype.getFieldOfViewRightEye=function(e){var t=this.getFieldOfViewLeftEye(e);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,downDegrees:t.downDegrees}},pe.prototype.getUndistortedFieldOfViewLeftEye=function(){var e=this.getUndistortedParams_();return{leftDegrees:re*Math.atan(e.outerDist),rightDegrees:re*Math.atan(e.innerDist),downDegrees:re*Math.atan(e.bottomDist),upDegrees:re*Math.atan(e.topDist)}},pe.prototype.getUndistortedViewportLeftEye=function(){var e=this.getUndistortedParams_(),t=this.viewer,n=this.device,r=t.screenLensDistance,i=n.widthMeters/r,s=n.heightMeters/r,o=n.width/i,a=n.height/s,l=Math.round((e.eyePosX-e.outerDist)*o),c=Math.round((e.eyePosY-e.bottomDist)*a);return{x:l,y:c,width:Math.round((e.eyePosX+e.innerDist)*o)-l,height:Math.round((e.eyePosY+e.topDist)*a)-c}},pe.prototype.getUndistortedParams_=function(){var e=this.viewer,t=this.device,n=this.distortion,r=e.screenLensDistance,i=e.interLensDistance/2/r,s=t.widthMeters/r,o=t.heightMeters/r,a=s/2-i,l=(e.baselineLensDistance-t.bevelMeters)/r,c=e.fov,d=n.distortInverse(Math.tan(ne*c)),h=Math.min(a,d),u=Math.min(i,d),p=Math.min(l,d);return{outerDist:h,innerDist:u,topDist:Math.min(o-l,d),bottomDist:p,eyePosX:a,eyePosY:l}},pe.Viewers=ue;var fe={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};function be(e,t){if(this.dpdb=fe,this.recalculateDeviceParams_(),e){this.onDeviceParamsUpdated=t;var n=new XMLHttpRequest,r=this;n.open("GET",e,!0),n.addEventListener("load",(function(){r.loading=!1,n.status>=200&&n.status<=299?(r.dpdb=JSON.parse(n.response),r.recalculateDeviceParams_()):console.error("Error loading online DPDB!")})),n.send()}}function ve(e){this.xdpi=e.xdpi,this.ydpi=e.ydpi,this.bevelMm=e.bevelMm}function ge(e,t){this.set(e,t)}function Ae(e,t){this.kFilter=e,this.isDebug=t,this.currentAccelMeasurement=new ge,this.currentGyroMeasurement=new ge,this.previousGyroMeasurement=new ge,d()?this.filterQ=new le(-1,0,0,1):this.filterQ=new le(1,0,0,1),this.previousFilterQ=new le,this.previousFilterQ.copy(this.filterQ),this.accelQ=new le,this.isOrientationInitialized=!1,this.estimatedGravity=new ie,this.measuredGravity=new ie,this.gyroIntegralQ=new le}function ye(e,t){this.predictionTimeS=e,this.isDebug=t,this.previousQ=new le,this.previousTimestampS=null,this.deltaQ=new le,this.outQ=new le}function we(e,t,n,r){this.yawOnly=n,this.accelerometer=new ie,this.gyroscope=new ie,this.filter=new Ae(e,r),this.posePredictor=new ye(t,r),this.isFirefoxAndroid=p(),this.isIOS=d();var i=m();this.isDeviceMotionInRadians=!this.isIOS&&i&&i<66,this.isWithoutDeviceMotion=b()||f(),this.filterToWorldQ=new le,d()?this.filterToWorldQ.setFromAxisAngle(new ie(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new ie(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new le,this.worldToScreenQ=new le,this.originalPoseAdjustQ=new le,this.originalPoseAdjustQ.setFromAxisAngle(new ie(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),g()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new le,this.orientationOut_=new Float32Array(4),this.start()}be.prototype.getDeviceParams=function(){return this.deviceParams},be.prototype.recalculateDeviceParams_=function(){var e=this.calcDeviceParams_();e?(this.deviceParams=e,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},be.prototype.calcDeviceParams_=function(){var e=this.dpdb;if(!e)return console.error("DPDB not available."),null;if(1!=e.format)return console.error("DPDB has unexpected format version."),null;if(!e.devices||!e.devices.length)return console.error("DPDB does not have a devices section."),null;var t=navigator.userAgent||navigator.vendor||window.opera,n=y(),r=w();if(!e.devices)return console.error("DPDB has no devices section."),null;for(var i=0;i<e.devices.length;i++){var s=e.devices[i];if(s.rules)if("ios"==s.type||"android"==s.type){if(d()==("ios"==s.type)){for(var o=!1,a=0;a<s.rules.length;a++){var l=s.rules[a];if(this.ruleMatches_(l,t,n,r)){o=!0;break}}if(o)return new ve({xdpi:s.dpi[0]||s.dpi,ydpi:s.dpi[1]||s.dpi,bevelMm:s.bw})}}else console.warn("Device["+i+"] has invalid type.");else console.warn("Device["+i+"] has no rules section.")}return console.warn("No DPDB device match."),null},be.prototype.ruleMatches_=function(e,t,n,r){if(!e.ua&&!e.res)return!1;if(e.ua&&"SM"===e.ua.substring(0,2)&&(e.ua=e.ua.substring(0,7)),e.ua&&t.indexOf(e.ua)<0)return!1;if(e.res){if(!e.res[0]||!e.res[1])return!1;var i=e.res[0],s=e.res[1];if(Math.min(n,r)!=Math.min(i,s)||Math.max(n,r)!=Math.max(i,s))return!1}return!0},ge.prototype.set=function(e,t){this.sample=e,this.timestampS=t},ge.prototype.copy=function(e){this.set(e.sample,e.timestampS)},Ae.prototype.addAccelMeasurement=function(e,t){this.currentAccelMeasurement.set(e,t)},Ae.prototype.addGyroMeasurement=function(e,t){this.currentGyroMeasurement.set(e,t);var n=t-this.previousGyroMeasurement.timestampS;A(n)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Ae.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var e=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,t=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,e);this.gyroIntegralQ.multiply(t),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(t);var n=new le;n.copy(this.filterQ),n.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(n),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var r=new le;r.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),r.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",re*F(r),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var i=new le;i.copy(this.filterQ),i.multiply(r),this.filterQ.slerp(i,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Ae.prototype.getOrientation=function(){return this.filterQ},Ae.prototype.accelToQuaternion_=function(e){var t=new ie;t.copy(e),t.normalize();var n=new le;return n.setFromUnitVectors(new ie(0,0,-1),t),n.inverse(),n},Ae.prototype.gyroToQuaternionDelta_=function(e,t){var n=new le,r=new ie;return r.copy(e),r.normalize(),n.setFromAxisAngle(r,e.length()*t),n},ye.prototype.getPrediction=function(e,t,n){if(!this.previousTimestampS)return this.previousQ.copy(e),this.previousTimestampS=n,e;var r=new ie;r.copy(t),r.normalize();var i=t.length();if(i<20*ne)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(re*i).toFixed(1)),this.outQ.copy(e),this.previousQ.copy(e),this.outQ;var s=i*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(r,s),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(e),this.previousTimestampS=n,this.outQ},we.prototype.getPosition=function(){return null},we.prototype.getOrientation=function(){var e=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ)return this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var e=(new le).setFromAxisAngle(new ie(0,0,-1),0),t=new le;return-90===window.orientation?t.setFromAxisAngle(new ie(0,1,0),Math.PI/-2):t.setFromAxisAngle(new ie(0,1,0),Math.PI/2),e.multiply(t)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||((t=new le).setFromAxisAngle(new ie(1,0,0),-Math.PI/2),t),e=this._deviceOrientationQ,(n=new le).copy(e),n.multiply(this.deviceOrientationFilterToWorldQ),n.multiply(this.resetQ),n.multiply(this.worldToScreenQ),n.multiplyQuaternions(this.deviceOrientationFixQ,n),this.yawOnly&&(n.x=0,n.z=0,n.normalize()),this.orientationOut_[0]=n.x,this.orientationOut_[1]=n.y,this.orientationOut_[2]=n.z,this.orientationOut_[3]=n.w,this.orientationOut_;var t,n,r=this.filter.getOrientation();return e=this.posePredictor.getPrediction(r,this.gyroscope,this.previousTimestampS),(n=new le).copy(this.filterToWorldQ),n.multiply(this.resetQ),n.multiply(e),n.multiply(this.worldToScreenQ),this.yawOnly&&(n.x=0,n.z=0,n.normalize()),this.orientationOut_[0]=n.x,this.orientationOut_[1]=n.y,this.orientationOut_[2]=n.z,this.orientationOut_[3]=n.w,this.orientationOut_},we.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),g()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},we.prototype.onDeviceOrientation_=function(e){this._deviceOrientationQ=this._deviceOrientationQ||new le;var t=e.alpha,n=e.beta,r=e.gamma;t=(t||0)*Math.PI/180,n=(n||0)*Math.PI/180,r=(r||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(n,t,-r)},we.prototype.onDeviceMotion_=function(e){this.updateDeviceMotion_(e)},we.prototype.updateDeviceMotion_=function(e){var t=e.accelerationIncludingGravity,n=e.rotationRate,r=e.timeStamp/1e3,i=r-this.previousTimestampS;return i<0?(B("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),void(this.previousTimestampS=r)):i<=o||i>a?(B("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),void(this.previousTimestampS=r)):(this.accelerometer.set(-t.x,-t.y,-t.z),n&&(v()?this.gyroscope.set(-n.beta,n.alpha,n.gamma):this.gyroscope.set(n.alpha,n.beta,n.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,r)),this.filter.addAccelMeasurement(this.accelerometer,r),void(this.previousTimestampS=r))},we.prototype.onOrientationChange_=function(e){this.setScreenTransform_()},we.prototype.onMessage_=function(e){var t=e.data;t&&t.type&&"devicemotion"===t.type.toLowerCase()&&this.updateDeviceMotion_(t.deviceMotionEvent)},we.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new ie(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new ie(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},we.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),d()&&V()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},we.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var _e=60,xe=new ie(1,0,0),Ee=new ie(0,0,1),Se=new le;Se.setFromAxisAngle(xe,-Math.PI/2),Se.multiply((new le).setFromAxisAngle(Ee,Math.PI/2));var Me=function(){function e(t){r(this,e),this.config=t,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new le,this._outQ=new le,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return i(e,[{key:"init",value:function(){var e=null;try{(e=new RelativeOrientationSensor({frequency:_e,referenceFrame:"screen"})).addEventListener("error",this._onSensorError)}catch(e){this.errors.push(e),"SecurityError"===e.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===e.name?this.useDeviceMotion():console.error(e)}e&&(this.api="sensor",this.sensor=e,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new we(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var e=this.sensor.quaternion;this._sensorQ.set(e[0],e[1],e[2],e[3]);var t=this._outQ;return t.copy(Se),t.multiply(this._sensorQ),this.config.YAW_ONLY&&(t.x=t.z=0,t.normalize()),this._out[0]=t.x,this._out[1]=t.y,this._out[2]=t.z,this._out[3]=t.w,this._out}},{key:"_onSensorError",value:function(e){this.errors.push(e.error),"NotAllowedError"===e.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===e.error.name?console.error("Sensor could not be read"):console.error(e.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),e}(),Re="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Te(){this.loadIcon_();var e=document.createElement("div");(s=e.style).position="fixed",s.top=0,s.right=0,s.bottom=0,s.left=0,s.backgroundColor="gray",s.fontFamily="sans-serif",s.zIndex=1e6;var t=document.createElement("img");t.src=this.icon,(s=t.style).marginLeft="25%",s.marginTop="25%",s.width="50%",e.appendChild(t);var n=document.createElement("div");(s=n.style).textAlign="center",s.fontSize="16px",s.lineHeight="24px",s.margin="24px 25%",s.width="50%",n.innerHTML="Place your phone into your Cardboard viewer.",e.appendChild(n);var r=document.createElement("div");(s=r.style).backgroundColor="#CFD8DC",s.position="fixed",s.bottom=0,s.width="100%",s.height="48px",s.padding="14px 24px",s.boxSizing="border-box",s.color="#656A6B",e.appendChild(r);var i=document.createElement("div");i.style.float="left",i.innerHTML="No Cardboard viewer?";var s,o=document.createElement("a");o.href="https://www.google.com/get/cardboard/get-cardboard/",o.innerHTML="get one",o.target="_blank",(s=o.style).float="right",s.fontWeight=600,s.textTransform="uppercase",s.borderLeft="1px solid gray",s.paddingLeft="24px",s.textDecoration="none",s.color="#656A6B",r.appendChild(i),r.appendChild(o),this.overlay=e,this.text=n,this.hide()}Te.prototype.show=function(e){e||this.overlay.parentElement?e&&(this.overlay.parentElement&&this.overlay.parentElement!=e&&this.overlay.parentElement.removeChild(this.overlay),e.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var t=this.overlay.querySelector("img").style;g()?(t.width="20%",t.marginLeft="40%",t.marginTop="3%"):(t.width="50%",t.marginLeft="25%",t.marginTop="25%")},Te.prototype.hide=function(){this.overlay.style.display="none"},Te.prototype.showTemporarily=function(e,t){this.show(t),this.timer=setTimeout(this.hide.bind(this),e)},Te.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Te.prototype.update=function(){this.disableShowTemporarily(),!g()&&T()?this.show():this.hide()},Te.prototype.loadIcon_=function(){this.icon=l("image/svg+xml",Re)};var Ce="CardboardV1",Ie="WEBVR_CARDBOARD_VIEWER",De="webvr-polyfill-viewer-selector";function Ve(e){try{this.selectedKey=localStorage.getItem(Ie)}catch(e){console.error("Failed to load viewer profile: %s",e)}this.selectedKey||(this.selectedKey=e||Ce),this.dialog=this.createDialog_(pe.Viewers),this.root=null,this.onChangeCallbacks_=[]}function Pe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Fe(e,t){return e(t={exports:{}},t.exports),t.exports}Ve.prototype.show=function(e){this.root=e,e.appendChild(this.dialog),this.dialog.querySelector("#"+this.selectedKey).checked=!0,this.dialog.style.display="block"},Ve.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},Ve.prototype.getCurrentViewer=function(){return pe.Viewers[this.selectedKey]},Ve.prototype.getSelectedKey_=function(){var e=this.dialog.querySelector("input[name=field]:checked");return e?e.id:null},Ve.prototype.onChange=function(e){this.onChangeCallbacks_.push(e)},Ve.prototype.fireOnChange_=function(e){for(var t=0;t<this.onChangeCallbacks_.length;t++)this.onChangeCallbacks_[t](e)},Ve.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),this.selectedKey&&pe.Viewers[this.selectedKey]){this.fireOnChange_(pe.Viewers[this.selectedKey]);try{localStorage.setItem(Ie,this.selectedKey)}catch(e){console.error("Failed to save viewer profile: %s",e)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")},Ve.prototype.createDialog_=function(e){var t=document.createElement("div");t.classList.add(De),t.style.display="none";var n=document.createElement("div");(s=n.style).position="fixed",s.left=0,s.top=0,s.width="100%",s.height="100%",s.background="rgba(0, 0, 0, 0.3)",n.addEventListener("click",this.hide.bind(this));var r=280,i=document.createElement("div"),s=i.style;for(var o in s.boxSizing="border-box",s.position="fixed",s.top="24px",s.left="50%",s.marginLeft=-r/2+"px",s.width=r+"px",s.padding="24px",s.overflow="hidden",s.background="#fafafa",s.fontFamily="'Roboto', sans-serif",s.boxShadow="0px 5px 20px #666",i.appendChild(this.createH1_("Select your viewer")),e)i.appendChild(this.createChoice_(o,e[o].label));return i.appendChild(this.createButton_("Save",this.onSave_.bind(this))),t.appendChild(n),t.appendChild(i),t},Ve.prototype.createH1_=function(e){var t=document.createElement("h1"),n=t.style;return n.color="black",n.fontSize="20px",n.fontWeight="bold",n.marginTop=0,n.marginBottom="24px",t.innerHTML=e,t},Ve.prototype.createChoice_=function(e,t){var n=document.createElement("div");n.style.marginTop="8px",n.style.color="black";var r=document.createElement("input");r.style.fontSize="30px",r.setAttribute("id",e),r.setAttribute("type","radio"),r.setAttribute("value",e),r.setAttribute("name","field");var i=document.createElement("label");return i.style.marginLeft="4px",i.setAttribute("for",e),i.innerHTML=t,n.appendChild(r),n.appendChild(i),n},Ve.prototype.createButton_=function(e,t){var n=document.createElement("button");n.innerHTML=e;var r=n.style;return r.float="right",r.textTransform="uppercase",r.color="#1094f7",r.fontSize="14px",r.letterSpacing=0,r.border=0,r.background="none",r.marginTop="16px",n.addEventListener("click",t),n},"undefined"!=typeof window?window:void 0!==Nt||"undefined"!=typeof self&&self;var Be=Fe((function(e,t){!function(t,n){e.exports=n()}(0,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=n(1),o="undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,a=function(){function e(){i(this,e),o?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",s),this.noSleepVideo.addEventListener("timeupdate",function(e){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return r(e,[{key:"enable",value:function(){o?(this.disable(),this.noSleepTimer=window.setInterval((function(){window.location.href="/",window.setTimeout(window.stop,0)}),15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){o?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),e}();e.exports=a},function(e,t,n){e.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])}))})),Le=Pe(Be),ke=1e3,Oe=[0,0,.5,1],Ne=[.5,0,.5,1],Ge=window.requestAnimationFrame,Ue=window.cancelAnimationFrame;function He(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function ze(e){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:e.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:e.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:e.canPresent},maxLayers:{writable:!1,enumerable:!0,value:e.maxLayers},hasOrientation:{enumerable:!0,get:function(){return L("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),e.hasOrientation}}})}function je(e){var t=!("wakelock"in(e=e||{}))||e.wakelock;this.isPolyfilled=!0,this.displayId=ke++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return L("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new ze({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,t&&T()&&(this.wakelock_=new Le)}je.prototype.getFrameData=function(e){return D(e,this._getPose(),this)},je.prototype.getPose=function(){return L("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},je.prototype.resetPose=function(){return L("VRDisplay.prototype.resetPose"),this._resetPose()},je.prototype.getImmediatePose=function(){return L("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},je.prototype.requestAnimationFrame=function(e){return Ge(e)},je.prototype.cancelAnimationFrame=function(e){return Ue(e)},je.prototype.wrapForFullscreen=function(e){if(d())return e;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var t=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",t.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==e)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=e,this.originalParent_=e.parentElement,this.originalParent_||document.body.appendChild(e),!this.fullscreenWrapper_.parentElement){var n=this.fullscreenElement_.parentElement;n.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),n.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var r=this;function i(){if(r.fullscreenElement_){var e=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];r.fullscreenElement_.setAttribute("style",e.join("; ")+";")}}return i(),this.fullscreenWrapper_},je.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var e=this.fullscreenElement_;this.fullscreenElementCachedStyle_?e.setAttribute("style",this.fullscreenElementCachedStyle_):e.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var t=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(e),this.originalParent_===t?t.insertBefore(e,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(e),t.removeChild(this.fullscreenWrapper_),e}},je.prototype.requestPresent=function(e){var t=this.isPresenting,n=this;return e instanceof Array||(L("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),e=[e]),new Promise((function(r,i){if(n.capabilities.canPresent)if(0==e.length||e.length>n.capabilities.maxLayers)i(new Error("Invalid number of layers."));else{var s=e[0];if(s.source){var o=s.leftBounds||Oe,a=s.rightBounds||Ne;if(t){var l=n.layer_;l.source!==s.source&&(l.source=s.source);for(var c=0;c<4;c++)l.leftBounds[c]=o[c],l.rightBounds[c]=a[c];return n.wrapForFullscreen(n.layer_.source),n.updatePresent_(),void r()}if(n.layer_={predistorted:s.predistorted,source:s.source,leftBounds:o.slice(0),rightBounds:a.slice(0)},n.waitingForPresent_=!1,n.layer_&&n.layer_.source){var u=n.wrapForFullscreen(n.layer_.source),p=function(){var e=E();n.isPresenting=u===e,n.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch((function(e){console.error("screen.orientation.lock() failed due to",e.message)})),n.waitingForPresent_=!1,n.beginPresent_(),r()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),n.removeFullscreenWrapper(),n.disableWakeLock(),n.endPresent_(),n.removeFullscreenListeners_()),n.fireVRDisplayPresentChange_()},m=function(){n.waitingForPresent_&&(n.removeFullscreenWrapper(),n.removeFullscreenListeners_(),n.disableWakeLock(),n.waitingForPresent_=!1,n.isPresenting=!1,i(new Error("Unable to present.")))};n.addFullscreenListeners_(u,p,m),_(u)?(n.enableWakeLock(),n.waitingForPresent_=!0):(d()||h())&&(n.enableWakeLock(),n.isPresenting=!0,n.beginPresent_(),n.fireVRDisplayPresentChange_(),r())}n.waitingForPresent_||d()||(x(),i(new Error("Unable to present.")))}else r()}else i(new Error("VRDisplay is not capable of presenting."))}))},je.prototype.exitPresent=function(){var e=this.isPresenting,t=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise((function(n,r){e?(!x()&&d()&&(t.endPresent_(),t.fireVRDisplayPresentChange_()),h()&&(t.removeFullscreenWrapper(),t.removeFullscreenListeners_(),t.endPresent_(),t.fireVRDisplayPresentChange_()),n()):r(new Error("Was not presenting to VRDisplay."))}))},je.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},je.prototype.fireVRDisplayPresentChange_=function(){var e=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(e)},je.prototype.fireVRDisplayConnect_=function(){var e=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(e)},je.prototype.addFullscreenListeners_=function(e,t,n){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=e,this.fullscreenChangeHandler_=t,this.fullscreenErrorHandler_=n,t&&(document.fullscreenEnabled?e.addEventListener("fullscreenchange",t,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenchange",t,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",t,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenchange",t,!1)),n&&(document.fullscreenEnabled?e.addEventListener("fullscreenerror",n,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenerror",n,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",n,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenerror",n,!1))},je.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var e=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var t=this.fullscreenChangeHandler_;e.removeEventListener("fullscreenchange",t,!1),e.removeEventListener("webkitfullscreenchange",t,!1),document.removeEventListener("mozfullscreenchange",t,!1),e.removeEventListener("msfullscreenchange",t,!1)}if(this.fullscreenErrorHandler_){var n=this.fullscreenErrorHandler_;e.removeEventListener("fullscreenerror",n,!1),e.removeEventListener("webkitfullscreenerror",n,!1),document.removeEventListener("mozfullscreenerror",n,!1),e.removeEventListener("msfullscreenerror",n,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},je.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},je.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},je.prototype.beginPresent_=function(){},je.prototype.endPresent_=function(){},je.prototype.submitFrame=function(e){},je.prototype.getEyeParameters=function(e){return null};var Xe={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Qe={LEFT:"left",RIGHT:"right"};function We(e){var t=C({},Xe);e=C(t,e||{}),je.call(this,{wakelock:e.MOBILE_WAKE_LOCK}),this.config=e,this.displayName="Cardboard VRDisplay",this.capabilities=new ze({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new Me(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new be(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new pe(this.dpdb_.getDeviceParams(),e.ADDITIONAL_VIEWERS),this.viewerSelector_=new Ve(e.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Te),d()&&window.addEventListener("resize",this.onResize_.bind(this))}return We.prototype=Object.create(je.prototype),We.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},We.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},We.prototype._getFieldOfView=function(e){var t;if(e==Qe.LEFT)t=this.deviceInfo_.getFieldOfViewLeftEye();else{if(e!=Qe.RIGHT)return console.error("Invalid eye provided: %s",e),null;t=this.deviceInfo_.getFieldOfViewRightEye()}return t},We.prototype._getEyeOffset=function(e){var t;if(e==Qe.LEFT)t=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else{if(e!=Qe.RIGHT)return console.error("Invalid eye provided: %s",e),null;t=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return t},We.prototype.getEyeParameters=function(e){var t=this._getEyeOffset(e),n=this._getFieldOfView(e),r={offset:t,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(r,"fieldOfView",{enumerable:!0,get:function(){return L("VRFieldOfView","VRFrameData's projection matrices"),n}}),r},We.prototype.onDeviceParamsUpdated_=function(e){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},We.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},We.prototype.beginPresent_=function(){var e=this.layer_.source.getContext("webgl");e||(e=this.layer_.source.getContext("experimental-webgl")),e||(e=this.layer_.source.getContext("webgl2")),e&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(e.canvas.width=y()*this.bufferScale_,e.canvas.height=w()*this.bufferScale_,this.cardboardUI_=new ee(e)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new ee(e)),this.distorter_=new U(e,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(e){this.viewerSelector_.show(this.layer_.source.parentElement),e.stopPropagation(),e.preventDefault()}.bind(this),function(e){this.exitPresent(),e.stopPropagation(),e.preventDefault()}.bind(this)),this.rotateInstructions_&&(g()&&T()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},We.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},We.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},We.prototype.submitFrame=function(e){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl")),t||(t=this.layer_.source.getContext("webgl2"));var n=t.canvas;n.width==this.lastWidth&&n.height==this.lastHeight||this.cardboardUI_.onResize(),this.lastWidth=n.width,this.lastHeight=n.height,this.cardboardUI_.render()}},We.prototype.onOrientationChange_=function(e){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},We.prototype.onResize_=function(e){if(this.layer_){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl")),t||(t=this.layer_.source.getContext("webgl2"));var n=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];t.canvas.setAttribute("style",n.join("; ")+";"),I(t.canvas)}},We.prototype.onViewerChanged_=function(e){this.deviceInfo_.setViewer(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},We.prototype.fireVRDisplayDeviceParamsChange_=function(){var e=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(e)},We.VRFrameData=He,We.VRDisplay=je,We}()},Gt(Ut={exports:{}},Ut.exports),Ut.exports),zt=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(Ht);class jt extends be{constructor(e){super(),this.global=e,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(e,t){throw new Error("Not implemented")}isSessionSupported(e){throw new Error("Not implemented")}isFeatureSupported(e){throw new Error("Not implemented")}async requestSession(e,t){throw new Error("Not implemented")}requestAnimationFrame(e){throw new Error("Not implemented")}onFrameStart(e){throw new Error("Not implemented")}onFrameEnd(e){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(e,t){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(e,t){}cancelAnimationFrame(e){throw new Error("Not implemented")}endSession(e){throw new Error("Not implemented")}getViewport(e,t,n,r){throw new Error("Not implemented")}getProjectionMatrix(e){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(e){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(e,t,n){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}}let Xt={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},Qt={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},Wt={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[-.08*Math.PI,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},qt={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},Zt={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},Yt={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},Kt={"Daydream Controller":{mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},"Gear VR Controller":qt,"HTC Vive Focus Controller":{mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},"Oculus Go Controller":Xt,"Oculus Touch (Right)":Qt,"Oculus Touch (Left)":Qt,"OpenVR Gamepad":Wt,"Spatial Controller (Spatial Interaction Source) 045E-065A":Yt,"Spatial Controller (Spatial Interaction Source) 045E-065D":Zt,"Windows Mixed Reality (Right)":Yt,"Windows Mixed Reality (Left)":Yt};const Jt=Te(.155,-.465,-.15),$t=Te(-.155,-.465,-.15),en=Te(0,0,-.25),tn=Te(0,0,.05),nn=Te(-.08,.14,.08),rn=180/Math.PI;class sn{constructor(){this.hand="right",this.headElbowOffset=Jt,this.controllerQ=ke(),this.lastControllerQ=ke(),this.headQ=ke(),this.headPos=Me(),this.elbowPos=Me(),this.wristPos=Me(),this.time=null,this.lastTime=null,this.rootQ=ke(),this.position=Me()}setHandedness(e){this.hand!=e&&(this.hand=e,"left"==this.hand?this.headElbowOffset=$t:this.headElbowOffset=Jt)}update(e,t){this.time=nt(),e&&(ze(this.lastControllerQ,this.controllerQ),ze(this.controllerQ,e)),t&&(xe(this.headPos,t),Ee(this.headQ,t));let n=this.getHeadYawOrientation_(),r=this.quatAngle_(this.lastControllerQ,this.controllerQ);r/((this.time-this.lastTime)/1e3)>.61?Ne(this.rootQ,this.rootQ,n,Math.min(r/.175,1)):ze(this.rootQ,n);let i=Te(0,0,-1);Be(i,i,this.controllerQ);let s=Pe(i,[0,1,0]),o=this.clamp_((s-.12)/.87,0,1),a=Ue(this.rootQ);Ge(a,a),Oe(a,a,this.controllerQ);let l=this.elbowPos;Ce(l,this.headPos),Ie(l,l,this.headElbowOffset);let c=Re(nn);De(c,c,o),Ie(l,l,c);let d=this.quatAngle_(a,ke())*rn,h=(1-Math.pow(d/180,4))*(.4+.6*o*.4),u=ke();Ne(u,u,a,h);let p=Ge(ke(),u),m=Ue(a);Oe(m,m,p);let f=this.wristPos;Ce(f,tn),Be(f,f,u),Ie(f,f,en),Be(f,f,m),Ie(f,f,l);let b=Re(nn);De(b,b,o),Ie(this.position,this.wristPos,b),Be(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let e=Me();!function(e,t,n){function r(e,t,n){return e<t?t:e>n?n:e}var i=t[0]*t[0],s=t[1]*t[1],o=t[2]*t[2],a=t[3]*t[3];if("XYZ"===n)e[0]=Math.atan2(2*(t[0]*t[3]-t[1]*t[2]),a-i-s+o),e[1]=Math.asin(r(2*(t[0]*t[2]+t[1]*t[3]),-1,1)),e[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),a+i-s-o);else if("YXZ"===n)e[0]=Math.asin(r(2*(t[0]*t[3]-t[1]*t[2]),-1,1)),e[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),a-i-s+o),e[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),a-i+s-o);else if("ZXY"===n)e[0]=Math.asin(r(2*(t[0]*t[3]+t[1]*t[2]),-1,1)),e[1]=Math.atan2(2*(t[1]*t[3]-t[2]*t[0]),a-i-s+o),e[2]=Math.atan2(2*(t[2]*t[3]-t[0]*t[1]),a-i+s-o);else if("ZYX"===n)e[0]=Math.atan2(2*(t[0]*t[3]+t[2]*t[1]),a-i-s+o),e[1]=Math.asin(r(2*(t[1]*t[3]-t[0]*t[2]),-1,1)),e[2]=Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),a+i-s-o);else if("YZX"===n)e[0]=Math.atan2(2*(t[0]*t[3]-t[2]*t[1]),a-i+s-o),e[1]=Math.atan2(2*(t[1]*t[3]-t[0]*t[2]),a+i-s-o),e[2]=Math.asin(r(2*(t[0]*t[1]+t[2]*t[3]),-1,1));else{if("XZY"!==n)return void console.log("No order given for quaternion to euler conversion.");e[0]=Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),a-i+s-o),e[1]=Math.atan2(2*(t[0]*t[2]+t[1]*t[3]),a+i-s-o),e[2]=Math.asin(r(2*(t[2]*t[3]-t[0]*t[1]),-1,1))}}(e,this.headQ,"YXZ");let t=function(e,t,n,r){let i=.5*Math.PI/180;t*=i,n*=i,r*=i;let s=Math.sin(t),o=Math.cos(t),a=Math.sin(n),l=Math.cos(n),c=Math.sin(r),d=Math.cos(r);return e[0]=s*l*d-o*a*c,e[1]=o*a*d+s*l*c,e[2]=o*l*c-s*a*d,e[3]=o*l*d+s*a*c,e}(ke(),0,e[1]*rn,0);return t}clamp_(e,t,n){return Math.min(Math.max(e,t),n)}quatAngle_(e,t){let n=[0,0,-1],r=[0,0,-1];return Be(n,n,e),Be(r,r,t),function(e,t){let n=Te(e[0],e[1],e[2]),r=Te(t[0],t[1],t[2]);Ve(n,n),Ve(r,r);let i=Pe(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}(n,r)}}const on=Symbol("@@webxr-polyfill/XRRemappedGamepad"),an={pressed:!1,touched:!1,value:0};Object.freeze(an);class ln{constructor(e,t,n){if(n||(n={}),n.userAgentOverrides)for(let e in n.userAgentOverrides)if(navigator.userAgent.includes(e)){let t=n.userAgentOverrides[e];for(let e in t)e in n?Object.assign(n[e],t[e]):n[e]=t[e];break}let r=new Array(n.axes&&n.axes.length?n.axes.length:e.axes.length),i=new Array(n.buttons&&n.buttons.length?n.buttons.length:e.buttons.length),s=null;if(n.gripTransform){let e=n.gripTransform.orientation||[0,0,0,1];s=ge(),_e(s,je(e,e),n.gripTransform.position||[0,0,0])}let o=null;if(n.targetRayTransform){let e=n.targetRayTransform.orientation||[0,0,0,1];o=ge(),_e(o,je(e,e),n.targetRayTransform.position||[0,0,0])}let a=n.profiles;n.displayProfiles&&t.displayName in n.displayProfiles&&(a=n.displayProfiles[t.displayName]),this[on]={gamepad:e,map:n,profiles:a||[e.id],mapping:n.mapping||e.mapping,axes:r,buttons:i,gripTransform:s,targetRayTransform:o},this._update()}_update(){let e=this[on].gamepad,t=this[on].map,n=this[on].axes;for(let r=0;r<n.length;++r)t.axes&&r in t.axes?null===t.axes[r]?n[r]=0:n[r]=e.axes[t.axes[r]]:n[r]=e.axes[r];if(t.axes&&t.axes.invert)for(let e of t.axes.invert)e<n.length&&(n[e]*=-1);let r=this[on].buttons;for(let n=0;n<r.length;++n)t.buttons&&n in t.buttons?null===t.buttons[n]?r[n]=an:r[n]=e.buttons[t.buttons[n]]:r[n]=e.buttons[n]}get id(){return""}get _profiles(){return this[on].profiles}get index(){return-1}get connected(){return this[on].gamepad.connected}get timestamp(){return this[on].gamepad.timestamp}get mapping(){return this[on].mapping}get axes(){return this[on].axes}get buttons(){return this[on].buttons}get hapticActuators(){return this[on].gamepad.hapticActuators}}class cn{constructor(e,t,n=0,r=-1){this.polyfill=e,this.display=t,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new Pt(this),this.lastPosition=Me(),this.emulatedPosition=!1,this.basePoseMatrix=ge(),this.outputMatrix=ge(),this.primaryButtonIndex=n,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=r,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(e){this.nativeGamepad!==e&&(this.nativeGamepad=e,this.gamepad=e?new ln(e,this.display,Kt[e.id]):null),this.handedness=""===e.hand?"none":e.hand,this.gamepad&&this.gamepad._update(),e.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!e.pose.hasPosition):""===e.hand&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let e=this.nativeGamepad.pose,t=e.position,n=e.orientation;if(!t&&!n)return;t?(this.lastPosition[0]=t[0],this.lastPosition[1]=t[1],this.lastPosition[2]=t[2]):e.hasPosition?t=this.lastPosition:(this.armModel||(this.armModel=new sn),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(n,this.polyfill.getBasePoseMatrix()),t=this.armModel.getPosition()),_e(this.basePoseMatrix,n,t)}else e=this.basePoseMatrix,t=this.polyfill.getBasePoseMatrix(),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15];var e,t;return this.basePoseMatrix}getXRPose(e,t){switch(this.updateBasePoseMatrix(),t){case"target-ray":e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[on].targetRayTransform&&we(this.outputMatrix,this.outputMatrix,this.gamepad[on].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[on].gripTransform&&we(this.outputMatrix,this.outputMatrix,this.gamepad[on].gripTransform);break;default:return null}return e._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}}const dn={highRefreshRate:!0},hn={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1};let un=0;class pn{constructor(e,t,n={}){if(this.mode=e,this.enabledFeatures=t,this.outputContext=null,this.immersive="immersive-vr"==e||"immersive-ar"==e,this.ended=null,this.baseLayer=null,this.id=++un,this.modifiedCanvasLayer=!1,this.outputContext){const e=n.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(e)}}}class mn extends jt{constructor(e,t){const{canPresent:n}=t.capabilities;super(e),this.display=t,this.frame=new e.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=n,this.baseModelMatrix=ge(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),e.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=e.navigator&&"getGamepads"in e.navigator,this.HAS_BITMAP_SUPPORT=(e=>!(!e.ImageBitmapRenderingContext||!e.createImageBitmap))(e)}get depthNear(){return this.display.depthNear}set depthNear(e){this.display.depthNear=e}get depthFar(){return this.display.depthFar}set depthFar(e){this.display.depthFar=e}onBaseLayerSet(e,t){const n=this.sessions.get(e),r=t.context.canvas;if(n.immersive){const e=this.display.getEyeParameters("left"),i=this.display.getEyeParameters("right");r.width=2*Math.max(e.renderWidth,i.renderWidth),r.height=Math.max(e.renderHeight,i.renderHeight),this.display.requestPresent([{source:r,attributes:dn}]).then((()=>{this.global.document.body.contains(r)||(n.modifiedCanvasLayer=!0,this.global.document.body.appendChild(r),(e=>{e.style.display="block",e.style.position="absolute",e.style.width=e.style.height="1px",e.style.top=e.style.left="0px"})(r)),n.baseLayer=t}))}else n.baseLayer=t}isSessionSupported(e){return"immersive-ar"!=e&&("immersive-vr"!=e||!1!==this.canPresent)}isFeatureSupported(e){switch(e){case"viewer":case"local":case"local-floor":return!0;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let n="immersive-vr"==e;if(n){const e=this.global.document.createElement("canvas");e.getContext("webgl");await this.display.requestPresent([{source:e,attributes:dn}])}const r=new pn(e,t,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(r.id,r),n&&(this.immersiveSession=r,this.dispatchEvent("@@webxr-polyfill/vr-present-start",r.id)),Promise.resolve(r.id)}requestAnimationFrame(e){return this.display.requestAnimationFrame(e)}getPrimaryButtonIndex(e){let t=0,n=e.id.toLowerCase();for(let e in hn)if(n.includes(e)){t=hn[e];break}return Math.min(t,e.buttons.length-1)}onFrameStart(e,t){this.display.depthNear=t.depthNear,this.display.depthFar=t.depthFar,this.display.getFrameData(this.frame);const n=this.sessions.get(e);if(n.immersive&&this.CAN_USE_GAMEPAD){let e=this.gamepadInputSources;this.gamepadInputSources={};let t=this.global.navigator.getGamepads();for(let r=0;r<t.length;++r){let i=t[r];if(i&&i.displayId>0){let t=e[r];if(t||(t=new cn(this,this.display,this.getPrimaryButtonIndex(i))),t.updateFromGamepad(i),this.gamepadInputSources[r]=t,-1!=t.primaryButtonIndex){let e=i.buttons[t.primaryButtonIndex].pressed;e&&!t.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:n.id,inputSource:t.inputSource}):!e&&t.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:n.id,inputSource:t.inputSource}),t.primaryActionPressed=e}if(-1!=t.primarySqueezeButtonIndex){let e=i.buttons[t.primarySqueezeButtonIndex].pressed;e&&!t.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:n.id,inputSource:t.inputSource}):!e&&t.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:n.id,inputSource:t.inputSource}),t.primarySqueezeActionPressed=e}}}}if(!n.immersive&&n.baseLayer){const e=n.baseLayer.context.canvas;Se(this.frame.leftProjectionMatrix,t.inlineVerticalFieldOfView,e.width/e.height,t.depthNear,t.depthFar)}}onFrameEnd(e){const t=this.sessions.get(e);if(!t.ended&&t.baseLayer){if(t.outputContext&&(!t.immersive||this.display.capabilities.hasExternalDisplay)){const e=t.immersive&&this.display.capabilities.hasExternalDisplay,n=t.baseLayer.context.canvas,r=e?n.width/2:n.width,i=n.height;{const e=t.outputContext.canvas,s=e.width,o=e.height,a=t.renderContext;this.HAS_BITMAP_SUPPORT?n.transferToImageBitmap?a.transferFromImageBitmap(n.transferToImageBitmap()):this.global.createImageBitmap(n,0,0,r,i,{resizeWidth:s,resizeHeight:o}).then((e=>a.transferFromImageBitmap(e))):a.drawImage(n,0,0,r,i,0,0,s,o)}}t.immersive&&t.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(e){this.display.cancelAnimationFrame(e)}async endSession(e){const t=this.sessions.get(e);if(!t.ended)return t.immersive?this.display.exitPresent():void(t.ended=!0)}doesSessionSupportReferenceSpace(e,t){const n=this.sessions.get(e);return!n.ended&&n.enabledFeatures.has(t)}requestStageBounds(){if(this.display.stageParameters){const e=this.display.stageParameters.sizeX,t=this.display.stageParameters.sizeZ,n=[];return n.push(-e/2),n.push(-t/2),n.push(e/2),n.push(-t/2),n.push(e/2),n.push(t/2),n.push(-e/2),n.push(t/2),n}return null}async requestFrameOfReferenceTransform(e,t){return("local-floor"===e||"bounded-floor"===e)&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(e){if("left"===e)return this.frame.leftProjectionMatrix;if("right"===e)return this.frame.rightProjectionMatrix;if("none"===e)return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(e,t,n,r){const i=this.sessions.get(e),{width:s,height:o}=n.context.canvas;if(!i.immersive)return r.x=r.y=0,r.width=s,r.height=o,!0;if("left"===t||"none"===t)r.x=0;else{if("right"!==t)return!1;r.x=s/2}return r.y=0,r.width=s/2,r.height=o,!0}getBasePoseMatrix(){let{position:e,orientation:t}=this.frame.pose;return e||t?(e||(e=this.tempVec3,e[0]=e[1]=e[2]=0),_e(this.baseModelMatrix,t,e),this.baseModelMatrix):this.baseModelMatrix}getBaseViewMatrix(e){if("left"===e||"none"===e)return this.frame.leftViewMatrix;if("right"===e)return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let e=[];for(let t in this.gamepadInputSources)e.push(this.gamepadInputSources[t].inputSource);return e}getInputPose(e,t,n){if(!t)return null;for(let r in this.gamepadInputSources){let i=this.gamepadInputSources[r];if(i.inputSource===e)return i.getXRPose(t,n)}return null}onWindowResize(){}onVRDisplayPresentChange(e){this.display.isPresenting||this.sessions.forEach((e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){const t=e.baseLayer.context.canvas;document.body.removeChild(t),t.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}}))}}class fn extends mn{constructor(e,t){const n=new zt(t||{});super(e,n),this.display=n,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}}let bn=0;class vn{constructor(e,t){this.mode=e,this.enabledFeatures=t,this.ended=null,this.baseLayer=null,this.id=++bn}}class gn extends jt{constructor(e){super(e),this.sessions=new Map,this.projectionMatrix=ge(),this.identityMatrix=ge()}onBaseLayerSet(e,t){this.sessions.get(e).baseLayer=t}isSessionSupported(e){return"inline"==e}isFeatureSupported(e){return"viewer"===e}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();const n=new vn(e,t);return this.sessions.set(n.id,n),Promise.resolve(n.id)}requestAnimationFrame(e){return window.requestAnimationFrame(e)}cancelAnimationFrame(e){window.cancelAnimationFrame(e)}onFrameStart(e,t){const n=this.sessions.get(e);if(n.baseLayer){const e=n.baseLayer.context.canvas;Se(this.projectionMatrix,t.inlineVerticalFieldOfView,e.width/e.height,t.depthNear,t.depthFar)}}onFrameEnd(e){}async endSession(e){this.sessions.get(e).ended=!0}doesSessionSupportReferenceSpace(e,t){const n=this.sessions.get(e);return!n.ended&&n.enabledFeatures.has(t)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(e,t){return null}getProjectionMatrix(e){return this.projectionMatrix}getViewport(e,t,n,r){this.sessions.get(e);const{width:i,height:s}=n.context.canvas;return r.x=r.y=0,r.width=i,r.height=s,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(e){return this.identityMatrix}getInputSources(){return[]}getInputPose(e,t,n){return null}onWindowResize(){}}const An=async function(e,t){if(t.webvr){let t=await async function(e){let t=null;if("getVRDisplays"in e.navigator)try{const n=await e.navigator.getVRDisplays();n&&n.length&&(t=new mn(e,n[0]))}catch(e){}return t}(e);if(t)return t}let n=(e=>{var t,n=!1;return t=e.navigator.userAgent||e.navigator.vendor||e.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(n=!0),n})(e);return n&&t.cardboard||!n&&t.allowCardboardOnDesktop?(e.VRFrameData||(e.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new fn(e,t.cardboardConfig)):new gn(e)},yn={global:me,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},wn=["navigator","HTMLCanvasElement","WebGLRenderingContext"];const _n=class{constructor(e={}){this.config=Object.freeze(Object.assign({},yn,e)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}_injectPolyfill(e){if(!wn.every((t=>!!e[t])))throw new Error(`Global must have the following attributes : ${wn}`);for(const t of Object.keys(Lt))void 0!==e[t]?console.warn(`${t} already defined on global.`):e[t]=Lt[t];kt(e.WebGLRenderingContext)&&(Ot(e.HTMLCanvasElement),e.OffscreenCanvas&&Ot(e.OffscreenCanvas),e.WebGL2RenderingContext&&kt(e.WebGL2RenderingContext),window.isSecureContext||console.warn("WebXR Polyfill Warning:\nThis page is not running in a secure context (https:// or localhost)!\nThis means that although the page may be able to use the WebXR Polyfill it will\nnot be able to use native WebXR implementations, and as such will not be able to\naccess dedicated VR or AR hardware, and will not be able to take advantage of\nany performance improvements a native WebXR implementation may offer. Please\nhost this content on a secure origin for the best user experience.\n"));this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let e=An(this.global,this.config);this.xr=new Lt.XRSystem(e),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(e){if(!wn.every((t=>!!e[t])))throw new Error(`Global must have the following attributes : ${wn}`);if(e.navigator.xr&&"supportsSession"in e.navigator.xr&&!("isSessionSupported"in e.navigator.xr)){let t=e.navigator.xr.supportsSession;e.navigator.xr.isSessionSupported=function(e){return t.call(this,e).then((()=>!0)).catch((()=>!1))},e.navigator.xr.supportsSession=function(e){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),t.call(this,e)}}}};function xn(e,t){return function(){return t.apply(e,arguments)}}function En(e){return e.replace(/\W/g,"_")}t.Vector3.prototype.toLog=function(){return`[${this.x}, ${this.y}, ${this.z}]`},t.Vector4.prototype.toLog=function(){return`[${this.x}, ${this.y}, ${this.z}, ${this.w}]`},t.Matrix3.prototype.toLog=function(){let e="\r\n";for(let t=0;t<3;t++){for(let n=0;n<3;n++)0!==n&&(e+=",\t"),e+=this.elements[t+3*n];e+="\r\n"}return e},t.Matrix3.prototype.power=function(e){if(e<0)return this.invert().power(-e);if(0===e)return this.identity();if(1===e)return this;if(e%2==0)return this.power(e/2),this.multiply(this);{const t=this.clone();return this.power(e-1),this.multiply(t)}},t.Matrix4.prototype.toLog=function(){let e="\r\n";for(let t=0;t<4;t++){for(let n=0;n<4;n++)0!==n&&(e+=",\t"),e+=this.elements[t+4*n];e+="\r\n"}return e},t.Matrix4.prototype.add=function(e){return this.set.apply(this,[].map.call(this.elements,(function(t,n){return t+e.elements[n]}))),this},t.Quaternion.prototype.toLog=function(){return`[${this.x}, ${this.y}, ${this.z}, ${this.w}]`},t.Quaternion.prototype.multiplyScalar=function(e){return this.set(e*this.x,e*this.y,e*this.z,e*this.w),this},t.Quaternion.prototype.add=function(e){return this.set(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w),this};const Sn=0,Mn=1;class Rn extends S{constructor(e,t,n,r,i,s={},o={}){new _n,super(e,t,n,r,i,s,o),this.threeRenderer.xr.enabled=!0,this.threeRenderer.xr.setReferenceSpaceType("local"),this.camera.threeCamera.layers.enable(1);const a=class{static createButton(e,t){t&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');const n=document.createElement("button");function r(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null,n.textContent="VR NOT SUPPORTED"}function i(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",i(n),navigator.xr.isSessionSupported("immersive-vr").then((function(t){t?function(){let t=null;async function r(r){r.addEventListener("end",i),await e.xr.setSession(r),n.textContent="EXIT VR",t=r}function i(){t.removeEventListener("end",i),n.textContent="ENTER VR",t=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){if(null===t){const e={optionalFeatures:["local-floor","bounded-floor","hand-tracking"]};navigator.xr.requestSession("immersive-vr",e).then(r)}else t.end()}}():r()})),n;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",i(e),e}}}.createButton(this.threeRenderer),l=xn(this.camera,this.camera.switchStereo);a.addEventListener("click",l,!1),document.body.appendChild(a),this._fragmentBuilder=[new M,new M]}get isVRRenderer(){return!0}get xr(){return this.threeRenderer.xr}buildFragmentShader(){for(const e of[Sn,Mn])this._fragmentBuilder[e].addChunk(I()),this._fragmentBuilder[e].addUniform("maxBounces","int",this.maxBounces),this._fragmentBuilder[e].addChunk(this.shader1),this._fragmentBuilder[e].addChunk(V()),this._fragmentBuilder[e].addChunk(this.shader2),this._fragmentBuilder[e].addChunk(F()),this._fragmentBuilder[e].addChunk(G()),this.set.shader(this._fragmentBuilder[e]),this.camera.sidedShader(this._fragmentBuilder[e],e),this.scene.shader(this._fragmentBuilder[e]),this._fragmentBuilder[e].addChunk(O()(this)),this._fragmentBuilder[e].addChunk(H()(this)),this._fragmentBuilder[e].addChunk(L()),this._fragmentBuilder[e].addChunk(X())}build(){const e=new t.SphereBufferGeometry(1e3,60,40);e.scale(1,1,-1),this.buildFragmentShader();const n=new t.ShaderMaterial({uniforms:this._fragmentBuilder[Sn].uniforms,vertexShader:T(),fragmentShader:this._fragmentBuilder[Sn].code}),r=new t.ShaderMaterial({uniforms:this._fragmentBuilder[Mn].uniforms,vertexShader:T(),fragmentShader:this._fragmentBuilder[Mn].code}),i=new t.Mesh(e,n),s=new t.Mesh(e,r);i.layers.set(1),s.layers.set(2),this.threeScene.add(i,s)}checkShader(e=Sn){console.log(this._fragmentBuilder[e].code)}render(){this.camera.chaseThreeCamera(this.threeRenderer.xr),this.threeRenderer.render(this.threeScene,this.camera.threeCamera)}}function Tn(e,t,n){return class extends e{constructor(){super(t,n,...arguments)}}}function Cn(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),i=Math.round(e.g),s=Math.round(e.b),o=e.a,a=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var d=e.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===n?"rgb("+r+","+i+","+s+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+s+","+o+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+s+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+s+","+o+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+s+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+s+",a:"+o+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+l+",v:"+c+",a:"+o+"}":"unknown format"}var In=Array.prototype.forEach,Dn=Array.prototype.slice,Vn={BREAK:{},extend:function(e){return this.each(Dn.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))}),this),e},defaults:function(e){return this.each(Dn.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))}),this),e},compose:function(){var e=Dn.call(arguments);return function(){for(var t=Dn.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(In&&e.forEach&&e.forEach===In)e.forEach(t,n);else if(e.length===e.length+0){var r,i=void 0;for(i=0,r=e.length;i<r;i++)if(i in e&&t.call(n,e[i],i)===this.BREAK)return}else for(var s in e)if(t.call(n,e[s],s)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r=void 0;return function(){var i=this,s=arguments;function o(){r=null,n||e.apply(i,s)}var a=n||!r;clearTimeout(r),r=setTimeout(o,t),a&&e.apply(i,s)}},toArray:function(e){return e.toArray?e.toArray():Dn.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},Pn=[{litmus:Vn.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:Cn},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:Cn},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:Cn},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:Cn}}},{litmus:Vn.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Vn.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Vn.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(Vn.isNumber(e.r)&&Vn.isNumber(e.g)&&Vn.isNumber(e.b)&&Vn.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(Vn.isNumber(e.r)&&Vn.isNumber(e.g)&&Vn.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(Vn.isNumber(e.h)&&Vn.isNumber(e.s)&&Vn.isNumber(e.v)&&Vn.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(Vn.isNumber(e.h)&&Vn.isNumber(e.s)&&Vn.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Fn=void 0,Bn=void 0,Ln=function(){Bn=!1;var e=arguments.length>1?Vn.toArray(arguments):arguments[0];return Vn.each(Pn,(function(t){if(t.litmus(e))return Vn.each(t.conversions,(function(t,n){if(Fn=t.read(e),!1===Bn&&!1!==Fn)return Bn=Fn,Fn.conversionName=n,Fn.conversion=t,Vn.BREAK})),Vn.BREAK})),Bn},kn=void 0,On={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),s=n*(1-t),o=n*(1-i*t),a=n*(1-(1-i)*t),l=[[n,a,s],[o,n,s],[s,n,a],[s,o,n],[a,s,n],[n,s,o]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),s=i-r,o=void 0;return 0===i?{h:NaN,s:0,v:0}:(o=e===i?(t-n)/s:t===i?2+(n-e)/s:4+(e-t)/s,(o/=6)<0&&(o+=1),{h:360*o,s:s/i,v:i/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(kn=8*t)|e&~(255<<kn)}},Nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Un=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Hn=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0},zn=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},jn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Xn=function(){function e(){if(Gn(this,e),this.__state=Ln.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Un(e,[{key:"toString",value:function(){return Cn(this)}},{key:"toHexString",value:function(){return Cn(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function Qn(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||Xn.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(Xn.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function Wn(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||Xn.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(Xn.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}Xn.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=On.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");Vn.extend(e.__state,On.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},Xn.recalculateHSV=function(e){var t=On.rgb_to_hsv(e.r,e.g,e.b);Vn.extend(e.__state,{s:t.s,v:t.v}),Vn.isNaN(t.h)?Vn.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},Xn.COMPONENTS=["r","g","b","h","s","v","hex","a"],Qn(Xn.prototype,"r",2),Qn(Xn.prototype,"g",1),Qn(Xn.prototype,"b",0),Wn(Xn.prototype,"h"),Wn(Xn.prototype,"s"),Wn(Xn.prototype,"v"),Object.defineProperty(Xn.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(Xn.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=On.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var qn=function(){function e(t,n){Gn(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return Un(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),Zn={};Vn.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){Vn.each(e,(function(e){Zn[e]=t}))}));var Yn=/(\d+(\.\d+)?)px/;function Kn(e){if("0"===e||Vn.isUndefined(e))return 0;var t=e.match(Yn);return Vn.isNull(t)?0:parseFloat(t[1])}var Jn={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var r=n,i=t;Vn.isUndefined(i)&&(i=!0),Vn.isUndefined(r)&&(r=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var i=n||{},s=Zn[t];if(!s)throw new Error("Event type "+t+" not supported.");var o=document.createEvent(s);switch(s){case"MouseEvents":var a=i.x||i.clientX||0,l=i.y||i.clientY||0;o.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=o.initKeyboardEvent||o.initKeyEvent;Vn.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:o.initEvent(t,i.bubbles||!1,i.cancelable||!0)}Vn.defaults(o,r),e.dispatchEvent(o)},bind:function(e,t,n,r){var i=r||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),Jn},unbind:function(e,t,n,r){var i=r||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),Jn},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Jn},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return Jn},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return Kn(t["border-left-width"])+Kn(t["border-right-width"])+Kn(t["padding-left"])+Kn(t["padding-right"])+Kn(t.width)},getHeight:function(e){var t=getComputedStyle(e);return Kn(t["border-top-width"])+Kn(t["border-bottom-width"])+Kn(t["padding-top"])+Kn(t["padding-bottom"])+Kn(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},$n=function(e){function t(e,n){Gn(this,t);var r=jn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),Jn.bind(r.__checkbox,"change",(function(){i.setValue(!i.__prev)}),!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return zn(t,e),Un(t,[{key:"setValue",value:function(e){var n=Hn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Hn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(qn),er=function(e){function t(e,n,r){Gn(this,t);var i=jn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),s=r,o=i;if(i.__select=document.createElement("select"),Vn.isArray(s)){var a={};Vn.each(s,(function(e){a[e]=e})),s=a}return Vn.each(s,(function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),o.__select.appendChild(n)})),i.updateDisplay(),Jn.bind(i.__select,"change",(function(){var e=this.options[this.selectedIndex].value;o.setValue(e)})),i.domElement.appendChild(i.__select),i}return zn(t,e),Un(t,[{key:"setValue",value:function(e){var n=Hn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return Jn.isActive(this.__select)?this:(this.__select.value=this.getValue(),Hn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(qn),tr=function(e){function t(e,n){Gn(this,t);var r=jn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;function s(){i.setValue(i.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),Jn.bind(r.__input,"keyup",s),Jn.bind(r.__input,"change",s),Jn.bind(r.__input,"blur",(function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())})),Jn.bind(r.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return zn(t,e),Un(t,[{key:"updateDisplay",value:function(){return Jn.isActive(this.__input)||(this.__input.value=this.getValue()),Hn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(qn);function nr(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var rr=function(e){function t(e,n,r){Gn(this,t);var i=jn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),s=r||{};return i.__min=s.min,i.__max=s.max,i.__step=s.step,Vn.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=nr(i.__impliedStep),i}return zn(t,e),Un(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),Hn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=nr(e),this}}]),t}(qn);var ir=function(e){function t(e,n,r){Gn(this,t);var i=jn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));i.__truncationSuspended=!1;var s=i,o=void 0;function a(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function l(e){var t=o-e.clientY;s.setValue(s.getValue()+t*s.__impliedStep),o=e.clientY}function c(){Jn.unbind(window,"mousemove",l),Jn.unbind(window,"mouseup",c),a()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),Jn.bind(i.__input,"change",(function(){var e=parseFloat(s.__input.value);Vn.isNaN(e)||s.setValue(e)})),Jn.bind(i.__input,"blur",(function(){a()})),Jn.bind(i.__input,"mousedown",(function(e){Jn.bind(window,"mousemove",l),Jn.bind(window,"mouseup",c),o=e.clientY})),Jn.bind(i.__input,"keydown",(function(e){13===e.keyCode&&(s.__truncationSuspended=!0,this.blur(),s.__truncationSuspended=!1,a())})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return zn(t,e),Un(t,[{key:"updateDisplay",value:function(){var e,n,r;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),n=this.__precision,r=Math.pow(10,n),Math.round(e*r)/r),Hn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(rr);function sr(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}var or=function(e){function t(e,n,r,i,s){Gn(this,t);var o=jn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:r,max:i,step:s})),a=o;function l(e){e.preventDefault();var t=a.__background.getBoundingClientRect();return a.setValue(sr(e.clientX,t.left,t.right,a.__min,a.__max)),!1}function c(){Jn.unbind(window,"mousemove",l),Jn.unbind(window,"mouseup",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function d(e){var t=e.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(sr(t,n.left,n.right,a.__min,a.__max))}function h(){Jn.unbind(window,"touchmove",d),Jn.unbind(window,"touchend",h),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),Jn.bind(o.__background,"mousedown",(function(e){document.activeElement.blur(),Jn.bind(window,"mousemove",l),Jn.bind(window,"mouseup",c),l(e)})),Jn.bind(o.__background,"touchstart",(function(e){if(1!==e.touches.length)return;Jn.bind(window,"touchmove",d),Jn.bind(window,"touchend",h),d(e)})),Jn.addClass(o.__background,"slider"),Jn.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return zn(t,e),Un(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Hn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(rr),ar=function(e){function t(e,n,r){Gn(this,t);var i=jn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),s=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===r?"Fire":r,Jn.bind(i.__button,"click",(function(e){return e.preventDefault(),s.fire(),!1})),Jn.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return zn(t,e),Un(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(qn),lr=function(e){function t(e,n){Gn(this,t);var r=jn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));r.__color=new Xn(r.getValue()),r.__temp=new Xn(0);var i=r;r.domElement=document.createElement("div"),Jn.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",Jn.bind(r.__input,"keydown",(function(e){13===e.keyCode&&h.call(this)})),Jn.bind(r.__input,"blur",h),Jn.bind(r.__selector,"mousedown",(function(){Jn.addClass(this,"drag").bind(window,"mouseup",(function(){Jn.removeClass(i.__selector,"drag")}))})),Jn.bind(r.__selector,"touchstart",(function(){Jn.addClass(this,"drag").bind(window,"touchend",(function(){Jn.removeClass(i.__selector,"drag")}))}));var s,o=document.createElement("div");function a(e){p(e),Jn.bind(window,"mousemove",p),Jn.bind(window,"touchmove",p),Jn.bind(window,"mouseup",c),Jn.bind(window,"touchend",c)}function l(e){m(e),Jn.bind(window,"mousemove",m),Jn.bind(window,"touchmove",m),Jn.bind(window,"mouseup",d),Jn.bind(window,"touchend",d)}function c(){Jn.unbind(window,"mousemove",p),Jn.unbind(window,"touchmove",p),Jn.unbind(window,"mouseup",c),Jn.unbind(window,"touchend",c),u()}function d(){Jn.unbind(window,"mousemove",m),Jn.unbind(window,"touchmove",m),Jn.unbind(window,"mouseup",d),Jn.unbind(window,"touchend",d),u()}function h(){var e=Ln(this.value);!1!==e?(i.__color.__state=e,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function u(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function p(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientX,s=n.clientY,o=(r-t.left)/(t.right-t.left),a=1-(s-t.top)/(t.bottom-t.top);return a>1?a=1:a<0&&(a=0),o>1?o=1:o<0&&(o=0),i.__color.v=a,i.__color.s=o,i.setValue(i.__color.toOriginal()),!1}function m(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),i.__color.h=360*n,i.setValue(i.__color.toOriginal()),!1}return Vn.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Vn.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Vn.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Vn.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Vn.extend(o.style,{width:"100%",height:"100%",background:"none"}),dr(o,"top","rgba(0,0,0,0)","#000"),Vn.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(s=r.__hue_field).style.background="",s.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",s.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",Vn.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),Jn.bind(r.__saturation_field,"mousedown",a),Jn.bind(r.__saturation_field,"touchstart",a),Jn.bind(r.__field_knob,"mousedown",a),Jn.bind(r.__field_knob,"touchstart",a),Jn.bind(r.__hue_field,"mousedown",l),Jn.bind(r.__hue_field,"touchstart",l),r.__saturation_field.appendChild(o),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return zn(t,e),Un(t,[{key:"updateDisplay",value:function(){var e=Ln(this.getValue());if(!1!==e){var t=!1;Vn.each(Xn.COMPONENTS,(function(n){if(!Vn.isUndefined(e[n])&&!Vn.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}}),this),t&&Vn.extend(this.__color.__state,e)}Vn.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;Vn.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,dr(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Vn.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(qn),cr=["-moz-","-o-","-webkit-","-ms-",""];function dr(e,t,n,r){e.style.background="",Vn.each(cr,(function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "}))}var hr=function(e,t){var n=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(r)}catch(e){}},ur='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',pr=function(e,t){var n=e[t];return Vn.isArray(arguments[2])||Vn.isObject(arguments[2])?new er(e,t,arguments[2]):Vn.isNumber(n)?Vn.isNumber(arguments[2])&&Vn.isNumber(arguments[3])?Vn.isNumber(arguments[4])?new or(e,t,arguments[2],arguments[3],arguments[4]):new or(e,t,arguments[2],arguments[3]):Vn.isNumber(arguments[4])?new ir(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ir(e,t,{min:arguments[2],max:arguments[3]}):Vn.isString(n)?new tr(e,t):Vn.isFunction(n)?new ar(e,t,""):Vn.isBoolean(n)?new $n(e,t):null};var mr=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},fr=function(){function e(){Gn(this,e),this.backgroundElement=document.createElement("div"),Vn.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Jn.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Vn.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;Jn.bind(this.backgroundElement,"click",(function(){t.hide()}))}return Un(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Vn.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",Jn.unbind(e.domElement,"webkitTransitionEnd",t),Jn.unbind(e.domElement,"transitionend",t),Jn.unbind(e.domElement,"oTransitionEnd",t)};Jn.bind(this.domElement,"webkitTransitionEnd",t),Jn.bind(this.domElement,"transitionend",t),Jn.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Jn.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Jn.getHeight(this.domElement)/2+"px"}}]),e}(),br=function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");hr(br);var vr="Default",gr=function(){try{return!!window.localStorage}catch(e){return!1}}(),Ar=void 0,yr=!0,wr=void 0,_r=!1,xr=[],Er=function e(t){var n=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Jn.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=Vn.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=Vn.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),Vn.isUndefined(r.load)?r.load={preset:vr}:r.preset&&(r.load.preset=r.preset),Vn.isUndefined(r.parent)&&r.hideable&&xr.push(this),r.resizable=Vn.isUndefined(r.parent)&&r.resizable,r.autoPlace&&Vn.isUndefined(r.scrollable)&&(r.scrollable=!0);var i,s=gr&&"true"===localStorage.getItem(Ir(this,"isLocal")),o=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,Br(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,a&&(a.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?Jn.addClass(n.__ul,e.CLASS_CLOSED):Jn.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return s},set:function(e){gr&&(s=e,e?Jn.bind(window,"unload",o):Jn.unbind(window,"unload",o),localStorage.setItem(Ir(n,"isLocal"),e))}}}),Vn.isUndefined(r.parent)){if(this.closed=r.closed||!1,Jn.addClass(this.domElement,e.CLASS_MAIN),Jn.makeSelectable(this.domElement,!1),gr&&s){n.useLocalStorage=!0;var l=localStorage.getItem(Ir(this,"gui"));l&&(r.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,Jn.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(Jn.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Jn.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Jn.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===r.closed&&(r.closed=!0);var c=document.createTextNode(r.name);Jn.addClass(c,"controller-name"),a=Sr(n,c);Jn.addClass(this.__ul,e.CLASS_CLOSED),Jn.addClass(a,"title"),Jn.bind(a,"click",(function(e){return e.preventDefault(),n.closed=!n.closed,!1})),r.closed||(this.closed=!1)}r.autoPlace&&(Vn.isUndefined(r.parent)&&(yr&&(wr=document.createElement("div"),Jn.addClass(wr,"dg"),Jn.addClass(wr,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(wr),yr=!1),wr.appendChild(this.domElement),Jn.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||Br(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},Jn.bind(window,"resize",this.__resizeHandler),Jn.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Jn.bind(this.__ul,"transitionend",this.__resizeHandler),Jn.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&Fr(this),o=function(){gr&&"true"===localStorage.getItem(Ir(n,"isLocal"))&&localStorage.setItem(Ir(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o,r.parent||((i=n.getRoot()).width+=1,Vn.defer((function(){i.width-=1})))};function Sr(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function Mr(e){Jn.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&Jn.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Rr(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function Tr(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t,n.load&&n.load.remembered){var s=n.load.remembered,o=void 0;if(s[e.preset])o=s[e.preset];else{if(!s.Default)return;o=s.Default}if(o[r]&&void 0!==o[r][t.property]){var a=o[r][t.property];t.initialValue=a,t.setValue(a)}}}}function Cr(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;if(r.color)i=new lr(t,n);else{var s=[t,n].concat(r.factoryArgs);i=pr.apply(e,s)}r.before instanceof qn&&(r.before=r.before.__li),Tr(e,i),Jn.addClass(i.domElement,"c");var o=document.createElement("span");Jn.addClass(o,"property-name"),o.innerHTML=i.property;var a=document.createElement("div");a.appendChild(o),a.appendChild(i.domElement);var l=Sr(e,a,r.before);return Jn.addClass(l,Er.CLASS_CONTROLLER_ROW),i instanceof lr?Jn.addClass(l,"color"):Jn.addClass(l,Nn(i.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,Vn.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),Cr(e,n.object,n.property,{before:r,factoryArgs:[Vn.toArray(arguments)]})}if(Vn.isArray(t)||Vn.isObject(t)){var i=n.__li.nextElementSibling;return n.remove(),Cr(e,n.object,n.property,{before:i,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof or){var r=new ir(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});Vn.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(r,e),t.apply(n,e)}})),Jn.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof ir){var i=function(t){if(Vn.isNumber(n.__min)&&Vn.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var s=Cr(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return s.name(r),i&&s.listen(),s}return t};n.min=Vn.compose(i,n.min),n.max=Vn.compose(i,n.max)}else n instanceof $n?(Jn.bind(t,"click",(function(){Jn.fakeEvent(n.__checkbox,"click")})),Jn.bind(n.__checkbox,"click",(function(e){e.stopPropagation()}))):n instanceof ar?(Jn.bind(t,"click",(function(){Jn.fakeEvent(n.__button,"click")})),Jn.bind(t,"mouseover",(function(){Jn.addClass(n.__button,"hover")})),Jn.bind(t,"mouseout",(function(){Jn.removeClass(n.__button,"hover")}))):n instanceof lr&&(Jn.addClass(t,"color"),n.updateDisplay=Vn.compose((function(e){return t.style.borderLeftColor=n.__color.toString(),e}),n.updateDisplay),n.updateDisplay());n.setValue=Vn.compose((function(t){return e.getRoot().__preset_select&&n.isModified()&&Rr(e.getRoot(),!0),t}),n.setValue)}(e,l,i),e.__controllers.push(i),i}function Ir(e,t){return document.location.href+"."+t}function Dr(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Vr(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Pr(e){var t=e.__save_row=document.createElement("li");Jn.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),Jn.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",Jn.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",Jn.addClass(r,"button"),Jn.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",Jn.addClass(i,"button"),Jn.addClass(i,"save-as");var s=document.createElement("span");s.innerHTML="Revert",Jn.addClass(s,"button"),Jn.addClass(s,"revert");var o=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?Vn.each(e.load.remembered,(function(t,n){Dr(e,n,n===e.preset)})):Dr(e,vr,!1),Jn.bind(o,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(o),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(s),gr){var a=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Ir(0,"isLocal"))&&l.setAttribute("checked","checked"),Vr(e,a),Jn.bind(l,"change",(function(){e.useLocalStorage=!e.useLocalStorage,Vr(e,a)}))}var c=document.getElementById("dg-new-constructor");Jn.bind(c,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Ar.hide()})),Jn.bind(n,"click",(function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),Ar.show(),c.focus(),c.select()})),Jn.bind(r,"click",(function(){e.save()})),Jn.bind(i,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),Jn.bind(s,"click",(function(){e.revert()}))}function Fr(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function r(){Jn.removeClass(e.__closeButton,Er.CLASS_DRAG),Jn.unbind(window,"mousemove",n),Jn.unbind(window,"mouseup",r)}function i(i){return i.preventDefault(),t=i.clientX,Jn.addClass(e.__closeButton,Er.CLASS_DRAG),Jn.bind(window,"mousemove",n),Jn.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),Vn.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Jn.bind(e.__resize_handle,"mousedown",i),Jn.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function Br(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Lr(e,t){var n={};return Vn.each(e.__rememberedObjects,(function(r,i){var s={},o=e.__rememberedObjectIndecesToControllers[i];Vn.each(o,(function(e,n){s[n]=t?e.initialValue:e.getValue()})),n[i]=s})),n}function kr(e){0!==e.length&&mr.call(window,(function(){kr(e)})),Vn.each(e,(function(e){e.updateDisplay()}))}Er.toggleHide=function(){_r=!_r,Vn.each(xr,(function(e){e.domElement.style.display=_r?"none":""}))},Er.CLASS_AUTO_PLACE="a",Er.CLASS_AUTO_PLACE_CONTAINER="ac",Er.CLASS_MAIN="main",Er.CLASS_CONTROLLER_ROW="cr",Er.CLASS_TOO_TALL="taller-than-window",Er.CLASS_CLOSED="closed",Er.CLASS_CLOSE_BUTTON="close-button",Er.CLASS_CLOSE_TOP="close-top",Er.CLASS_CLOSE_BOTTOM="close-bottom",Er.CLASS_DRAG="drag",Er.DEFAULT_WIDTH=245,Er.TEXT_CLOSED="Close Controls",Er.TEXT_OPEN="Open Controls",Er._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Er.toggleHide()},Jn.bind(window,"keydown",Er._keydownHandler,!1),Vn.extend(Er.prototype,{add:function(e,t){return Cr(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Cr(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Vn.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&wr.removeChild(this.domElement);var e=this;Vn.each(this.__folders,(function(t){e.removeFolder(t)})),Jn.unbind(window,"keydown",Er._keydownHandler,!1),Mr(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Er(t);this.__folders[e]=n;var r=Sr(this,n.domElement);return Jn.addClass(r,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],Mr(e);var t=this;Vn.each(e.__folders,(function(t){e.removeFolder(t)})),Vn.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=Jn.getOffset(e.__ul).top,n=0;Vn.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(n+=Jn.getHeight(t))})),window.innerHeight-t-20<n?(Jn.addClass(e.domElement,Er.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(Jn.removeClass(e.domElement,Er.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&Vn.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:Vn.debounce((function(){this.onResize()}),50),remember:function(){if(Vn.isUndefined(Ar)&&((Ar=new fr).domElement.innerHTML=ur),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;Vn.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&Pr(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&Br(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=Lr(this)),e.folders={},Vn.each(this.__folders,(function(t,n){e.folders[n]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Lr(this),Rr(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=Lr(this,!0)),this.load.remembered[e]=Lr(this),this.preset=e,Dr(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){Vn.each(this.__controllers,(function(t){this.getRoot().load.remembered?Tr(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),Vn.each(this.__folders,(function(e){e.revert(e)})),e||Rr(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&kr(this.__listening)},updateDisplay:function(){Vn.each(this.__controllers,(function(e){e.updateDisplay()})),Vn.each(this.__folders,(function(e){e.updateDisplay()}))}});var Or=Er;var Nr=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function r(n){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===n?"block":"none";e=n}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(n){n.preventDefault(),r(++e%t.children.length)}),!1);var i=(performance||Date).now(),s=i,o=0,a=n(new Nr.Panel("FPS","#0ff","#002")),l=n(new Nr.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=n(new Nr.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:n,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(l.update(e-i,200),e>=s+1e3&&(a.update(1e3*o/(e-s),100),s=e,o=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:r}};Nr.Panel=function(e,t,n){var r=1/0,i=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,d=2*o,h=3*o,u=15*o,p=74*o,m=30*o,f=document.createElement("canvas");f.width=a,f.height=l,f.style.cssText="width:80px;height:48px";var b=f.getContext("2d");return b.font="bold "+9*o+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=n,b.fillRect(0,0,a,l),b.fillStyle=t,b.fillText(e,c,d),b.fillRect(h,u,p,m),b.fillStyle=n,b.globalAlpha=.9,b.fillRect(h,u,p,m),{dom:f,update:function(l,v){r=Math.min(r,l),i=Math.max(i,l),b.fillStyle=n,b.globalAlpha=1,b.fillRect(0,0,a,u),b.fillStyle=t,b.fillText(s(l)+" "+e+" ("+s(r)+"-"+s(i)+")",c,d),b.drawImage(f,h+o,u,p-o,m,h,u,p-o,m),b.fillRect(h+p-o,u,o,m),b.fillStyle=n,b.globalAlpha=.9,b.fillRect(h+p-o,u,o,s((1-l/v)*m))}}};const Gr=Nr;class Ur{constructor(e){this.group=e,this.uuid=t.MathUtils.generateUUID().replaceAll("-","_")}get name(){return void 0===this._name&&(this._name=`groupElement_${this.uuid}`),this._name}identity(){throw new Error("GroupElement: This method need be overloaded.")}multiply(e){throw new Error("GroupElement: This method need be overloaded.")}premultiply(e){throw new Error("GroupElement: This method need be overloaded.")}invert(){throw new Error("GroupElement: This method need be overloaded.")}toIsometry(){throw new Error("GroupElement: This method need be overloaded.")}equals(e){throw new Error("GroupElement: This method need be overloaded.")}clone(){throw new Error("GroupElement: This method need be overloaded.")}copy(e){throw new Error("GroupElement: This method need be overloaded.")}}class Hr{constructor(e){this.local=new a,this.set=e,this.cellBoost=this.set.group.element(),this.invCellBoost=this.set.group.element()}reduceErrorBoost(){return this.local.reduceErrorBoost(),this}reduceErrorFacing(){return this.local.reduceErrorFacing(),this}reduceErrorLocal(){return this.local.reduceError(),this}reduceError(){return this.reduceErrorLocal(),this}get facing(){return this.local.facing}get localPoint(){return this.local.point}get point(){return this.local.point.applyIsometry(this.cellBoost.toIsometry())}get globalBoost(){return this.cellBoost.toIsometry().multiply(this.local.boost)}get globalPosition(){const e=new a;return e.boost.copy(this.globalBoost),e.quaternion.copy(this.local.quaternion),e}reset(){this.local.reset(),this.cellBoost.identity(),this.invCellBoost.identity()}applyQuaternion(e){return this.local.applyQuaternion(e),this}teleport(){let e,t;for(;;){t=this.localPoint,e=!0;for(const n of this.set.teleportations)if(e=e&&!n.jsTest(t),!e){this.local.applyIsometry(n.elt.toIsometry()),this.cellBoost.multiply(n.inv),this.invCellBoost.premultiply(n.elt);break}if(e)break}return this}flow(e){return this.local.flow(e),this.teleport(),this}fakeDiffExpMap(e){return this.local.fakeDiffExpMap(e),this}equals(e){let t=!0;return t=t&&this.local.equals(e.local),t=t&&this.cellBoost.equals(e.cellBoost),t}clone(){let e=new Hr(this.set);return e.cellBoost.copy(this.cellBoost),e.invCellBoost.copy(this.invCellBoost),e.local.copy(this.local),e}copy(e){this.cellBoost.copy(e.cellBoost),this.invCellBoost.copy(e.invCellBoost),this.local.copy(e.local)}}const zr={us:{a:"yawLeft",d:"yawRight",w:"pitchUp",s:"pitchDown",q:"rollLeft",e:"rollRight",ArrowUp:"forward",ArrowDown:"back",ArrowLeft:"left",ArrowRight:"right","'":"up","/":"down"},fr:{q:"yawLeft",d:"yawRight",z:"pitchUp",s:"pitchDown",a:"rollLeft",e:"rollRight",ArrowUp:"forward",ArrowDown:"back",ArrowLeft:"left",ArrowRight:"right",:"up","=":"down"}};class jr extends t.EventDispatcher{constructor(e,t="us"){super(),this.camera=e,this.keyboard=t,this.movementSpeed=.5,this.rollSpeed=.8,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new o(0,0,0),this._rotationVector=new o(0,0,0),this._onKeyDown=xn(this,this.onKeyDown),this._onKeyUp=xn(this,this.onKeyUp),window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1)}pause(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp)}restore(){window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1)}setKeyboard(e){this.keyboard=e}onKeyDown(e){if(e.key in zr[this.keyboard]){const t=zr[this.keyboard][e.key];this._moveState[t]=1,this.updateMovementVector(),this.updateRotationVector()}}onKeyUp(e){if(e.key in zr[this.keyboard]){const t=zr[this.keyboard][e.key];this._moveState[t]=0,this.updateMovementVector(),this.updateRotationVector()}}updateMovementVector(){this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-this._moveState.forward+this._moveState.back}updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}update(e){const n=this._moveVector.clone().multiplyScalar(this.movementSpeed*e).applyMatrix4(this.camera.matrix);this.camera.position.flow(n);const r=this._rotationVector.clone().multiplyScalar(this.movementSpeed*e).applyMatrix4(this.camera.matrix),i=new t.Quaternion(r.x,r.y,r.z,1).normalize();this.camera.position.applyQuaternion(i)}}var Xr=r(7591),Qr=r.n(Xr),Wr=r(1685),qr=r.n(Wr);class Zr{constructor(e){this.threeCamera=new t.PerspectiveCamera(void 0!==e.fov?e.fov:70,window.innerWidth/window.innerHeight,.01,2e3),this.threeCamera.position.set(0,0,0),this.threeCamera.lookAt(0,0,-1),this.minDist=void 0!==e.minDist?e.minDist:0,this.maxDist=void 0!==e.maxDist?e.maxDist:50,this.maxSteps=void 0!==e.maxSteps?e.maxSteps:100,this.threshold=void 0!==e.threshold?e.threshold:1e-4,this.position=new Hr(e.set)}set aspect(e){this.threeCamera.aspect=e}get fov(){return this.threeCamera.fov}set fov(e){this.threeCamera.fov=e,this.threeCamera.updateProjectionMatrix()}get matrix(){return this.threeCamera.matrixWorld}updateProjectionMatrix(){this.threeCamera.updateProjectionMatrix()}shader(e){e.addClass("Camera",Qr()),e.addUniform("camera","Camera",this),e.addChunk(qr())}}var Yr=r(6539),Kr=r.n(Yr),Jr=r(5074),$r=r.n(Jr);class ei extends Zr{constructor(e){super(e),this.isStereoOn=!1,this.ipDist=void 0!==e.ipDist?e.ipDist:.03200000151991844,this.fakeCameras=[];for(const e in[Sn,Mn])this.fakeCameras[e]={fov:this.fov,minDist:this.minDist,maxDist:this.maxDist,maxSteps:this.maxSteps,threshold:this.threshold,position:this.position.clone(),matrix:this.matrix}}get isStereoOff(){return!this.isStereoOn}switchStereo(){this.isStereoOn=!this.isStereoOn}updateFakeCamerasPosition(){if(this.fakeCameras[Sn].position.copy(this.position),this.fakeCameras[Mn].position.copy(this.position),this.isStereoOn){const e=new o(1,0,0).multiplyScalar(this.ipDist).applyMatrix4(this.matrix),t=e.clone().negate();this.fakeCameras[Mn].position.flow(e),this.fakeCameras[Sn].position.flow(t)}}get chaseThreeCamera(){if(void 0===this._chaseThreeCamera){const e=new o;this._chaseThreeCamera=function(n){const r=new o;if(this.isStereoOn){const e=n.getCamera(this.threeCamera).cameras,i=(new t.Vector3).setFromMatrixPosition(e[Sn].matrixWorld),s=(new t.Vector3).setFromMatrixPosition(e[Mn].matrixWorld);r.lerpVectors(i,s,.5)}else r.setFromMatrixPosition(this.matrix);const i=(new o).subVectors(r,e);this.position.flow(i),this.updateFakeCamerasPosition(),e.copy(r)}}return this._chaseThreeCamera}shader(e){throw new Error("StereoCamera: for stereographic cameras, use sidedShader instead")}sidedShader(e,t){e.addClass("VRCamera",Kr()),e.addUniform("camera","VRCamera",this.fakeCameras[t]),e.addChunk($r())}}var ti=r(766),ni=r.n(ti),ri=r(4651),ii=r.n(ri);class si extends Zr{constructor(e){super(e),this.focalLength=void 0!==e.focalLength?e.focalLength:1,this.aperture=void 0!==e.aperture?e.aperture:0}shader(e){e.addClass("Camera",ni()),e.addUniform("camera","PathTracerCamera",this),e.addChunk(ii())}}class oi{constructor(){this.uuid=t.MathUtils.generateUUID().replaceAll("-","_"),this.id=void 0,this.imports=[]}get className(){return this.constructor.name}get name(){return void 0===this._name&&(this._name=`${En(this.className)}_${this.uuid}`),this._name}get uniformType(){return""}setId(e){this.id=e.nextId,e.nextId=e.nextId+1}onAdd(e){}addImport(e){for(const e of arguments)this.imports.push(e)}static glslClass(){throw new Error("Generic: this function should be implemented")}glslInstance(){throw new Error("Generic: this function should be implemented")}shader(e){for(const t of this.imports)e.addImport(t);e.addClass(this.constructor.name,this.constructor.glslClass()),""!==this.uniformType&&e.addUniform(this.name,this.uniformType,this),e.addInstance(this.name,this.glslInstance())}}class ai extends oi{constructor(){super(),this.lights=void 0,this.reflectivity=void 0}get isMaterial(){return!0}get usesNormal(){return!0}get usesUVMap(){return!1}get usesLight(){return!1}get isReflecting(){return!1}onAdd(e){this.usesLight&&(this.hasOwnProperty("lights")&&void 0!==this.lights||(this.lights=e.lights))}glslRender(){throw new Error("Material: this method should be implemented")}glslInstance(){return this.glslRender()}}var li=r(2664),ci=r.n(li),di=r(8778),hi=r.n(di);class ui extends ai{constructor(e){super(),this.color=e}get uniformType(){return"SingleColorMaterial"}get usesNormal(){return!1}static glslClass(){return ci()}glslRender(){return hi()(this)}}class pi extends oi{constructor(){super()}get isPTMaterial(){return!0}get usesNormal(){return!0}get usesUVMap(){return!1}onAdd(e){}glslRender(){throw new Error("Material: this method should be implemented")}glslInstance(){return this.glslRender()}}var mi=r(2143),fi=r.n(mi),bi=r(9606),vi=r.n(bi),gi=r(5363),Ai=r.n(gi);class yi extends pi{constructor(e){super(),this.emission=void 0!==e.emission?e.emission:new t.Color(0,0,0),this.volumeEmission=void 0!==e.volumeEmission?e.volumeEmission:new t.Color(0,0,0),this.opticalDepth=void 0!==e.opticalDepth?e.opticalDepth:1e3,this.diffuse=void 0!==e.diffuse?e.diffuse:new t.Color(1,1,1),this.specular=void 0!==e.specular?e.specular:new t.Color(1,1,1),this.absorb=void 0!==e.absorb?e.absorb:new t.Color(.1,.1,.1),this.ior=void 0!==e.ior?e.ior:1,this.roughness=void 0!==e.roughness?e.roughness:.2,this.reflectionChance=void 0!==e.reflectionChance?e.reflectionChance:.1,this.refractionChance=void 0!==e.refractionChance?e.refractionChance:0,this.diffuseChance=void 0!==e.diffuseChance?e.diffuseChance:.9;const n=this.reflectionChance+this.refractionChance+this.diffuseChance;this.reflectionChance=this.reflectionChance/n,this.refractionChance=this.refractionChance/n,this.diffuseChance=this.diffuseChance/n,this.addImport(Ai())}get uniformType(){return"BasicPTMaterial"}static glslClass(){return fi()}glslRender(){return vi()(this)}}class wi{constructor(e={}){this.lights=[],this.solids=[],this.nextId=0,this.fog=e.fog,this.background=void 0!==e.background?e.background:new ui(new t.Color(0,0,0)),this.ptBackground=void 0!==e.ptBackground?e.ptBackground:new yi({diffuse:new t.Color(0,0,0),specular:new t.Color(0,0,0),absorb:new t.Color(.25,.25,.25)})}_add(e){return e.setId(this),e.onAdd(this),e.isLight&&this.lights.push(e),e.isSolid&&this.solids.push(e),this}add(e){for(const e of arguments)this._add(e);return this}shader(e){3===e.useCase?this.ptBackground.shader(e):this.background.shader(e);for(const t of this.lights)3!==e.useCase&&t.shader(e);for(const t of this.solids)t.shader(e);void 0!==this.fog&&this.fog.shader(e)}}class _i{constructor(){}shader(e){throw new Error("Fog: this method need be implemented")}}var xi=r(7885),Ei=r.n(xi),Si=r(5348),Mi=r.n(Si);class Ri extends _i{constructor(e,t){super(),this.color=e,this.scattering=t}shader(e){e.addClass("ExpFog",Ei()),e.addUniform("fog","ExpFog",this),e.addChunk(Mi())}}class Ti{constructor(e){this.thurston=e,this.state=0,this.dialogBoxWrap=document.getElementById("thurstonDialogBoxWrap"),this.downloadButton=document.getElementById("thurstonDownloadButton");const t=xn(this,this.onPressP);window.addEventListener("keydown",t);const n=xn(this,this.onClickGo);document.querySelector("#thurstonDialogBox input[type=submit]").addEventListener("click",n);const r=xn(this,this.onClickDownload);document.getElementById("thurstonDownloadButton").addEventListener("click",r)}onPressP(e){if("p"===e.key)switch(this.state){case 0:document.getElementById("widthInput").value=window.innerWidth;document.getElementById("heightInput").value=window.innerHeight,this.dialogBoxWrap.classList.add("visible"),this.state=1;break;case 2:this.downloadButton.classList.remove("visible"),this.thurston.setSize(window.innerWidth,window.innerHeight),this.thurston.switchRenderer(),this.state=0;break;default:this.dialogBoxWrap.classList.remove("visible"),this.state=0}}onClickGo(e){if(1===this.state){const e=document.getElementById("widthInput"),t=document.getElementById("heightInput");this.thurston.setSize(e.value,t.value),this.thurston.ptCamera.aspect=e.value/t.value,this.thurston.ptCamera.updateProjectionMatrix(),this.dialogBoxWrap.classList.remove("visible"),this.downloadButton.classList.add("visible"),this.thurston.switchRenderer(),this.state=2}}onClickDownload(e){2===this.state&&(this.thurston.ptRenderer.renderAccTarget(),this.downloadButton.href=this.thurston.ptRenderer.domElement.toDataURL("image/png",1),this.downloadButton.download="export.png")}}const Ci="\n    #thurstonDialogBoxWrap {\n        margin: 0;\n        background: rgba(0, 0, 0, 0.8);\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        visibility: hidden;\n    }\n\n    #thurstonDialogBox {\n        background: #9b9b9b;\n        opacity: 1;\n        width: 300px;\n        margin-top: 100px;\n        margin-left: auto;\n        margin-right: auto;\n        padding: 20px;\n    }\n\n    #thurstonDownloadButton {\n        display: block;\n        position: fixed;\n        bottom: 0;\n        right: 0;\n        padding: 10px;\n        background: black;\n        color: white;\n        visibility: hidden;\n    }\n\n    #thurstonDialogBoxWrap.visible,\n    #thurstonDownloadButton.visible {\n        visibility: visible;\n    }\n";class Ii extends t.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new Bi(e)})),this.register((function(e){return new ki(e)})),this.register((function(e){return new Oi(e)})),this.register((function(e){return new Li(e)})),this.register((function(e){return new Pi(e)})),this.register((function(e){return new Ni(e)}))}load(e,n,r,i){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:t.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){i?i(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},l=new t.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(t){try{s.parse(t,o,(function(t){n(t),s.manager.itemEnd(e)}),a)}catch(e){a(e)}}),r,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,r,i){let s;const o={},a={};if("string"==typeof e)s=e;else{if(t.LoaderUtils.decodeText(new Uint8Array(e,0,4))===Gi){try{o[Vi.KHR_BINARY_GLTF]=new zi(e)}catch(e){return void(i&&i(e))}s=o[Vi.KHR_BINARY_GLTF].content}else s=t.LoaderUtils.decodeText(new Uint8Array(e))}const l=JSON.parse(s);if(void 0===l.asset||l.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new ys(l,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](c);a[t.name]=t,o[t.name]=!0}if(l.extensionsUsed)for(let e=0;e<l.extensionsUsed.length;++e){const t=l.extensionsUsed[e],n=l.extensionsRequired||[];switch(t){case Vi.KHR_MATERIALS_UNLIT:o[t]=new Fi;break;case Vi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[t]=new Wi;break;case Vi.KHR_DRACO_MESH_COMPRESSION:o[t]=new ji(l,this.dracoLoader);break;case Vi.KHR_TEXTURE_TRANSFORM:o[t]=new Xi;break;case Vi.KHR_MESH_QUANTIZATION:o[t]=new qi;break;default:n.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(r,i)}}function Di(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Vi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Pi{constructor(e){this.parser=e,this.name=Vi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const n=this.parser,r="light:"+e;let i=n.cache.get(r);if(i)return i;const s=n.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let a;const l=new t.Color(16777215);void 0!==o.color&&l.fromArray(o.color);const c=void 0!==o.range?o.range:0;switch(o.type){case"directional":a=new t.DirectionalLight(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new t.PointLight(l),a.distance=c;break;case"spot":a=new t.SpotLight(l),a.distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,void 0!==o.intensity&&(a.intensity=o.intensity),a.name=n.createUniqueName(o.name||"light_"+e),i=Promise.resolve(a),n.cache.add(r,i),i}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))}}class Fi{constructor(){this.name=Vi.KHR_MATERIALS_UNLIT}getMaterialType(){return t.MeshBasicMaterial}extendParams(e,n,r){const i=[];e.color=new t.Color(1,1,1),e.opacity=1;const s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==s.baseColorTexture&&i.push(r.assignTexture(e,"map",s.baseColorTexture))}return Promise.all(i)}}class Bi{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];if(void 0!==o.clearcoatFactor&&(n.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(r.assignTexture(n,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(n.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(r.assignTexture(n,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(r.assignTexture(n,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new t.Vector2(e,-e)}return Promise.all(s)}}class Li{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(i)}}class ki{constructor(e){this.parser=e,this.name=Vi.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],s=n.images[i.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s,o)}}class Oi{constructor(e){this.parser=e,this.name=Vi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],o=r.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,o,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Ni{constructor(e){this.name=Vi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,i.ready]).then((function(t){const n=e.byteOffset||0,r=e.byteLength||0,s=e.count,o=e.byteStride,a=new ArrayBuffer(s*o),l=new Uint8Array(t[0],n,r);return i.decodeGltfBuffer(new Uint8Array(a),s,o,l,e.mode,e.filter),a}))}return null}}const Gi="glTF",Ui=1313821514,Hi=5130562;class zi{constructor(e){this.name=Vi.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,12);if(this.header={magic:t.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Gi)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,i=new DataView(e,12);let s=0;for(;s<r;){const n=i.getUint32(s,!0);s+=4;const r=i.getUint32(s,!0);if(s+=4,r===Ui){const r=new Uint8Array(e,12+s,n);this.content=t.LoaderUtils.decodeText(r)}else if(r===Hi){const t=12+s;this.body=e.slice(t,t+n)}s+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ji{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Vi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},a={},l={};for(const e in s){const t=as[e]||e.toLowerCase();o[t]=s[e]}for(const t in e.attributes){const r=as[t]||t.toLowerCase();if(void 0!==s[t]){const i=n.accessors[e.attributes[t]],s=rs[i.componentType];l[r]=s,a[r]=!0===i.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],r=a[t];void 0!==r&&(n.normalized=r)}t(e)}),o,l)}))}))}}class Xi{constructor(){this.name=Vi.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Qi extends t.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const n=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new t.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(const t in a)e.uniforms[t]=a[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",n).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Wi{constructor(){this.name=Vi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Qi}extendParams(e,n,r){const i=n.extensions[this.name];e.color=new t.Color(1,1,1),e.opacity=1;const s=[];if(Array.isArray(i.diffuseFactor)){const t=i.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==i.diffuseTexture&&s.push(r.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new t.Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new t.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){const t=i.specularGlossinessTexture;s.push(r.assignTexture(e,"glossinessMap",t)),s.push(r.assignTexture(e,"specularMap",t))}return Promise.all(s)}createMaterial(e){const n=new Qi(e);return n.fog=!0,n.color=e.color,n.map=void 0===e.map?null:e.map,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=void 0===e.aoMap?null:e.aoMap,n.aoMapIntensity=1,n.emissive=e.emissive,n.emissiveIntensity=1,n.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,n.bumpMap=void 0===e.bumpMap?null:e.bumpMap,n.bumpScale=1,n.normalMap=void 0===e.normalMap?null:e.normalMap,n.normalMapType=t.TangentSpaceNormalMap,e.normalScale&&(n.normalScale=e.normalScale),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=void 0===e.specularMap?null:e.specularMap,n.specular=e.specular,n.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,n.glossiness=e.glossiness,n.alphaMap=null,n.envMap=void 0===e.envMap?null:e.envMap,n.envMapIntensity=1,n.refractionRatio=.98,n}}class qi{constructor(){this.name=Vi.KHR_MESH_QUANTIZATION}}class Zi extends t.Interpolant{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let e=0;e!==r;e++)t[e]=n[i+e];return t}}Zi.prototype.beforeStart_=Zi.prototype.copySampleValue_,Zi.prototype.afterEnd_=Zi.prototype.copySampleValue_,Zi.prototype.interpolate_=function(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=r-t,d=(n-t)/c,h=d*d,u=h*d,p=e*l,m=p-l,f=-2*u+3*h,b=u-h,v=1-f,g=b-h+d;for(let e=0;e!==o;e++){const t=s[m+e+o],n=s[m+e+a]*c,r=s[p+e+o],l=s[p+e]*c;i[e]=v*t+g*n+f*r+b*l}return i};const Yi=0,Ki=1,Ji=2,$i=3,es=4,ts=5,ns=6,rs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},is={9728:t.NearestFilter,9729:t.LinearFilter,9984:t.NearestMipmapNearestFilter,9985:t.LinearMipmapNearestFilter,9986:t.NearestMipmapLinearFilter,9987:t.LinearMipmapLinearFilter},ss={33071:t.ClampToEdgeWrapping,33648:t.MirroredRepeatWrapping,10497:t.RepeatWrapping},os={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},as={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ls={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},cs={CUBICSPLINE:void 0,LINEAR:t.InterpolateLinear,STEP:t.InterpolateDiscrete},ds="OPAQUE",hs="MASK",us="BLEND";function ps(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function ms(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function fs(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function bs(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function vs(e){const t=e.extensions&&e.extensions[Vi.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+gs(t.attributes):e.indices+":"+gs(e.attributes)+":"+e.mode,n}function gs(e){let t="";const n=Object.keys(e).sort();for(let r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function As(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class ys{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new Di,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new t.ImageBitmapLoader(this.options.manager):this.textureLoader=new t.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new t.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const s={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};ms(i,s,r),fs(s,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n].joints;for(let t=0,n=r.length;t<n;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(n[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone();return r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Vi.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(e,i){n.load(ps(t.uri,r.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}loadAccessor(e){const n=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);const s=[];return void 0!==i.bufferView?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),void 0!==i.sparse&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then((function(e){const s=e[0],o=os[i.type],a=rs[i.componentType],l=a.BYTES_PER_ELEMENT,c=l*o,d=i.byteOffset||0,h=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,u=!0===i.normalized;let p,m;if(h&&h!==c){const e=Math.floor(d/h),r="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let c=n.cache.get(r);c||(p=new a(s,e*h,i.count*h/l),c=new t.InterleavedBuffer(p,h/l),n.cache.add(r,c)),m=new t.InterleavedBufferAttribute(c,o,d%h/l,u)}else p=null===s?new a(i.count*o):new a(s,d,i.count*o),m=new t.BufferAttribute(p,o,u);if(void 0!==i.sparse){const n=os.SCALAR,r=rs[i.sparse.indices.componentType],l=i.sparse.indices.byteOffset||0,c=i.sparse.values.byteOffset||0,d=new r(e[1],l,i.sparse.count*n),h=new a(e[2],c,i.sparse.count*o);null!==s&&(m=new t.BufferAttribute(m.array.slice(),m.itemSize,m.normalized));for(let e=0,t=d.length;e<t;e++){const t=d[e];if(m.setX(t,h[e*o]),o>=2&&m.setY(t,h[e*o+1]),o>=3&&m.setZ(t,h[e*o+2]),o>=4&&m.setW(t,h[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m}))}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e],i=t.images[r.source];let s=this.textureLoader;if(i.uri){const e=n.manager.getHandler(i.uri);null!==e&&(s=e)}return this.loadTextureImage(e,i,s)}loadTextureImage(e,n,r){const i=this,s=this.json,o=this.options,a=s.textures[e],l=(n.uri||n.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=self.URL||self.webkitURL;let d=n.uri||"",h=!1,u=!0;const p=d.search(/\.jpe?g($|\?)/i)>0||0===d.search(/^data\:image\/jpeg/);if(("image/jpeg"===n.mimeType||p)&&(u=!1),void 0!==n.bufferView)d=i.getDependency("bufferView",n.bufferView).then((function(e){if("image/png"===n.mimeType){const t=new DataView(e,25,1).getUint8(0,!1);u=6===t||4===t||3===t}h=!0;const t=new Blob([e],{type:n.mimeType});return d=c.createObjectURL(t),d}));else if(void 0===n.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const m=Promise.resolve(d).then((function(e){return new Promise((function(n,i){let s=n;!0===r.isImageBitmapLoader&&(s=function(e){n(new t.CanvasTexture(e))}),r.load(ps(e,o.path),s,void 0,i)}))})).then((function(n){!0===h&&c.revokeObjectURL(d),n.flipY=!1,a.name&&(n.name=a.name),u||(n.format=t.RGBFormat);const r=(s.samplers||{})[a.sampler]||{};return n.magFilter=is[r.magFilter]||t.LinearFilter,n.minFilter=is[r.minFilter]||t.LinearMipmapLinearFilter,n.wrapS=ss[r.wrapS]||t.RepeatWrapping,n.wrapT=ss[r.wrapT]||t.RepeatWrapping,i.associations.set(n,{type:"textures",index:e}),n}));return this.textureCache[l]=m,m}assignTexture(e,t,n){const r=this;return this.getDependency("texture",n.index).then((function(i){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[Vi.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[Vi.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(i);i=r.extensions[Vi.KHR_TEXTURE_TRANSFORM].extendTexture(i,e),r.associations.set(i,t)}}e[t]=i}))}assignFinalMaterial(e){const n=e.geometry;let r=e.material;const i=void 0!==n.attributes.tangent,s=void 0!==n.attributes.color,o=void 0===n.attributes.normal,a=Object.keys(n.morphAttributes).length>0,l=a&&void 0!==n.morphAttributes.normal;if(e.isPoints){const e="PointsMaterial:"+r.uuid;let n=this.cache.get(e);n||(n=new t.PointsMaterial,t.Material.prototype.copy.call(n,r),n.color.copy(r.color),n.map=r.map,n.sizeAttenuation=!1,this.cache.add(e,n)),r=n}else if(e.isLine){const e="LineBasicMaterial:"+r.uuid;let n=this.cache.get(e);n||(n=new t.LineBasicMaterial,t.Material.prototype.copy.call(n,r),n.color.copy(r.color),this.cache.add(e,n)),r=n}if(i||s||o||a){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),i&&(e+="vertex-tangents:"),s&&(e+="vertex-colors:"),o&&(e+="flat-shading:"),a&&(e+="morph-targets:"),l&&(e+="morph-normals:");let t=this.cache.get(e);t||(t=r.clone(),s&&(t.vertexColors=!0),o&&(t.flatShading=!0),a&&(t.morphTargets=!0),l&&(t.morphNormals=!0),i&&(t.vertexTangents=!0,t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===n.attributes.uv2&&void 0!==n.attributes.uv&&n.setAttribute("uv2",n.attributes.uv),e.material=r}getMaterialType(){return t.MeshStandardMaterial}loadMaterial(e){const n=this,r=this.json,i=this.extensions,s=r.materials[e];let o;const a={},l=s.extensions||{},c=[];if(l[Vi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=i[Vi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=e.getMaterialType(),c.push(e.extendParams(a,s,n))}else if(l[Vi.KHR_MATERIALS_UNLIT]){const e=i[Vi.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),c.push(e.extendParams(a,s,n))}else{const r=s.pbrMetallicRoughness||{};if(a.color=new t.Color(1,1,1),a.opacity=1,Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;a.color.fromArray(e),a.opacity=e[3]}void 0!==r.baseColorTexture&&c.push(n.assignTexture(a,"map",r.baseColorTexture)),a.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,a.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(c.push(n.assignTexture(a,"metalnessMap",r.metallicRoughnessTexture)),c.push(n.assignTexture(a,"roughnessMap",r.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===s.doubleSided&&(a.side=t.DoubleSide);const d=s.alphaMode||ds;return d===us?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,d===hs&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==t.MeshBasicMaterial&&(c.push(n.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new t.Vector2(1,-1),void 0!==s.normalTexture.scale&&a.normalScale.set(s.normalTexture.scale,-s.normalTexture.scale)),void 0!==s.occlusionTexture&&o!==t.MeshBasicMaterial&&(c.push(n.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==t.MeshBasicMaterial&&(a.emissive=(new t.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==t.MeshBasicMaterial&&c.push(n.assignTexture(a,"emissiveMap",s.emissiveTexture)),Promise.all(c).then((function(){let r;return r=o===Qi?i[Vi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new o(a),s.name&&(r.name=s.name),r.map&&(r.map.encoding=t.sRGBEncoding),r.emissiveMap&&(r.emissiveMap.encoding=t.sRGBEncoding),fs(r,s),n.associations.set(r,{type:"materials",index:e}),s.extensions&&ms(i,r,s),r}))}createUniqueName(e){const n=t.PropertyBinding.sanitizeNodeName(e||"");let r=n;for(let e=1;this.nodeNamesUsed[r];++e)r=n+"_"+e;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){const n=this,r=this.extensions,i=this.primitiveCache;function s(e){return r[Vi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,n).then((function(t){return _s(t,e,n)}))}const o=[];for(let r=0,a=e.length;r<a;r++){const a=e[r],l=vs(a),c=i[l];if(c)o.push(c.promise);else{let e;e=a.extensions&&a.extensions[Vi.KHR_DRACO_MESH_COMPRESSION]?s(a):_s(new t.BufferGeometry,a,n),i[l]={primitive:a,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const n=this,r=this.json,i=this.extensions,s=r.meshes[e],o=s.primitives,a=[];for(let e=0,n=o.length;e<n;e++){const n=void 0===o[e].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new t.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:t.FrontSide})),l.DefaultMaterial):this.getDependency("material",o[e].material);a.push(n)}var l;return a.push(n.loadGeometries(o)),Promise.all(a).then((function(r){const a=r.slice(0,r.length-1),l=r[r.length-1],c=[];for(let r=0,d=l.length;r<d;r++){const d=l[r],h=o[r];let u;const p=a[r];if(h.mode===es||h.mode===ts||h.mode===ns||void 0===h.mode)u=!0===s.isSkinnedMesh?new t.SkinnedMesh(d,p):new t.Mesh(d,p),!0!==u.isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),h.mode===ts?u.geometry=xs(u.geometry,t.TriangleStripDrawMode):h.mode===ns&&(u.geometry=xs(u.geometry,t.TriangleFanDrawMode));else if(h.mode===Ki)u=new t.LineSegments(d,p);else if(h.mode===$i)u=new t.Line(d,p);else if(h.mode===Ji)u=new t.LineLoop(d,p);else{if(h.mode!==Yi)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);u=new t.Points(d,p)}Object.keys(u.geometry.morphAttributes).length>0&&bs(u,s),u.name=n.createUniqueName(s.name||"mesh_"+e),fs(u,s),h.extensions&&ms(i,u,h),n.assignFinalMaterial(u),c.push(u)}if(1===c.length)return c[0];const d=new t.Group;for(let e=0,t=c.length;e<t;e++)d.add(c[e]);return d}))}loadCamera(e){let n;const r=this.json.cameras[e],i=r[r.type];if(i)return"perspective"===r.type?n=new t.PerspectiveCamera(t.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(n=new t.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(n.name=this.createUniqueName(r.name)),fs(n,r),Promise.resolve(n);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}loadAnimation(e){const n=this.json.animations[e],r=[],i=[],s=[],o=[],a=[];for(let e=0,t=n.channels.length;e<t;e++){const t=n.channels[e],l=n.samplers[t.sampler],c=t.target,d=void 0!==c.node?c.node:c.id,h=void 0!==n.parameters?n.parameters[l.input]:l.input,u=void 0!==n.parameters?n.parameters[l.output]:l.output;r.push(this.getDependency("node",d)),i.push(this.getDependency("accessor",h)),s.push(this.getDependency("accessor",u)),o.push(l),a.push(c)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(s),Promise.all(o),Promise.all(a)]).then((function(r){const i=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=[];for(let e=0,n=i.length;e<n;e++){const n=i[e],r=s[e],d=o[e],h=a[e],u=l[e];if(void 0===n)continue;let p;switch(n.updateMatrix(),n.matrixAutoUpdate=!0,ls[u.path]){case ls.weights:p=t.NumberKeyframeTrack;break;case ls.rotation:p=t.QuaternionKeyframeTrack;break;default:p=t.VectorKeyframeTrack}const m=n.name?n.name:n.uuid,f=void 0!==h.interpolation?cs[h.interpolation]:t.InterpolateLinear,b=[];ls[u.path]===ls.weights?n.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)})):b.push(m);let v=d.array;if(d.normalized){const e=As(v.constructor),t=new Float32Array(v.length);for(let n=0,r=v.length;n<r;n++)t[n]=v[n]*e;v=t}for(let e=0,t=b.length;e<t;e++){const t=new p(b[e]+"."+ls[u.path],r.array,v,f);"CUBICSPLINE"===h.interpolation&&(t.createInterpolant=function(e){return new Zi(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const d=n.name?n.name:"animation_"+e;return new t.AnimationClip(d,void 0,c)}))}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}loadNode(e){const n=this.json,r=this.extensions,i=this,s=n.nodes[e],o=s.name?i.createUniqueName(s.name):"";return function(){const t=[],n=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==s.camera&&t.push(i.getDependency("camera",s.camera).then((function(e){return i._getNodeRef(i.cameraCache,s.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(n){let a;if(a=!0===s.isBone?new t.Bone:n.length>1?new t.Group:1===n.length?n[0]:new t.Object3D,a!==n[0])for(let e=0,t=n.length;e<t;e++)a.add(n[e]);if(s.name&&(a.userData.name=s.name,a.name=o),fs(a,s),s.extensions&&ms(r,a,s),void 0!==s.matrix){const e=new t.Matrix4;e.fromArray(s.matrix),a.applyMatrix4(e)}else void 0!==s.translation&&a.position.fromArray(s.translation),void 0!==s.rotation&&a.quaternion.fromArray(s.rotation),void 0!==s.scale&&a.scale.fromArray(s.scale);return i.associations.set(a,{type:"nodes",index:e}),a}))}loadScene(e){const n=this.json,r=this.extensions,i=this.json.scenes[e],s=this,o=new t.Group;i.name&&(o.name=s.createUniqueName(i.name)),fs(o,i),i.extensions&&ms(r,o,i);const a=i.nodes||[],l=[];for(let e=0,t=a.length;e<t;e++)l.push(ws(a[e],o,n,s));return Promise.all(l).then((function(){return o}))}}function ws(e,n,r,i){const s=r.nodes[e];return i.getDependency("node",e).then((function(e){if(void 0===s.skin)return e;let n;return i.getDependency("skin",s.skin).then((function(e){n=e;const t=[];for(let e=0,r=n.joints.length;e<r;e++)t.push(i.getDependency("node",n.joints[e]));return Promise.all(t)})).then((function(r){return e.traverse((function(e){if(!e.isMesh)return;const i=[],s=[];for(let e=0,o=r.length;e<o;e++){const o=r[e];if(o){i.push(o);const r=new t.Matrix4;void 0!==n.inverseBindMatrices&&r.fromArray(n.inverseBindMatrices.array,16*e),s.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[e])}e.bind(new t.Skeleton(i,s),e.matrixWorld)})),e}))})).then((function(e){n.add(e);const t=[];if(s.children){const n=s.children;for(let s=0,o=n.length;s<o;s++){const o=n[s];t.push(ws(o,e,r,i))}}return Promise.all(t)}))}function _s(e,n,r){const i=n.attributes,s=[];function o(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in i){const n=as[t]||t.toLowerCase();n in e.attributes||s.push(o(i[t],n))}if(void 0!==n.indices&&!e.index){const t=r.getDependency("accessor",n.indices).then((function(t){e.setIndex(t)}));s.push(t)}return fs(e,n),function(e,n,r){const i=n.attributes,s=new t.Box3;if(void 0===i.POSITION)return;{const e=r.json.accessors[i.POSITION],n=e.min,o=e.max;if(void 0===n||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new t.Vector3(n[0],n[1],n[2]),new t.Vector3(o[0],o[1],o[2])),e.normalized){const t=As(rs[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}const o=n.targets;if(void 0!==o){const e=new t.Vector3,n=new t.Vector3;for(let t=0,i=o.length;t<i;t++){const i=o[t];if(void 0!==i.POSITION){const t=r.json.accessors[i.POSITION],s=t.min,o=t.max;if(void 0!==s&&void 0!==o){if(n.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),n.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),n.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),t.normalized){const e=As(rs[t.componentType]);n.multiplyScalar(e)}e.max(n)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;const a=new t.Sphere;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=a}(e,n,r),Promise.all(s).then((function(){return void 0!==n.targets?function(e,t,n){let r=!1,i=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(r=!0),void 0!==n.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(e);const s=[],o=[];for(let a=0,l=t.length;a<l;a++){const l=t[a];if(r){const t=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):e.attributes.position;s.push(t)}if(i){const t=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):e.attributes.normal;o.push(t)}}return Promise.all([Promise.all(s),Promise.all(o)]).then((function(t){const n=t[0],s=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=s),e.morphTargetsRelative=!0,e}))}(e,n.targets,r):e}))}function xs(e,n){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const i=r.count-2,s=[];if(n===t.TriangleFanDrawMode)for(let e=1;e<=i;e++)s.push(r.getX(0)),s.push(r.getX(e)),s.push(r.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(s.push(r.getX(e)),s.push(r.getX(e+1)),s.push(r.getX(e+2))):(s.push(r.getX(e+2)),s.push(r.getX(e+1)),s.push(r.getX(e)));s.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(s),o}const Es={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Ss(e){const t=await fetch(e);if(t.ok)return t.json();throw new Error(t.statusText)}async function Ms(e,t,n=null,r=!0){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const i=await async function(e){if(!e)throw new Error("No basePath supplied");return await Ss(`${e}/profilesList.json`)}(t);let s;if(e.profiles.some((e=>{const n=i[e];return n&&(s={profileId:e,profilePath:`${t}/${n.path}`,deprecated:!!n.deprecated}),!!s})),!s){if(!n)throw new Error("No matching profile name found");const e=i[n];if(!e)throw new Error(`No matching profile name found and default profile "${n}" missing.`);s={profileId:n,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const o=await Ss(s.profilePath);let a;if(r){let t;if(t="any"===e.handedness?o.layouts[Object.keys(o.layouts)[0]]:o.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${s.profileId}`);t.assetPath&&(a=s.profilePath.replace("profile.json",t.assetPath))}return{profile:o,assetPath:a}}const Rs={xAxis:0,yAxis:0,button:0,state:Es.ComponentState.DEFAULT};class Ts{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Es.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Rs)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:r}){const{normalizedXAxis:i,normalizedYAxis:s}=function(e=0,t=0){let n=e,r=t;if(Math.sqrt(e*e+t*t)>1){const i=Math.atan2(t,e);n=Math.cos(i),r=Math.sin(i)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*r+.5}}(e,t);switch(this.componentProperty){case Es.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?i:.5;break;case Es.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?s:.5;break;case Es.ComponentProperty.BUTTON:this.value=this.states.includes(r)?n:0;break;case Es.ComponentProperty.STATE:this.valueNodeProperty===Es.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Cs{constructor(e,t){if(!(e&&t&&t.visualResponses&&t.gamepadIndices&&0!==Object.keys(t.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach((e=>{const n=new Ts(t.visualResponses[e]);this.visualResponses[e]=n})),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Es.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Es.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=Es.ComponentState.PRESSED:(t.touched||this.values.button>Es.ButtonTouchThreshold)&&(this.values.state=Es.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Es.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Es.AxisTouchThreshold&&(this.values.state=Es.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Es.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Es.AxisTouchThreshold&&(this.values.state=Es.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((e=>{e.updateFromComponent(this.values)}))}}class Is{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((e=>{const t=this.layoutDescription.components[e];this.components[e]=new Cs(e,t)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach((t=>{e.push(t.data)})),e}updateFromGamepad(){Object.values(this.components).forEach((e=>{e.updateFromGamepad(this.xrInputSource.gamepad)}))}}class Ds extends t.Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e||(this.envMap=e,this.traverse((e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}))),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((e=>{Object.values(e.visualResponses).forEach((e=>{const{valueNode:t,minNode:n,maxNode:r,value:i,valueNodeProperty:s}=e;t&&(s===Es.VisualResponseProperty.VISIBILITY?t.visible=i:s===Es.VisualResponseProperty.TRANSFORM&&(t.quaternion.slerpQuaternions(n.quaternion,r.quaternion,i),t.position.lerpVectors(n.position,r.position,i)))}))})))}}function Vs(e,n){!function(e,n){Object.values(e.components).forEach((e=>{const{type:r,touchPointNodeName:i,visualResponses:s}=e;if(r===Es.ComponentType.TOUCHPAD)if(e.touchPointNode=n.getObjectByName(i),e.touchPointNode){const n=new t.SphereGeometry(.001),r=new t.MeshBasicMaterial({color:255}),i=new t.Mesh(n,r);e.touchPointNode.add(i)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(s).forEach((e=>{const{valueNodeName:t,minNodeName:r,maxNodeName:i,valueNodeProperty:s}=e;if(s===Es.VisualResponseProperty.TRANSFORM){if(e.minNode=n.getObjectByName(r),e.maxNode=n.getObjectByName(i),!e.minNode)return void console.warn(`Could not find ${r} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${i} in the model`)}e.valueNode=n.getObjectByName(t),e.valueNode||console.warn(`Could not find ${t} in the model`)}))}))}(e.motionController,n),e.envMap&&n.traverse((t=>{t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)})),e.add(n)}class Ps{constructor(e=null){this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new Ii)}createControllerModel(e){const t=new Ds;let n=null;return e.addEventListener("connected",(e=>{const r=e.data;"tracked-pointer"===r.targetRayMode&&r.gamepad&&Ms(r,this.path,"generic-trigger").then((({profile:e,assetPath:i})=>{t.motionController=new Is(r,e,i);const s=this._assetCache[t.motionController.assetUrl];if(s)n=s.scene.clone(),Vs(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,(e=>{this._assetCache[t.motionController.assetUrl]=e,n=e.scene.clone(),Vs(t,n)}),null,(()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)}))}})).catch((e=>{console.warn(e)}))})),e.addEventListener("disconnected",(()=>{t.motionController=null,t.remove(n),n=null})),t}}class Fs extends t.EventDispatcher{constructor(e,t){super(),this.position=e,this.controller=t,this.movementSpeed=.5,this._isSelecting=!1,this._isSqueezing=!1;const n=xn(this,this.onSelectStart),r=xn(this,this.onSelectEnd),i=xn(this,this.onSqueezeStart),s=xn(this,this.onSqueezeEnd);this.controller.addEventListener("selectstart",n),this.controller.addEventListener("selectend",r),this.controller.addEventListener("squeezestart",i),this.controller.addEventListener("squeezeend",s)}onSelectStart(){this._isSelecting=!0}onSelectEnd(){this._isSelecting=!1}onSqueezeStart(){this._isSqueezing=!0}onSqueezeEnd(){this._isSqueezing=!1}update(e){if(this._isSelecting){const t=new o;this.controller.getWorldDirection(t),t.normalize().multiplyScalar(-this.movementSpeed*e),this.position.flow(t)}}}class Bs extends t.EventDispatcher{constructor(e,t){super(),this.position=e,this.controller=t,this._isSelecting=!1,this._isSqueezing=!1;const n=xn(this,this.onSelectStart),r=xn(this,this.onSelectEnd),i=xn(this,this.onSqueezeStart),s=xn(this,this.onSqueezeEnd);this.controller.addEventListener("selectstart",n),this.controller.addEventListener("selectend",r),this.controller.addEventListener("squeezestart",i),this.controller.addEventListener("squeezeend",s)}onSelectStart(){this._isSelecting=!0}onSelectEnd(){this._isSelecting=!1}onSqueezeStart(){this._isSqueezing=!0}onSqueezeEnd(){this._isSqueezing=!1}get update(){if(void 0===this._update){const e=10,n=new o,r=new o;let i=[],s=0,a=!1;this._update=function(l){const c=new o;if(this.controller.getWorldDirection(c),c.normalize().multiplyScalar(1/e),r.add(c),a&&r.sub(i[s]),i[s]=c,a&&this._isSelecting){const e=r.clone().normalize(),i=n.clone().normalize(),s=(new t.Quaternion).setFromUnitVectors(e,i).normalize();this.position.applyQuaternion(s)}n.copy(r),s=(s+1)%e,0===s&&(a=!0)}}return this._update}}function Ls(e,t,n){return class extends e{constructor(){super(t,n,...arguments)}}}class ks{constructor(){}element(){throw new Error("Group: this method should be implemented")}shader(e){throw new Error("Group: this method should be implemented")}}class Os extends Ur{constructor(e){super(e),this.fake=!0}identity(){return this}multiply(e){return this}premultiply(e){return this}invert(){return this}toIsometry(){return new n}equals(e){return!0}clone(){return new Os}copy(e){return this}}var Ns=r(9188),Gs=r.n(Ns);class Us extends ks{constructor(){super()}element(){return new Os(this)}shader(e){e.addChunk(Gs())}}var Hs=r(8008),zs=r.n(Hs);const js=/bool\s*(\w+)\(Point.*\)/m,Xs=/ExtVector\s*(\w+)\(ExtVector.*\)/m;class Qs{constructor(e,n,r,i,s,o){let a;if(this.set=e,this.uuid=t.MathUtils.generateUUID().replaceAll("-","_"),this.jsTest=n,this.glslTest=r,this.glslTestName=void 0,a=r.match(js),!a)throw new Error("Teleportation: unable to find the name of the GLSL test");if(this.glslTestName=a[1],this.elt=i,this.inv=void 0!==s?s:i.clone().invert(),this.glslCreepCustom=void 0,this.glslCreep=void 0,this.glslCreepName=void 0,void 0!==o){if(this.glslCreepCustom=!0,this.glslCreep=o,a=o.match(Xs),!a)throw new Error("Teleportation: unable to find the name of the GLSL creep");this.glslCreepName=a[1]}else this.glslCreepCustom=!1,this.glslCreepName=`creep${this.uuid}`,this.glslCreep=zs()(this)}get name(){return void 0===this._name&&(this._name=`teleportation_${this.uuid}`),this._name}get usesCreepingCustom(){return this.set.usesCreeping&&this.glslCreepCustom}get usesCreepingBinary(){return this.set.creepingType===$s&&!this.glslCreepCustom}shader(e){e.addChunk(this.glslTest),this.set.usesCreeping&&e.addChunk(this.glslCreep),e.addUniform(this.elt.name,"GroupElement",this.elt),e.addUniform(this.elt.name,"GroupElement",this.inv)}}var Ws=r(2792),qs=r.n(Ws),Zs=r(968),Ys=r.n(Zs);const Ks=0,Js=1,$s=2;class eo{constructor(e=[],t=!1,n=Ks){this.teleportations=[],this.neighbors=e,this.usesNearestNeighbors=t,this.creepingType=n}get usesCreeping(){return this.creepingType===Js||this.creepingType===$s}add(e,t,n,r,i){this.teleportations.push(new Qs(this,e,t,n,r,i));return this}get group(){return 0!==this.teleportations.length?this.teleportations[0].elt.group:new Us}shader(e){this.group.shader(e),e.addChunk(qs());for(const t of this.teleportations)t.shader(e);for(const t of this.neighbors)e.addUniform(t.elt.name,"GroupElement",t.elt),e.addUniform(t.inv.name,"GroupElement",t.inv);e.addChunk(Ys()(this))}}class to extends oi{constructor(e){super(),this.maxDirs=e}get isLight(){return!0}get isGlobal(){throw new Error("Generic: this method should be implemented")}get isLocal(){return!this.isGlobal}glslDirections(){throw new Error("Light: this method should be implemented")}glslInstance(){return this.glslDirections()}}const no=new eo;var ro=r(3496),io=r.n(ro),so=r(6077),oo=r.n(so);class ao extends ai{constructor(){super()}get uniformType(){return""}static glslClass(){return io()}glslRender(){return oo()(this)}}var lo=r(6045),co=r.n(lo),ho=r(8149),uo=r.n(ho);class po extends ai{constructor(e={}){super(),this.color=void 0!==e.color?e.color:new t.Color(1,1,1),this.ambient=void 0!==e.ambient?e.ambient:.5,this.diffuse=void 0!==e.diffuse?e.diffuse:.4,this.specular=void 0!==e.specular?e.specular:.1;const n=this.ambient+this.diffuse+this.specular;this.ambient=this.ambient/n,this.diffuse=this.diffuse/n,this.specular=this.specular/n,this.shininess=void 0!==e.shininess?e.shininess:10,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:new t.Color(0,0,0),this.lights=e.lights}get uniformType(){return"PhongMaterial"}get usesLight(){return!0}get isReflecting(){return!0}static glslClass(){return co()}glslRender(){return uo()(this)}shader(e){for(const t of this.lights)t.shader(e);super.shader(e)}}var mo=r(2197),fo=r.n(mo),bo=r(1215),vo=r.n(bo);class go extends ai{constructor(e,t,n,r){super(),this.dir1=e,this.dir2=t,this.color1=n,this.color2=r}get uniformType(){return"CheckerboardMaterial"}get usesNormal(){return!1}get usesUVMap(){return!0}static glslClass(){return fo()}glslRender(){return vo()(this)}}var Ao=r(7793),yo=r.n(Ao),wo=r(9909),_o=r.n(wo);class xo extends ai{constructor(){super()}get uniformType(){return""}get usesNormal(){return!1}get usesUVMap(){return!1}get usesLight(){return!1}get isReflecting(){return!1}static glslClass(){return yo()}glslRender(){return _o()(this)}shader(e){super.shader(e)}}var Eo=r(9095),So=r.n(Eo);class Mo extends ai{constructor(e,n={}){super(),this.sampler=(new t.TextureLoader).load(e),this.sampler.wrapS=void 0!==n.wrapS?n.wrapS:t.RepeatWrapping,this.sampler.wrapT=void 0!==n.wrapT?n.wrapT:t.RepeatWrapping,this.sampler.magFilter=t.LinearFilter,this.sampler.minFilter=t.LinearFilter,this.start=void 0!==n.start?n.start.clone():new t.Vector2(0,0),this.scale=void 0!==n.scale?n.scale.clone():new t.Vector2(1,1)}get uniformType(){return"SimpleTextureMaterial"}get usesNormal(){return!1}get usesUVMap(){return!0}static glslClass(){return So()}glslRender(){return vo()(this)}}var Ro=r(466);class To extends Mo{constructor(){super(Ro,{start:new t.Vector2(-Math.PI,0),scale:new t.Vector2(1/(2*Math.PI),1/Math.PI)})}}var Co=r(2971);class Io extends Mo{constructor(){super(Co,{start:new t.Vector2(-Math.PI,0),scale:new t.Vector2(1/(2*Math.PI),1/Math.PI)})}}var Do=r(5753);class Vo extends Mo{constructor(){super(Do,{start:new t.Vector2(-Math.PI,0),scale:new t.Vector2(1/(2*Math.PI),1/Math.PI)})}}var Po=r(8367);class Fo extends Mo{constructor(){super(Po,{start:new t.Vector2(-Math.PI,0),scale:new t.Vector2(1/(2*Math.PI),1/Math.PI)})}}var Bo=r(5836),Lo=r.n(Bo),ko=r(3838),Oo=r.n(ko),No=r(472),Go=r.n(No),Uo=r(8204),Ho=r.n(Uo),zo=r(7660),jo=r.n(zo);class Xo extends ai{constructor(e,n={}){super(),this.material=e,this.ambient=void 0!==n.ambient?n.ambient:.5,this.diffuse=void 0!==n.diffuse?n.diffuse:.5,this.specular=void 0!==n.specular?n.specular:.5,this.shininess=void 0!==n.shininess?n.shininess:10,this.reflectivity=void 0!==n.reflectivity?n.reflectivity:new t.Vector3(0,0,0),this.lights=n.lights}get uniformType(){return"PhongWrapMaterial"}static glslClass(){return Lo()}get usesNormal(){return!0}get usesUVMap(){return this.material.usesUVMap}get usesLight(){return!0}get isReflecting(){return!0}glslRender(){return this.material.usesNormal?this.material.usesUVMap?jo()(this):Go()(this):this.material.usesUVMap?Ho()(this):Oo()(this)}setId(e){this.material.setId(e),super.setId(e)}onAdd(e){this.material.onAdd(e),super.onAdd(e)}shader(e){this.material.shader(e);for(const t of this.lights)t.shader(e);super.shader(e)}}function Qo(e,t={}){return new Xo(e,t)}var Wo=r(7198),qo=r.n(Wo),Zo=r(1202),Yo=r.n(Zo),Ko=r(2330),Jo=r.n(Ko),$o=r(588),ea=r.n($o),ta=r(9040),na=r.n(ta),ra=r(1365),ia=r.n(ra);class sa extends pi{constructor(e,n){super(),this.material=e,this.emission=void 0!==n.emission?n.emission:new t.Color(0,0,0),this.volumeEmission=void 0!==n.volumeEmission?n.volumeEmission:new t.Color(0,0,0),this.opticalDepth=void 0!==n.opticalDepth?n.opticalDepth:0,this.specular=void 0!==n.specular?n.specular:new t.Color(1,1,1),this.absorb=void 0!==n.absorb?n.absorb:new t.Color(.1,.1,.1),this.ior=void 0!==n.ior?n.ior:1,this.roughness=void 0!==n.roughness?n.roughness:.2,this.reflectionChance=void 0!==n.reflectionChance?n.reflectionChance:.1,this.refractionChance=void 0!==n.refractionChance?n.refractionChance:0,this.diffuseChance=void 0!==n.diffuseChance?n.diffuseChance:.9;const r=this.reflectionChance+this.refractionChance+this.diffuseChance;this.reflectionChance=this.reflectionChance/r,this.refractionChance=this.refractionChance/r,this.diffuseChance=this.diffuseChance/r,this.addImport(Ai())}get uniformType(){return"PathTracerWrapMaterial"}static glslClass(){return qo()}get usesUVMap(){return this.material.usesUVMap}glslRender(){let e="";return e+=Yo()(this),this.material.usesNormal?this.material.usesUVMap?e+=ea()(this):e+=na()(this):this.material.usesUVMap?e+=ia()(this):e+=Jo()(this),e}setId(e){this.material.setId(e),super.setId(e)}onAdd(e){this.material.onAdd(e),super.onAdd(e)}shader(e){this.material.shader(e),super.shader(e)}}function oa(e,t={}){return new sa(e,t)}var aa=r(8266),la=r.n(aa);class ca extends oi{constructor(e){super(),this.isom=void 0!==e?e:new n,this.isomInv=this.isom.clone().invert(),this.parent=void 0,this._absoluteIsom=void 0,this._absoluteIsomInv=void 0}updateAbsoluteIsom(){void 0===this._absoluteIsom&&(this._absoluteIsom=new n,this._absoluteIsomInv=new n),this.isomInv=this.isom.clone().invert(),this._absoluteIsom.copy(this.isom),this._absoluteIsomInv.copy(this.isomInv),void 0!==this.parent&&(this._absoluteIsom.premultiply(this.parent.absoluteIsom),this._absoluteIsomInv.multiply(this.parent.absoluteIsomInv))}updateData(){this.updateAbsoluteIsom()}get absoluteIsom(){return void 0===this._absoluteIsom&&this.updateAbsoluteIsom(),this._absoluteIsom}get absoluteIsomInv(){return void 0===this._absoluteIsomInv&&this.updateAbsoluteIsom(),this._absoluteIsomInv}get isShape(){return!0}get isBasicShape(){throw new Error("Shape: this method should be implemented")}get isAdvancedShape(){return!this.isBasicShape}get isGlobal(){throw new Error("Shape: this method should be implemented")}get isLocal(){return!this.isGlobal}get hasUVMap(){return!1}glslSDF(){throw new Error("Shape: this method should be implemented")}glslGradient(){return la()(this)}glslUVMap(){throw new Error("Shape: this method should be implemented")}glslInstance(){let e=this.glslSDF()+"\r\n"+this.glslGradient();return this.hasUVMap&&(e=e+"\r\n"+this.glslUVMap()),e}}class da extends ca{constructor(e){super(e)}get isBasicShape(){return!1}}var ha=r(7939),ua=r.n(ha),pa=r(6142),ma=r.n(pa),fa=r(7260),ba=r.n(fa);class va extends da{constructor(e){super(),this.shape=e,this.shape.parent=this}updateAbsoluteIsom(){super.updateAbsoluteIsom(),this.shape.updateAbsoluteIsom()}updateData(){super.updateData(),this.shape.updateData()}get isGlobal(){return this.shape.isGlobal}get hasUVMap(){return this.shape.hasUVMap}static glslClass(){return""}glslSDF(){return ua()(this)}glslGradient(){return ma()(this)}glslUVMap(){return ba()(this)}setId(e){this.shape.setId(e),super.setId(e)}onAdd(e){this.shape.onAdd(e),super.onAdd(e)}shader(e){this.shape.shader(e),super.shader(e)}}function ga(e){return new va(e)}var Aa=r(2093),ya=r.n(Aa),wa=r(2076),_a=r.n(wa),xa=r(3335),Ea=r.n(xa),Sa=r(6428),Ma=r.n(Sa),Ra=r(6861),Ta=r.n(Ra),Ca=r(2905),Ia=r.n(Ca),Da=r(7333),Va=r.n(Da);const Pa=1;class Fa extends da{constructor(e,t,n={}){if(e.isGlobal!==t.isGlobal)throw new Error("IntersectionShape: the two shapes should be both local or both global");if(super(),this.shape1=e,this.shape2=t,this.shape1.parent=this,this.shape2.parent=this,this.maxType=void 0!==n.maxType?n.maxType:0,this.maxCoeff=0,this.maxType===Pa)this.addImport(ya()),this.maxCoeff=void 0!==n.maxCoeff?n.maxCoeff:.1}updateAbsoluteIsom(){super.updateAbsoluteIsom(),this.shape1.updateAbsoluteIsom(),this.shape2.updateAbsoluteIsom()}updateData(){super.updateData(),this.shape1.updateData(),this.shape2.updateData()}get uniformType(){return"IntersectionShape"}static glslClass(){return Va()}get isGlobal(){return this.shape1.isGlobal}get hasUVMap(){return this.shape1.hasUVMap&&this.shape2.hasUVMap}glslSDF(){return this.maxType===Pa?Ma()(this):_a()(this)}glslGradient(){return this.maxType===Pa?Ta()(this):Ea()(this)}glslUVMap(){return Ia()(this)}setId(e){this.shape1.setId(e),this.shape2.setId(e),super.setId(e)}onAdd(e){this.shape1.onAdd(e),this.shape2.onAdd(e),super.onAdd(e)}shader(e){this.shape1.shader(e),this.shape2.shader(e),super.shader(e)}}function Ba(){let e,t={};const n=arguments.length;if(0===n)throw new Error("union: the function expect at least one argument");arguments[n-1].isShape||(t=arguments[n-1]),e=arguments[0];for(let r=1;r<n;r++)arguments[r].isShape&&(e=new Fa(e,arguments[r],t));return e}var La=r(5442),ka=r.n(La),Oa=r(3908),Na=r.n(Oa),Ga=r(7762),Ua=r.n(Ga),Ha=r(7500),za=r.n(Ha),ja=r(3238),Xa=r.n(ja),Qa=r(519),Wa=r.n(Qa),qa=r(8655),Za=r.n(qa);const Ya=1;class Ka extends da{constructor(e,t,n={}){if(e.isGlobal!==t.isGlobal)throw new Error("UnionShape: the two shapes should be both local or both global");if(super(),this.shape1=e,this.shape2=t,this.shape1.parent=this,this.shape2.parent=this,this.minType=void 0!==n.minType?n.minType:0,this.minCoeff=0,this.minType===Ya)this.addImport(ka()),this.minCoeff=void 0!==n.minCoeff?n.minCoeff:.1}updateAbsoluteIsom(){super.updateAbsoluteIsom(),this.shape1.updateAbsoluteIsom(),this.shape2.updateAbsoluteIsom()}updateData(){super.updateData(),this.shape1.updateData(),this.shape2.updateData()}get uniformType(){return"UnionShape"}static glslClass(){return Wa()}get isGlobal(){return this.shape1.isGlobal}get hasUVMap(){return this.shape1.hasUVMap&&this.shape2.hasUVMap}glslSDF(){return this.minType===Ya?Xa()(this):Na()(this)}glslGradient(){return this.minType===Ya?Za()(this):Ua()(this)}glslUVMap(){return za()(this)}setId(e){this.shape1.setId(e),this.shape2.setId(e),super.setId(e)}onAdd(e){this.shape1.onAdd(e),this.shape2.onAdd(e),super.onAdd(e)}shader(e){this.shape1.shader(e),this.shape2.shader(e),super.shader(e)}}function Ja(){let e,t={};const n=arguments.length;if(0===n)throw new Error("union: the function expect at least one argument");arguments[n-1].isShape||(t=arguments[n-1]),e=arguments[0];for(let r=1;r<n;r++)arguments[r].isShape&&(e=new Ka(e,arguments[r],t));return e}var $a=r(3105),el=r.n($a),tl=r(6242),nl=r.n(tl),rl=r(9338),il=r.n(rl);class sl extends da{constructor(e,t){if(e.isGlobal!==t.isGlobal)throw new Error("WrapShape: the two shapes should be both local or both global");super(),this.wrap=e,this.shape=t,this.shape.parent=this,this.wrap.parent=this}updateAbsoluteIsom(){super.updateAbsoluteIsom(),this.shape.updateAbsoluteIsom(),this.wrap.updateAbsoluteIsom()}updateData(){super.updateData(),this.shape.updateData(),this.wrap.updateData()}get isWrapShape(){return!0}get isGlobal(){return this.shape.isGlobal}get hasUVMap(){return this.shape.hasUVMap}static glslClass(){return""}glslSDF(){return el()(this)}glslGradient(){return nl()(this)}glslUVMap(){return il()(this)}setId(e){this.wrap.setId(e),this.shape.setId(e),super.setId(e)}onAdd(e){this.wrap.onAdd(e),this.shape.onAdd(e),super.onAdd(e)}shader(e){this.wrap.shader(e),this.shape.shader(e),super.shader(e)}}function ol(e,t){return new sl(e,t)}class al{constructor(e="i"){this.action=void 0,this.key=e;const t=xn(this,this.onKeyDown);window.addEventListener("keydown",t,!1)}onKeyDown(e){e.key===this.key&&void 0!==this.action&&this.action()}}class ll{constructor(e,t,n){this.controller=e,this.camera=t,this.solid=n,this._isSelecting=!1,this._isSqueezing=!1;const r=xn(this,this.onSelectStart),i=xn(this,this.onSelectEnd),s=xn(this,this.onSqueezeStart),o=xn(this,this.onSqueezeEnd);this.controller.addEventListener("selectstart",r),this.controller.addEventListener("selectend",i),this.controller.addEventListener("squeezestart",s),this.controller.addEventListener("squeezeend",o)}onSelectStart(){this._isSelecting=!0}onSelectEnd(){this._isSelecting=!1}onSqueezeStart(){this._isSqueezing=!0}onSqueezeEnd(){this._isSqueezing=!1}chase(e){this.solid.isRendered=this._isSelecting;const n=(new o).setFromMatrixPosition(this.controller.matrixWorld);let r=new o;if(this.camera.isStereoOn){const n=e.getCamera(this.camera.threeCamera).cameras,i=(new t.Vector3).setFromMatrixPosition(n[Sn].matrixWorld),s=(new t.Vector3).setFromMatrixPosition(n[Mn].matrixWorld);r.lerpVectors(i,s,.5)}else r.setFromMatrixPosition(this.camera.matrix);const i=n.clone().sub(r),s=this.controller.matrixWorld.clone().setPosition(i),a=this.camera.position.clone().fakeDiffExpMap(s);this.solid.isom.copy(a.globalBoost),this.solid.isom.matrix.multiply(a.facing),this.solid.updateData()}}class cl{constructor(e="p"){this.actionKeyDown=void 0,this.actionKeyUp=void 0,this.key=e;const t=xn(this,this.onKeyDown),n=xn(this,this.onKeyUp);window.addEventListener("keydown",t,!1),window.addEventListener("keyup",n,!1)}onKeyDown(e){e.key===this.key&&void 0!==this.actionKeyDown&&this.actionKeyDown()}onKeyUp(e){e.key===this.key&&void 0!==this.actionKeyUp&&this.actionKeyUp()}}class dl{constructor(e,n,r,i){this.controller=e,this.camera=n,this.solids=r,this.speed=i,this._status=0,this._nextBullet=0,this._clock=new t.Clock;const s=xn(this,this.onSelectStart),o=xn(this,this.onSelectEnd);this.controller.addEventListener("selectstart",s),this.controller.addEventListener("selectend",o)}onSelectStart(){0===this._status&&(this._status=1)}onSelectEnd(){}shoot(e){const t=this.solids[this._nextBullet];t.bulletData={time:this._clock.getElapsedTime(),position:e},t.isRendered=!0,this._nextBullet=(this._nextBullet+1)%this.solids.length}updateBullet(e){const t=this.solids[e];if(t.hasOwnProperty("bulletData")){const e=this._clock.getElapsedTime()-t.bulletData.time,n=t.bulletData.position.clone().flow(new o(0,0,-this.speed*e));t.isom.copy(n.boost),t.updateData()}}updateAllBullets(){for(let e=0;e<this.solids.length;e++)this.updateBullet(e)}update(e){if(1===this._status){const n=(new o).setFromMatrixPosition(this.controller.matrixWorld);let r=new o;if(this.camera.isStereoOn){const n=e.getCamera(this.camera.threeCamera).cameras,i=(new t.Vector3).setFromMatrixPosition(n[Sn].matrixWorld),s=(new t.Vector3).setFromMatrixPosition(n[Mn].matrixWorld);r.lerpVectors(i,s,.5)}else r.setFromMatrixPosition(this.camera.matrix);const i=n.clone().sub(r),s=this.controller.matrixWorld.clone().setPosition(i),a=this.camera.position.clone().fakeDiffExpMap(s);this.shoot(a.globalPosition),this._status=0}this.updateAllBullets()}}class hl{constructor(e="p",t=2,n=0){this.key=e,this.stateNumber=t,this.state=n,this.justChanged=!1;const r=xn(this,this.onKeyDown);window.addEventListener("keydown",r,!1)}onKeyDown(e){e.key===this.key&&(this.state=(this.state+1)%this.stateNumber,this.justChanged=!0)}}class ul{constructor(e,t,n){this.controller=e,this.camera=t,this.light=n}chase(e){const n=(new o).setFromMatrixPosition(this.controller.matrixWorld);let r=new o;if(this.camera.isStereoOn){const n=e.getCamera(this.camera.threeCamera).cameras,i=(new t.Vector3).setFromMatrixPosition(n[Sn].matrixWorld),s=(new t.Vector3).setFromMatrixPosition(n[Mn].matrixWorld);r.lerpVectors(i,s,.5)}else r.setFromMatrixPosition(this.camera.matrix);const i=n.clone().sub(r),a=this.controller.matrixWorld.clone().setPosition(i),l=this.camera.position.clone().fakeDiffExpMap(a);this.light.position=(new s).applyIsometry(l.globalBoost)}}class pl{constructor(e,t,n=!1,r){if(this.position=e,this.controller=t,this._reset=0,this._alignFacing=n,this._camera=r,this._alignFacing&&void 0===r)throw new Error("VRControlsReset.constructor, the camera is needed when the alignFacing option is on");const i=xn(this,this.onSelectStart),s=xn(this,this.onSelectEnd);this.controller.addEventListener("selectstart",i),this.controller.addEventListener("selectend",s)}onSelectStart(){this._reset=1}onSelectEnd(){}update(){if(1===this._reset){if(this.position.reset(),this._alignFacing){const e=this._camera.threeCamera.matrixWorld;this.position.local.quaternion.setFromRotationMatrix(e),this.position.local.quaternion.invert()}this._reset=0}}}class ml{constructor(e,t=0,n=0){this.ring=e,this.a=t,this.b=n,this.reduce()}reduce(){return this.a=Math.round(this.a),this.b=Math.round(this.b),this}negate(){return this.a=-this.a,this.b=-this.b,this}multiply(e){const t=this.a,n=this.b;return this.a=t*e.a+this.ring.d*n*e.b,this.b=t*e.b+n*e.a,this.reduce()}add(e){return this.a=this.a+e.a,this.b=this.b+e.b,this.reduce()}sub(e){return this.a=this.a-e.a,this.b=this.b-e.b,this.reduce()}sum(){this.copy(this.ring.zero);for(const e of arguments)this.add(e);return this}product(){this.copy(this.ring.one);for(const e of arguments)this.multiply(e);return this}addProduct(){const e=new ml(this.ring).product(...arguments);return this.add(e),this}subProduct(){const e=new ml(this.ring).product(...arguments);return this.sub(e),this}toNumber(){return this.a+this.b*Math.sqrt(this.ring.d)}equals(e){return this.a===e.a&&this.b===e.b}isZero(){return 0===this.a&&0===this.b}clone(){const e=new ml(this.ring);return e.a=this.a,e.b=this.b,e}copy(e){return this.a=e.a,this.b=e.b,this}toLog(){return`${this.a} + ${this.b} _rD`}}var fl=r(5688),bl=r.n(fl);class vl{constructor(e){this.ring=e,this.elements=[this.ring.one.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.one.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.one.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.one.clone()]}get isQuadRingMatrix4(){return!0}get a(){const e=this.toArray().map((e=>e.a));return(new t.Matrix4).fromArray(e)}get b(){const e=this.toArray().map((e=>e.b));return(new t.Matrix4).fromArray(e)}getEntry(e,t){return this.elements[4*t+e]}setEntry(e,t,n){return this.elements[4*t+e].copy(n),this}set(e,t,n,r,i,s,o,a,l,c,d,h,u,p,m,f){for(let e=0;e<4;e++)for(let t=0;t<4;t++)this.setEntry(e,t,arguments[4*e+t]);return this}identity(){return this.elements=[this.ring.one.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.one.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.one.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.zero.clone(),this.ring.one.clone()],this}multiplyMatrices(e,t){for(let n=0;n<4;n++)for(let r=0;r<4;r++){this.setEntry(n,r,this.ring.zero);for(let i=0;i<4;i++)this.getEntry(n,r).addProduct(e.getEntry(n,i),t.getEntry(i,r))}return this}multiply(e){return this.multiplyMatrices(this.clone(),e)}premultiply(e){return this.multiplyMatrices(e,this.clone())}multiplyScalar(e){for(let t=0;t<16;t++)this.elements[t].multiply(e);return this}transpose(){const e=this.elements;let t=this.ring.element();return t.copy(e[1]),e[1].copy(e[4]),e[4].copy(t),t.copy(e[2]),e[2].copy(e[8]),e[8].copy(t),t.copy(e[6]),e[6].copy(e[9]),e[9].copy(t),t.copy(e[3]),e[3].copy(e[12]),e[12].copy(t),t.copy(e[7]),e[7].copy(e[13]),e[13].copy(t),t.copy(e[11]),e[11].copy(e[14]),e[14].copy(t),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],d=e[9],h=e[10],u=e[11],p=e[12],m=e[13],f=e[14],b=e[15];return e[0]=this.ring.element().addProduct(d,f,l).subProduct(m,h,l).addProduct(m,a,u).subProduct(o,f,u).subProduct(d,a,b).addProduct(o,h,b),e[1]=this.ring.element().addProduct(m,h,i).subProduct(d,f,i).subProduct(m,r,u).addProduct(n,f,u).addProduct(d,r,b).subProduct(n,h,b),e[2]=this.ring.element().addProduct(o,f,i).subProduct(m,a,i).addProduct(m,r,l).subProduct(n,f,l).subProduct(o,r,b).addProduct(n,a,b),e[3]=this.ring.element().addProduct(d,a,i).subProduct(o,h,i).subProduct(d,r,l).addProduct(n,h,l).addProduct(o,r,u).subProduct(n,a,u),e[4]=this.ring.element().addProduct(p,h,l).subProduct(c,f,l).subProduct(p,a,u).addProduct(s,f,u).addProduct(c,a,b).subProduct(s,h,b),e[5]=this.ring.element().addProduct(c,f,i).subProduct(p,h,i).addProduct(p,r,u).subProduct(t,f,u).subProduct(c,r,b).addProduct(t,h,b),e[6]=this.ring.element().addProduct(p,a,i).subProduct(s,f,i).subProduct(p,r,l).addProduct(t,f,l).addProduct(s,r,b).subProduct(t,a,b),e[7]=this.ring.element().addProduct(s,h,i).subProduct(c,a,i).addProduct(c,r,l).subProduct(t,h,l).subProduct(s,r,u).addProduct(t,a,u),e[8]=this.ring.element().addProduct(c,m,l).subProduct(p,d,l).addProduct(p,o,u).subProduct(s,m,u).subProduct(c,o,b).addProduct(s,d,b),e[9]=this.ring.element().addProduct(p,d,i).subProduct(c,m,i).subProduct(p,n,u).addProduct(t,m,u).addProduct(c,n,b).subProduct(t,d,b),e[10]=this.ring.element().addProduct(s,m,i).subProduct(p,o,i).addProduct(p,n,l).subProduct(t,m,l).subProduct(s,n,b).addProduct(t,o,b),e[11]=this.ring.element().addProduct(c,o,i).subProduct(s,d,i).subProduct(c,n,l).addProduct(t,d,l).addProduct(s,n,u).subProduct(t,o,u),e[12]=this.ring.element().addProduct(p,d,a).subProduct(c,m,a).subProduct(p,o,h).addProduct(s,m,h).addProduct(c,o,f).subProduct(s,d,f),e[13]=this.ring.element().addProduct(c,m,r).subProduct(p,d,r).addProduct(p,n,h).subProduct(t,m,h).subProduct(c,n,f).addProduct(t,d,f),e[14]=this.ring.element().addProduct(p,o,r).subProduct(s,m,r).subProduct(p,n,a).addProduct(t,m,a).addProduct(s,n,f).subProduct(t,o,f),e[15]=this.ring.element().addProduct(s,d,r).subProduct(c,o,r).addProduct(c,n,a).subProduct(t,d,a).subProduct(s,n,h).addProduct(t,o,h),this}equals(e){for(let t=0;t<16;t++)if(!this.elements[t].equals(e.elements[t]))return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n].copy(e[n+t]);return this}toArray(e=[],t=0){const n=this.elements;for(let r=0;r<16;r++)e[t+r]=n[r].clone();return e}toMatrix4(){const e=this.toArray().map((e=>e.toNumber()));return(new t.Matrix4).fromArray(e)}clone(){return new vl(this.ring).fromArray(this.elements)}copy(e){return this.fromArray(e.elements)}toLog(){return this.toMatrix4().toLog()}}class gl{constructor(e){this.d=e}element(e=0,t=0){return new ml(this,e,t)}matrix4(){return new vl(this)}get one(){return new ml(this,1)}get zero(){return new ml(this,0)}shader(e){e.addChunk(bl()),e.addConstant("QUAD_RING_D","int",this.d)}}class Al{constructor(){this.elements=[1,0,0,1]}set(e,t,n,r){return this.elements=[e,n,t,r],this}identity(){return this.set(1,0,0,1),this}multplyMatrices(e,t){const[n,r,i,s]=e.elements,[o,a,l,c]=t.elements;return this.elements=[n*o+i*a,r*o+s*a,n*l+i*c,r*l+s*c],this}multiply(e){return this.multplyMatrices(this,e)}premultiply(e){return this.multplyMatrices(e,this)}power(e){if(e<0)return this.invert().power(-e);if(0===e)return this.identity();if(1===e)return this;if(e%2==0)return this.power(e/2),this.multiply(this);{const t=this.clone();return this.power(e-1),this.multiply(t)}}determinant(){const[e,t,n,r]=this.elements;return e*r-n*t}invert(){const[e,t,n,r]=this.elements,i=this.determinant();return this.elements=[r/i,-t/i,-n/i,e/i],this}clone(){const e=new Al;for(let t=0;t<4;t++)e.elements[t]=this.elements[t];return e}copy(e){for(let t=0;t<4;t++)this.elements[t]=e.elements[t];return this}equals(e){for(let t=0;t<4;t++)if(this.elements[t]!==e.elements[t])return!1;return!0}}class yl extends Ur{constructor(e){super(e),this.isom=new n}identity(){return this.isom.identity(),this}multiply(e){return this.isom.multiply(e.isom),this}premultiply(e){return this.isom.premultiply(e.isom),this}invert(){return this.isom.invert(),this}toIsometry(){return this.isom.clone()}equals(e){return this.isom.equals(e.isom)}clone(){const e=new yl;return e.isom.copy(this.isom),e}copy(e){return this.isom.copy(e.isom),this}}var wl=r(6097),_l=r.n(wl);class xl extends ks{constructor(){super()}element(){return new yl(this)}shader(e){e.addChunk(_l())}}r(7802);(new t.Matrix3).set(2,1,0,1,1,0,0,0,1);const El=.5*(1+Math.sqrt(5)),Sl=1/(El+2),Ml=2*Math.log(El);const Rl=new xl,Tl=new t.Vector4(El,-1,0,0),Cl=new t.Vector4(1,El,0,0),Il=new t.Vector4(0,0,1/Ml,0);const Dl=`//\nbool testXp(Point p){\n    vec4 normal = vec4(${El}, -1, 0, 0);\n    return dot(p.coords, normal) > 0.5;\n}\n`;const Vl=`//\nbool testXn(Point p){\n    vec4 normal = vec4(${El}, -1, 0, 0);\n    return dot(p.coords, normal) < -0.5;\n}\n`;const Pl=`//\nbool testYp(Point p){\n    vec4 normal = vec4(1, ${El}, 0, 0);\n    return dot(p.coords, normal) > 0.5;\n}\n`;const Fl=`//\nbool testYn(Point p){\n    vec4 normal = vec4(1, ${El}, 0, 0);\n    return dot(p.coords, normal) < -0.5;\n}\n`;const Bl=`//\nbool testZp(Point p){\n    vec4 normal = vec4(0, 0, ${1/Ml}, 0);\n    return dot(p.coords, normal) > 0.5;\n}\n`;const Ll=`//\nbool testZn(Point p){\n    vec4 normal = vec4(0, 0, ${1/Ml}, 0);\n    return dot(p.coords, normal) < -0.5;\n}\n`,kl=Rl.element(),Ol=Rl.element(),Nl=Rl.element(),Gl=Rl.element(),Ul=Rl.element(),Hl=Rl.element();kl.isom.makeTranslation(new s(-El*Sl,Sl,0,1)),Ol.isom.makeTranslation(new s(El*Sl,-Sl,0,1)),Nl.isom.makeTranslation(new s(-Sl,-El*Sl,0,1)),Gl.isom.makeTranslation(new s(Sl,El*Sl,0,1)),Ul.isom.makeTranslation(new s(0,0,-Ml,1)),Hl.isom.makeTranslation(new s(0,0,Ml,1));const zl=(new eo).add((function(e){return e.coords.dot(Il)>.5}),Bl,Ul,Hl).add((function(e){return e.coords.dot(Il)<-.5}),Ll,Hl,Ul).add((function(e){return e.coords.dot(Tl)>.5}),Dl,kl,Ol).add((function(e){return e.coords.dot(Tl)<-.5}),Vl,Ol,kl).add((function(e){return e.coords.dot(Cl)>.5}),Pl,Nl,Gl).add((function(e){return e.coords.dot(Cl)<-.5}),Fl,Gl,Nl);r(1360);const jl=.5*(1+Math.sqrt(5)),Xl=1/(jl+2);const Ql=new xl,Wl=new t.Vector4(jl,-1,0,0),ql=new t.Vector4(1,jl,0,0);const Zl=`//\nbool testXp(Point p){\n    vec4 normal = vec4(${jl}, -1, 0, 0);\n    return dot(p.coords, normal) > 0.5;\n}\n`;const Yl=`//\nbool testXn(Point p){\n    vec4 normal = vec4(${jl}, -1, 0, 0);\n    return dot(p.coords, normal) < -0.5;\n}\n`;const Kl=`//\nbool testYp(Point p){\n    vec4 normal = vec4(1, ${jl}, 0, 0);\n    return dot(p.coords, normal) > 0.5;\n}\n`;const Jl=`//\nbool testYn(Point p){\n    vec4 normal = vec4(1, ${jl}, 0, 0);\n    return dot(p.coords, normal) < -0.5;\n}\n`,$l=Ql.element(),ec=Ql.element(),tc=Ql.element(),nc=Ql.element();$l.isom.makeTranslation(new s(-jl*Xl,Xl,0,1)),ec.isom.makeTranslation(new s(jl*Xl,-Xl,0,1)),tc.isom.makeTranslation(new s(-Xl,-jl*Xl,0,1)),nc.isom.makeTranslation(new s(Xl,jl*Xl,0,1));const rc=(new eo).add((function(e){return e.coords.dot(Wl)>.5}),Zl,$l,ec).add((function(e){return e.coords.dot(Wl)<-.5}),Yl,ec,$l).add((function(e){return e.coords.dot(ql)>.5}),Kl,tc,nc).add((function(e){return e.coords.dot(ql)<-.5}),Jl,nc,tc),ic=new xl,sc=1.01;const oc=ic.element(),ac=ic.element();oc.isom.matrix.set(Math.exp(-1.01),0,0,0,0,Math.exp(sc),0,0,0,0,1,-1.01,0,0,0,1),ac.isom.matrix.set(Math.exp(sc),0,0,0,0,Math.exp(-1.01),0,0,0,0,1,sc,0,0,0,1);const lc=(new eo).add((function(e){return e.coords.z>.505}),"//\nbool testZp(Point p){\n    return p.coords.z > 0.505;\n}\n",oc,ac).add((function(e){return e.coords.z<-.505}),"//\nbool testZn(Point p){\n    return p.coords.z < -0.505;\n}\n",ac,oc);var cc=r(6010),dc=r.n(cc),hc=r(7577),uc=r.n(hc);class pc extends to{constructor(e,t=1,n=1){super(1),this.color=e,this.intensity=t,this.direction=n}get isGlobal(){return!0}get uniformType(){return"ZSun"}static glslClass(){return dc()}glslDirections(){return uc()(this)}}var mc=r(3573),fc=r.n(mc);class bc extends to{constructor(e,t=1,n){super(1),this.color=e,this.intensity=t,this.direction=n}get isGlobal(){return!0}get uniformType(){return"ConstDirLight"}static glslClass(){return fc()}glslDirections(){return uc()(this)}}var vc=r(3275),gc=r.n(vc);class Ac extends ai{constructor(e,t){super(),this.mainColor=e,this.weight=t}get uniformType(){return"VaryingColorMaterial"}get usesNormal(){return!1}static glslClass(){return gc()}glslRender(){return hi()(this)}}class yc extends ca{constructor(e){super(e)}get isBasicShape(){return!0}}var wc=r(2361),_c=r.n(wc),xc=r(3707),Ec=r.n(xc),Sc=r(5030),Mc=r.n(Sc);class Rc extends yc{constructor(e,t){const r=new n;if(e.isIsometry)r.copy(e);else{if(!e.isPoint)throw new Error("FakeBallShape: the type of location is not implemented");r.makeTranslation(e)}super(r),this.radius=t,this._center=void 0}updateData(){super.updateData(),this._center=(new s).applyIsometry(this.absoluteIsom)}get center(){return void 0===this._center&&this.updateData(),this._center}get isGlobal(){return!0}get isFakeBallShape(){return!0}get uniformType(){return"FakeBallShape"}static glslClass(){return _c()}glslSDF(){return Ec()(this)}glslGradient(){return Mc()(this)}}var Tc=r(6290),Cc=r.n(Tc);class Ic extends yc{constructor(e,t){const r=new n;if(e.isIsometry)r.copy(e);else{if(!e.isPoint)throw new Error("FakeBallShape: the type of location is not implemented");r.makeTranslation(e)}super(r),this.radius=t,this._center=void 0}updateData(){super.updateData(),this._center=(new s).applyIsometry(this.absoluteIsom)}get center(){return void 0===this._center&&this.updateData(),this._center}get isGlobal(){return!1}get isFakeBallShape(){return!0}get uniformType(){return"LocalFakeBallShape"}static glslClass(){return Cc()}glslSDF(){return Ec()(this)}glslGradient(){return Mc()(this)}}var Dc=r(5239),Vc=r.n(Dc),Pc=r(4355),Fc=r.n(Pc);class Bc extends yc{constructor(e){super(e),this._origin=void 0,this._test=void 0,this._uDir=void 0,this._vDir=void 0}updateData(){super.updateData(),this._origin=(new s).applyIsometry(this.absoluteIsom);const e=(new t.Matrix4).copy(this.absoluteIsomInv.matrix).transpose();this._test=new t.Vector4(0,0,1,0).applyMatrix4(e),this._uDir=new o(1,0,0).applyMatrix4(this.absoluteIsom.matrix),this._vDir=new o(0,1,0).applyMatrix4(this.absoluteIsom.matrix)}get origin(){return void 0===this._origin&&this.updateData(),this._origin}get test(){return void 0===this._test&&this.updateData(),this._test}get uDir(){return void 0===this._uDir&&this.updateData(),this._uDir}get vDir(){return void 0===this._vDir&&this.updateData(),this._vDir}get isGlobal(){return!0}get isZHalfSpaceShape(){return!0}get hasUVMap(){return!0}get uniformType(){return"ZHalfSpaceShape"}static glslClass(){return Vc()}glslSDF(){return Ec()(this)}glslGradient(){return Mc()(this)}glslUVMap(){return Fc()(this)}}var Lc=r(668),kc=r.n(Lc);class Oc extends yc{constructor(e){super(e),this._origin=void 0,this._testX=void 0,this._testZ=void 0,this._uDir=void 0,this._vDir=void 0}updateData(){super.updateData(),this._origin=(new s).applyIsometry(this.absoluteIsom);const e=(new t.Matrix4).copy(this.absoluteIsomInv.matrix).transpose();this._testX=new t.Vector4(1,0,0,0).applyMatrix4(e),this._testZ=new t.Vector4(0,0,1,0).applyMatrix4(e),this._uDir=new o(0,1,0).applyMatrix4(this.absoluteIsom.matrix),this._vDir=new o(0,0,1).applyMatrix4(this.absoluteIsom.matrix)}get origin(){return void 0===this._origin&&this.updateData(),this._origin}get testX(){return void 0===this._testX&&this.updateData(),this._testX}get testZ(){return void 0===this._testZ&&this.updateData(),this._testZ}get uDir(){return void 0===this._uDir&&this.updateData(),this._uDir}get vDir(){return void 0===this._vDir&&this.updateData(),this._vDir}get isGlobal(){return!0}get isXYHalfSpaceShape(){return!0}get hasUVMap(){return!0}get uniformType(){return"XYHalfSpaceShape"}static glslClass(){return kc()}glslSDF(){return Ec()(this)}glslGradient(){return Mc()(this)}glslUVMap(){return Fc()(this)}}var Nc=r(9583),Gc=r.n(Nc);class Uc extends yc{constructor(e){super(e),this._origin=void 0,this._test=void 0,this._uDir=void 0,this._vDir=void 0}updateData(){super.updateData(),this._origin=(new s).applyIsometry(this.absoluteIsom);const e=(new t.Matrix4).copy(this.absoluteIsomInv.matrix).transpose();this._test=new t.Vector4(0,0,1,0).applyMatrix4(e),this._uDir=new o(1,0,0).applyMatrix4(this.absoluteIsom.matrix),this._vDir=new o(0,1,0).applyMatrix4(this.absoluteIsom.matrix)}get origin(){return void 0===this._origin&&this.updateData(),this._origin}get test(){return void 0===this._test&&this.updateData(),this._test}get uDir(){return void 0===this._uDir&&this.updateData(),this._uDir}get vDir(){return void 0===this._vDir&&this.updateData(),this._vDir}get isGlobal(){return!1}get isLocalZHalfSpaceShape(){return!0}get hasUVMap(){return!0}get uniformType(){return"LocalZHalfSpaceShape"}static glslClass(){return Gc()}glslSDF(){return Ec()(this)}glslGradient(){return Mc()(this)}glslUVMap(){return Fc()(this)}}var Hc=r(1273),zc=r.n(Hc);class jc extends yc{constructor(e){super(e),this._origin=void 0,this._testX=void 0,this._testZ=void 0,this._uDir=void 0,this._vDir=void 0}updateData(){super.updateData(),this._origin=(new s).applyIsometry(this.absoluteIsom);const e=(new t.Matrix4).copy(this.absoluteIsomInv.matrix).transpose();this._testX=new t.Vector4(1,0,0,0).applyMatrix4(e),this._testZ=new t.Vector4(0,0,1,0).applyMatrix4(e),this._uDir=new o(0,1,0).applyMatrix4(this.absoluteIsom.matrix),this._vDir=new o(0,0,1).applyMatrix4(this.absoluteIsom.matrix)}get origin(){return void 0===this._origin&&this.updateData(),this._origin}get testX(){return void 0===this._testX&&this.updateData(),this._testX}get testZ(){return void 0===this._testZ&&this.updateData(),this._testZ}get uDir(){return void 0===this._uDir&&this.updateData(),this._uDir}get vDir(){return void 0===this._vDir&&this.updateData(),this._vDir}get isGlobal(){return!1}get isLocalXYHalfSpaceShape(){return!0}get hasUVMap(){return!0}get uniformType(){return"LocalXYHalfSpaceShape"}static glslClass(){return zc()}glslSDF(){return Ec()(this)}glslGradient(){return Mc()(this)}glslUVMap(){return Fc()(this)}}var Xc=r(9277),Qc=r.n(Xc);class Wc extends yc{constructor(e,r,i=.01){const s=new n;if(e.isIsometry)s.copy(e);else{if(!e.isPoint)throw new Error("FakeBallShape: the type of location is not implemented");s.makeTranslation(e)}super(s),r.isVector3?this.sides=r.clone():this.sides=new t.Vector3(r,r,r),this.addImport(ya()),this.smoothness=i,this._origin=void 0,this._testX=void 0,this._testY=void 0,this._testZ=void 0}updateData(){super.updateData(),this._origin=(new s).applyIsometry(this.absoluteIsom);const e=(new t.Matrix4).copy(this.absoluteIsomInv.matrix).transpose();this._testX=new t.Vector4(1,0,0,0).applyMatrix4(e),this._testY=new t.Vector4(0,1,0,0).applyMatrix4(e),this._testZ=new t.Vector4(0,0,1,0).applyMatrix4(e)}get testX(){return void 0===this._testX&&this.updateData(),this._testX}get testY(){return void 0===this._testY&&this.updateData(),this._testY}get testZ(){return void 0===this._testZ&&this.updateData(),this._testZ}get isGlobal(){return!1}get isLocalCube(){return!0}get uniformType(){return"LocalCube"}static glslClass(){return Qc()}glslSDF(){return Ec()(this)}glslGradient(){return Mc()(this)}}var qc=r(7499),Zc=r.n(qc);class Yc extends oi{constructor(e,t,n){if(!e.hasUVMap){if(t.usesUVMap)throw new Error("Solid: a material using UV coordinates cannot be applied to a shape without a UV map");if(void 0!==n&&n.usesUVMap)throw new Error("Solid: a material using UV coordinates cannot be applied to a shape without a UV map")}super(),this.shape=e,this.material=t,this.ptMaterial=n,this.isRendered=!0,this.addImport(Zc())}get isSolid(){return!0}get isom(){return this.shape.isom}get absoluteIsom(){return this.shape.absoluteIsom}get isGlobal(){return this.shape.isGlobal}get isLocal(){return this.shape.isLocal}get uniformType(){return"Solid"}updateData(){this.shape.updateData()}setId(e){this.shape.setId(e),this.material.setId(e),super.setId(e)}onAdd(e){this.shape.onAdd(e),this.material.onAdd(e),super.onAdd(e)}static glslClass(){return""}glslInstance(){return""}shader(e){this.shape.shader(e),3===e.useCase&&void 0!==this.ptMaterial?this.ptMaterial.shader(e):this.material.shader(e),super.shader(e)}}class Kc extends Yc{constructor(e,t,n,r){super(new Rc(e,t),n,r)}}class Jc extends Yc{constructor(e,t,n,r){super(new Ic(e,t),n,r)}}class $c extends Yc{constructor(e,t,n){super(new Bc(e),t,n)}}class ed extends Yc{constructor(e,t,n){super(new Oc(e),t,n)}}class td extends Yc{constructor(e,t,n){super(new Uc(e),t,n)}}class nd extends Yc{constructor(e,t,n){super(new Uc(e),t,n)}}class rd extends Yc{constructor(e,t,n,r,i){super(new Wc(e,t,n),r,i)}}const id=Tn(Q,d(),u()),sd=Tn(pe,d(),u()),od=Tn(Rn,d(),u()),ad=Ls(class{constructor(e,n,r,i={}){this.set=r,this.callback=void 0;const s=new Ri(new t.Color(0,0,0),.07);this.scene=new wi({fog:s}),this.camera=new Zr({set:this.set}),this.ptCamera=new si({set:this.set}),this.threeRenderer=new t.WebGLRenderer,this.threeRenderer.setClearColor(new t.Color(0,0,.2),1),document.body.appendChild(this.threeRenderer.domElement),this.renderer=new Q(e,n,this.set,this.camera,this.scene,{},this.threeRenderer),this.ptRenderer=new pe(e,n,this.set,this.ptCamera,this.scene,{},this.threeRenderer),this.currentRenderer=this.renderer,this.setSize(window.innerWidth,window.innerHeight),this._onWindowResize=xn(this,this.onWindowResize),window.addEventListener("resize",this._onWindowResize,!1),this.flyControls=new jr(this.camera,void 0!==i.keyboard?i.keyboard:"us"),this.clock=new t.Clock,this.stats=void 0,this.gui=void 0,this.pathTracerUI=void 0,this.onLoad()}onLoad(){const e=document.createElement("style");e.setAttribute("type","text/css"),e.textContent=Ci.trim(),document.head.appendChild(e),document.body.insertAdjacentHTML("beforeend",'\n<div id="thurstonDialogBoxWrap">\n    <div id="thurstonDialogBox">\n    <p>\n        Choose the resolution of the picture, and click on "Go".\n        You can download the image any time, with the "Download" button in the bottom right corner.\n        To leave the path tracer mode, hit \'p\'.\n    </p>\n        <form action="javascript:void(0);">\n            <label for="widthInput">Width :</label> <input id="widthInput" type="number"><br>\n            <label for="heightInput">Height:</label> <input id="heightInput" type="number"><br>\n            <input type="submit" value="Go!">\n        </form>\n    </div>\n</div>\n'),document.body.insertAdjacentHTML("beforeend",'\n<a id="thurstonDownloadButton" href="#">Download</a>\n')}setPixelRatio(e){this.renderer.setPixelRatio(e),this.ptRenderer.setPixelRatio(e)}setSize(e,t){this.renderer.setSize(e,t),this.ptRenderer.setSize(e,t)}initGUI(){this.gui=new Or,this.gui.close(),this.gui.add({help:function(){window.open("https://github.com/henryseg/non-euclidean_VR")}},"help").name("Help/About"),this.gui.add(this.flyControls,"keyboard",{QWERTY:"us",AZERTY:"fr"}).name("Keyboard");const e=this.gui.addFolder("Camera");return e.add(this.camera,"fov",45,120).name("Field of view"),e.add(this.camera,"maxDist",0,100,1).name("Max distance"),e.add(this.camera,"maxSteps",20,500,1).name("Max steps"),e.add(this.camera,"threshold").name("Threshold"),this}initStats(){return this.stats=new Gr,this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this}initPathTracerUI(){this.pathTracerUI=new Ti(this)}add(e){this.scene.add(...arguments)}onWindowResize(e){this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}switchRenderer(){this.currentRenderer.isBasicRenderer?(this.flyControls.pause(),window.removeEventListener("resize",this._onWindowResize),this.ptCamera.position.copy(this.camera.position),this.ptRenderer.iFrame=0,this.threeRenderer.setRenderTarget(this.ptRenderer.accReadTarget),this.threeRenderer.clear(),this.currentRenderer=this.ptRenderer):(this.flyControls.restore(),window.addEventListener("resize",this._onWindowResize),this.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.currentRenderer=this.renderer)}animate(){const e=this.clock.getDelta();void 0!==this.callback&&this.callback(),this.flyControls.update(e),this.currentRenderer.render(),this.stats.update()}run(){this.initStats(),this.initGUI(),this.initPathTracerUI(),this.renderer.build(),this.ptRenderer.build();const e=xn(this,this.animate);this.threeRenderer.setAnimationLoop(e)}},d(),u()),ld=Ls(class{constructor(e,n,r,i={}){this.set=r,this.callback=void 0;const s=new Ri(new t.Color(0,0,0),.07);this.scene=new wi({fog:s}),this.camera=new Zr({set:this.set}),this.renderer=new Q(e,n,this.set,this.camera,this.scene,{}),this.setPixelRatio(window.devicePixelRatio),this.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(new t.Color(0,0,.2),1),document.body.appendChild(this.renderer.domElement);const o=xn(this,this.onWindowResize);window.addEventListener("resize",o,!1),this.flyControls=new jr(this.camera,void 0!==i.keyboard?i.keyboard:"us"),this.clock=new t.Clock,this.stats=void 0,this.gui=void 0}setPixelRatio(e){this.renderer.setPixelRatio(e)}setSize(e,t){this.renderer.setSize(e,t)}initGUI(){this.gui=new Or,this.gui.close(),this.gui.add({help:function(){window.open("https://github.com/henryseg/non-euclidean_VR")}},"help").name("Help/About"),this.gui.add(this.flyControls,"keyboard",{QWERTY:"us",AZERTY:"fr"}).name("Keyboard");const e=this.gui.addFolder("Camera");return e.add(this.camera,"fov",45,120).name("Field of view"),e.add(this.camera,"maxDist",0,100,1).name("Max distance"),e.add(this.camera,"maxSteps",20,500,1).name("Max steps"),e.add(this.camera,"threshold").name("Threshold"),this}initStats(){return this.stats=new Gr,this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this}add(e){this.scene.add(...arguments)}onWindowResize(e){this.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}animate(){const e=this.clock.getDelta();this.flyControls.update(e),this.renderer.render(),void 0!==this.callback&&this.callback(),this.stats.update()}run(){this.initStats(),this.initGUI(),this.renderer.build();const e=xn(this,this.animate);this.renderer.threeRenderer.setAnimationLoop(e)}},d(),u()),cd=Ls(class{constructor(e,n,r,i={}){this.set=r,this.callback=void 0,this.camera=void 0!==i.camera?i.camera:new ei({set:this.set});const s=new Ri(new t.Color(0,0,0),.07);this.scene=new wi({fog:s}),this.renderer=new Rn(e,n,this.set,this.camera,this.scene),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(new t.Color(0,0,.2),1),document.body.appendChild(this.renderer.domElement);const o=xn(this,this.onWindowResize);window.addEventListener("resize",o,!1),this.flyControls=new jr(this.camera,void 0!==i.keyboard?i.keyboard:"us"),this.clock=new t.Clock,this.stats=void 0,this.gui=void 0;const a=new Ps,l=this.renderer.xr.getControllerGrip(0),c=a.createControllerModel(l);l.add(c),this.renderer.threeScene.add(l);const d=this.renderer.xr.getControllerGrip(1),h=a.createControllerModel(d);d.add(h),this.renderer.threeScene.add(d);const u=this.renderer.xr.getController(0);this.renderer.threeScene.add(u);const p=this.renderer.xr.getController(1);this.renderer.threeScene.add(p),this.VRControlsMove=new Fs(this.camera.position,u),this.VRControlsDrag=new Bs(this.camera.position,p)}initGUI(){this.gui=new Or,this.gui.close(),this.gui.add({help:function(){window.open("https://github.com/henryseg/non-euclidean_VR")}},"help").name("Help/About"),this.gui.add(this.flyControls,"keyboard",{QWERTY:"us",AZERTY:"fr"}).name("Keyboard");const e=this.gui.addFolder("Camera");return e.add(this.camera,"fov",45,120).name("Field of view"),e.add(this.camera,"maxDist",0,100,1).name("Max distance"),e.add(this.camera,"maxSteps",20,500,1).name("Max steps"),e.add(this.camera,"threshold").name("Threshold"),this}initStats(){return this.stats=new Gr,this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this}add(e){this.scene.add(...arguments)}onWindowResize(e){this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}animate(){const e=this.clock.getDelta();void 0!==this.callback&&this.callback(),this.flyControls.update(e),this.VRControlsMove.update(e),this.VRControlsDrag.update(e),this.renderer.render(),this.stats.update()}run(){this.initStats(),this.initGUI(),this.renderer.build();const e=xn(this,this.animate);this.renderer.setAnimationLoop(e)}},d(),u())})();var s=i.QU,o=i.ZH,a=i.K9,l=i.cK,c=i._x,d=i.kj,h=i.Vz,u=i.Iy,p=i.Vf,m=i.TB,f=i.Al,b=i.KO,v=i.c$,g=i.OZ,A=i.Ao,y=i.mD,w=i.yb,_=i.ZA,x=i.Jz,E=i.HZ,S=i.TN,M=i.JV,R=i.Sc,T=i.Nh,C=i.RL,I=i._k,D=i.uR,V=i.EB,P=i.Zs,F=i.oR,B=i.lt,L=i.mU,k=i.Vh,O=i.Qc,N=i.Q9,G=i.Qv,U=i.F5,H=i.Uc,z=i.Yu,j=i.Fh,X=i.oB,Q=i.pJ,W=i.GW,q=i.DZ,Z=i._K,Y=i.JF,K=i.Lv,J=i.E9,$=i.Ly,ee=i.jo,te=i.mH,ne=i.xd,re=i.pX,ie=i.Dz,se=i.Uj,oe=i.cV,ae=i.lR,le=i.xs,ce=i.oC,de=i.h8,he=i.Qf,ue=i._D,pe=i.$p,me=i.xG,fe=i.qC,be=i.N$,ve=i.TO,ge=i.yI,Ae=i.E6,ye=i.zO,we=i.cB,_e=i.OW,xe=i.$9,Ee=i.iR,Se=i.Y2,Me=i.ot,Re=i.JX,Te=i.fr,Ce=i.t2,Ie=i.ak,De=i.Cy,Ve=i.M3,Pe=i.jV,Fe=i.jS,Be=i.wS,Le=i.IJ,ke=i.p2,Oe=i.dV,Ne=i.G0,Ge=i.re,Ue=i.xS;export{s as BasicCamera,o as BasicPTMaterial,a as BasicRenderer,l as CREEPING_FULL,c as CREEPING_OFF,d as CREEPING_STRICT,h as CheckerboardMaterial,u as ComplementShape,p as ConstDirLight,m as DebugMaterial,f as DragVRControls,b as EarthTexture,v as ExpFog,g as FakeBall,A as FakeBallShape,y as FlyControls,w as Fog,_ as Group,x as GroupElement,E as InfoControls,S as IntersectionShape,M as Isometry,R as IsotropicChaseVRControls,T as KeyGenericControls,C as LEFT,I as Light,D as LightVRControls,V as LocalCube,P as LocalCubeShape,F as LocalFakeBall,B as LocalFakeBallShape,L as LocalXYHalfSpace,k as LocalXYHalfSpaceShape,O as LocalZHalfSpace,N as LocalZHalfSpaceShape,G as MarsTexture,U as Material,H as Matrix2,z as MoonTexture,j as MoveVRControls,X as NormalMaterial,Q as PTMaterial,W as PathTracerCamera,q as PathTracerRenderer,Z as PathTracerWrapMaterial,Y as PhongMaterial,K as PhongWrapMaterial,J as Point,$ as Position,ee as QuadRing,te as QuadRingElement,ne as QuadRingMatrix4,re as RIGHT,ie as RelPosition,se as ResetVRControls,oe as SMOOTH_MAX_POLY,ae as SMOOTH_MIN_POLY,le as Scene,ce as ShootVRControls,de as SingleColorMaterial,he as Solid,ue as SunTexture,pe as SwitchControls,me as TeleportationSet,fe as Thurston,be as ThurstonLite,ve as ThurstonVR,ge as UnionShape,Ae as VRCamera,ye as VRRenderer,we as VaryingColorMaterial,_e as Vector,xe as WrapShape,Ee as XRControllerModelFactory,Se as XYHalfSpace,Me as XYHalfSpaceShape,Re as ZHalfSpace,Te as ZHalfSpaceShape,Ce as ZSun,Ie as bind,De as complement,Ve as horizontalSet,Pe as intersection,Fe as mappingTorusSet,Be as pathTracerWrap,Le as phongWrap,ke as safeString,Oe as trivialSet,Ne as union,Ge as wrap,Ue as zLoopSet};